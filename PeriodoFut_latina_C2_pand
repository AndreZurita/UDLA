rm(list = ls()) #limpia los objetos 
graphics.off() #limpiar el dispositivo de graficas
gc() #limpiar la memoria virtual 
cat("\014") #limpiar la consola

start_time <- Sys.time()

library(tidyverse)
library(tidyr)
library(benford)
library(readxl)
library(benford.analysis)
library(janitor)
library(data.table)
library(plyr)
library(reshape2)
library(ggridges)
library(ggplot2)
library(viridis)
library(hrbrthemes)
library(readxl)
library(ggExtra)
library(dplyr)
library(ggplotlyExtra)
library(ggplot2)
library(plotly)
library(zoo)
library(xts)
library(tsbox)
library(streamgraph)
library(devtools)
library(rgdal) #readOGR
library(RColorBrewer)
library(classInt)
library(raster)
library(sqldf)
library(RColorBrewer)
library(writexl)
library(tidyverse)
library(stringr)
library(igraph)
library(rapport)
library(rapportools)
library(tcltk2)
library(CINNA)
library(psych)
library(PerformanceAnalytics)
library(Hmisc)
library(DataExplorer)
library(networkD3)
library(DataCombine)
#------------------------------------------------------------------------------
#PERIODO FUTURO CR 
#COORDINACION DE PROYECTOS
#INTELIGENCIA DE LA INFORMACION 
#UDLA
#------------------------------------------------------------------------------



##################### TRABAJO EN BASE ULATINA ############################

setwd("C:/Users/ritaz/OneDrive - Universidad de Las Américas")
pf_latina <- read_excel("COORDINACION DE PROYECTOS/CurriculumPers/mat_hist_1c_CR.xlsx", sheet = "Ulatina (NUEVOS PUROS)")

#Solo 1 cuatrimestre

pf_latina <- filter(pf_latina, BLOQUE == "I Cuatrimestre")

#En pandemia

pf_latina <- filter(pf_latina, TIPO_JORNADA == "JORNADA EN PANDEMIA ( VIRTUAL )")

#Solo periodos 1

pf_latina <- filter(pf_latina, PERIODO == 2)

names(pf_latina)[15] <- "sede"
names(pf_latina)[12] <- "carrera"
names(pf_latina)[19] <- "cod_padre"
names(pf_latina)[20] <- "cod_hijo"

#Aquellos que no tienen en su codigo padre registro, lo registraremos como hijo

pf_latina$cod_padre[is.na(pf_latina$cod_padre)] <- pf_latina$cod_hijo

pf_latina$carrera <- sub(".* - ", "", pf_latina$carrera)
pf_latina$sede <- sub(".* - ", "", pf_latina$sede)
pf_latina$sede <- sub(".*CAMPUS ", "", pf_latina$sede)
pf_latina$sede <- sub(".*SEDE ", "", pf_latina$sede)

#Cambio estructura de sedes

count(pf_latina$sede)

pf_latina$sede[pf_latina$sede == "CAÑAS"] <- "CANAS"
pf_latina$sede[pf_latina$sede == "CENTRAL SAN JOSE"] <- "SANJOSE"
pf_latina$sede[pf_latina$sede == "CIUDAD NEILY"] <- "NEILY"
pf_latina$sede[pf_latina$sede == "PEREZ ZELEDON"] <- "PEREZZELEDON"
pf_latina$sede[pf_latina$sede == "SANTA CRUZ"] <- "SANTACRUZ"

#Cambio estrucutura carreras

count(pf_latina$carrera)

pf_latina$carrera[pf_latina$carrera == "ADMINISTRACIÓN DE EMPRESAS HOTELERAS" ] <- "admin_hoteleria"
pf_latina$carrera[pf_latina$carrera == "ADMINISTRACIÓN DE NEGOCIOS" ] <- "admin_neg"
pf_latina$carrera[pf_latina$carrera == "ARQUITECTURA" ] <- "arquit"
pf_latina$carrera[pf_latina$carrera == "ARQUITECTURA Y URBANISMO" ] <- "arq_urb"
pf_latina$carrera[pf_latina$carrera == "BACHILLERATO EN ANIMACIÓN DIGITAL" ] <- "anim_dig"
pf_latina$carrera[pf_latina$carrera == "CIENCIAS BIOLÓGICAS" ] <- "c_biolo"
pf_latina$carrera[pf_latina$carrera == "CIENCIAS DE LA COMUNICACIÓN COLECTIVA" ] <- "c_com"
pf_latina$carrera[pf_latina$carrera == "CIENCIAS DE LA EDUCACIÓN" ] <- "educ"
pf_latina$carrera[pf_latina$carrera == "CIENCIAS DE LA EDUCACIÓN EN LA ENSEÑANZA CIENCIAS NATURALES" ] <- "educ_ccnn"
pf_latina$carrera[pf_latina$carrera == "CIENCIAS DE LA EDUCACIÓN PREESCOLAR" ] <- "educ_pre"
pf_latina$carrera[pf_latina$carrera == "COMUNICACIÓN DE MERCADEO" ] <- "com_mercadeo"
pf_latina$carrera[pf_latina$carrera == "COMUNICACIÓN DIGITAL" ] <- "com_dig"
pf_latina$carrera[pf_latina$carrera == "CONTADURÍA" ] <- "conta"
pf_latina$carrera[pf_latina$carrera == "CONTADURÍA PÚBLICA" ] <- "conta_pub"
pf_latina$carrera[pf_latina$carrera == "DERECHO" ] <- "derecho"
pf_latina$carrera[pf_latina$carrera == "DERECHO EJECUTIVO CUATRIMESTRAL" ] <- "derecho_eje"
pf_latina$carrera[pf_latina$carrera == "DISEÑO GRÁFICO" ] <- "dis_graf"
pf_latina$carrera[pf_latina$carrera == "DISEÑO Y DECORACIÓN DE INTERIORES" ] <- "dis_int"
pf_latina$carrera[pf_latina$carrera == "ECONOMÍA" ] <- "econ"
pf_latina$carrera[pf_latina$carrera == "ENFERMERÍA" ] <- "enf"
pf_latina$carrera[pf_latina$carrera == "FARMACIA" ] <- "farm"
pf_latina$carrera[pf_latina$carrera == "GASTRONOMÍA" ] <- "gastro"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA CIVIL" ] <- "civil"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA DE SISTEMAS INFORMÁTICOS" ] <- "sist"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA DEL SOFTWARE" ] <- "soft"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA ELECTROMECÁNICA" ] <- "elect_mec"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA ELECTRÓNICA" ] <- "elect"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA ELECTRÓNICA EN AUTOMATIZACIÓN" ] <- "elect_aut"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA ELECTRÓNICA EN AUTOMATIZACIÓN Y CONTROL" ] <- "elect_control"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA ELECTRÓNICA EN TELECOMUNICACIONES" ] <- "elect_tel"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA ELECTRÓNICA Y COMUNICACIONES" ] <- "elect_com"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA EN ELECTROMEDICINA" ] <- "elect_med"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA EN SISTEMAS COMPUTACIONALES" ] <- "comput"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA INDUSTRIAL" ] <- "indus"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA EN TELEMÁTICA" ] <- "telem"
pf_latina$carrera[pf_latina$carrera == "INGENIERÍA MECÁNICA Y ADMINISTRACIÓN" ] <- "mec_adm"
pf_latina$carrera[pf_latina$carrera == "LA ENSEÑANZA DEL INGLÉS" ] <- "ingles"
pf_latina$carrera[pf_latina$carrera == "MEDICINA Y CIRUGÍA" ] <- "med_cir"
pf_latina$carrera[pf_latina$carrera == "NUTRICIÓN" ] <- "nutri"
pf_latina$carrera[pf_latina$carrera == "ODONTOLOGÍA" ] <- "odonto"
pf_latina$carrera[pf_latina$carrera == "OPTOMETRÍA" ] <- "optom"
pf_latina$carrera[pf_latina$carrera == "PERIODISMO" ] <- "period"
pf_latina$carrera[pf_latina$carrera == "PSICOLOGÍA" ] <- "psico"
pf_latina$carrera[pf_latina$carrera == "PUBLICIDAD" ] <- "publ"
pf_latina$carrera[pf_latina$carrera == "RELACIONES INTERNACIONALES" ] <- "relint"
pf_latina$carrera[pf_latina$carrera == "RELACIONES PÚBLICAS" ] <- "relpub"
pf_latina$carrera[pf_latina$carrera == "SEGURIDAD INFORMÁTICA" ] <- "seg_inf"
pf_latina$carrera[pf_latina$carrera == "TECNOLOGÍAS DE INFORMACIÓN PARA LA GESTIÓN DE LOS NEGOCIOS" ] <- "gest_neg"
pf_latina$carrera[pf_latina$carrera == "TERAPIA FÍSICA" ] <- "ter_fis"
pf_latina$carrera[pf_latina$carrera == "TRABAJO SOCIAL" ] <- "social"
pf_latina$carrera[pf_latina$carrera == "TURISMO" ] <- "turi"
pf_latina$carrera[pf_latina$carrera == "TURISMO SOSTENIBLE" ] <- "tur_sos"


pf_latina_list <- split(pf_latina, f = pf_latina$sede) 
list2env(pf_latina_list,envir=.GlobalEnv)



######## ULATINA SEDE CANAS #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_canas_carr <- split(CANAS, f = CANAS$carrera) 
names(ulat_canas_carr) <- paste0("CANAS-",names(ulat_canas_carr)) 

list2env(ulat_canas_carr,envir=.GlobalEnv)

#segundo anidado Sede-carrera-materias#

#canas-admin de negocios

`CANAS-admin_neg-materias` <- split(`CANAS-admin_neg`, f = `CANAS-admin_neg`$cod_padre) 
names(`CANAS-admin_neg-materias`) <- paste0("CANAS-admin_neg-materias-",names(`CANAS-admin_neg-materias`)) 

list2env(`CANAS-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_CANAS_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_CANAS_admin_neg)[1] <- "horario"
horario_CANAS_admin_neg <- unique(horario_CANAS_admin_neg)


`obs_CANAS-admin_neg-materias` <- as.data.frame(sapply(`CANAS-admin_neg-materias`, NROW))

`obs_CANAS-admin_neg-materias` <- tibble::rownames_to_column(`obs_CANAS-admin_neg-materias`, "materia")
names(`obs_CANAS-admin_neg-materias`)[2] <- "obs"

`obs_CANAS-admin_neg-materias`$materia <- str_remove(`obs_CANAS-admin_neg-materias`$materia, "CANAS-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-admin_neg-materias` <- filter(`obs_CANAS-admin_neg-materias`, obs >= 10)
`no_elegibles_CANAS-admin_neg-materias` <- filter(`obs_CANAS-admin_neg-materias`, obs < 10)



#BAN 01

`BAN 01` <- as.data.frame(count(`CANAS-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_CANAS_admin_neg <- left_join(horario_CANAS_admin_neg, `BAN 01`)
names(horario_CANAS_admin_neg)[2] <- "BAN 01"

horario_CANAS_admin_neg$`BAN 01`[is.na(horario_CANAS_admin_neg$`BAN 01`)] <- 0



#BAN 03

`BAN 03` <- as.data.frame(count(`CANAS-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_CANAS_admin_neg <- left_join(horario_CANAS_admin_neg, `BAN 03`)
names(horario_CANAS_admin_neg)[3] <- "BAN 03"

horario_CANAS_admin_neg$`BAN 03`[is.na(horario_CANAS_admin_neg$`BAN 03`)] <- 0




#BCP 01

`BCP 01` <- as.data.frame(count(`CANAS-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_CANAS_admin_neg <- left_join(horario_CANAS_admin_neg, `BCP 01`)
names(horario_CANAS_admin_neg)[4] <- "BCP 01"

horario_CANAS_admin_neg$`BCP 01`[is.na(horario_CANAS_admin_neg$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`CANAS-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_CANAS_admin_neg <- left_join(horario_CANAS_admin_neg, `BMA 02`)
names(horario_CANAS_admin_neg)[5] <- "BMA 02"

horario_CANAS_admin_neg$`BMA 02`[is.na(horario_CANAS_admin_neg$`BMA 02`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`CANAS-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_CANAS_admin_neg <- left_join(horario_CANAS_admin_neg, `BPE 27`)
names(horario_CANAS_admin_neg)[6] <- "BPE 27"

horario_CANAS_admin_neg$`BPE 27`[is.na(horario_CANAS_admin_neg$`BPE 27`)] <- 0


##wide to long

horario_CANAS_admin_neg$id <- "Ulatina_CANAS_admin-neg_pand_c2"
horario_CANAS_admin_neg <-  horario_CANAS_admin_neg%>% dplyr::select(id, everything())

horario_CANAS_admin_neg <- melt(horario_CANAS_admin_neg, id = c("id", "horario"))
names(horario_CANAS_admin_neg)[3] <- "materia"
names(horario_CANAS_admin_neg)[4] <- "asistencia"


#canas-CONTABILIDAD

`CANAS-conta-materias` <- split(`CANAS-conta`, f = `CANAS-conta`$cod_padre) 
names(`CANAS-conta-materias`) <- paste0("CANAS-conta-materias-",names(`CANAS-conta-materias`)) 

list2env(`CANAS-conta-materias`,envir=.GlobalEnv)

#Probabilidades de horarios anidadas para cada una de las materias de CONTABILIDAD 

horario_CANAS_conta <- as.data.frame(pf_latina$HORARIO)
names(horario_CANAS_conta)[1] <- "horario"
horario_CANAS_conta <- unique(horario_CANAS_conta)



`obs_CANAS-conta-materias` <- as.data.frame(sapply(`CANAS-conta-materias`, NROW))

`obs_CANAS-conta-materias` <- tibble::rownames_to_column(`obs_CANAS-conta-materias`, "materia")
names(`obs_CANAS-conta-materias`)[2] <- "obs"

`obs_CANAS-conta-materias`$materia <- str_remove(`obs_CANAS-conta-materias`$materia, "CANAS-conta-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-conta-materias` <- filter(`obs_CANAS-conta-materias`, obs >= 10)
`no_elegibles_CANAS-conta-materias` <- filter(`obs_CANAS-conta-materias`, obs < 10)


#BAN 01

`BAN 01` <- as.data.frame(count(`CANAS-conta-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_CANAS_conta <- left_join(horario_CANAS_conta, `BAN 01`)
names(horario_CANAS_conta)[2] <- "BAN 01"

horario_CANAS_conta$`BAN 01`[is.na(horario_CANAS_conta$`BAN 01`)] <- 0


#BAN-040

`BAN-040` <- as.data.frame(count(`CANAS-conta-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_CANAS_conta <- left_join(horario_CANAS_conta, `BAN-040`)
names(horario_CANAS_conta)[3] <- "BAN-040"

horario_CANAS_conta$`BAN-040`[is.na(horario_CANAS_conta$`BAN-040`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`CANAS-conta-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_CANAS_conta <- left_join(horario_CANAS_conta, `BCP 01`)
names(horario_CANAS_conta)[4] <- "BCP 01"

horario_CANAS_conta$`BCP 01`[is.na(horario_CANAS_conta$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`CANAS-conta-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_CANAS_conta <- left_join(horario_CANAS_conta, `BMA 02`)
names(horario_CANAS_conta)[5] <- "BMA 02"

horario_CANAS_conta$`BMA 02`[is.na(horario_CANAS_conta$`BMA 02`)] <- 0

##wide to long

horario_CANAS_conta$id <- "Ulatina_CANAS_conta_pand_c2"
horario_CANAS_conta <-  horario_CANAS_conta%>% dplyr::select(id, everything())

horario_CANAS_conta <- melt(horario_CANAS_conta, id = c("id", "horario"))
names(horario_CANAS_conta)[3] <- "materia"
names(horario_CANAS_conta)[4] <- "asistencia"


#canas-CONTABILIDAD PUBLICA

`CANAS-conta_pub-materias` <- split(`CANAS-conta_pub`, f = `CANAS-conta_pub`$cod_padre) 
names(`CANAS-conta_pub-materias`) <- paste0("CANAS-conta_pub-materias-",names(`CANAS-conta_pub-materias`)) 

list2env(`CANAS-conta_pub-materias`,envir=.GlobalEnv)


`obs_CANAS-conta_pub-materias` <- as.data.frame(sapply(`CANAS-conta_pub-materias`, NROW))

`obs_CANAS-conta_pub-materias` <- tibble::rownames_to_column(`obs_CANAS-conta_pub-materias`, "materia")
names(`obs_CANAS-conta_pub-materias`)[2] <- "obs"

`obs_CANAS-conta_pub-materias`$materia <- str_remove(`obs_CANAS-conta_pub-materias`$materia, "CANAS-conta_pub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-conta_pub-materias` <- filter(`obs_CANAS-conta_pub-materias`, obs >= 10)
`no_elegibles_CANAS-conta_pub-materias` <- filter(`obs_CANAS-conta_pub-materias`, obs < 10)


#NO HAY SUFICIENTE INFORMACION PARA DETERMINAR


#canas-derecho

`CANAS-derecho-materias` <- split(`CANAS-derecho`, f = `CANAS-derecho`$cod_padre) 
names(`CANAS-derecho-materias`) <- paste0("CANAS-derecho-materias-",names(`CANAS-derecho-materias`)) 

list2env(`CANAS-derecho-materias`,envir=.GlobalEnv)

#Probabilidades de horarios anidadas para cada una de las materias de derechoBILIDAD 

horario_CANAS_derecho <- as.data.frame(pf_latina$HORARIO)
names(horario_CANAS_derecho)[1] <- "horario"
horario_CANAS_derecho <- unique(horario_CANAS_derecho)


`obs_CANAS-derecho-materias` <- as.data.frame(sapply(`CANAS-derecho-materias`, NROW))

`obs_CANAS-derecho-materias` <- tibble::rownames_to_column(`obs_CANAS-derecho-materias`, "materia")
names(`obs_CANAS-derecho-materias`)[2] <- "obs"

`obs_CANAS-derecho-materias`$materia <- str_remove(`obs_CANAS-derecho-materias`$materia, "CANAS-derecho-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-derecho-materias` <- filter(`obs_CANAS-derecho-materias`, obs >= 10)
`no_elegibles_CANAS-derecho-materias` <- filter(`obs_CANAS-derecho-materias`, obs < 10)


#BAH 03

`BAH 03` <- as.data.frame(count(`CANAS-derecho-materias-BAH 03`$HORARIO)) 

`BAH 03`$freq <- (`BAH 03`$freq)/sum(`BAH 03`$freq)

names(`BAH 03`)[1] <- "horario"

horario_CANAS_derecho <- left_join(horario_CANAS_derecho, `BAH 03`)
names(horario_CANAS_derecho)[2] <- "BAH 03"

horario_CANAS_derecho$`BAH 03`[is.na(horario_CANAS_derecho$`BAH 03`)] <- 0


#BAH 04

`BAH 04` <- as.data.frame(count(`CANAS-derecho-materias-BAH 04`$HORARIO)) 

`BAH 04`$freq <- (`BAH 04`$freq)/sum(`BAH 04`$freq)

names(`BAH 04`)[1] <- "horario"

horario_CANAS_derecho <- left_join(horario_CANAS_derecho, `BAH 04`)
names(horario_CANAS_derecho)[3] <- "BAH 04"

horario_CANAS_derecho$`BAH 04`[is.na(horario_CANAS_derecho$`BAH 04`)] <- 0

##wide to long

horario_CANAS_derecho$id <- "Ulatina_CANAS_derecho_pand_c2"
horario_CANAS_derecho <-  horario_CANAS_derecho%>% dplyr::select(id, everything())

horario_CANAS_derecho <- melt(horario_CANAS_derecho, id = c("id", "horario"))
names(horario_CANAS_derecho)[3] <- "materia"
names(horario_CANAS_derecho)[4] <- "asistencia"



#canas-educ

`CANAS-educ-materias` <- split(`CANAS-educ`, f = `CANAS-educ`$cod_padre) 
names(`CANAS-educ-materias`) <- paste0("CANAS-educ-materias-",names(`CANAS-educ-materias`)) 

list2env(`CANAS-educ-materias`,envir=.GlobalEnv)

#Probabilidades de horarios anidadas para cada una de las materias de educBILIDAD 

horario_CANAS_educ <- as.data.frame(pf_latina$HORARIO)
names(horario_CANAS_educ)[1] <- "horario"
horario_CANAS_educ <- unique(horario_CANAS_educ)



`obs_CANAS-educ-materias` <- as.data.frame(sapply(`CANAS-educ-materias`, NROW))

`obs_CANAS-educ-materias` <- tibble::rownames_to_column(`obs_CANAS-educ-materias`, "materia")
names(`obs_CANAS-educ-materias`)[2] <- "obs"

`obs_CANAS-educ-materias`$materia <- str_remove(`obs_CANAS-educ-materias`$materia, "CANAS-educ-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-educ-materias` <- filter(`obs_CANAS-educ-materias`, obs >= 10)
`no_elegibles_CANAS-educ-materias` <- filter(`obs_CANAS-educ-materias`, obs < 10)

#NO HAY SUFICIENETE INFORMACION PARA DETERMINAR EDUCACION EN CANAS



#canas-INDUS

`CANAS-indus-materias` <- split(`CANAS-indus`, f = `CANAS-indus`$cod_padre) 
names(`CANAS-indus-materias`) <- paste0("CANAS-indus-materias-",names(`CANAS-indus-materias`)) 

list2env(`CANAS-indus-materias`,envir=.GlobalEnv)

#Probabilidades de horarios anidadas para cada una de las materias de indusBILIDAD 

horario_CANAS_indus <- as.data.frame(pf_latina$HORARIO)
names(horario_CANAS_indus)[1] <- "horario"
horario_CANAS_indus <- unique(horario_CANAS_indus)



`obs_CANAS-indus-materias` <- as.data.frame(sapply(`CANAS-indus-materias`, NROW))

`obs_CANAS-indus-materias` <- tibble::rownames_to_column(`obs_CANAS-indus-materias`, "materia")
names(`obs_CANAS-indus-materias`)[2] <- "obs"

`obs_CANAS-indus-materias`$materia <- str_remove(`obs_CANAS-indus-materias`$materia, "CANAS-indus-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-indus-materias` <- filter(`obs_CANAS-indus-materias`, obs >= 10)
`no_elegibles_CANAS-indus-materias` <- filter(`obs_CANAS-indus-materias`, obs < 10)


#BII 01

`BII 01` <- as.data.frame(count(`CANAS-indus-materias-BII 01`$HORARIO)) 

`BII 01`$freq <- (`BII 01`$freq)/sum(`BII 01`$freq)

names(`BII 01`)[1] <- "horario"

horario_CANAS_indus <- left_join(horario_CANAS_indus, `BII 01`)
names(horario_CANAS_indus)[2] <- "BII 01"

horario_CANAS_indus$`BII 01`[is.na(horario_CANAS_indus$`BII 01`)] <- 0


#BIM 21

`BIM 21` <- as.data.frame(count(`CANAS-indus-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_CANAS_indus <- left_join(horario_CANAS_indus, `BIM 21`)
names(horario_CANAS_indus)[3] <- "BIM 21"

horario_CANAS_indus$`BIM 21`[is.na(horario_CANAS_indus$`BIM 21`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`CANAS-indus-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_CANAS_indus <- left_join(horario_CANAS_indus, `BPE 27`)
names(horario_CANAS_indus)[4] <- "BPE 27"

horario_CANAS_indus$`BPE 27`[is.na(horario_CANAS_indus$`BPE 27`)] <- 0


#QU 01

`QU 01` <- as.data.frame(count(`CANAS-indus-materias-QU 01`$HORARIO)) 

`QU 01`$freq <- (`QU 01`$freq)/sum(`QU 01`$freq)

names(`QU 01`)[1] <- "horario"

horario_CANAS_indus <- left_join(horario_CANAS_indus, `QU 01`)
names(horario_CANAS_indus)[5] <- "QU 01"

horario_CANAS_indus$`QU 01`[is.na(horario_CANAS_indus$`QU 01`)] <- 0



##wide to long

horario_CANAS_indus$id <- "Ulatina_CANAS_indus_pand_c2"
horario_CANAS_indus <-  horario_CANAS_indus%>% dplyr::select(id, everything())

horario_CANAS_indus <- melt(horario_CANAS_indus, id = c("id", "horario"))
names(horario_CANAS_indus)[3] <- "materia"
names(horario_CANAS_indus)[4] <- "asistencia"


#canas-INGLES

`CANAS-ingles-materias` <- split(`CANAS-ingles`, f = `CANAS-ingles`$cod_padre) 
names(`CANAS-ingles-materias`) <- paste0("CANAS-ingles-materias-",names(`CANAS-ingles-materias`)) 

list2env(`CANAS-ingles-materias`,envir=.GlobalEnv)

#Probabilidades de horarios anidadas para cada una de las materias de ingles

horario_CANAS_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_CANAS_ingles)[1] <- "horario"
horario_CANAS_ingles <- unique(horario_CANAS_ingles)


`obs_CANAS-ingles-materias` <- as.data.frame(sapply(`CANAS-ingles-materias`, NROW))

`obs_CANAS-ingles-materias` <- tibble::rownames_to_column(`obs_CANAS-ingles-materias`, "materia")
names(`obs_CANAS-ingles-materias`)[2] <- "obs"

`obs_CANAS-ingles-materias`$materia <- str_remove(`obs_CANAS-ingles-materias`$materia, "CANAS-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_CANAS-ingles-materias` <- filter(`obs_CANAS-ingles-materias`, obs >= 10)
`no_elegibles_CANAS-ingles-materias` <- filter(`obs_CANAS-ingles-materias`, obs < 10)



#BAN 01

`BAN 01` <- as.data.frame(count(`CANAS-ingles-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_CANAS_ingles <- left_join(horario_CANAS_ingles, `BAN 01`)
names(horario_CANAS_ingles)[2] <- "BAN 01"

horario_CANAS_ingles$`BAN 01`[is.na(horario_CANAS_ingles$`BAN 01`)] <- 0




##wide to long

horario_CANAS_ingles$id <- "Ulatina_CANAS_ingles_pand_c2"
horario_CANAS_ingles <-  horario_CANAS_ingles%>% dplyr::select(id, everything())

horario_CANAS_ingles <- melt(horario_CANAS_ingles, id = c("id", "horario"))
names(horario_CANAS_ingles)[3] <- "materia"
names(horario_CANAS_ingles)[4] <- "asistencia"

#Consolidado de sede CANAS

horario_CANAS <- rbind(horario_CANAS_indus, horario_CANAS_derecho, horario_CANAS_ingles, 
                       horario_CANAS_admin_neg, horario_CANAS_conta)

#total poblacion por carrera CANAS

materias_canas_pand_c2 <- count(CANAS$cod_padre)
names(materias_canas_pand_c2)[1] <- "materia"
names(materias_canas_pand_c2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_CANAS <- left_join(horario_CANAS, materias_canas_pand_c2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_CANAS$asistencia, by = list(horario_CANAS$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_CANAS <- left_join(horario_CANAS, pob_asist2)

horario_CANAS$asistencia2 <- horario_CANAS$asistencia/horario_CANAS$sum_prop
horario_CANAS$asistencia2[horario_CANAS$asistencia2 == Inf] <- 0

horario_CANAS$pob_asist <- round((horario_CANAS$asistencia2)*(horario_CANAS$poblacion),0)


#Guardo todos los horarios en su folder correspondiente

count(horario_CANAS$id)

write_xlsx(horario_CANAS,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/horario_CANAS_latina_pand_c2.xlsx")

write_xlsx(horario_CANAS_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/admin_neg_c2.xlsx")
write_xlsx(horario_CANAS_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/contabilidad_c2.xlsx")
write_xlsx(horario_CANAS_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/derecho_c2.xlsx")
write_xlsx(horario_CANAS_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/industrial_c2.xlsx")
write_xlsx(horario_CANAS_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/ingles_c2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_CANAS$id, "_", 5)

horario_CANAS <- cbind(split, horario_CANAS)
names(horario_CANAS)[1] <- "marca"
names(horario_CANAS)[2] <- "sede"
names(horario_CANAS)[3] <- "carrera"
names(horario_CANAS)[4] <- "modalidad"
names(horario_CANAS)[5] <- "cuatrimestre"

horario_CANAS <- horario_CANAS %>% dplyr::select(-id)


horario_CANAS_unique <- subset(horario_CANAS, pob_asist != 0)

horario_CANAS_unique <- horario_CANAS_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_CANAS_unique$marca <- "Ulatina"
horario_CANAS_unique$sede <- "CANAS"
horario_CANAS_unique$modalidad <- "pand"
horario_CANAS_unique$cuatrimestre <- "c2"

horario_CANAS_unique <- horario_CANAS_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_CANAS_unique <- horario_CANAS_unique[with(horario_CANAS_unique, order(materia, horario)), ]  

horario_CANAS_unique <- horario_CANAS_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_CANAS_unique$unoanueve <- 0
horario_CANAS_unique$unoanueve[horario_CANAS_unique$Asistencia <= 9] <- 1

horario_CANAS_unique$dieza17 <- 0
horario_CANAS_unique$dieza17[horario_CANAS_unique$Asistencia >= 10 & horario_CANAS_unique$Asistencia <= 17] <- 1

horario_CANAS_unique$di18a30 <- 0
horario_CANAS_unique$di18a30[horario_CANAS_unique$Asistencia >= 18 & horario_CANAS_unique$Asistencia <= 30] <- 1

horario_CANAS_unique$di31a60 <- 0
horario_CANAS_unique$di31a60[horario_CANAS_unique$Asistencia >= 31 & horario_CANAS_unique$Asistencia <= 60] <- 1

horario_CANAS_unique$mas60 <- 0
horario_CANAS_unique$mas60[horario_CANAS_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_CANAS_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_CANAS_unique <- left_join(horario_CANAS_unique, duplicados, by = "materia")

names(horario_CANAS_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_CANAS_unique$recomendacion <- 0
horario_CANAS_unique$recomendacion[horario_CANAS_unique$unoanueve == 1 & horario_CANAS_unique$duplicado == 0] <- "cerrar horario"
horario_CANAS_unique$recomendacion[horario_CANAS_unique$unoanueve == 1 & horario_CANAS_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_CANAS_unique$recomendacion[horario_CANAS_unique$dieza17 == 1 & horario_CANAS_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_CANAS_unique$recomendacion[horario_CANAS_unique$dieza17 == 1 & horario_CANAS_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_CANAS_unique$recomendacion[horario_CANAS_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_CANAS_unique$recomendacion[horario_CANAS_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_CANAS_unique$recomendacion[horario_CANAS_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_CANAS_unique <- horario_CANAS_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                horario, materia, Asistencia, recomendacion)


horario_split <- as.data.frame(str_split_fixed(horario_CANAS_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_CANAS_unique <- cbind(horario_CANAS_unique, horario_split)
names(horario_CANAS_unique)

horario_CANAS_unique$recom_d <- 0
horario_CANAS_unique$recom_d[horario_CANAS_unique$recomendacion == "unir horario" | horario_CANAS_unique$recomendacion == "cerrar horario"] <- 0
horario_CANAS_unique$recom_d[horario_CANAS_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                               horario_CANAS_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_CANAS_unique$recom_d[horario_CANAS_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_CANAS_unique$recom_d[horario_CANAS_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_CANAS_unique <- horario_CANAS_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)

write_xlsx(horario_CANAS_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_canas/recom_CANAS_latina_pand_c2.xlsx")



######## ULATINA SEDE GRECIA #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_GRECIA_carr <- split(GRECIA, f = GRECIA$carrera) 
names(ulat_GRECIA_carr) <- paste0("GRECIA-",names(ulat_GRECIA_carr)) 

list2env(ulat_GRECIA_carr,envir=.GlobalEnv)

#segundo anidado Sede-carrera-materias#

#GRECIA-admin de negocios

`GRECIA-admin_neg-materias` <- split(`GRECIA-admin_neg`, f = `GRECIA-admin_neg`$cod_padre) 
names(`GRECIA-admin_neg-materias`) <- paste0("GRECIA-admin_neg-materias-",names(`GRECIA-admin_neg-materias`)) 

list2env(`GRECIA-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GRECIA_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_GRECIA_admin_neg)[1] <- "horario"
horario_GRECIA_admin_neg <- unique(horario_GRECIA_admin_neg)


`obs_GRECIA-admin_neg-materias` <- as.data.frame(sapply(`GRECIA-admin_neg-materias`, NROW))

`obs_GRECIA-admin_neg-materias` <- tibble::rownames_to_column(`obs_GRECIA-admin_neg-materias`, "materia")
names(`obs_GRECIA-admin_neg-materias`)[2] <- "obs"

`obs_GRECIA-admin_neg-materias`$materia <- str_remove(`obs_GRECIA-admin_neg-materias`$materia, "GRECIA-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GRECIA-admin_neg-materias` <- filter(`obs_GRECIA-admin_neg-materias`, obs >= 10)
`no_elegibles_GRECIA-admin_neg-materias` <- filter(`obs_GRECIA-admin_neg-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`GRECIA-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_GRECIA_admin_neg <- left_join(horario_GRECIA_admin_neg, `BAN 01`)
names(horario_GRECIA_admin_neg)[2] <- "BAN 01"

horario_GRECIA_admin_neg$`BAN 01`[is.na(horario_GRECIA_admin_neg$`BAN 01`)] <- 0




#BAN 03

`BAN 03` <- as.data.frame(count(`GRECIA-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_GRECIA_admin_neg <- left_join(horario_GRECIA_admin_neg, `BAN 03`)
names(horario_GRECIA_admin_neg)[3] <- "BAN 03"

horario_GRECIA_admin_neg$`BAN 03`[is.na(horario_GRECIA_admin_neg$`BAN 03`)] <- 0



#BCP 01

`BCP 01` <- as.data.frame(count(`GRECIA-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_GRECIA_admin_neg <- left_join(horario_GRECIA_admin_neg, `BCP 01`)
names(horario_GRECIA_admin_neg)[4] <- "BCP 01"

horario_GRECIA_admin_neg$`BCP 01`[is.na(horario_GRECIA_admin_neg$`BCP 01`)] <- 0



#BMA 02

`BMA 02` <- as.data.frame(count(`GRECIA-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_GRECIA_admin_neg <- left_join(horario_GRECIA_admin_neg, `BMA 02`)
names(horario_GRECIA_admin_neg)[5] <- "BMA 02"

horario_GRECIA_admin_neg$`BMA 02`[is.na(horario_GRECIA_admin_neg$`BMA 02`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`GRECIA-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_GRECIA_admin_neg <- left_join(horario_GRECIA_admin_neg, `BPE 27`)
names(horario_GRECIA_admin_neg)[6] <- "BPE 27"

horario_GRECIA_admin_neg$`BPE 27`[is.na(horario_GRECIA_admin_neg$`BPE 27`)] <- 0



##wide to long

horario_GRECIA_admin_neg$id <- "Ulatina_GRECIA_admin_neg_pand_c2"
horario_GRECIA_admin_neg <-  horario_GRECIA_admin_neg%>% dplyr::select(id, everything())

horario_GRECIA_admin_neg <- melt(horario_GRECIA_admin_neg, id = c("id", "horario"))
names(horario_GRECIA_admin_neg)[3] <- "materia"
names(horario_GRECIA_admin_neg)[4] <- "asistencia"



#GRECIA-computacion

`GRECIA-comput-materias` <- split(`GRECIA-comput`, f = `GRECIA-comput`$cod_padre) 
names(`GRECIA-comput-materias`) <- paste0("GRECIA-comput-materias-",names(`GRECIA-comput-materias`)) 

list2env(`GRECIA-comput-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GRECIA_comput <- as.data.frame(pf_latina$HORARIO)
names(horario_GRECIA_comput)[1] <- "horario"
horario_GRECIA_comput <- unique(horario_GRECIA_comput)


`obs_GRECIA-comput-materias` <- as.data.frame(sapply(`GRECIA-comput-materias`, NROW))

`obs_GRECIA-comput-materias` <- tibble::rownames_to_column(`obs_GRECIA-comput-materias`, "materia")
names(`obs_GRECIA-comput-materias`)[2] <- "obs"

`obs_GRECIA-comput-materias`$materia <- str_remove(`obs_GRECIA-comput-materias`$materia, "GRECIA-comput-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GRECIA-comput-materias` <- filter(`obs_GRECIA-comput-materias`, obs >= 10)
`no_elegibles_GRECIA-comput-materias` <- filter(`obs_GRECIA-comput-materias`, obs < 10)


#BCS01

BCS01 <- as.data.frame(count(`GRECIA-comput-materias-BCS01`$HORARIO)) 

BCS01$freq <- (BCS01$freq)/sum(BCS01$freq)

names(BCS01)[1] <- "horario"

horario_GRECIA_comput <- left_join(horario_GRECIA_comput, BCS01)
names(horario_GRECIA_comput)[2] <- "BCS01"

horario_GRECIA_comput$BCS01[is.na(horario_GRECIA_comput$BCS01)] <- 0



#BIS01

BIS01 <- as.data.frame(count(`GRECIA-comput-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_GRECIA_comput <- left_join(horario_GRECIA_comput, BIS01)
names(horario_GRECIA_comput)[3] <- "BIS01"

horario_GRECIA_comput$BIS01[is.na(horario_GRECIA_comput$BIS01)] <- 0


#BIS02

BIS02 <- as.data.frame(count(`GRECIA-comput-materias-BIS02`$HORARIO)) 

BIS02$freq <- (BIS02$freq)/sum(BIS02$freq)

names(BIS02)[1] <- "horario"

horario_GRECIA_comput <- left_join(horario_GRECIA_comput, BIS02)
names(horario_GRECIA_comput)[4] <- "BIS02"

horario_GRECIA_comput$BIS02[is.na(horario_GRECIA_comput$BIS02)] <- 0


#BMA01

BMA01 <- as.data.frame(count(`GRECIA-comput-materias-BMA01`$HORARIO)) 

BMA01$freq <- (BMA01$freq)/sum(BMA01$freq)

names(BMA01)[1] <- "horario"

horario_GRECIA_comput <- left_join(horario_GRECIA_comput, BMA01)
names(horario_GRECIA_comput)[5] <- "BMA01"

horario_GRECIA_comput$BMA01[is.na(horario_GRECIA_comput$BMA01)] <- 0


#BSI-02

`BSI-02` <- as.data.frame(count(`GRECIA-comput-materias-BSI-02`$HORARIO)) 

`BSI-02`$freq <- (`BSI-02`$freq)/sum(`BSI-02`$freq)

names(`BSI-02`)[1] <- "horario"

horario_GRECIA_comput <- left_join(horario_GRECIA_comput, `BSI-02`)
names(horario_GRECIA_comput)[6] <- "BSI-02"

horario_GRECIA_comput$`BSI-02`[is.na(horario_GRECIA_comput$`BSI-02`)] <- 0

##wide to long

horario_GRECIA_comput$id <- "Ulatina_GRECIA_comput_pand_c2"
horario_GRECIA_comput <-  horario_GRECIA_comput%>% dplyr::select(id, everything())

horario_GRECIA_comput <- melt(horario_GRECIA_comput, id = c("id", "horario"))
names(horario_GRECIA_comput)[3] <- "materia"
names(horario_GRECIA_comput)[4] <- "asistencia"


#GRECIA-conta

`GRECIA-conta-materias` <- split(`GRECIA-conta`, f = `GRECIA-conta`$cod_padre) 
names(`GRECIA-conta-materias`) <- paste0("GRECIA-conta-materias-",names(`GRECIA-conta-materias`)) 

list2env(`GRECIA-conta-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GRECIA_conta <- as.data.frame(pf_latina$HORARIO)
names(horario_GRECIA_conta)[1] <- "horario"
horario_GRECIA_conta <- unique(horario_GRECIA_conta)


`obs_GRECIA-conta-materias` <- as.data.frame(sapply(`GRECIA-conta-materias`, NROW))

`obs_GRECIA-conta-materias` <- tibble::rownames_to_column(`obs_GRECIA-conta-materias`, "materia")
names(`obs_GRECIA-conta-materias`)[2] <- "obs"

`obs_GRECIA-conta-materias`$materia <- str_remove(`obs_GRECIA-conta-materias`$materia, "GRECIA-conta-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GRECIA-conta-materias` <- filter(`obs_GRECIA-conta-materias`, obs >= 10)
`no_elegibles_GRECIA-conta-materias` <- filter(`obs_GRECIA-conta-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`GRECIA-conta-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_GRECIA_conta <- left_join(horario_GRECIA_conta, `BAN-040`)
names(horario_GRECIA_conta)[2] <- "BAN-040"

horario_GRECIA_conta$`BAN-040`[is.na(horario_GRECIA_conta$`BAN-040`)] <- 0



#BAN 01

`BAN 01` <- as.data.frame(count(`GRECIA-conta-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_GRECIA_conta <- left_join(horario_GRECIA_conta, `BAN 01`)
names(horario_GRECIA_conta)[3] <- "BAN 01"

horario_GRECIA_conta$`BAN 01`[is.na(horario_GRECIA_conta$`BAN 01`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`GRECIA-conta-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_GRECIA_conta <- left_join(horario_GRECIA_conta, `BCP 01`)
names(horario_GRECIA_conta)[4] <- "BCP 01"

horario_GRECIA_conta$`BCP 01`[is.na(horario_GRECIA_conta$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`GRECIA-conta-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_GRECIA_conta <- left_join(horario_GRECIA_conta, `BMA 02`)
names(horario_GRECIA_conta)[5] <- "BMA 02"

horario_GRECIA_conta$`BMA 02`[is.na(horario_GRECIA_conta$`BMA 02`)] <- 0



##wide to long

horario_GRECIA_conta$id <- "Ulatina_GRECIA_conta_pand_c2"
horario_GRECIA_conta <-  horario_GRECIA_conta%>% dplyr::select(id, everything())

horario_GRECIA_conta <- melt(horario_GRECIA_conta, id = c("id", "horario"))
names(horario_GRECIA_conta)[3] <- "materia"
names(horario_GRECIA_conta)[4] <- "asistencia"


#GRECIA-conta_pub

`GRECIA-conta_pub-materias` <- split(`GRECIA-conta_pub`, f = `GRECIA-conta_pub`$cod_padre) 
names(`GRECIA-conta_pub-materias`) <- paste0("GRECIA-conta_pub-materias-",names(`GRECIA-conta_pub-materias`)) 

list2env(`GRECIA-conta_pub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GRECIA_conta_pub <- as.data.frame(pf_latina$HORARIO)
names(horario_GRECIA_conta_pub)[1] <- "horario"
horario_GRECIA_conta_pub <- unique(horario_GRECIA_conta_pub)


`obs_GRECIA-conta_pub-materias` <- as.data.frame(sapply(`GRECIA-conta_pub-materias`, NROW))

`obs_GRECIA-conta_pub-materias` <- tibble::rownames_to_column(`obs_GRECIA-conta_pub-materias`, "materia")
names(`obs_GRECIA-conta_pub-materias`)[2] <- "obs"

`obs_GRECIA-conta_pub-materias`$materia <- str_remove(`obs_GRECIA-conta_pub-materias`$materia, "GRECIA-conta_pub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GRECIA-conta_pub-materias` <- filter(`obs_GRECIA-conta_pub-materias`, obs >= 10)
`no_elegibles_GRECIA-conta_pub-materias` <- filter(`obs_GRECIA-conta_pub-materias`, obs < 10)


#BFIS 01

`BFIS 01` <- as.data.frame(count(`GRECIA-conta_pub-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_GRECIA_conta_pub <- left_join(horario_GRECIA_conta_pub, `BFIS 01`)
names(horario_GRECIA_conta_pub)[2] <- "BFIS 01"

horario_GRECIA_conta_pub$`BFIS 01`[is.na(horario_GRECIA_conta_pub$`BFIS 01`)] <- 0



##wide to long

horario_GRECIA_conta_pub$id <- "Ulatina_GRECIA_conta_pub_pand_c2"
horario_GRECIA_conta_pub <-  horario_GRECIA_conta_pub%>% dplyr::select(id, everything())

horario_GRECIA_conta_pub <- melt(horario_GRECIA_conta_pub, id = c("id", "horario"))
names(horario_GRECIA_conta_pub)[3] <- "materia"
names(horario_GRECIA_conta_pub)[4] <- "asistencia"


#GRECIA-elect_med

#MUESTRA NO SUFICIENTE DE TODA LA MATERIA DE ELECTOMEDICINA


#GRECIA-ingles

`GRECIA-ingles-materias` <- split(`GRECIA-ingles`, f = `GRECIA-ingles`$cod_padre) 
names(`GRECIA-ingles-materias`) <- paste0("GRECIA-ingles-materias-",names(`GRECIA-ingles-materias`)) 

list2env(`GRECIA-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GRECIA_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_GRECIA_ingles)[1] <- "horario"
horario_GRECIA_ingles <- unique(horario_GRECIA_ingles)


`obs_GRECIA-ingles-materias` <- as.data.frame(sapply(`GRECIA-ingles-materias`, NROW))

`obs_GRECIA-ingles-materias` <- tibble::rownames_to_column(`obs_GRECIA-ingles-materias`, "materia")
names(`obs_GRECIA-ingles-materias`)[2] <- "obs"

`obs_GRECIA-ingles-materias`$materia <- str_remove(`obs_GRECIA-ingles-materias`$materia, "GRECIA-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GRECIA-ingles-materias` <- filter(`obs_GRECIA-ingles-materias`, obs >= 10)
`no_elegibles_GRECIA-ingles-materias` <- filter(`obs_GRECIA-ingles-materias`, obs < 10)


#BAR-03

`BAR-03` <- as.data.frame(count(`GRECIA-ingles-materias-BAR-03`$HORARIO)) 

`BAR-03`$freq <- (`BAR-03`$freq)/sum(`BAR-03`$freq)

names(`BAR-03`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BAR-03`)
names(horario_GRECIA_ingles)[2] <- "BAR-03"

horario_GRECIA_ingles$`BAR-03`[is.na(horario_GRECIA_ingles$`BAR-03`)] <- 0



#BAR-05

`BAR-05` <- as.data.frame(count(`GRECIA-ingles-materias-BAR-05`$HORARIO)) 

`BAR-05`$freq <- (`BAR-05`$freq)/sum(`BAR-05`$freq)

names(`BAR-05`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BAR-05`)
names(horario_GRECIA_ingles)[3] <- "BAR-05"

horario_GRECIA_ingles$`BAR-05`[is.na(horario_GRECIA_ingles$`BAR-05`)] <- 0


#BCA-02

`BCA-02` <- as.data.frame(count(`GRECIA-ingles-materias-BCA-02`$HORARIO)) 

`BCA-02`$freq <- (`BCA-02`$freq)/sum(`BCA-02`$freq)

names(`BCA-02`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BCA-02`)
names(horario_GRECIA_ingles)[4] <- "BCA-02"

horario_GRECIA_ingles$`BCA-02`[is.na(horario_GRECIA_ingles$`BCA-02`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`GRECIA-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BCP 01`)
names(horario_GRECIA_ingles)[5] <- "BCP 01"

horario_GRECIA_ingles$`BCP 01`[is.na(horario_GRECIA_ingles$`BCP 01`)] <- 0



#BCS-01

`BCS-01` <- as.data.frame(count(`GRECIA-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BCS-01`)
names(horario_GRECIA_ingles)[6] <- "BCS-01"

horario_GRECIA_ingles$`BCS-01`[is.na(horario_GRECIA_ingles$`BCS-01`)] <- 0


#BCS 01

`BCS 01` <- as.data.frame(count(`GRECIA-ingles-materias-BCS 01`$HORARIO)) 

`BCS 01`$freq <- (`BCS 01`$freq)/sum(`BCS 01`$freq)

names(`BCS 01`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BCS 01`)
names(horario_GRECIA_ingles)[7] <- "BCS 01"

horario_GRECIA_ingles$`BCS 01`[is.na(horario_GRECIA_ingles$`BCS 01`)] <- 0



#BCS01

BCS01 <- as.data.frame(count(`GRECIA-ingles-materias-BCS01`$HORARIO)) 

BCS01$freq <- (BCS01$freq)/sum(BCS01$freq)

names(BCS01)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, BCS01)
names(horario_GRECIA_ingles)[8] <- "BCS01"

horario_GRECIA_ingles$BCS01[is.na(horario_GRECIA_ingles$BCS01)] <- 0


#BIN-01

`BIN-01` <- as.data.frame(count(`GRECIA-ingles-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_GRECIA_ingles <- left_join(horario_GRECIA_ingles, `BIN-01`)
names(horario_GRECIA_ingles)[9] <- "BIN-01"

horario_GRECIA_ingles$`BIN-01`[is.na(horario_GRECIA_ingles$`BIN-01`)] <- 0

##wide to long

horario_GRECIA_ingles$id <- "Ulatina_GRECIA_ingles_pand_c2"
horario_GRECIA_ingles <-  horario_GRECIA_ingles%>% dplyr::select(id, everything())

horario_GRECIA_ingles <- melt(horario_GRECIA_ingles, id = c("id", "horario"))
names(horario_GRECIA_ingles)[3] <- "materia"
names(horario_GRECIA_ingles)[4] <- "asistencia"


#GRECIA-PSICOLOGIA

#MUESTRA NO SUFICIENTE DE TODA LA CARRERA DE PSICOLOGIA
#MUESTRA NO SUFICIENTE DE TODA LA CARRERA DE PUBLICIDAD
#MUESTRA NO SUFICIENTE PARA LA CARRERA DE SISTEMAS

#Consolidado de sede GRECIA

horario_GRECIA <- rbind(horario_GRECIA_admin_neg, horario_GRECIA_comput, horario_GRECIA_conta,
                        horario_GRECIA_ingles)

#total poblacion por carrera GRECIA

materias_GRECIA_pand_c2 <- count(GRECIA$cod_padre)
names(materias_GRECIA_pand_c2)[1] <- "materia"
names(materias_GRECIA_pand_c2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_GRECIA <- left_join(horario_GRECIA, materias_GRECIA_pand_c2)

#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_GRECIA$asistencia, by = list(horario_GRECIA$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_GRECIA <- left_join(horario_GRECIA, pob_asist2)

horario_GRECIA$asistencia2 <- horario_GRECIA$asistencia/horario_GRECIA$sum_prop
horario_GRECIA$asistencia2[horario_GRECIA$asistencia2 == Inf] <- 0

horario_GRECIA$pob_asist <- round((horario_GRECIA$asistencia2)*(horario_GRECIA$poblacion),0)


#asistencia porcentual en horario i /sumatorio de asistencia iesimo por materia


#Guardo todos los horarios en su folder correspondiente

count(horario_GRECIA$id)
Replaces <- data.frame(from = c("Ulatina_GRECIA_admin_neg_pand_c2", "Ulatina_GRECIA_conta_pub_pand_c2"), to = c("Ulatina_GRECIA_admin-neg_pand_c2","Ulatina_GRECIA_conta-pub_pand_c2"))
horario_GRECIA <- FindReplace(data = horario_GRECIA, Var = "id", replaceData = Replaces,
                              from = "from", to = "to", exact = FALSE)


write_xlsx(horario_GRECIA,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/horario_GRECIA_latina_pand_c2.xlsx")


write_xlsx(horario_GRECIA_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/admin_neg_c2.xlsx")
write_xlsx(horario_GRECIA_comput,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/computacion_c2.xlsx")
write_xlsx(horario_GRECIA_conta_pub,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/conta_pub_c2.xlsx")
write_xlsx(horario_GRECIA_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/contabilidad_c2.xlsx")
write_xlsx(horario_GRECIA_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/ingles_c2.xlsx")



#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_GRECIA$id, "_", 5)

horario_GRECIA <- cbind(split, horario_GRECIA)
names(horario_GRECIA)[1] <- "marca"
names(horario_GRECIA)[2] <- "sede"
names(horario_GRECIA)[3] <- "carrera"
names(horario_GRECIA)[4] <- "modalidad"
names(horario_GRECIA)[5] <- "cuatrimestre"

horario_GRECIA <- horario_GRECIA %>% dplyr::select(-id)


horario_GRECIA_unique <- subset(horario_GRECIA, pob_asist != 0)

horario_GRECIA_unique <- horario_GRECIA_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_GRECIA_unique$marca <- "Ulatina"
horario_GRECIA_unique$sede <- "GRECIA"
horario_GRECIA_unique$modalidad <- "pand"
horario_GRECIA_unique$cuatrimestre <- "c2"

horario_GRECIA_unique <- horario_GRECIA_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_GRECIA_unique <- horario_GRECIA_unique[with(horario_GRECIA_unique, order(materia, horario)), ]  

horario_GRECIA_unique <- horario_GRECIA_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_GRECIA_unique$unoanueve <- 0
horario_GRECIA_unique$unoanueve[horario_GRECIA_unique$Asistencia <= 9] <- 1

horario_GRECIA_unique$dieza17 <- 0
horario_GRECIA_unique$dieza17[horario_GRECIA_unique$Asistencia >= 10 & horario_GRECIA_unique$Asistencia <= 17] <- 1

horario_GRECIA_unique$di18a30 <- 0
horario_GRECIA_unique$di18a30[horario_GRECIA_unique$Asistencia >= 18 & horario_GRECIA_unique$Asistencia <= 30] <- 1

horario_GRECIA_unique$di31a60 <- 0
horario_GRECIA_unique$di31a60[horario_GRECIA_unique$Asistencia >= 31 & horario_GRECIA_unique$Asistencia <= 60] <- 1

horario_GRECIA_unique$mas60 <- 0
horario_GRECIA_unique$mas60[horario_GRECIA_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_GRECIA_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_GRECIA_unique <- left_join(horario_GRECIA_unique, duplicados, by = "materia")

names(horario_GRECIA_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_GRECIA_unique$recomendacion <- 0
horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$unoanueve == 1 & horario_GRECIA_unique$duplicado == 0] <- "cerrar horario"
horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$unoanueve == 1 & horario_GRECIA_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$dieza17 == 1 & horario_GRECIA_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$dieza17 == 1 & horario_GRECIA_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_GRECIA_unique$recomendacion[horario_GRECIA_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_GRECIA_unique <- horario_GRECIA_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                  horario, materia, Asistencia, recomendacion)

horario_split <- as.data.frame(str_split_fixed(horario_GRECIA_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_GRECIA_unique <- cbind(horario_GRECIA_unique, horario_split)
names(horario_GRECIA_unique)

horario_GRECIA_unique$recom_d <- 0
horario_GRECIA_unique$recom_d[horario_GRECIA_unique$recomendacion == "unir horario" | horario_GRECIA_unique$recomendacion == "cerrar horario"] <- 0
horario_GRECIA_unique$recom_d[horario_GRECIA_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                                horario_GRECIA_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_GRECIA_unique$recom_d[horario_GRECIA_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_GRECIA_unique$recom_d[horario_GRECIA_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_GRECIA_unique <- horario_GRECIA_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)



write_xlsx(horario_GRECIA_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_grecia/recom_GRECIA_latina_pand_c2.xlsx")



######## ULATINA SEDE GUAPILES #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_GUAPILES_carr <- split(GUAPILES, f = GUAPILES$carrera) 
names(ulat_GUAPILES_carr) <- paste0("GUAPILES-",names(ulat_GUAPILES_carr)) 

list2env(ulat_GUAPILES_carr,envir=.GlobalEnv)

#segundo anidado Sede-carrera-materias#

#GUAPILES-admin de negocios

`GUAPILES-admin_neg-materias` <- split(`GUAPILES-admin_neg`, f = `GUAPILES-admin_neg`$cod_padre) 
names(`GUAPILES-admin_neg-materias`) <- paste0("GUAPILES-admin_neg-materias-",names(`GUAPILES-admin_neg-materias`)) 

list2env(`GUAPILES-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_admin_neg)[1] <- "horario"
horario_GUAPILES_admin_neg <- unique(horario_GUAPILES_admin_neg)


`obs_GUAPILES-admin_neg-materias` <- as.data.frame(sapply(`GUAPILES-admin_neg-materias`, NROW))

`obs_GUAPILES-admin_neg-materias` <- tibble::rownames_to_column(`obs_GUAPILES-admin_neg-materias`, "materia")
names(`obs_GUAPILES-admin_neg-materias`)[2] <- "obs"

`obs_GUAPILES-admin_neg-materias`$materia <- str_remove(`obs_GUAPILES-admin_neg-materias`$materia, "GUAPILES-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-admin_neg-materias` <- filter(`obs_GUAPILES-admin_neg-materias`, obs >= 10)
`no_elegibles_GUAPILES-admin_neg-materias` <- filter(`obs_GUAPILES-admin_neg-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`GUAPILES-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_GUAPILES_admin_neg <- left_join(horario_GUAPILES_admin_neg, `BAN 01`)
names(horario_GUAPILES_admin_neg)[2] <- "BAN 01"

horario_GUAPILES_admin_neg$`BAN 01`[is.na(horario_GUAPILES_admin_neg$`BAN 01`)] <- 0



#BAN 03

`BAN 03` <- as.data.frame(count(`GUAPILES-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_GUAPILES_admin_neg <- left_join(horario_GUAPILES_admin_neg, `BAN 03`)
names(horario_GUAPILES_admin_neg)[3] <- "BAN 03"

horario_GUAPILES_admin_neg$`BAN 03`[is.na(horario_GUAPILES_admin_neg$`BAN 03`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`GUAPILES-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_GUAPILES_admin_neg <- left_join(horario_GUAPILES_admin_neg, `BCP 01`)
names(horario_GUAPILES_admin_neg)[4] <- "BCP 01"

horario_GUAPILES_admin_neg$`BCP 01`[is.na(horario_GUAPILES_admin_neg$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`GUAPILES-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_GUAPILES_admin_neg <- left_join(horario_GUAPILES_admin_neg, `BMA 02`)
names(horario_GUAPILES_admin_neg)[5] <- "BMA 02"

horario_GUAPILES_admin_neg$`BMA 02`[is.na(horario_GUAPILES_admin_neg$`BMA 02`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`GUAPILES-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_GUAPILES_admin_neg <- left_join(horario_GUAPILES_admin_neg, `BPE 27`)
names(horario_GUAPILES_admin_neg)[6] <- "BPE 27"

horario_GUAPILES_admin_neg$`BPE 27`[is.na(horario_GUAPILES_admin_neg$`BPE 27`)] <- 0


##wide to long

horario_GUAPILES_admin_neg$id <- "Ulatina_GUAPILES_admin_neg_pand_c2"
horario_GUAPILES_admin_neg <-  horario_GUAPILES_admin_neg%>% dplyr::select(id, everything())

horario_GUAPILES_admin_neg <- melt(horario_GUAPILES_admin_neg, id = c("id", "horario"))
names(horario_GUAPILES_admin_neg)[3] <- "materia"
names(horario_GUAPILES_admin_neg)[4] <- "asistencia"


#GUAPILES-conta

`GUAPILES-conta-materias` <- split(`GUAPILES-conta`, f = `GUAPILES-conta`$cod_padre) 
names(`GUAPILES-conta-materias`) <- paste0("GUAPILES-conta-materias-",names(`GUAPILES-conta-materias`)) 

list2env(`GUAPILES-conta-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_conta <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_conta)[1] <- "horario"
horario_GUAPILES_conta <- unique(horario_GUAPILES_conta)


`obs_GUAPILES-conta-materias` <- as.data.frame(sapply(`GUAPILES-conta-materias`, NROW))

`obs_GUAPILES-conta-materias` <- tibble::rownames_to_column(`obs_GUAPILES-conta-materias`, "materia")
names(`obs_GUAPILES-conta-materias`)[2] <- "obs"

`obs_GUAPILES-conta-materias`$materia <- str_remove(`obs_GUAPILES-conta-materias`$materia, "GUAPILES-conta-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-conta-materias` <- filter(`obs_GUAPILES-conta-materias`, obs >= 10)
`no_elegibles_GUAPILES-conta-materias` <- filter(`obs_GUAPILES-conta-materias`, obs < 10)


#BAN-040

`BAN-040` <- as.data.frame(count(`GUAPILES-conta-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_GUAPILES_conta <- left_join(horario_GUAPILES_conta, `BAN-040`)
names(horario_GUAPILES_conta)[2] <- "BAN-040"

horario_GUAPILES_conta$`BAN-040`[is.na(horario_GUAPILES_conta$`BAN-040`)] <- 0

#BAN 01

`BAN 01` <- as.data.frame(count(`GUAPILES-conta-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_GUAPILES_conta <- left_join(horario_GUAPILES_conta, `BAN 01`)
names(horario_GUAPILES_conta)[3] <- "BAN 01"

horario_GUAPILES_conta$`BAN 01`[is.na(horario_GUAPILES_conta$`BAN 01`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`GUAPILES-conta-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_GUAPILES_conta <- left_join(horario_GUAPILES_conta, `BCP 01`)
names(horario_GUAPILES_conta)[4] <- "BCP 01"

horario_GUAPILES_conta$`BCP 01`[is.na(horario_GUAPILES_conta$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`GUAPILES-conta-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_GUAPILES_conta <- left_join(horario_GUAPILES_conta, `BMA 02`)
names(horario_GUAPILES_conta)[5] <- "BMA 02"

horario_GUAPILES_conta$`BMA 02`[is.na(horario_GUAPILES_conta$`BMA 02`)] <- 0


##wide to long

horario_GUAPILES_conta$id <- "Ulatina_GUAPILES_conta_pand_c2"
horario_GUAPILES_conta <-  horario_GUAPILES_conta%>% dplyr::select(id, everything())

horario_GUAPILES_conta <- melt(horario_GUAPILES_conta, id = c("id", "horario"))
names(horario_GUAPILES_conta)[3] <- "materia"
names(horario_GUAPILES_conta)[4] <- "asistencia"




#GUAPILES-conta_pub

`GUAPILES-conta_pub-materias` <- split(`GUAPILES-conta_pub`, f = `GUAPILES-conta_pub`$cod_padre) 
names(`GUAPILES-conta_pub-materias`) <- paste0("GUAPILES-conta_pub-materias-",names(`GUAPILES-conta_pub-materias`)) 

list2env(`GUAPILES-conta_pub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_conta_pub <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_conta_pub)[1] <- "horario"
horario_GUAPILES_conta_pub <- unique(horario_GUAPILES_conta_pub)


`obs_GUAPILES-conta_pub-materias` <- as.data.frame(sapply(`GUAPILES-conta_pub-materias`, NROW))

`obs_GUAPILES-conta_pub-materias` <- tibble::rownames_to_column(`obs_GUAPILES-conta_pub-materias`, "materia")
names(`obs_GUAPILES-conta_pub-materias`)[2] <- "obs"

`obs_GUAPILES-conta_pub-materias`$materia <- str_remove(`obs_GUAPILES-conta_pub-materias`$materia, "GUAPILES-conta_pub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-conta_pub-materias` <- filter(`obs_GUAPILES-conta_pub-materias`, obs >= 10)
`no_elegibles_GUAPILES-conta_pub-materias` <- filter(`obs_GUAPILES-conta_pub-materias`, obs < 10)


#BFIS 01

`BFIS 01` <- as.data.frame(count(`GUAPILES-conta_pub-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_GUAPILES_conta_pub <- left_join(horario_GUAPILES_conta_pub, `BFIS 01`)
names(horario_GUAPILES_conta_pub)[2] <- "BFIS 01"

horario_GUAPILES_conta_pub$`BFIS 01`[is.na(horario_GUAPILES_conta_pub$`BFIS 01`)] <- 0 


#GUAPILES-derecho

`GUAPILES-derecho-materias` <- split(`GUAPILES-derecho`, f = `GUAPILES-derecho`$cod_padre) 
names(`GUAPILES-derecho-materias`) <- paste0("GUAPILES-derecho-materias-",names(`GUAPILES-derecho-materias`)) 

list2env(`GUAPILES-derecho-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_derecho <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_derecho)[1] <- "horario"
horario_GUAPILES_derecho <- unique(horario_GUAPILES_derecho)


`obs_GUAPILES-derecho-materias` <- as.data.frame(sapply(`GUAPILES-derecho-materias`, NROW))

`obs_GUAPILES-derecho-materias` <- tibble::rownames_to_column(`obs_GUAPILES-derecho-materias`, "materia")
names(`obs_GUAPILES-derecho-materias`)[2] <- "obs"

`obs_GUAPILES-derecho-materias`$materia <- str_remove(`obs_GUAPILES-derecho-materias`$materia, "GUAPILES-derecho-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-derecho-materias` <- filter(`obs_GUAPILES-derecho-materias`, obs >= 10)
`no_elegibles_GUAPILES-derecho-materias` <- filter(`obs_GUAPILES-derecho-materias`, obs < 10)


#BAN-01

`BAN-01` <- as.data.frame(count(`GUAPILES-derecho-materias-BAN-01`$HORARIO)) 

`BAN-01`$freq <- (`BAN-01`$freq)/sum(`BAN-01`$freq)

names(`BAN-01`)[1] <- "horario"

horario_GUAPILES_derecho <- left_join(horario_GUAPILES_derecho, `BAN-01`)
names(horario_GUAPILES_derecho)[2] <- "BAN-01"

horario_GUAPILES_derecho$`BAN-01`[is.na(horario_GUAPILES_derecho$`BAN-01`)] <- 0


#BAN 01

`BAN 01` <- as.data.frame(count(`GUAPILES-derecho-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_GUAPILES_derecho <- left_join(horario_GUAPILES_derecho, `BAN 01`)
names(horario_GUAPILES_derecho)[3] <- "BAN 01"

horario_GUAPILES_derecho$`BAN 01`[is.na(horario_GUAPILES_derecho$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`GUAPILES-derecho-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_GUAPILES_derecho <- left_join(horario_GUAPILES_derecho, `BAN 03`)
names(horario_GUAPILES_derecho)[4] <- "BAN 03"

horario_GUAPILES_derecho$`BAN 03`[is.na(horario_GUAPILES_derecho$`BAN 03`)] <- 0


##wide to long

horario_GUAPILES_derecho$id <- "Ulatina_GUAPILES_derecho_pand_c2"
horario_GUAPILES_derecho <-  horario_GUAPILES_derecho%>% dplyr::select(id, everything())

horario_GUAPILES_derecho <- melt(horario_GUAPILES_derecho, id = c("id", "horario"))
names(horario_GUAPILES_derecho)[3] <- "materia"
names(horario_GUAPILES_derecho)[4] <- "asistencia"

#GUAPILES-educ

`GUAPILES-educ-materias` <- split(`GUAPILES-educ`, f = `GUAPILES-educ`$cod_padre) 
names(`GUAPILES-educ-materias`) <- paste0("GUAPILES-educ-materias-",names(`GUAPILES-educ-materias`)) 

list2env(`GUAPILES-educ-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_educ <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_educ)[1] <- "horario"
horario_GUAPILES_educ <- unique(horario_GUAPILES_educ)


`obs_GUAPILES-educ-materias` <- as.data.frame(sapply(`GUAPILES-educ-materias`, NROW))

`obs_GUAPILES-educ-materias` <- tibble::rownames_to_column(`obs_GUAPILES-educ-materias`, "materia")
names(`obs_GUAPILES-educ-materias`)[2] <- "obs"

`obs_GUAPILES-educ-materias`$materia <- str_remove(`obs_GUAPILES-educ-materias`$materia, "GUAPILES-educ-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-educ-materias` <- filter(`obs_GUAPILES-educ-materias`, obs >= 10)
`no_elegibles_GUAPILES-educ-materias` <- filter(`obs_GUAPILES-educ-materias`, obs < 10)


#BAN-03

`BAN-03` <- as.data.frame(count(`GUAPILES-educ-materias-BAN-03`$HORARIO)) 

`BAN-03`$freq <- (`BAN-03`$freq)/sum(`BAN-03`$freq)

names(`BAN-03`)[1] <- "horario"

horario_GUAPILES_educ <- left_join(horario_GUAPILES_educ, `BAN-03`)
names(horario_GUAPILES_educ)[2] <- "BAN-03"

horario_GUAPILES_educ$`BAN-03`[is.na(horario_GUAPILES_educ$`BAN-03`)] <- 0

#BAN-04

`BAN-04` <- as.data.frame(count(`GUAPILES-educ-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_GUAPILES_educ <- left_join(horario_GUAPILES_educ, `BAN-04`)
names(horario_GUAPILES_educ)[3] <- "BAN-04"

horario_GUAPILES_educ$`BAN-04`[is.na(horario_GUAPILES_educ$`BAN-04`)] <- 0


#BAN-040

`BAN-040` <- as.data.frame(count(`GUAPILES-educ-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_GUAPILES_educ <- left_join(horario_GUAPILES_educ, `BAN-040`)
names(horario_GUAPILES_educ)[4] <- "BAN-040"

horario_GUAPILES_educ$`BAN-040`[is.na(horario_GUAPILES_educ$`BAN-040`)] <- 0




#BELC 01

`BELC 01` <- as.data.frame(count(`GUAPILES-educ-materias-BELC 01`$HORARIO)) 

`BELC 01`$freq <- (`BELC 01`$freq)/sum(`BELC 01`$freq)

names(`BELC 01`)[1] <- "horario"

horario_GUAPILES_educ <- left_join(horario_GUAPILES_educ, `BELC 01`)
names(horario_GUAPILES_educ)[5] <- "BELC 01"

horario_GUAPILES_educ$`BELC 01`[is.na(horario_GUAPILES_educ$`BELC 01`)] <- 0


#BFIS 01

`BFIS 01` <- as.data.frame(count(`GUAPILES-educ-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_GUAPILES_educ <- left_join(horario_GUAPILES_educ, `BFIS 01`)
names(horario_GUAPILES_educ)[6] <- "BFIS 01"

horario_GUAPILES_educ$`BFIS 01`[is.na(horario_GUAPILES_educ$`BFIS 01`)] <- 0


## wide to long 

horario_GUAPILES_educ$id <- "Ulatina_GUAPILES_educ_pand_c2"
horario_GUAPILES_educ <-  horario_GUAPILES_educ%>% dplyr::select(id, everything())

horario_GUAPILES_educ <- melt(horario_GUAPILES_educ, id = c("id", "horario"))
names(horario_GUAPILES_educ)[3] <- "materia"
names(horario_GUAPILES_educ)[4] <- "asistencia"




#GUAPILES-educ_pre

#NO SUFICIENTE INFORMACION PARA EDUCACION PREKINDER

#GUAPILES-elect_med

#NO SUFICIENTE INFORMACION PARA ELECTROMEDICINA


#GUAPILES-enf

`GUAPILES-enf-materias` <- split(`GUAPILES-enf`, f = `GUAPILES-enf`$cod_padre) 
names(`GUAPILES-enf-materias`) <- paste0("GUAPILES-enf-materias-",names(`GUAPILES-enf-materias`)) 

list2env(`GUAPILES-enf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_enf <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_enf)[1] <- "horario"
horario_GUAPILES_enf <- unique(horario_GUAPILES_enf)


`obs_GUAPILES-enf-materias` <- as.data.frame(sapply(`GUAPILES-enf-materias`, NROW))

`obs_GUAPILES-enf-materias` <- tibble::rownames_to_column(`obs_GUAPILES-enf-materias`, "materia")
names(`obs_GUAPILES-enf-materias`)[2] <- "obs"

`obs_GUAPILES-enf-materias`$materia <- str_remove(`obs_GUAPILES-enf-materias`$materia, "GUAPILES-enf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-enf-materias` <- filter(`obs_GUAPILES-enf-materias`, obs >= 10)
`no_elegibles_GUAPILES-enf-materias` <- filter(`obs_GUAPILES-enf-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`GUAPILES-enf-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BCS-01`)
names(horario_GUAPILES_enf)[2] <- "BCS-01"

horario_GUAPILES_enf$`BCS-01`[is.na(horario_GUAPILES_enf$`BCS-01`)] <- 0



#BIE-01

`BIE-01` <- as.data.frame(count(`GUAPILES-enf-materias-BIE-01`$HORARIO)) 

`BIE-01`$freq <- (`BIE-01`$freq)/sum(`BIE-01`$freq)

names(`BIE-01`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BIE-01`)
names(horario_GUAPILES_enf)[3] <- "BIE-01"

horario_GUAPILES_enf$`BIE-01`[is.na(horario_GUAPILES_enf$`BIE-01`)] <- 0



#BIE-02

`BIE-02` <- as.data.frame(count(`GUAPILES-enf-materias-BIE-02`$HORARIO)) 

`BIE-02`$freq <- (`BIE-02`$freq)/sum(`BIE-02`$freq)

names(`BIE-02`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BIE-02`)
names(horario_GUAPILES_enf)[4] <- "BIE-02"

horario_GUAPILES_enf$`BIE-02`[is.na(horario_GUAPILES_enf$`BIE-02`)] <- 0


#BIE-03

`BIE-03` <- as.data.frame(count(`GUAPILES-enf-materias-BIE-03`$HORARIO)) 

`BIE-03`$freq <- (`BIE-03`$freq)/sum(`BIE-03`$freq)

names(`BIE-03`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BIE-03`)
names(horario_GUAPILES_enf)[5] <- "BIE-03"

horario_GUAPILES_enf$`BIE-03`[is.na(horario_GUAPILES_enf$`BIE-03`)] <- 0


#BIE-05

`BIE-05` <- as.data.frame(count(`GUAPILES-enf-materias-BIE-05`$HORARIO)) 

`BIE-05`$freq <- (`BIE-05`$freq)/sum(`BIE-05`$freq)

names(`BIE-05`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BIE-05`)
names(horario_GUAPILES_enf)[6] <- "BIE-05"

horario_GUAPILES_enf$`BIE-05`[is.na(horario_GUAPILES_enf$`BIE-05`)] <- 0


#BII 01

`BII 01` <- as.data.frame(count(`GUAPILES-enf-materias-BII 01`$HORARIO)) 

`BII 01`$freq <- (`BII 01`$freq)/sum(`BII 01`$freq)

names(`BII 01`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BII 01`)
names(horario_GUAPILES_enf)[7] <- "BII 01"

horario_GUAPILES_enf$`BII 01`[is.na(horario_GUAPILES_enf$`BII 01`)] <- 0


#BIM 21

`BIM 21` <- as.data.frame(count(`GUAPILES-enf-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BIM 21`)
names(horario_GUAPILES_enf)[8] <- "BIM 21"

horario_GUAPILES_enf$`BIM 21`[is.na(horario_GUAPILES_enf$`BIM 21`)] <- 0



#BIN-01

`BIN-01` <- as.data.frame(count(`GUAPILES-enf-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_GUAPILES_enf <- left_join(horario_GUAPILES_enf, `BIN-01`)
names(horario_GUAPILES_enf)[9] <- "BIN-01"

horario_GUAPILES_enf$`BIN-01`[is.na(horario_GUAPILES_enf$`BIN-01`)] <- 0


## wide to long 

horario_GUAPILES_enf$id <- "Ulatina_GUAPILES_enf_pand_c2"
horario_GUAPILES_enf <-  horario_GUAPILES_enf%>% dplyr::select(id, everything())

horario_GUAPILES_enf <- melt(horario_GUAPILES_enf, id = c("id", "horario"))
names(horario_GUAPILES_enf)[3] <- "materia"
names(horario_GUAPILES_enf)[4] <- "asistencia"



#GUAPILES-gastro

#NO SUFICIENTE INFORMACION PARA GASTRONOMIA


#GUAPILES-indus

`GUAPILES-indus-materias` <- split(`GUAPILES-indus`, f = `GUAPILES-indus`$cod_padre) 
names(`GUAPILES-indus-materias`) <- paste0("GUAPILES-indus-materias-",names(`GUAPILES-indus-materias`)) 

list2env(`GUAPILES-indus-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_indus <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_indus)[1] <- "horario"
horario_GUAPILES_indus <- unique(horario_GUAPILES_indus)


`obs_GUAPILES-indus-materias` <- as.data.frame(sapply(`GUAPILES-indus-materias`, NROW))

`obs_GUAPILES-indus-materias` <- tibble::rownames_to_column(`obs_GUAPILES-indus-materias`, "materia")
names(`obs_GUAPILES-indus-materias`)[2] <- "obs"

`obs_GUAPILES-indus-materias`$materia <- str_remove(`obs_GUAPILES-indus-materias`$materia, "GUAPILES-indus-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-indus-materias` <- filter(`obs_GUAPILES-indus-materias`, obs >= 10)
`no_elegibles_GUAPILES-indus-materias` <- filter(`obs_GUAPILES-indus-materias`, obs < 10)



#BFIS 01

`BFIS 01` <- as.data.frame(count(`GUAPILES-indus-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_GUAPILES_indus <- left_join(horario_GUAPILES_indus, `BFIS 01`)
names(horario_GUAPILES_indus)[2] <- "BFIS 01"

horario_GUAPILES_indus$`BFIS 01`[is.na(horario_GUAPILES_indus$`BFIS 01`)] <- 0



#BIM 21

`BIM 21` <- as.data.frame(count(`GUAPILES-indus-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_GUAPILES_indus <- left_join(horario_GUAPILES_indus, `BIM 21`)
names(horario_GUAPILES_indus)[3] <- "BIM 21"

horario_GUAPILES_indus$`BIM 21`[is.na(horario_GUAPILES_indus$`BIM 21`)] <- 0



#BMA 01

`BMA 01` <- as.data.frame(count(`GUAPILES-indus-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_GUAPILES_indus <- left_join(horario_GUAPILES_indus, `BMA 01`)
names(horario_GUAPILES_indus)[4] <- "BMA 01"

horario_GUAPILES_indus$`BMA 01`[is.na(horario_GUAPILES_indus$`BMA 01`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`GUAPILES-indus-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_GUAPILES_indus <- left_join(horario_GUAPILES_indus, `BPE 27`)
names(horario_GUAPILES_indus)[5] <- "BPE 27"

horario_GUAPILES_indus$`BPE 27`[is.na(horario_GUAPILES_indus$`BPE 27`)] <- 0



#LCB-03

`LCB-03` <- as.data.frame(count(`GUAPILES-indus-materias-LCB-03`$HORARIO)) 

`LCB-03`$freq <- (`LCB-03`$freq)/sum(`LCB-03`$freq)

names(`LCB-03`)[1] <- "horario"

horario_GUAPILES_indus <- left_join(horario_GUAPILES_indus, `LCB-03`)
names(horario_GUAPILES_indus)[6] <- "LCB-03"

horario_GUAPILES_indus$`LCB-03`[is.na(horario_GUAPILES_indus$`LCB-03`)] <- 0



#BAR-01

`BAR-01` <- as.data.frame(count(`GUAPILES-indus-materias-BAR-01`$HORARIO)) 

`BAR-01`$freq <- (`BAR-01`$freq)/sum(`BAR-01`$freq)

names(`BAR-01`)[1] <- "horario"

horario_GUAPILES_indus <- left_join(horario_GUAPILES_indus, `BAR-01`)
names(horario_GUAPILES_indus)[7] <- "BAR-01"

horario_GUAPILES_indus$`BAR-01`[is.na(horario_GUAPILES_indus$`BAR-01`)] <- 0



## wide to long 

horario_GUAPILES_indus$id <- "Ulatina_GUAPILES_indus_pand_c2"
horario_GUAPILES_indus <-  horario_GUAPILES_indus%>% dplyr::select(id, everything())

horario_GUAPILES_indus <- melt(horario_GUAPILES_indus, id = c("id", "horario"))
names(horario_GUAPILES_indus)[3] <- "materia"
names(horario_GUAPILES_indus)[4] <- "asistencia"


#GUAPILES-ingles

`GUAPILES-ingles-materias` <- split(`GUAPILES-ingles`, f = `GUAPILES-ingles`$cod_padre) 
names(`GUAPILES-ingles-materias`) <- paste0("GUAPILES-ingles-materias-",names(`GUAPILES-ingles-materias`)) 

list2env(`GUAPILES-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_ingles)[1] <- "horario"
horario_GUAPILES_ingles <- unique(horario_GUAPILES_ingles)


`obs_GUAPILES-ingles-materias` <- as.data.frame(sapply(`GUAPILES-ingles-materias`, NROW))

`obs_GUAPILES-ingles-materias` <- tibble::rownames_to_column(`obs_GUAPILES-ingles-materias`, "materia")
names(`obs_GUAPILES-ingles-materias`)[2] <- "obs"

`obs_GUAPILES-ingles-materias`$materia <- str_remove(`obs_GUAPILES-ingles-materias`$materia, "GUAPILES-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-ingles-materias` <- filter(`obs_GUAPILES-ingles-materias`, obs >= 10)
`no_elegibles_GUAPILES-ingles-materias` <- filter(`obs_GUAPILES-ingles-materias`, obs < 10)


#BAR-04

`BAR-04` <- as.data.frame(count(`GUAPILES-ingles-materias-BAR-04`$HORARIO)) 

`BAR-04`$freq <- (`BAR-04`$freq)/sum(`BAR-04`$freq)

names(`BAR-04`)[1] <- "horario"

horario_GUAPILES_ingles <- left_join(horario_GUAPILES_ingles, `BAR-04`)
names(horario_GUAPILES_ingles)[2] <- "BAR-04"

horario_GUAPILES_ingles$`BAR-04`[is.na(horario_GUAPILES_ingles$`BAR-04`)] <- 0



#BCA-01

`BCA-01` <- as.data.frame(count(`GUAPILES-ingles-materias-BCA-01`$HORARIO)) 

`BCA-01`$freq <- (`BCA-01`$freq)/sum(`BCA-01`$freq)

names(`BCA-01`)[1] <- "horario"

horario_GUAPILES_ingles <- left_join(horario_GUAPILES_ingles, `BCA-01`)
names(horario_GUAPILES_ingles)[3] <- "BCA-01"

horario_GUAPILES_ingles$`BCA-01`[is.na(horario_GUAPILES_ingles$`BCA-01`)] <- 0



#BCP 01

`BCP 01` <- as.data.frame(count(`GUAPILES-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_GUAPILES_ingles <- left_join(horario_GUAPILES_ingles, `BCP 01`)
names(horario_GUAPILES_ingles)[4] <- "BCP 01"

horario_GUAPILES_ingles$`BCP 01`[is.na(horario_GUAPILES_ingles$`BCP 01`)] <- 0




#BCS-01

`BCS-01` <- as.data.frame(count(`GUAPILES-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_GUAPILES_ingles <- left_join(horario_GUAPILES_ingles, `BCS-01`)
names(horario_GUAPILES_ingles)[5] <- "BCS-01"

horario_GUAPILES_ingles$`BCS-01`[is.na(horario_GUAPILES_ingles$`BCS-01`)] <- 0


#BCS 01

`BCS 01` <- as.data.frame(count(`GUAPILES-ingles-materias-BCS 01`$HORARIO)) 

`BCS 01`$freq <- (`BCS 01`$freq)/sum(`BCS 01`$freq)

names(`BCS 01`)[1] <- "horario"

horario_GUAPILES_ingles <- left_join(horario_GUAPILES_ingles, `BCS 01`)
names(horario_GUAPILES_ingles)[6] <- "BCS 01"

horario_GUAPILES_ingles$`BCS 01`[is.na(horario_GUAPILES_ingles$`BCS 01`)] <- 0


#BCS01

BCS01 <- as.data.frame(count(`GUAPILES-ingles-materias-BCS01`$HORARIO)) 

BCS01$freq <- (BCS01$freq)/sum(BCS01$freq)

names(BCS01)[1] <- "horario"

horario_GUAPILES_ingles <- left_join(horario_GUAPILES_ingles, BCS01)
names(horario_GUAPILES_ingles)[7] <- "BCS01"

horario_GUAPILES_ingles$BCS01[is.na(horario_GUAPILES_ingles$BCS01)] <- 0



## wide to long 

horario_GUAPILES_ingles$id <- "Ulatina_GUAPILES_ingles_pand_c2"
horario_GUAPILES_ingles <-  horario_GUAPILES_ingles%>% dplyr::select(id, everything())

horario_GUAPILES_ingles <- melt(horario_GUAPILES_ingles, id = c("id", "horario"))
names(horario_GUAPILES_ingles)[3] <- "materia"
names(horario_GUAPILES_ingles)[4] <- "asistencia"

#GUAPILES-psico

`GUAPILES-psico-materias` <- split(`GUAPILES-psico`, f = `GUAPILES-psico`$cod_padre) 
names(`GUAPILES-psico-materias`) <- paste0("GUAPILES-psico-materias-",names(`GUAPILES-psico-materias`)) 

list2env(`GUAPILES-psico-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_psico <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_psico)[1] <- "horario"
horario_GUAPILES_psico <- unique(horario_GUAPILES_psico)


`obs_GUAPILES-psico-materias` <- as.data.frame(sapply(`GUAPILES-psico-materias`, NROW))

`obs_GUAPILES-psico-materias` <- tibble::rownames_to_column(`obs_GUAPILES-psico-materias`, "materia")
names(`obs_GUAPILES-psico-materias`)[2] <- "obs"

`obs_GUAPILES-psico-materias`$materia <- str_remove(`obs_GUAPILES-psico-materias`$materia, "GUAPILES-psico-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-psico-materias` <- filter(`obs_GUAPILES-psico-materias`, obs >= 10)
`no_elegibles_GUAPILES-psico-materias` <- filter(`obs_GUAPILES-psico-materias`, obs < 10)



#LCTS-01

`LCTS-01` <- as.data.frame(count(`GUAPILES-psico-materias-LCTS-01`$HORARIO)) 

`LCTS-01`$freq <- (`LCTS-01`$freq)/sum(`LCTS-01`$freq)

names(`LCTS-01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `LCTS-01`)
names(horario_GUAPILES_psico)[2] <- "LCTS-01"
horario_GUAPILES_psico$`LCTS-01`[is.na(horario_GUAPILES_psico$`LCTS-01`)] <- 0


#LPS 01

`LPS 01` <- as.data.frame(count(`GUAPILES-psico-materias-LPS 01`$HORARIO)) 

`LPS 01`$freq <- (`LPS 01`$freq)/sum(`LPS 01`$freq)

names(`LPS 01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `LPS 01`)
names(horario_GUAPILES_psico)[3] <- "LPS 01"
horario_GUAPILES_psico$`LPS 01`[is.na(horario_GUAPILES_psico$`LPS 01`)] <- 0


#LPS 04

`LPS 04` <- as.data.frame(count(`GUAPILES-psico-materias-LPS 04`$HORARIO)) 

`LPS 04`$freq <- (`LPS 04`$freq)/sum(`LPS 04`$freq)

names(`LPS 04`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `LPS 04`)
names(horario_GUAPILES_psico)[4] <- "LPS 04"
horario_GUAPILES_psico$`LPS 04`[is.na(horario_GUAPILES_psico$`LPS 04`)] <- 0


#BIE-01

`BIE-01` <- as.data.frame(count(`GUAPILES-psico-materias-BIE-01`$HORARIO)) 

`BIE-01`$freq <- (`BIE-01`$freq)/sum(`BIE-01`$freq)

names(`BIE-01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `BIE-01`)
names(horario_GUAPILES_psico)[5] <- "BIE-01"
horario_GUAPILES_psico$`BIE-01`[is.na(horario_GUAPILES_psico$`BIE-01`)] <- 0


#BING 01

`BING 01` <- as.data.frame(count(`GUAPILES-psico-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `BING 01`)
names(horario_GUAPILES_psico)[6] <- "BING 01"
horario_GUAPILES_psico$`BING 01`[is.na(horario_GUAPILES_psico$`BING 01`)] <- 0


#GUAPILES-ter_fis

`GUAPILES-ter_fis-materias` <- split(`GUAPILES-ter_fis`, f = `GUAPILES-ter_fis`$cod_padre) 
names(`GUAPILES-ter_fis-materias`) <- paste0("GUAPILES-ter_fis-materias-",names(`GUAPILES-ter_fis-materias`)) 

list2env(`GUAPILES-ter_fis-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_ter_fis <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_ter_fis)[1] <- "horario"
horario_GUAPILES_ter_fis <- unique(horario_GUAPILES_ter_fis)


`obs_GUAPILES-ter_fis-materias` <- as.data.frame(sapply(`GUAPILES-ter_fis-materias`, NROW))

`obs_GUAPILES-ter_fis-materias` <- tibble::rownames_to_column(`obs_GUAPILES-ter_fis-materias`, "materia")
names(`obs_GUAPILES-ter_fis-materias`)[2] <- "obs"

`obs_GUAPILES-ter_fis-materias`$materia <- str_remove(`obs_GUAPILES-ter_fis-materias`$materia, "GUAPILES-ter_fis-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-ter_fis-materias` <- filter(`obs_GUAPILES-ter_fis-materias`, obs >= 10)
`no_elegibles_GUAPILES-ter_fis-materias` <- filter(`obs_GUAPILES-ter_fis-materias`, obs < 10)


#BAN-040

`BAN-040` <- as.data.frame(count(`GUAPILES-ter_fis-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_GUAPILES_ter_fis <- left_join(horario_GUAPILES_ter_fis, `BAN-040`)
names(horario_GUAPILES_ter_fis)[2] <- "BAN-040"

horario_GUAPILES_ter_fis$`BAN-040`[is.na(horario_GUAPILES_ter_fis$`BAN-040`)] <- 0



#BDE-42

`BDE-42` <- as.data.frame(count(`GUAPILES-ter_fis-materias-BDE-42`$HORARIO)) 

`BDE-42`$freq <- (`BDE-42`$freq)/sum(`BDE-42`$freq)

names(`BDE-42`)[1] <- "horario"

horario_GUAPILES_ter_fis <- left_join(horario_GUAPILES_ter_fis, `BDE-42`)
names(horario_GUAPILES_ter_fis)[3] <- "BDE-42"

horario_GUAPILES_ter_fis$`BDE-42`[is.na(horario_GUAPILES_ter_fis$`BDE-42`)] <- 0



## wide to long 

horario_GUAPILES_ter_fis$id <- "Ulatina_GUAPILES_ter_fis_pand_c2"
horario_GUAPILES_ter_fis <-  horario_GUAPILES_ter_fis%>% dplyr::select(id, everything())

horario_GUAPILES_ter_fis <- melt(horario_GUAPILES_ter_fis, id = c("id", "horario"))
names(horario_GUAPILES_ter_fis)[3] <- "materia"
names(horario_GUAPILES_ter_fis)[4] <- "asistencia"


#GUAPILES-comput

`GUAPILES-comput-materias` <- split(`GUAPILES-comput`, f = `GUAPILES-comput`$cod_padre) 
names(`GUAPILES-comput-materias`) <- paste0("GUAPILES-comput-materias-",names(`GUAPILES-comput-materias`)) 

list2env(`GUAPILES-comput-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_comput <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_comput)[1] <- "horario"
horario_GUAPILES_comput <- unique(horario_GUAPILES_comput)


`obs_GUAPILES-comput-materias` <- as.data.frame(sapply(`GUAPILES-comput-materias`, NROW))

`obs_GUAPILES-comput-materias` <- tibble::rownames_to_column(`obs_GUAPILES-comput-materias`, "materia")
names(`obs_GUAPILES-comput-materias`)[2] <- "obs"

`obs_GUAPILES-comput-materias`$materia <- str_remove(`obs_GUAPILES-comput-materias`$materia, "GUAPILES-comput-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-comput-materias` <- filter(`obs_GUAPILES-comput-materias`, obs >= 10)
`no_elegibles_GUAPILES-comput-materias` <- filter(`obs_GUAPILES-comput-materias`, obs < 10)


#BCS-01

`BCS-01` <- as.data.frame(count(`GUAPILES-comput-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_GUAPILES_comput <- left_join(horario_GUAPILES_comput, `BCS-01`)
names(horario_GUAPILES_comput)[2] <- "BCS-01"

horario_GUAPILES_comput$`BCS-01`[is.na(horario_GUAPILES_comput$`BCS-01`)] <- 0



#BIS01

BIS01 <- as.data.frame(count(`GUAPILES-comput-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_GUAPILES_comput <- left_join(horario_GUAPILES_comput, BIS01)
names(horario_GUAPILES_comput)[3] <- "BIS01"

horario_GUAPILES_comput$BIS01[is.na(horario_GUAPILES_comput$BIS01)] <- 0


#BIS02

BIS02 <- as.data.frame(count(`GUAPILES-comput-materias-BIS02`$HORARIO)) 

BIS02$freq <- (BIS02$freq)/sum(BIS02$freq)

names(BIS02)[1] <- "horario"

horario_GUAPILES_comput <- left_join(horario_GUAPILES_comput, BIS02)
names(horario_GUAPILES_comput)[4] <- "BIS02"

horario_GUAPILES_comput$BIS02[is.na(horario_GUAPILES_comput$BIS02)] <- 0



#BIS03

BIS03 <- as.data.frame(count(`GUAPILES-comput-materias-BIS03`$HORARIO)) 

BIS03$freq <- (BIS03$freq)/sum(BIS03$freq)

names(BIS03)[1] <- "horario"

horario_GUAPILES_comput <- left_join(horario_GUAPILES_comput, BIS03)
names(horario_GUAPILES_comput)[5] <- "BIS03"

horario_GUAPILES_comput$BIS03[is.na(horario_GUAPILES_comput$BIS03)] <- 0



#BMA 01

`BMA 01` <- as.data.frame(count(`GUAPILES-comput-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_GUAPILES_comput <- left_join(horario_GUAPILES_comput, `BMA 01`)
names(horario_GUAPILES_comput)[6] <- "BMA 01"

horario_GUAPILES_comput$`BMA 01`[is.na(horario_GUAPILES_comput$`BMA 01`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`GUAPILES-comput-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_GUAPILES_comput <- left_join(horario_GUAPILES_comput, `BPE 27`)
names(horario_GUAPILES_comput)[7] <- "BPE 27"

horario_GUAPILES_comput$`BPE 27`[is.na(horario_GUAPILES_comput$`BPE 27`)] <- 0



## wide to long 

horario_GUAPILES_comput$id <- "Ulatina_GUAPILES_comput_pand_c2"
horario_GUAPILES_comput <-  horario_GUAPILES_comput%>% dplyr::select(id, everything())

horario_GUAPILES_comput <- melt(horario_GUAPILES_comput, id = c("id", "horario"))
names(horario_GUAPILES_comput)[3] <- "materia"
names(horario_GUAPILES_comput)[4] <- "asistencia"



#GUAPILES-psico

`GUAPILES-psico-materias` <- split(`GUAPILES-psico`, f = `GUAPILES-psico`$cod_padre) 
names(`GUAPILES-psico-materias`) <- paste0("GUAPILES-psico-materias-",names(`GUAPILES-psico-materias`)) 

list2env(`GUAPILES-psico-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_GUAPILES_psico <- as.data.frame(pf_latina$HORARIO)
names(horario_GUAPILES_psico)[1] <- "horario"
horario_GUAPILES_psico <- unique(horario_GUAPILES_psico)


`obs_GUAPILES-psico-materias` <- as.data.frame(sapply(`GUAPILES-psico-materias`, NROW))

`obs_GUAPILES-psico-materias` <- tibble::rownames_to_column(`obs_GUAPILES-psico-materias`, "materia")
names(`obs_GUAPILES-psico-materias`)[2] <- "obs"

`obs_GUAPILES-psico-materias`$materia <- str_remove(`obs_GUAPILES-psico-materias`$materia, "GUAPILES-psico-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_GUAPILES-psico-materias` <- filter(`obs_GUAPILES-psico-materias`, obs >= 10)
`no_elegibles_GUAPILES-psico-materias` <- filter(`obs_GUAPILES-psico-materias`, obs < 10)



#LCTS-01

`LCTS-01` <- as.data.frame(count(`GUAPILES-psico-materias-LCTS-01`$HORARIO)) 

`LCTS-01`$freq <- (`LCTS-01`$freq)/sum(`LCTS-01`$freq)

names(`LCTS-01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `LCTS-01`)
names(horario_GUAPILES_psico)[2] <- "LCTS-01"

horario_GUAPILES_psico$`LCTS-01`[is.na(horario_GUAPILES_psico$`LCTS-01`)] <- 0



#LPS 01

`LPS 01` <- as.data.frame(count(`GUAPILES-psico-materias-LPS 01`$HORARIO)) 

`LPS 01`$freq <- (`LPS 01`$freq)/sum(`LPS 01`$freq)

names(`LPS 01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `LPS 01`)
names(horario_GUAPILES_psico)[3] <- "LPS 01"

horario_GUAPILES_psico$`LPS 01`[is.na(horario_GUAPILES_psico$`LPS 01`)] <- 0



#LPS 04

`LPS 04` <- as.data.frame(count(`GUAPILES-psico-materias-LPS 04`$HORARIO)) 

`LPS 04`$freq <- (`LPS 04`$freq)/sum(`LPS 04`$freq)

names(`LPS 04`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `LPS 04`)
names(horario_GUAPILES_psico)[4] <- "LPS 04"

horario_GUAPILES_psico$`LPS 04`[is.na(horario_GUAPILES_psico$`LPS 04`)] <- 0


#BIE-01

`BIE-01` <- as.data.frame(count(`GUAPILES-psico-materias-BIE-01`$HORARIO)) 

`BIE-01`$freq <- (`BIE-01`$freq)/sum(`BIE-01`$freq)

names(`BIE-01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `BIE-01`)
names(horario_GUAPILES_psico)[5] <- "BIE-01"

horario_GUAPILES_psico$`BIE-01`[is.na(horario_GUAPILES_psico$`BIE-01`)] <- 0


#BING 01

`BING 01` <- as.data.frame(count(`GUAPILES-psico-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_GUAPILES_psico <- left_join(horario_GUAPILES_psico, `BING 01`)
names(horario_GUAPILES_psico)[6] <- "BING 01"

horario_GUAPILES_psico$`BING 01`[is.na(horario_GUAPILES_psico$`BING 01`)] <- 0


## wide to long 

horario_GUAPILES_psico$id <- "Ulatina_GUAPILES_psico_pand_c2"
horario_GUAPILES_psico <-  horario_GUAPILES_psico%>% dplyr::select(id, everything())

horario_GUAPILES_psico <- melt(horario_GUAPILES_psico, id = c("id", "horario"))
names(horario_GUAPILES_psico)[3] <- "materia"
names(horario_GUAPILES_psico)[4] <- "asistencia"



#Consolidado de sede GUAPILES

horario_GUAPILES <- rbind(horario_GUAPILES_indus, horario_GUAPILES_derecho, horario_GUAPILES_ingles, 
                          horario_GUAPILES_admin_neg, horario_GUAPILES_conta, horario_GUAPILES_comput, horario_GUAPILES_educ,
                          horario_GUAPILES_enf,horario_GUAPILES_psico,horario_GUAPILES_ter_fis)

#total poblacion por carrera GUAPILES

materias_GUAPILES_pand_c2 <- count(GUAPILES$cod_padre)
names(materias_GUAPILES_pand_c2)[1] <- "materia"
names(materias_GUAPILES_pand_c2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_GUAPILES <- left_join(horario_GUAPILES, materias_GUAPILES_pand_c2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_GUAPILES$asistencia, by = list(horario_GUAPILES$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_GUAPILES <- left_join(horario_GUAPILES, pob_asist2)

horario_GUAPILES$asistencia2 <- horario_GUAPILES$asistencia/horario_GUAPILES$sum_prop
horario_GUAPILES$asistencia2[horario_GUAPILES$asistencia2 == Inf] <- 0

horario_GUAPILES$pob_asist <- round((horario_GUAPILES$asistencia2)*(horario_GUAPILES$poblacion),0)



#Guardo todos los horarios en su folder correspondiente


count(horario_GUAPILES$id)
Replaces <- data.frame(from = c("Ulatina_GUAPILES_admin_neg_pand_c2","Ulatina_GUAPILES_ter_fis_pand_c2", "Ulatina_GUAPILES_conta_pub_pand_c2"), 
                       to = c("Ulatina_GUAPILES_admin-neg_pand_c2", "Ulatina_GUAPILES_ter-fis_pand_c2", "Ulatina_GUAPILES_conta_pub-pand_c2"))
horario_GUAPILES <- FindReplace(data = horario_GUAPILES, Var = "id", replaceData = Replaces,
                                from = "from", to = "to", exact = FALSE)


write_xlsx(horario_GUAPILES,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/horario_GUAPILES_latina_pand_c2.xlsx")

write_xlsx(horario_GUAPILES_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/admin_neg_c2.xlsx")
write_xlsx(horario_GUAPILES_comput,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/computacion_c2.xlsx")
write_xlsx(horario_GUAPILES_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/contabilidad_c2.xlsx")
write_xlsx(horario_GUAPILES_conta_pub,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/contabilidad_pub_c2.xlsx")
write_xlsx(horario_GUAPILES_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/derecho_c2.xlsx")
write_xlsx(horario_GUAPILES_educ,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/educacion_c2.xlsx")
write_xlsx(horario_GUAPILES_enf,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/enfermeria_c2.xlsx")
write_xlsx(horario_GUAPILES_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/industrial_c2.xlsx")
write_xlsx(horario_GUAPILES_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/ingles_c2.xlsx")
write_xlsx(horario_GUAPILES_psico,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/psico_c2.xlsx")
write_xlsx(horario_GUAPILES_ter_fis,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/terapia_fisica_c2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_GUAPILES$id, "_", 5)

horario_GUAPILES <- cbind(split, horario_GUAPILES)
names(horario_GUAPILES)[1] <- "marca"
names(horario_GUAPILES)[2] <- "sede"
names(horario_GUAPILES)[3] <- "carrera"
names(horario_GUAPILES)[4] <- "modalidad"
names(horario_GUAPILES)[5] <- "cuatrimestre"

horario_GUAPILES <- horario_GUAPILES %>% dplyr::select(-id)


horario_GUAPILES_unique <- subset(horario_GUAPILES, pob_asist != 0)

horario_GUAPILES_unique <- horario_GUAPILES_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_GUAPILES_unique$marca <- "Ulatina"
horario_GUAPILES_unique$sede <- "GUAPILES"
horario_GUAPILES_unique$modalidad <- "pand"
horario_GUAPILES_unique$cuatrimestre <- "c2"

horario_GUAPILES_unique <- horario_GUAPILES_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_GUAPILES_unique <- horario_GUAPILES_unique[with(horario_GUAPILES_unique, order(materia, horario)), ]  

horario_GUAPILES_unique <- horario_GUAPILES_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_GUAPILES_unique$unoanueve <- 0
horario_GUAPILES_unique$unoanueve[horario_GUAPILES_unique$Asistencia <= 9] <- 1

horario_GUAPILES_unique$dieza17 <- 0
horario_GUAPILES_unique$dieza17[horario_GUAPILES_unique$Asistencia >= 10 & horario_GUAPILES_unique$Asistencia <= 17] <- 1

horario_GUAPILES_unique$di18a30 <- 0
horario_GUAPILES_unique$di18a30[horario_GUAPILES_unique$Asistencia >= 18 & horario_GUAPILES_unique$Asistencia <= 30] <- 1

horario_GUAPILES_unique$di31a60 <- 0
horario_GUAPILES_unique$di31a60[horario_GUAPILES_unique$Asistencia >= 31 & horario_GUAPILES_unique$Asistencia <= 60] <- 1

horario_GUAPILES_unique$mas60 <- 0
horario_GUAPILES_unique$mas60[horario_GUAPILES_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_GUAPILES_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_GUAPILES_unique <- left_join(horario_GUAPILES_unique, duplicados, by = "materia")

names(horario_GUAPILES_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_GUAPILES_unique$recomendacion <- 0
horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$unoanueve == 1 & horario_GUAPILES_unique$duplicado == 0] <- "cerrar horario"
horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$unoanueve == 1 & horario_GUAPILES_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$dieza17 == 1 & horario_GUAPILES_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$dieza17 == 1 & horario_GUAPILES_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_GUAPILES_unique$recomendacion[horario_GUAPILES_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_GUAPILES_unique <- horario_GUAPILES_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                      horario, materia, Asistencia, recomendacion)

horario_split <- as.data.frame(str_split_fixed(horario_GUAPILES_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_GUAPILES_unique <- cbind(horario_GUAPILES_unique, horario_split)
names(horario_GUAPILES_unique)

horario_GUAPILES_unique$recom_d <- 0
horario_GUAPILES_unique$recom_d[horario_GUAPILES_unique$recomendacion == "unir horario" | horario_GUAPILES_unique$recomendacion == "cerrar horario"] <- 0
horario_GUAPILES_unique$recom_d[horario_GUAPILES_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                                  horario_GUAPILES_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_GUAPILES_unique$recom_d[horario_GUAPILES_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_GUAPILES_unique$recom_d[horario_GUAPILES_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_GUAPILES_unique <- horario_GUAPILES_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)



write_xlsx(horario_GUAPILES_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_GUAPILES/recom_GUAPILES_latina_pand_c2.xlsx")



######## ULATINA SEDE HEREDIA #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_HEREDIA_carr <- split(HEREDIA, f = HEREDIA$carrera) 
names(ulat_HEREDIA_carr) <- paste0("HEREDIA-",names(ulat_HEREDIA_carr)) 

list2env(ulat_HEREDIA_carr,envir=.GlobalEnv)


#segundo anidado Sede-carrera-materias#

#HEREDIA-admin_hoteleria


`HEREDIA-admin_hoteleria-materias` <- split(`HEREDIA-admin_hoteleria`, f = `HEREDIA-admin_hoteleria`$cod_padre) 
names(`HEREDIA-admin_hoteleria-materias`) <- paste0("HEREDIA-admin_hoteleria-materias-",names(`HEREDIA-admin_hoteleria-materias`)) 

list2env(`HEREDIA-admin_hoteleria-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_admin_hoteleria <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_admin_hoteleria)[1] <- "horario"
horario_HEREDIA_admin_hoteleria <- unique(horario_HEREDIA_admin_hoteleria)


`obs_HEREDIA-admin_hoteleria-materias` <- as.data.frame(sapply(`HEREDIA-admin_hoteleria-materias`, NROW))

`obs_HEREDIA-admin_hoteleria-materias` <- tibble::rownames_to_column(`obs_HEREDIA-admin_hoteleria-materias`, "materia")
names(`obs_HEREDIA-admin_hoteleria-materias`)[2] <- "obs"

`obs_HEREDIA-admin_hoteleria-materias`$materia <- str_remove(`obs_HEREDIA-admin_hoteleria-materias`$materia, "HEREDIA-admin_hoteleria-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-admin_hoteleria-materias` <- filter(`obs_HEREDIA-admin_hoteleria-materias`, obs >= 10)
`no_elegibles_HEREDIA-admin_hoteleria-materias` <- filter(`obs_HEREDIA-admin_hoteleria-materias`, obs < 10)




#BAH 01

`BAH 01` <- as.data.frame(count(`HEREDIA-admin_hoteleria-materias-BAH 01`$HORARIO)) 

`BAH 01`$freq <- (`BAH 01`$freq)/sum(`BAH 01`$freq)

names(`BAH 01`)[1] <- "horario"

horario_HEREDIA_admin_hoteleria <- left_join(horario_HEREDIA_admin_hoteleria, `BAH 01`)
names(horario_HEREDIA_admin_hoteleria)[2] <- "BAH 01"

horario_HEREDIA_admin_hoteleria$`BAH 01`[is.na(horario_HEREDIA_admin_hoteleria$`BAH 01`)] <- 0


#BAH 04

`BAH 04` <- as.data.frame(count(`HEREDIA-admin_hoteleria-materias-BAH 04`$HORARIO)) 

`BAH 04`$freq <- (`BAH 04`$freq)/sum(`BAH 04`$freq)

names(`BAH 04`)[1] <- "horario"

horario_HEREDIA_admin_hoteleria <- left_join(horario_HEREDIA_admin_hoteleria, `BAH 04`)
names(horario_HEREDIA_admin_hoteleria)[3] <- "BAH 04"

horario_HEREDIA_admin_hoteleria$`BAH 04`[is.na(horario_HEREDIA_admin_hoteleria$`BAH 04`)] <- 0



##wide to long

horario_HEREDIA_admin_hoteleria$id <- "Ulatina_HEREDIA_admin_hoteleria_pand_C2"
horario_HEREDIA_admin_hoteleria <-  horario_HEREDIA_admin_hoteleria%>% dplyr::select(id, everything())

horario_HEREDIA_admin_hoteleria <- melt(horario_HEREDIA_admin_hoteleria, id = c("id", "horario"))
names(horario_HEREDIA_admin_hoteleria)[3] <- "materia"
names(horario_HEREDIA_admin_hoteleria)[4] <- "asistencia"


#HEREDIA-admin_neg


`HEREDIA-admin_neg-materias` <- split(`HEREDIA-admin_neg`, f = `HEREDIA-admin_neg`$cod_padre) 
names(`HEREDIA-admin_neg-materias`) <- paste0("HEREDIA-admin_neg-materias-",names(`HEREDIA-admin_neg-materias`)) 

list2env(`HEREDIA-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_admin_neg)[1] <- "horario"
horario_HEREDIA_admin_neg <- unique(horario_HEREDIA_admin_neg)


`obs_HEREDIA-admin_neg-materias` <- as.data.frame(sapply(`HEREDIA-admin_neg-materias`, NROW))

`obs_HEREDIA-admin_neg-materias` <- tibble::rownames_to_column(`obs_HEREDIA-admin_neg-materias`, "materia")
names(`obs_HEREDIA-admin_neg-materias`)[2] <- "obs"

`obs_HEREDIA-admin_neg-materias`$materia <- str_remove(`obs_HEREDIA-admin_neg-materias`$materia, "HEREDIA-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-admin_neg-materias` <- filter(`obs_HEREDIA-admin_neg-materias`, obs >= 10)
`no_elegibles_HEREDIA-admin_neg-materias` <- filter(`obs_HEREDIA-admin_neg-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`HEREDIA-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_HEREDIA_admin_neg <- left_join(horario_HEREDIA_admin_neg, `BAN 01`)
names(horario_HEREDIA_admin_neg)[2] <- "BAN 01"

horario_HEREDIA_admin_neg$`BAN 01`[is.na(horario_HEREDIA_admin_neg$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`HEREDIA-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_HEREDIA_admin_neg <- left_join(horario_HEREDIA_admin_neg, `BAN 03`)
names(horario_HEREDIA_admin_neg)[3] <- "BAN 03"

horario_HEREDIA_admin_neg$`BAN 03`[is.na(horario_HEREDIA_admin_neg$`BAN 03`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`HEREDIA-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_HEREDIA_admin_neg <- left_join(horario_HEREDIA_admin_neg, `BCP 01`)
names(horario_HEREDIA_admin_neg)[4] <- "BCP 01"

horario_HEREDIA_admin_neg$`BCP 01`[is.na(horario_HEREDIA_admin_neg$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`HEREDIA-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_HEREDIA_admin_neg <- left_join(horario_HEREDIA_admin_neg, `BMA 02`)
names(horario_HEREDIA_admin_neg)[5] <- "BMA 02"

horario_HEREDIA_admin_neg$`BMA 02`[is.na(horario_HEREDIA_admin_neg$`BMA 02`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`HEREDIA-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_HEREDIA_admin_neg <- left_join(horario_HEREDIA_admin_neg, `BPE 27`)
names(horario_HEREDIA_admin_neg)[6] <- "BPE 27"

horario_HEREDIA_admin_neg$`BPE 27`[is.na(horario_HEREDIA_admin_neg$`BPE 27`)] <- 0




#LAN 01

`LAN 01` <- as.data.frame(count(`HEREDIA-admin_neg-materias-LAN 01`$HORARIO)) 

`LAN 01`$freq <- (`LAN 01`$freq)/sum(`LAN 01`$freq)

names(`LAN 01`)[1] <- "horario"

horario_HEREDIA_admin_neg <- left_join(horario_HEREDIA_admin_neg, `LAN 01`)
names(horario_HEREDIA_admin_neg)[7] <- "LAN 01"

horario_HEREDIA_admin_neg$`LAN 01`[is.na(horario_HEREDIA_admin_neg$`LAN 01`)] <- 0


##wide to long

horario_HEREDIA_admin_neg$id <- "Ulatina_HEREDIA_admin_neg_pand_C2"
horario_HEREDIA_admin_neg <-  horario_HEREDIA_admin_neg%>% dplyr::select(id, everything())

horario_HEREDIA_admin_neg <- melt(horario_HEREDIA_admin_neg, id = c("id", "horario"))
names(horario_HEREDIA_admin_neg)[3] <- "materia"
names(horario_HEREDIA_admin_neg)[4] <- "asistencia"



#HEREDIA-anim_dig


`HEREDIA-anim_dig-materias` <- split(`HEREDIA-anim_dig`, f = `HEREDIA-anim_dig`$cod_padre) 
names(`HEREDIA-anim_dig-materias`) <- paste0("HEREDIA-anim_dig-materias-",names(`HEREDIA-anim_dig-materias`)) 

list2env(`HEREDIA-anim_dig-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_anim_dig <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_anim_dig)[1] <- "horario"
horario_HEREDIA_anim_dig <- unique(horario_HEREDIA_anim_dig)


`obs_HEREDIA-anim_dig-materias` <- as.data.frame(sapply(`HEREDIA-anim_dig-materias`, NROW))

`obs_HEREDIA-anim_dig-materias` <- tibble::rownames_to_column(`obs_HEREDIA-anim_dig-materias`, "materia")
names(`obs_HEREDIA-anim_dig-materias`)[2] <- "obs"

`obs_HEREDIA-anim_dig-materias`$materia <- str_remove(`obs_HEREDIA-anim_dig-materias`$materia, "HEREDIA-anim_dig-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-anim_dig-materias` <- filter(`obs_HEREDIA-anim_dig-materias`, obs >= 10)
`no_elegibles_HEREDIA-anim_dig-materias` <- filter(`obs_HEREDIA-anim_dig-materias`, obs < 10)




#NO SUFICIENTE INFORMACION PARA DEDUCIR


#HEREDIA-arquit


`HEREDIA-arquit-materias` <- split(`HEREDIA-arquit`, f = `HEREDIA-arquit`$cod_padre) 
names(`HEREDIA-arquit-materias`) <- paste0("HEREDIA-arquit-materias-",names(`HEREDIA-arquit-materias`)) 

list2env(`HEREDIA-arquit-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_arquit <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_arquit)[1] <- "horario"
horario_HEREDIA_arquit <- unique(horario_HEREDIA_arquit)


`obs_HEREDIA-arquit-materias` <- as.data.frame(sapply(`HEREDIA-arquit-materias`, NROW))

`obs_HEREDIA-arquit-materias` <- tibble::rownames_to_column(`obs_HEREDIA-arquit-materias`, "materia")
names(`obs_HEREDIA-arquit-materias`)[2] <- "obs"

`obs_HEREDIA-arquit-materias`$materia <- str_remove(`obs_HEREDIA-arquit-materias`$materia, "HEREDIA-arquit-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-arquit-materias` <- filter(`obs_HEREDIA-arquit-materias`, obs >= 10)
`no_elegibles_HEREDIA-arquit-materias` <- filter(`obs_HEREDIA-arquit-materias`, obs < 10)




#BAR-01

`BAR-01` <- as.data.frame(count(`HEREDIA-arquit-materias-BAR-01`$HORARIO)) 

`BAR-01`$freq <- (`BAR-01`$freq)/sum(`BAR-01`$freq)

names(`BAR-01`)[1] <- "horario"

horario_HEREDIA_arquit <- left_join(horario_HEREDIA_arquit, `BAR-01`)
names(horario_HEREDIA_arquit)[2] <- "BAR-01"

horario_HEREDIA_arquit$`BAR-01`[is.na(horario_HEREDIA_arquit$`BAR-01`)] <- 0


#BAR-03

`BAR-03` <- as.data.frame(count(`HEREDIA-arquit-materias-BAR-03`$HORARIO)) 

`BAR-03`$freq <- (`BAR-03`$freq)/sum(`BAR-03`$freq)

names(`BAR-03`)[1] <- "horario"

horario_HEREDIA_arquit <- left_join(horario_HEREDIA_arquit, `BAR-03`)
names(horario_HEREDIA_arquit)[3] <- "BAR-03"

horario_HEREDIA_arquit$`BAR-03`[is.na(horario_HEREDIA_arquit$`BAR-03`)] <- 0


#BAR-04

`BAR-04` <- as.data.frame(count(`HEREDIA-arquit-materias-BAR-04`$HORARIO)) 

`BAR-04`$freq <- (`BAR-04`$freq)/sum(`BAR-04`$freq)

names(`BAR-04`)[1] <- "horario"

horario_HEREDIA_arquit <- left_join(horario_HEREDIA_arquit, `BAR-04`)
names(horario_HEREDIA_arquit)[4] <- "BAR-04"

horario_HEREDIA_arquit$`BAR-04`[is.na(horario_HEREDIA_arquit$`BAR-04`)] <- 0


#BAR-05

`BAR-05` <- as.data.frame(count(`HEREDIA-arquit-materias-BAR-05`$HORARIO)) 

`BAR-05`$freq <- (`BAR-05`$freq)/sum(`BAR-05`$freq)

names(`BAR-05`)[1] <- "horario"

horario_HEREDIA_arquit <- left_join(horario_HEREDIA_arquit, `BAR-05`)
names(horario_HEREDIA_arquit)[5] <- "BAR-05"

horario_HEREDIA_arquit$`BAR-05`[is.na(horario_HEREDIA_arquit$`BAR-05`)] <- 0



#BDG 02

`BDG 02` <- as.data.frame(count(`HEREDIA-arquit-materias-BDG 02`$HORARIO)) 

`BDG 02`$freq <- (`BDG 02`$freq)/sum(`BDG 02`$freq)

names(`BDG 02`)[1] <- "horario"

horario_HEREDIA_arquit <- left_join(horario_HEREDIA_arquit, `BDG 02`)
names(horario_HEREDIA_arquit)[6] <- "BDG 02"

horario_HEREDIA_arquit$`BDG 02`[is.na(horario_HEREDIA_arquit$`BDG 02`)] <- 0



##wide to long

horario_HEREDIA_arquit$id <- "Ulatina_HEREDIA_arquit_pand_C2"
horario_HEREDIA_arquit <-  horario_HEREDIA_arquit%>% dplyr::select(id, everything())

horario_HEREDIA_arquit <- melt(horario_HEREDIA_arquit, id = c("id", "horario"))
names(horario_HEREDIA_arquit)[3] <- "materia"
names(horario_HEREDIA_arquit)[4] <- "asistencia"



#HEREDIA-civil


`HEREDIA-civil-materias` <- split(`HEREDIA-civil`, f = `HEREDIA-civil`$cod_padre) 
names(`HEREDIA-civil-materias`) <- paste0("HEREDIA-civil-materias-",names(`HEREDIA-civil-materias`)) 

list2env(`HEREDIA-civil-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_civil <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_civil)[1] <- "horario"
horario_HEREDIA_civil <- unique(horario_HEREDIA_civil)


`obs_HEREDIA-civil-materias` <- as.data.frame(sapply(`HEREDIA-civil-materias`, NROW))

`obs_HEREDIA-civil-materias` <- tibble::rownames_to_column(`obs_HEREDIA-civil-materias`, "materia")
names(`obs_HEREDIA-civil-materias`)[2] <- "obs"

`obs_HEREDIA-civil-materias`$materia <- str_remove(`obs_HEREDIA-civil-materias`$materia, "HEREDIA-civil-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-civil-materias` <- filter(`obs_HEREDIA-civil-materias`, obs >= 10)
`no_elegibles_HEREDIA-civil-materias` <- filter(`obs_HEREDIA-civil-materias`, obs < 10)




#BAN-04

`BAN-04` <- as.data.frame(count(`HEREDIA-civil-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BAN-04`)
names(horario_HEREDIA_civil)[2] <- "BAN-04"

horario_HEREDIA_civil$`BAN-04`[is.na(horario_HEREDIA_civil$`BAN-04`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`HEREDIA-civil-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BMA 01`)
names(horario_HEREDIA_civil)[3] <- "BMA 01"

horario_HEREDIA_civil$`BMA 01`[is.na(horario_HEREDIA_civil$`BMA 01`)] <- 0


#LIC 01

`LIC 01` <- as.data.frame(count(`HEREDIA-civil-materias-LIC 01`$HORARIO)) 

`LIC 01`$freq <- (`LIC 01`$freq)/sum(`LIC 01`$freq)

names(`LIC 01`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `LIC 01`)
names(horario_HEREDIA_civil)[4] <- "LIC 01"

horario_HEREDIA_civil$`LIC 01`[is.na(horario_HEREDIA_civil$`LIC 01`)] <- 0



#QUL-140

`QUL-140` <- as.data.frame(count(`HEREDIA-civil-materias-QUL-140`$HORARIO)) 

`QUL-140`$freq <- (`QUL-140`$freq)/sum(`QUL-140`$freq)

names(`QUL-140`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `QUL-140`)
names(horario_HEREDIA_civil)[5] <- "QUL-140"

horario_HEREDIA_civil$`QUL-140`[is.na(horario_HEREDIA_civil$`QUL-140`)] <- 0



#BDE-43

`BDE-43` <- as.data.frame(count(`HEREDIA-civil-materias-BDE-43`$HORARIO)) 

`BDE-43`$freq <- (`BDE-43`$freq)/sum(`BDE-43`$freq)

names(`BDE-43`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BDE-43`)
names(horario_HEREDIA_civil)[6] <- "BDE-43"

horario_HEREDIA_civil$`BDE-43`[is.na(horario_HEREDIA_civil$`BDE-43`)] <- 0


#BED-25

`BED-25` <- as.data.frame(count(`HEREDIA-civil-materias-BED-25`$HORARIO)) 

`BED-25`$freq <- (`BED-25`$freq)/sum(`BED-25`$freq)

names(`BED-25`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BED-25`)
names(horario_HEREDIA_civil)[7] <- "BED-25"

horario_HEREDIA_civil$`BED-25`[is.na(horario_HEREDIA_civil$`BED-25`)] <- 0



#BIN-01

`BIN-01` <- as.data.frame(count(`HEREDIA-civil-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BIN-01`)
names(horario_HEREDIA_civil)[8] <- "BIN-01"

horario_HEREDIA_civil$`BIN-01`[is.na(horario_HEREDIA_civil$`BIN-01`)] <- 0


#BING 01

`BING 01` <- as.data.frame(count(`HEREDIA-civil-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BING 01`)
names(horario_HEREDIA_civil)[9] <- "BING 01"

horario_HEREDIA_civil$`BING 01`[is.na(horario_HEREDIA_civil$`BING 01`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`HEREDIA-civil-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_HEREDIA_civil <- left_join(horario_HEREDIA_civil, `BPE 27`)
names(horario_HEREDIA_civil)[10] <- "BPE 27"

horario_HEREDIA_civil$`BPE 27`[is.na(horario_HEREDIA_civil$`BPE 27`)] <- 0


##wide to long

horario_HEREDIA_civil$id <- "Ulatina_HEREDIA_civil_pand_C2"
horario_HEREDIA_civil <-  horario_HEREDIA_civil%>% dplyr::select(id, everything())

horario_HEREDIA_civil <- melt(horario_HEREDIA_civil, id = c("id", "horario"))
names(horario_HEREDIA_civil)[3] <- "materia"
names(horario_HEREDIA_civil)[4] <- "asistencia"


#HEREDIA-comput


`HEREDIA-comput-materias` <- split(`HEREDIA-comput`, f = `HEREDIA-comput`$cod_padre) 
names(`HEREDIA-comput-materias`) <- paste0("HEREDIA-comput-materias-",names(`HEREDIA-comput-materias`)) 

list2env(`HEREDIA-comput-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_comput <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_comput)[1] <- "horario"
horario_HEREDIA_comput <- unique(horario_HEREDIA_comput)


`obs_HEREDIA-comput-materias` <- as.data.frame(sapply(`HEREDIA-comput-materias`, NROW))

`obs_HEREDIA-comput-materias` <- tibble::rownames_to_column(`obs_HEREDIA-comput-materias`, "materia")
names(`obs_HEREDIA-comput-materias`)[2] <- "obs"

`obs_HEREDIA-comput-materias`$materia <- str_remove(`obs_HEREDIA-comput-materias`$materia, "HEREDIA-comput-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-comput-materias` <- filter(`obs_HEREDIA-comput-materias`, obs >= 10)
`no_elegibles_HEREDIA-comput-materias` <- filter(`obs_HEREDIA-comput-materias`, obs < 10)


#BCS01

BCS01 <- as.data.frame(count(`HEREDIA-comput-materias-BCS01`$HORARIO)) 

BCS01$freq <- (BCS01$freq)/sum(BCS01$freq)

names(BCS01)[1] <- "horario"

horario_HEREDIA_comput <- left_join(horario_HEREDIA_comput, BCS01)
names(horario_HEREDIA_comput)[2] <- "BCS01"

horario_HEREDIA_comput$BCS01[is.na(horario_HEREDIA_comput$BCS01)] <- 0


#BIS03

BIS03 <- as.data.frame(count(`HEREDIA-comput-materias-BIS03`$HORARIO)) 

BIS03$freq <- (BIS03$freq)/sum(BIS03$freq)

names(BIS03)[1] <- "horario"

horario_HEREDIA_comput <- left_join(horario_HEREDIA_comput, BIS03)
names(horario_HEREDIA_comput)[3] <- "BIS03"

horario_HEREDIA_comput$BIS03[is.na(horario_HEREDIA_comput$BIS03)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`HEREDIA-comput-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_HEREDIA_comput <- left_join(horario_HEREDIA_comput, `BMA 01`)
names(horario_HEREDIA_comput)[4] <- "BMA 01"

horario_HEREDIA_comput$`BMA 01`[is.na(horario_HEREDIA_comput$`BMA 01`)] <- 0



#BAN 01

`BAN 01` <- as.data.frame(count(`HEREDIA-comput-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_HEREDIA_comput <- left_join(horario_HEREDIA_comput, `BAN 01`)
names(horario_HEREDIA_comput)[5] <- "BAN 01"

horario_HEREDIA_comput$`BAN 01`[is.na(horario_HEREDIA_comput$`BAN 01`)] <- 0


#BIS01

BIS01 <- as.data.frame(count(`HEREDIA-comput-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_HEREDIA_comput <- left_join(horario_HEREDIA_comput, BIS01)
names(horario_HEREDIA_comput)[6] <- "BIS01"

horario_HEREDIA_comput$BIS01[is.na(horario_HEREDIA_comput$BIS01)] <- 0



##wide to long

horario_HEREDIA_comput$id <- "Ulatina_HEREDIA_comput_pand_C2"
horario_HEREDIA_comput <-  horario_HEREDIA_comput%>% dplyr::select(id, everything())

horario_HEREDIA_comput <- melt(horario_HEREDIA_comput, id = c("id", "horario"))
names(horario_HEREDIA_comput)[3] <- "materia"
names(horario_HEREDIA_comput)[4] <- "asistencia"


#HEREDIA-conta


`HEREDIA-conta-materias` <- split(`HEREDIA-conta`, f = `HEREDIA-conta`$cod_padre) 
names(`HEREDIA-conta-materias`) <- paste0("HEREDIA-conta-materias-",names(`HEREDIA-conta-materias`)) 

list2env(`HEREDIA-conta-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_conta <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_conta)[1] <- "horario"
horario_HEREDIA_conta <- unique(horario_HEREDIA_conta)


`obs_HEREDIA-conta-materias` <- as.data.frame(sapply(`HEREDIA-conta-materias`, NROW))

`obs_HEREDIA-conta-materias` <- tibble::rownames_to_column(`obs_HEREDIA-conta-materias`, "materia")
names(`obs_HEREDIA-conta-materias`)[2] <- "obs"

`obs_HEREDIA-conta-materias`$materia <- str_remove(`obs_HEREDIA-conta-materias`$materia, "HEREDIA-conta-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-conta-materias` <- filter(`obs_HEREDIA-conta-materias`, obs >= 10)
`no_elegibles_HEREDIA-conta-materias` <- filter(`obs_HEREDIA-conta-materias`, obs < 10)


#NO SUFICIENTE PARA INFERIR HORARIOS


#HEREDIA-conta_pub


`HEREDIA-conta_pub-materias` <- split(`HEREDIA-conta_pub`, f = `HEREDIA-conta_pub`$cod_padre) 
names(`HEREDIA-conta_pub-materias`) <- paste0("HEREDIA-conta_pub-materias-",names(`HEREDIA-conta_pub-materias`)) 

list2env(`HEREDIA-conta_pub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_conta_pub <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_conta_pub)[1] <- "horario"
horario_HEREDIA_conta_pub <- unique(horario_HEREDIA_conta_pub)


`obs_HEREDIA-conta_pub-materias` <- as.data.frame(sapply(`HEREDIA-conta_pub-materias`, NROW))

`obs_HEREDIA-conta_pub-materias` <- tibble::rownames_to_column(`obs_HEREDIA-conta_pub-materias`, "materia")
names(`obs_HEREDIA-conta_pub-materias`)[2] <- "obs"

`obs_HEREDIA-conta_pub-materias`$materia <- str_remove(`obs_HEREDIA-conta_pub-materias`$materia, "HEREDIA-conta_pub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-conta_pub-materias` <- filter(`obs_HEREDIA-conta_pub-materias`, obs >= 10)
`no_elegibles_HEREDIA-conta_pub-materias` <- filter(`obs_HEREDIA-conta_pub-materias`, obs < 10)


#DATA NO SUFICIENTE PARA INFERIR


#HEREDIA-derecho


`HEREDIA-derecho-materias` <- split(`HEREDIA-derecho`, f = `HEREDIA-derecho`$cod_padre) 
names(`HEREDIA-derecho-materias`) <- paste0("HEREDIA-derecho-materias-",names(`HEREDIA-derecho-materias`)) 

list2env(`HEREDIA-derecho-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_derecho <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_derecho)[1] <- "horario"
horario_HEREDIA_derecho <- unique(horario_HEREDIA_derecho)


`obs_HEREDIA-derecho-materias` <- as.data.frame(sapply(`HEREDIA-derecho-materias`, NROW))

`obs_HEREDIA-derecho-materias` <- tibble::rownames_to_column(`obs_HEREDIA-derecho-materias`, "materia")
names(`obs_HEREDIA-derecho-materias`)[2] <- "obs"

`obs_HEREDIA-derecho-materias`$materia <- str_remove(`obs_HEREDIA-derecho-materias`$materia, "HEREDIA-derecho-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-derecho-materias` <- filter(`obs_HEREDIA-derecho-materias`, obs >= 10)
`no_elegibles_HEREDIA-derecho-materias` <- filter(`obs_HEREDIA-derecho-materias`, obs < 10)




#BAN-02

`BAN-02` <- as.data.frame(count(`HEREDIA-derecho-materias-BAN-02`$HORARIO)) 

`BAN-02`$freq <- (`BAN-02`$freq)/sum(`BAN-02`$freq)

names(`BAN-02`)[1] <- "horario"

horario_HEREDIA_derecho <- left_join(horario_HEREDIA_derecho, `BAN-02`)
names(horario_HEREDIA_derecho)[2] <- "BAN-02"

horario_HEREDIA_derecho$`BAN-02`[is.na(horario_HEREDIA_derecho$`BAN-02`)] <- 0



#BAN 03

`BAN 03` <- as.data.frame(count(`HEREDIA-derecho-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_HEREDIA_derecho <- left_join(horario_HEREDIA_derecho, `BAN 03`)
names(horario_HEREDIA_derecho)[3] <- "BAN 03"

horario_HEREDIA_derecho$`BAN 03`[is.na(horario_HEREDIA_derecho$`BAN 03`)] <- 0



#BDE-33

`BDE-33` <- as.data.frame(count(`HEREDIA-derecho-materias-BDE-33`$HORARIO)) 

`BDE-33`$freq <- (`BDE-33`$freq)/sum(`BDE-33`$freq)

names(`BDE-33`)[1] <- "horario"

horario_HEREDIA_derecho <- left_join(horario_HEREDIA_derecho, `BDE-33`)
names(horario_HEREDIA_derecho)[4] <- "BDE-33"

horario_HEREDIA_derecho$`BDE-33`[is.na(horario_HEREDIA_derecho$`BDE-33`)] <- 0



#BDE-42

`BDE-42` <- as.data.frame(count(`HEREDIA-derecho-materias-BDE-42`$HORARIO)) 

`BDE-42`$freq <- (`BDE-42`$freq)/sum(`BDE-42`$freq)

names(`BDE-42`)[1] <- "horario"

horario_HEREDIA_derecho <- left_join(horario_HEREDIA_derecho, `BDE-42`)
names(horario_HEREDIA_derecho)[5] <- "BDE-42"

horario_HEREDIA_derecho$`BDE-42`[is.na(horario_HEREDIA_derecho$`BDE-42`)] <- 0



##wide to long

horario_HEREDIA_derecho$id <- "Ulatina_HEREDIA_derecho_pand_C2"
horario_HEREDIA_derecho <-  horario_HEREDIA_derecho%>% dplyr::select(id, everything())

horario_HEREDIA_derecho <- melt(horario_HEREDIA_derecho, id = c("id", "horario"))
names(horario_HEREDIA_derecho)[3] <- "materia"
names(horario_HEREDIA_derecho)[4] <- "asistencia"



#HEREDIA-dis_graf


`HEREDIA-dis_graf-materias` <- split(`HEREDIA-dis_graf`, f = `HEREDIA-dis_graf`$cod_padre) 
names(`HEREDIA-dis_graf-materias`) <- paste0("HEREDIA-dis_graf-materias-",names(`HEREDIA-dis_graf-materias`)) 

list2env(`HEREDIA-dis_graf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_dis_graf <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_dis_graf)[1] <- "horario"
horario_HEREDIA_dis_graf <- unique(horario_HEREDIA_dis_graf)


`obs_HEREDIA-dis_graf-materias` <- as.data.frame(sapply(`HEREDIA-dis_graf-materias`, NROW))

`obs_HEREDIA-dis_graf-materias` <- tibble::rownames_to_column(`obs_HEREDIA-dis_graf-materias`, "materia")
names(`obs_HEREDIA-dis_graf-materias`)[2] <- "obs"

`obs_HEREDIA-dis_graf-materias`$materia <- str_remove(`obs_HEREDIA-dis_graf-materias`$materia, "HEREDIA-dis_graf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-dis_graf-materias` <- filter(`obs_HEREDIA-dis_graf-materias`, obs >= 10)
`no_elegibles_HEREDIA-dis_graf-materias` <- filter(`obs_HEREDIA-dis_graf-materias`, obs < 10)




#BAN-03

`BAN-03` <- as.data.frame(count(`HEREDIA-dis_graf-materias-BAN-03`$HORARIO)) 

`BAN-03`$freq <- (`BAN-03`$freq)/sum(`BAN-03`$freq)

names(`BAN-03`)[1] <- "horario"

horario_HEREDIA_dis_graf <- left_join(horario_HEREDIA_dis_graf, `BAN-03`)
names(horario_HEREDIA_dis_graf)[2] <- "BAN-03"

horario_HEREDIA_dis_graf$`BAN-03`[is.na(horario_HEREDIA_dis_graf$`BAN-03`)] <- 0


#BPE 02

`BPE 02` <- as.data.frame(count(`HEREDIA-dis_graf-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_HEREDIA_dis_graf <- left_join(horario_HEREDIA_dis_graf, `BPE 02`)
names(horario_HEREDIA_dis_graf)[3] <- "BPE 02"

horario_HEREDIA_dis_graf$`BPE 02`[is.na(horario_HEREDIA_dis_graf$`BPE 02`)] <- 0



#BPU 01

`BPU 01` <- as.data.frame(count(`HEREDIA-dis_graf-materias-BPU 01`$HORARIO)) 

`BPU 01`$freq <- (`BPU 01`$freq)/sum(`BPU 01`$freq)

names(`BPU 01`)[1] <- "horario"

horario_HEREDIA_dis_graf <- left_join(horario_HEREDIA_dis_graf, `BPU 01`)
names(horario_HEREDIA_dis_graf)[4] <- "BPU 01"

horario_HEREDIA_dis_graf$`BPU 01`[is.na(horario_HEREDIA_dis_graf$`BPU 01`)] <- 0


##wide to long

horario_HEREDIA_dis_graf$id <- "Ulatina_HEREDIA_dis_graf_pand_C2"
horario_HEREDIA_dis_graf <-  horario_HEREDIA_dis_graf%>% dplyr::select(id, everything())

horario_HEREDIA_dis_graf <- melt(horario_HEREDIA_dis_graf, id = c("id", "horario"))
names(horario_HEREDIA_dis_graf)[3] <- "materia"
names(horario_HEREDIA_dis_graf)[4] <- "asistencia"




#HEREDIA-dis_int


`HEREDIA-dis_int-materias` <- split(`HEREDIA-dis_int`, f = `HEREDIA-dis_int`$cod_padre) 
names(`HEREDIA-dis_int-materias`) <- paste0("HEREDIA-dis_int-materias-",names(`HEREDIA-dis_int-materias`)) 

list2env(`HEREDIA-dis_int-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_dis_int <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_dis_int)[1] <- "horario"
horario_HEREDIA_dis_int <- unique(horario_HEREDIA_dis_int)


`obs_HEREDIA-dis_int-materias` <- as.data.frame(sapply(`HEREDIA-dis_int-materias`, NROW))

`obs_HEREDIA-dis_int-materias` <- tibble::rownames_to_column(`obs_HEREDIA-dis_int-materias`, "materia")
names(`obs_HEREDIA-dis_int-materias`)[2] <- "obs"

`obs_HEREDIA-dis_int-materias`$materia <- str_remove(`obs_HEREDIA-dis_int-materias`$materia, "HEREDIA-dis_int-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-dis_int-materias` <- filter(`obs_HEREDIA-dis_int-materias`, obs >= 10)
`no_elegibles_HEREDIA-dis_int-materias` <- filter(`obs_HEREDIA-dis_int-materias`, obs < 10)




#BAR-03

`BAR-03` <- as.data.frame(count(`HEREDIA-dis_int-materias-BAR-03`$HORARIO)) 

`BAR-03`$freq <- (`BAR-03`$freq)/sum(`BAR-03`$freq)

names(`BAR-03`)[1] <- "horario"

horario_HEREDIA_dis_int <- left_join(horario_HEREDIA_dis_int, `BAR-03`)
names(horario_HEREDIA_dis_int)[2] <- "BAR-03"

horario_HEREDIA_dis_int$`BAR-03`[is.na(horario_HEREDIA_dis_int$`BAR-03`)] <- 0



#BAR-08

`BAR-08` <- as.data.frame(count(`HEREDIA-dis_int-materias-BAR-08`$HORARIO)) 

`BAR-08`$freq <- (`BAR-08`$freq)/sum(`BAR-08`$freq)

names(`BAR-08`)[1] <- "horario"

horario_HEREDIA_dis_int <- left_join(horario_HEREDIA_dis_int, `BAR-08`)
names(horario_HEREDIA_dis_int)[3] <- "BAR-08"

horario_HEREDIA_dis_int$`BAR-08`[is.na(horario_HEREDIA_dis_int$`BAR-08`)] <- 0



#BAR-15

`BAR-15` <- as.data.frame(count(`HEREDIA-dis_int-materias-BAR-15`$HORARIO)) 

`BAR-15`$freq <- (`BAR-15`$freq)/sum(`BAR-15`$freq)

names(`BAR-15`)[1] <- "horario"

horario_HEREDIA_dis_int <- left_join(horario_HEREDIA_dis_int, `BAR-15`)
names(horario_HEREDIA_dis_int)[4] <- "BAR-15"

horario_HEREDIA_dis_int$`BAR-15`[is.na(horario_HEREDIA_dis_int$`BAR-15`)] <- 0



#BAR-18

`BAR-18` <- as.data.frame(count(`HEREDIA-dis_int-materias-BAR-18`$HORARIO)) 

`BAR-18`$freq <- (`BAR-18`$freq)/sum(`BAR-18`$freq)

names(`BAR-18`)[1] <- "horario"

horario_HEREDIA_dis_int <- left_join(horario_HEREDIA_dis_int, `BAR-18`)
names(horario_HEREDIA_dis_int)[5] <- "BAR-18"

horario_HEREDIA_dis_int$`BAR-18`[is.na(horario_HEREDIA_dis_int$`BAR-18`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`HEREDIA-dis_int-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_HEREDIA_dis_int <- left_join(horario_HEREDIA_dis_int, `BPE 27`)
names(horario_HEREDIA_dis_int)[6] <- "BPE 27"

horario_HEREDIA_dis_int$`BPE 27`[is.na(horario_HEREDIA_dis_int$`BPE 27`)] <- 0


##wide to long

horario_HEREDIA_dis_int$id <- "Ulatina_HEREDIA_dis_int_pand_C2"
horario_HEREDIA_dis_int <-  horario_HEREDIA_dis_int%>% dplyr::select(id, everything())

horario_HEREDIA_dis_int <- melt(horario_HEREDIA_dis_int, id = c("id", "horario"))
names(horario_HEREDIA_dis_int)[3] <- "materia"
names(horario_HEREDIA_dis_int)[4] <- "asistencia"



#HEREDIA-elect


`HEREDIA-elect-materias` <- split(`HEREDIA-elect`, f = `HEREDIA-elect`$cod_padre) 
names(`HEREDIA-elect-materias`) <- paste0("HEREDIA-elect-materias-",names(`HEREDIA-elect-materias`)) 

list2env(`HEREDIA-elect-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_elect <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_elect)[1] <- "horario"
horario_HEREDIA_elect <- unique(horario_HEREDIA_elect)


`obs_HEREDIA-elect-materias` <- as.data.frame(sapply(`HEREDIA-elect-materias`, NROW))

`obs_HEREDIA-elect-materias` <- tibble::rownames_to_column(`obs_HEREDIA-elect-materias`, "materia")
names(`obs_HEREDIA-elect-materias`)[2] <- "obs"

`obs_HEREDIA-elect-materias`$materia <- str_remove(`obs_HEREDIA-elect-materias`$materia, "HEREDIA-elect-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-elect-materias` <- filter(`obs_HEREDIA-elect-materias`, obs >= 10)
`no_elegibles_HEREDIA-elect-materias` <- filter(`obs_HEREDIA-elect-materias`, obs < 10)




#BMA 01

`BMA 01` <- as.data.frame(count(`HEREDIA-elect-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_HEREDIA_elect <- left_join(horario_HEREDIA_elect, `BMA 01`)
names(horario_HEREDIA_elect)[2] <- "BMA 01"

horario_HEREDIA_elect$`BMA 01`[is.na(horario_HEREDIA_elect$`BMA 01`)] <- 0



#BAN-04

`BAN-04` <- as.data.frame(count(`HEREDIA-elect-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_HEREDIA_elect <- left_join(horario_HEREDIA_elect, `BAN-04`)
names(horario_HEREDIA_elect)[3] <- "BAN-04"

horario_HEREDIA_elect$`BAN-04`[is.na(horario_HEREDIA_elect$`BAN-04`)] <- 0


#IN-010

`IN-010` <- as.data.frame(count(`HEREDIA-elect-materias-IN-010`$HORARIO)) 

`IN-010`$freq <- (`IN-010`$freq)/sum(`IN-010`$freq)

names(`IN-010`)[1] <- "horario"

horario_HEREDIA_elect <- left_join(horario_HEREDIA_elect, `IN-010`)
names(horario_HEREDIA_elect)[4] <- "IN-010"

horario_HEREDIA_elect$`IN-010`[is.na(horario_HEREDIA_elect$`IN-010`)] <- 0

#QUL-140

`QUL-140` <- as.data.frame(count(`HEREDIA-elect-materias-QUL-140`$HORARIO)) 

`QUL-140`$freq <- (`QUL-140`$freq)/sum(`QUL-140`$freq)

names(`QUL-140`)[1] <- "horario"

horario_HEREDIA_elect <- left_join(horario_HEREDIA_elect, `QUL-140`)
names(horario_HEREDIA_elect)[5] <- "QUL-140"

horario_HEREDIA_elect$`QUL-140`[is.na(horario_HEREDIA_elect$`QUL-140`)] <- 0



##wide to long

horario_HEREDIA_elect$id <- "Ulatina_HEREDIA_elect_pand_C2"
horario_HEREDIA_elect <-  horario_HEREDIA_elect%>% dplyr::select(id, everything())

horario_HEREDIA_elect <- melt(horario_HEREDIA_elect, id = c("id", "horario"))
names(horario_HEREDIA_elect)[3] <- "materia"
names(horario_HEREDIA_elect)[4] <- "asistencia"



#HEREDIA-elect_mec


`HEREDIA-elect_mec-materias` <- split(`HEREDIA-elect_mec`, f = `HEREDIA-elect_mec`$cod_padre) 
names(`HEREDIA-elect_mec-materias`) <- paste0("HEREDIA-elect_mec-materias-",names(`HEREDIA-elect_mec-materias`)) 

list2env(`HEREDIA-elect_mec-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_elect_mec <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_elect_mec)[1] <- "horario"
horario_HEREDIA_elect_mec <- unique(horario_HEREDIA_elect_mec)


`obs_HEREDIA-elect_mec-materias` <- as.data.frame(sapply(`HEREDIA-elect_mec-materias`, NROW))

`obs_HEREDIA-elect_mec-materias` <- tibble::rownames_to_column(`obs_HEREDIA-elect_mec-materias`, "materia")
names(`obs_HEREDIA-elect_mec-materias`)[2] <- "obs"

`obs_HEREDIA-elect_mec-materias`$materia <- str_remove(`obs_HEREDIA-elect_mec-materias`$materia, "HEREDIA-elect_mec-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-elect_mec-materias` <- filter(`obs_HEREDIA-elect_mec-materias`, obs >= 10)
`no_elegibles_HEREDIA-elect_mec-materias` <- filter(`obs_HEREDIA-elect_mec-materias`, obs < 10)




#BAN 05

`BAN 05` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BAN 05`$HORARIO)) 

`BAN 05`$freq <- (`BAN 05`$freq)/sum(`BAN 05`$freq)

names(`BAN 05`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BAN 05`)
names(horario_HEREDIA_elect_mec)[2] <- "BAN 05"

horario_HEREDIA_elect_mec$`BAN 05`[is.na(horario_HEREDIA_elect_mec$`BAN 05`)] <- 0



#BDE-43

`BDE-43` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BDE-43`$HORARIO)) 

`BDE-43`$freq <- (`BDE-43`$freq)/sum(`BDE-43`$freq)

names(`BDE-43`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BDE-43`)
names(horario_HEREDIA_elect_mec)[3] <- "BDE-43"

horario_HEREDIA_elect_mec$`BDE-43`[is.na(horario_HEREDIA_elect_mec$`BDE-43`)] <- 0



#BFIS 02

`BFIS 02` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BFIS 02`$HORARIO)) 

`BFIS 02`$freq <- (`BFIS 02`$freq)/sum(`BFIS 02`$freq)

names(`BFIS 02`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BFIS 02`)
names(horario_HEREDIA_elect_mec)[4] <- "BFIS 02"

horario_HEREDIA_elect_mec$`BFIS 02`[is.na(horario_HEREDIA_elect_mec$`BFIS 02`)] <- 0



#BPE 02

`BPE 02` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BPE 02`)
names(horario_HEREDIA_elect_mec)[5] <- "BPE 02"

horario_HEREDIA_elect_mec$`BPE 02`[is.na(horario_HEREDIA_elect_mec$`BPE 02`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BPE 27`)
names(horario_HEREDIA_elect_mec)[6] <- "BPE 27"

horario_HEREDIA_elect_mec$`BPE 27`[is.na(horario_HEREDIA_elect_mec$`BPE 27`)] <- 0


#IN-010

`IN-010` <- as.data.frame(count(`HEREDIA-elect_mec-materias-IN-010`$HORARIO)) 

`IN-010`$freq <- (`IN-010`$freq)/sum(`IN-010`$freq)

names(`IN-010`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `IN-010`)
names(horario_HEREDIA_elect_mec)[7] <- "IN-010"

horario_HEREDIA_elect_mec$`IN-010`[is.na(horario_HEREDIA_elect_mec$`IN-010`)] <- 0


#BED-34

`BED-34` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BED-34`$HORARIO)) 

`BED-34`$freq <- (`BED-34`$freq)/sum(`BED-34`$freq)

names(`BED-34`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BED-34`)
names(horario_HEREDIA_elect_mec)[8] <- "BED-34"

horario_HEREDIA_elect_mec$`BED-34`[is.na(horario_HEREDIA_elect_mec$`BED-34`)] <- 0


#BING 01

`BING 01` <- as.data.frame(count(`HEREDIA-elect_mec-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_HEREDIA_elect_mec <- left_join(horario_HEREDIA_elect_mec, `BING 01`)
names(horario_HEREDIA_elect_mec)[9] <- "BING 01"

horario_HEREDIA_elect_mec$`BING 01`[is.na(horario_HEREDIA_elect_mec$`BING 01`)] <- 0




##wide to long

horario_HEREDIA_elect_mec$id <- "Ulatina_HEREDIA_elect_mec_pand_C2"
horario_HEREDIA_elect_mec <-  horario_HEREDIA_elect_mec%>% dplyr::select(id, everything())

horario_HEREDIA_elect_mec <- melt(horario_HEREDIA_elect_mec, id = c("id", "horario"))
names(horario_HEREDIA_elect_mec)[3] <- "materia"
names(horario_HEREDIA_elect_mec)[4] <- "asistencia"



#HEREDIA-gastro


`HEREDIA-gastro-materias` <- split(`HEREDIA-gastro`, f = `HEREDIA-gastro`$cod_padre) 
names(`HEREDIA-gastro-materias`) <- paste0("HEREDIA-gastro-materias-",names(`HEREDIA-gastro-materias`)) 

list2env(`HEREDIA-gastro-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_gastro <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_gastro)[1] <- "horario"
horario_HEREDIA_gastro <- unique(horario_HEREDIA_gastro)


`obs_HEREDIA-gastro-materias` <- as.data.frame(sapply(`HEREDIA-gastro-materias`, NROW))

`obs_HEREDIA-gastro-materias` <- tibble::rownames_to_column(`obs_HEREDIA-gastro-materias`, "materia")
names(`obs_HEREDIA-gastro-materias`)[2] <- "obs"

`obs_HEREDIA-gastro-materias`$materia <- str_remove(`obs_HEREDIA-gastro-materias`$materia, "HEREDIA-gastro-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-gastro-materias` <- filter(`obs_HEREDIA-gastro-materias`, obs >= 10)
`no_elegibles_HEREDIA-gastro-materias` <- filter(`obs_HEREDIA-gastro-materias`, obs < 10)




#BDE-43

`BDE-43` <- as.data.frame(count(`HEREDIA-gastro-materias-BDE-43`$HORARIO)) 

`BDE-43`$freq <- (`BDE-43`$freq)/sum(`BDE-43`$freq)

names(`BDE-43`)[1] <- "horario"

horario_HEREDIA_gastro <- left_join(horario_HEREDIA_gastro, `BDE-43`)
names(horario_HEREDIA_gastro)[2] <- "BDE-43"

horario_HEREDIA_gastro$`BDE-43`[is.na(horario_HEREDIA_gastro$`BDE-43`)] <- 0



#BDG 01

`BDG 01` <- as.data.frame(count(`HEREDIA-gastro-materias-BDG 01`$HORARIO)) 

`BDG 01`$freq <- (`BDG 01`$freq)/sum(`BDG 01`$freq)

names(`BDG 01`)[1] <- "horario"

horario_HEREDIA_gastro <- left_join(horario_HEREDIA_gastro, `BDG 01`)
names(horario_HEREDIA_gastro)[3] <- "BDG 01"

horario_HEREDIA_gastro$`BDG 01`[is.na(horario_HEREDIA_gastro$`BDG 01`)] <- 0



#BDG 02

`BDG 02` <- as.data.frame(count(`HEREDIA-gastro-materias-BDG 02`$HORARIO)) 

`BDG 02`$freq <- (`BDG 02`$freq)/sum(`BDG 02`$freq)

names(`BDG 02`)[1] <- "horario"

horario_HEREDIA_gastro <- left_join(horario_HEREDIA_gastro, `BDG 02`)
names(horario_HEREDIA_gastro)[4] <- "BDG 02"

horario_HEREDIA_gastro$`BDG 02`[is.na(horario_HEREDIA_gastro$`BDG 02`)] <- 0



#BDG 03

`BDG 03` <- as.data.frame(count(`HEREDIA-gastro-materias-BDG 03`$HORARIO)) 

`BDG 03`$freq <- (`BDG 03`$freq)/sum(`BDG 03`$freq)

names(`BDG 03`)[1] <- "horario"

horario_HEREDIA_gastro <- left_join(horario_HEREDIA_gastro, `BDG 03`)
names(horario_HEREDIA_gastro)[5] <- "BDG 03"

horario_HEREDIA_gastro$`BDG 03`[is.na(horario_HEREDIA_gastro$`BDG 03`)] <- 0


#EG100

EG100 <- as.data.frame(count(`HEREDIA-gastro-materias-EG100`$HORARIO)) 

EG100$freq <- (EG100$freq)/sum(EG100$freq)

names(EG100)[1] <- "horario"

horario_HEREDIA_gastro <- left_join(horario_HEREDIA_gastro, EG100)
names(horario_HEREDIA_gastro)[6] <- "EG100"

horario_HEREDIA_gastro$EG100[is.na(horario_HEREDIA_gastro$EG100)] <- 0

#BED-25

`BED-25` <- as.data.frame(count(`HEREDIA-gastro-materias-BED-25`$HORARIO)) 

`BED-25`$freq <- (`BED-25`$freq)/sum(`BED-25`$freq)

names(`BED-25`)[1] <- "horario"

horario_HEREDIA_gastro <- left_join(horario_HEREDIA_gastro, `BED-25`)
names(horario_HEREDIA_gastro)[7] <- "BED-25"

horario_HEREDIA_gastro$`BED-25`[is.na(horario_HEREDIA_gastro$`BED-25`)] <- 0


##wide to long

horario_HEREDIA_gastro$id <- "Ulatina_HEREDIA_gastro_pand_C2"
horario_HEREDIA_gastro <-  horario_HEREDIA_gastro%>% dplyr::select(id, everything())

horario_HEREDIA_gastro <- melt(horario_HEREDIA_gastro, id = c("id", "horario"))
names(horario_HEREDIA_gastro)[3] <- "materia"
names(horario_HEREDIA_gastro)[4] <- "asistencia"


#HEREDIA-indus


`HEREDIA-indus-materias` <- split(`HEREDIA-indus`, f = `HEREDIA-indus`$cod_padre) 
names(`HEREDIA-indus-materias`) <- paste0("HEREDIA-indus-materias-",names(`HEREDIA-indus-materias`)) 

list2env(`HEREDIA-indus-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_indus <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_indus)[1] <- "horario"
horario_HEREDIA_indus <- unique(horario_HEREDIA_indus)


`obs_HEREDIA-indus-materias` <- as.data.frame(sapply(`HEREDIA-indus-materias`, NROW))

`obs_HEREDIA-indus-materias` <- tibble::rownames_to_column(`obs_HEREDIA-indus-materias`, "materia")
names(`obs_HEREDIA-indus-materias`)[2] <- "obs"

`obs_HEREDIA-indus-materias`$materia <- str_remove(`obs_HEREDIA-indus-materias`$materia, "HEREDIA-indus-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-indus-materias` <- filter(`obs_HEREDIA-indus-materias`, obs >= 10)
`no_elegibles_HEREDIA-indus-materias` <- filter(`obs_HEREDIA-indus-materias`, obs < 10)




#BAN-04

`BAN-04` <- as.data.frame(count(`HEREDIA-indus-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `BAN-04`)
names(horario_HEREDIA_indus)[2] <- "BAN-04"

horario_HEREDIA_indus$`BAN-04`[is.na(horario_HEREDIA_indus$`BAN-04`)] <- 0



#BAR-02

`BAR-02` <- as.data.frame(count(`HEREDIA-indus-materias-BAR-02`$HORARIO)) 

`BAR-02`$freq <- (`BAR-02`$freq)/sum(`BAR-02`$freq)

names(`BAR-02`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `BAR-02`)
names(horario_HEREDIA_indus)[3] <- "BAR-02"

horario_HEREDIA_indus$`BAR-02`[is.na(horario_HEREDIA_indus$`BAR-02`)] <- 0

#BII 01

`BII 01` <- as.data.frame(count(`HEREDIA-indus-materias-BII 01`$HORARIO)) 

`BII 01`$freq <- (`BII 01`$freq)/sum(`BII 01`$freq)

names(`BII 01`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `BII 01`)
names(horario_HEREDIA_indus)[4] <- "BII 01"

horario_HEREDIA_indus$`BII 01`[is.na(horario_HEREDIA_indus$`BII 01`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`HEREDIA-indus-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `BMA 01`)
names(horario_HEREDIA_indus)[5] <- "BMA 01"

horario_HEREDIA_indus$`BMA 01`[is.na(horario_HEREDIA_indus$`BMA 01`)] <- 0



#BPE 02

`BPE 02` <- as.data.frame(count(`HEREDIA-indus-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `BPE 02`)
names(horario_HEREDIA_indus)[6] <- "BPE 02"

horario_HEREDIA_indus$`BPE 02`[is.na(horario_HEREDIA_indus$`BPE 02`)] <- 0



#BPE 27

`BPE 27` <- as.data.frame(count(`HEREDIA-indus-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `BPE 27`)
names(horario_HEREDIA_indus)[7] <- "BPE 27"

horario_HEREDIA_indus$`BPE 27`[is.na(horario_HEREDIA_indus$`BPE 27`)] <- 0


#QUL-140

`QUL-140` <- as.data.frame(count(`HEREDIA-indus-materias-QUL-140`$HORARIO)) 

`QUL-140`$freq <- (`QUL-140`$freq)/sum(`QUL-140`$freq)

names(`QUL-140`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `QUL-140`)
names(horario_HEREDIA_indus)[8] <- "QUL-140"

horario_HEREDIA_indus$`QUL-140`[is.na(horario_HEREDIA_indus$`QUL-140`)] <- 0




#IM-430

`IM-430` <- as.data.frame(count(`HEREDIA-indus-materias-IM-430`$HORARIO)) 

`IM-430`$freq <- (`IM-430`$freq)/sum(`IM-430`$freq)

names(`IM-430`)[1] <- "horario"

horario_HEREDIA_indus <- left_join(horario_HEREDIA_indus, `IM-430`)
names(horario_HEREDIA_indus)[9] <- "IM-430"

horario_HEREDIA_indus$`IM-430`[is.na(horario_HEREDIA_indus$`IM-430`)] <- 0


##wide to long

horario_HEREDIA_indus$id <- "Ulatina_HEREDIA_indus_pand_C2"
horario_HEREDIA_indus <-  horario_HEREDIA_indus%>% dplyr::select(id, everything())

horario_HEREDIA_indus <- melt(horario_HEREDIA_indus, id = c("id", "horario"))
names(horario_HEREDIA_indus)[3] <- "materia"
names(horario_HEREDIA_indus)[4] <- "asistencia"



#HEREDIA-mec_adm


`HEREDIA-mec_adm-materias` <- split(`HEREDIA-mec_adm`, f = `HEREDIA-mec_adm`$cod_padre) 
names(`HEREDIA-mec_adm-materias`) <- paste0("HEREDIA-mec_adm-materias-",names(`HEREDIA-mec_adm-materias`)) 

list2env(`HEREDIA-mec_adm-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_mec_adm <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_mec_adm)[1] <- "horario"
horario_HEREDIA_mec_adm <- unique(horario_HEREDIA_mec_adm)


`obs_HEREDIA-mec_adm-materias` <- as.data.frame(sapply(`HEREDIA-mec_adm-materias`, NROW))

`obs_HEREDIA-mec_adm-materias` <- tibble::rownames_to_column(`obs_HEREDIA-mec_adm-materias`, "materia")
names(`obs_HEREDIA-mec_adm-materias`)[2] <- "obs"

`obs_HEREDIA-mec_adm-materias`$materia <- str_remove(`obs_HEREDIA-mec_adm-materias`$materia, "HEREDIA-mec_adm-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-mec_adm-materias` <- filter(`obs_HEREDIA-mec_adm-materias`, obs >= 10)
`no_elegibles_HEREDIA-mec_adm-materias` <- filter(`obs_HEREDIA-mec_adm-materias`, obs < 10)




#BAN 05

`BAN 05` <- as.data.frame(count(`HEREDIA-mec_adm-materias-BAN 05`$HORARIO)) 

`BAN 05`$freq <- (`BAN 05`$freq)/sum(`BAN 05`$freq)

names(`BAN 05`)[1] <- "horario"

horario_HEREDIA_mec_adm <- left_join(horario_HEREDIA_mec_adm, `BAN 05`)
names(horario_HEREDIA_mec_adm)[2] <- "BAN 05"

horario_HEREDIA_mec_adm$`BAN 05`[is.na(horario_HEREDIA_mec_adm$`BAN 05`)] <- 0



#BDE-43

`BDE-43` <- as.data.frame(count(`HEREDIA-mec_adm-materias-BDE-43`$HORARIO)) 

`BDE-43`$freq <- (`BDE-43`$freq)/sum(`BDE-43`$freq)

names(`BDE-43`)[1] <- "horario"

horario_HEREDIA_mec_adm <- left_join(horario_HEREDIA_mec_adm, `BDE-43`)
names(horario_HEREDIA_mec_adm)[3] <- "BDE-43"

horario_HEREDIA_mec_adm$`BDE-43`[is.na(horario_HEREDIA_mec_adm$`BDE-43`)] <- 0




#IN-010

`IN-010` <- as.data.frame(count(`HEREDIA-mec_adm-materias-IN-010`$HORARIO)) 

`IN-010`$freq <- (`IN-010`$freq)/sum(`IN-010`$freq)

names(`IN-010`)[1] <- "horario"

horario_HEREDIA_mec_adm <- left_join(horario_HEREDIA_mec_adm, `IN-010`)
names(horario_HEREDIA_mec_adm)[4] <- "IN-010"

horario_HEREDIA_mec_adm$`IN-010`[is.na(horario_HEREDIA_mec_adm$`IN-010`)] <- 0




#BING 01

`BING 01` <- as.data.frame(count(`HEREDIA-mec_adm-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_HEREDIA_mec_adm <- left_join(horario_HEREDIA_mec_adm, `BING 01`)
names(horario_HEREDIA_mec_adm)[5] <- "BING 01"

horario_HEREDIA_mec_adm$`BING 01`[is.na(horario_HEREDIA_mec_adm$`BING 01`)] <- 0


##wide to long

horario_HEREDIA_mec_adm$id <- "Ulatina_HEREDIA_mec_adm_pand_C2"
horario_HEREDIA_mec_adm <-  horario_HEREDIA_mec_adm%>% dplyr::select(id, everything())

horario_HEREDIA_mec_adm <- melt(horario_HEREDIA_mec_adm, id = c("id", "horario"))
names(horario_HEREDIA_mec_adm)[3] <- "materia"
names(horario_HEREDIA_mec_adm)[4] <- "asistencia"


#HEREDIA-period


`HEREDIA-period-materias` <- split(`HEREDIA-period`, f = `HEREDIA-period`$cod_padre) 
names(`HEREDIA-period-materias`) <- paste0("HEREDIA-period-materias-",names(`HEREDIA-period-materias`)) 

list2env(`HEREDIA-period-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_period <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_period)[1] <- "horario"
horario_HEREDIA_period <- unique(horario_HEREDIA_period)


`obs_HEREDIA-period-materias` <- as.data.frame(sapply(`HEREDIA-period-materias`, NROW))

`obs_HEREDIA-period-materias` <- tibble::rownames_to_column(`obs_HEREDIA-period-materias`, "materia")
names(`obs_HEREDIA-period-materias`)[2] <- "obs"

`obs_HEREDIA-period-materias`$materia <- str_remove(`obs_HEREDIA-period-materias`$materia, "HEREDIA-period-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-period-materias` <- filter(`obs_HEREDIA-period-materias`, obs >= 10)
`no_elegibles_HEREDIA-period-materias` <- filter(`obs_HEREDIA-period-materias`, obs < 10)




#NO SUFICIENTE INFORMACION

#HEREDIA-psico


`HEREDIA-psico-materias` <- split(`HEREDIA-psico`, f = `HEREDIA-psico`$cod_padre) 
names(`HEREDIA-psico-materias`) <- paste0("HEREDIA-psico-materias-",names(`HEREDIA-psico-materias`)) 

list2env(`HEREDIA-psico-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_psico <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_psico)[1] <- "horario"
horario_HEREDIA_psico <- unique(horario_HEREDIA_psico)


`obs_HEREDIA-psico-materias` <- as.data.frame(sapply(`HEREDIA-psico-materias`, NROW))

`obs_HEREDIA-psico-materias` <- tibble::rownames_to_column(`obs_HEREDIA-psico-materias`, "materia")
names(`obs_HEREDIA-psico-materias`)[2] <- "obs"

`obs_HEREDIA-psico-materias`$materia <- str_remove(`obs_HEREDIA-psico-materias`$materia, "HEREDIA-psico-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-psico-materias` <- filter(`obs_HEREDIA-psico-materias`, obs >= 10)
`no_elegibles_HEREDIA-psico-materias` <- filter(`obs_HEREDIA-psico-materias`, obs < 10)




#BFIS 01

`BFIS 01` <- as.data.frame(count(`HEREDIA-psico-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_HEREDIA_psico <- left_join(horario_HEREDIA_psico, `BFIS 01`)
names(horario_HEREDIA_psico)[2] <- "BFIS 01"

horario_HEREDIA_psico$`BFIS 01`[is.na(horario_HEREDIA_psico$`BFIS 01`)] <- 0



#LPS 01

`LPS 01` <- as.data.frame(count(`HEREDIA-psico-materias-LPS 01`$HORARIO)) 

`LPS 01`$freq <- (`LPS 01`$freq)/sum(`LPS 01`$freq)

names(`LPS 01`)[1] <- "horario"

horario_HEREDIA_psico <- left_join(horario_HEREDIA_psico, `LPS 01`)
names(horario_HEREDIA_psico)[3] <- "LPS 01"

horario_HEREDIA_psico$`LPS 01`[is.na(horario_HEREDIA_psico$`LPS 01`)] <- 0


#LPS 05

`LPS 05` <- as.data.frame(count(`HEREDIA-psico-materias-LPS 05`$HORARIO)) 

`LPS 05`$freq <- (`LPS 05`$freq)/sum(`LPS 05`$freq)

names(`LPS 05`)[1] <- "horario"

horario_HEREDIA_psico <- left_join(horario_HEREDIA_psico, `LPS 05`)
names(horario_HEREDIA_psico)[4] <- "LPS 05"

horario_HEREDIA_psico$`LPS 05`[is.na(horario_HEREDIA_psico$`LPS 05`)] <- 0


##wide to long

horario_HEREDIA_psico$id <- "Ulatina_HEREDIA_psico_pand_C2"
horario_HEREDIA_psico <-  horario_HEREDIA_psico%>% dplyr::select(id, everything())

horario_HEREDIA_psico <- melt(horario_HEREDIA_psico, id = c("id", "horario"))
names(horario_HEREDIA_psico)[3] <- "materia"
names(horario_HEREDIA_psico)[4] <- "asistencia"


#HEREDIA-publ


`HEREDIA-publ-materias` <- split(`HEREDIA-publ`, f = `HEREDIA-publ`$cod_padre) 
names(`HEREDIA-publ-materias`) <- paste0("HEREDIA-publ-materias-",names(`HEREDIA-publ-materias`)) 

list2env(`HEREDIA-publ-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_publ <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_publ)[1] <- "horario"
horario_HEREDIA_publ <- unique(horario_HEREDIA_publ)


`obs_HEREDIA-publ-materias` <- as.data.frame(sapply(`HEREDIA-publ-materias`, NROW))

`obs_HEREDIA-publ-materias` <- tibble::rownames_to_column(`obs_HEREDIA-publ-materias`, "materia")
names(`obs_HEREDIA-publ-materias`)[2] <- "obs"

`obs_HEREDIA-publ-materias`$materia <- str_remove(`obs_HEREDIA-publ-materias`$materia, "HEREDIA-publ-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-publ-materias` <- filter(`obs_HEREDIA-publ-materias`, obs >= 10)
`no_elegibles_HEREDIA-publ-materias` <- filter(`obs_HEREDIA-publ-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`HEREDIA-publ-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_HEREDIA_publ <- left_join(horario_HEREDIA_publ, `BAN 01`)
names(horario_HEREDIA_publ)[2] <- "BAN 01"

horario_HEREDIA_publ$`BAN 01`[is.na(horario_HEREDIA_publ$`BAN 01`)] <- 0



#BPE 02

`BPE 02` <- as.data.frame(count(`HEREDIA-publ-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_HEREDIA_publ <- left_join(horario_HEREDIA_publ, `BPE 02`)
names(horario_HEREDIA_publ)[3] <- "BPE 02"

horario_HEREDIA_publ$`BPE 02`[is.na(horario_HEREDIA_publ$`BPE 02`)] <- 0



#BPU-20

`BPU-20` <- as.data.frame(count(`HEREDIA-publ-materias-BPU-20`$HORARIO)) 

`BPU-20`$freq <- (`BPU-20`$freq)/sum(`BPU-20`$freq)

names(`BPU-20`)[1] <- "horario"

horario_HEREDIA_publ <- left_join(horario_HEREDIA_publ, `BPU-20`)
names(horario_HEREDIA_publ)[4] <- "BPU-20"

horario_HEREDIA_publ$`BPU-20`[is.na(horario_HEREDIA_publ$`BPU-20`)] <- 0


#EG100

EG100 <- as.data.frame(count(`HEREDIA-publ-materias-EG100`$HORARIO)) 

EG100$freq <- (EG100$freq)/sum(EG100$freq)

names(EG100)[1] <- "horario"

horario_HEREDIA_publ <- left_join(horario_HEREDIA_publ, EG100)
names(horario_HEREDIA_publ)[5] <- "EG100"

horario_HEREDIA_publ$EG100[is.na(horario_HEREDIA_publ$EG100)] <- 0



##wide to long

horario_HEREDIA_publ$id <- "Ulatina_HEREDIA_publ_pand_C2"
horario_HEREDIA_publ <-  horario_HEREDIA_publ%>% dplyr::select(id, everything())

horario_HEREDIA_publ <- melt(horario_HEREDIA_publ, id = c("id", "horario"))
names(horario_HEREDIA_publ)[3] <- "materia"
names(horario_HEREDIA_publ)[4] <- "asistencia"


#HEREDIA-relpub


`HEREDIA-relpub-materias` <- split(`HEREDIA-relpub`, f = `HEREDIA-relpub`$cod_padre) 
names(`HEREDIA-relpub-materias`) <- paste0("HEREDIA-relpub-materias-",names(`HEREDIA-relpub-materias`)) 

list2env(`HEREDIA-relpub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_relpub <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_relpub)[1] <- "horario"
horario_HEREDIA_relpub <- unique(horario_HEREDIA_relpub)


`obs_HEREDIA-relpub-materias` <- as.data.frame(sapply(`HEREDIA-relpub-materias`, NROW))

`obs_HEREDIA-relpub-materias` <- tibble::rownames_to_column(`obs_HEREDIA-relpub-materias`, "materia")
names(`obs_HEREDIA-relpub-materias`)[2] <- "obs"

`obs_HEREDIA-relpub-materias`$materia <- str_remove(`obs_HEREDIA-relpub-materias`$materia, "HEREDIA-relpub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-relpub-materias` <- filter(`obs_HEREDIA-relpub-materias`, obs >= 10)
`no_elegibles_HEREDIA-relpub-materias` <- filter(`obs_HEREDIA-relpub-materias`, obs < 10)



#BAN 01

`BAN 01` <- as.data.frame(count(`HEREDIA-relpub-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_HEREDIA_relpub <- left_join(horario_HEREDIA_relpub, `BAN 01`)
names(horario_HEREDIA_relpub)[2] <- "BAN 01"

horario_HEREDIA_relpub$`BAN 01`[is.na(horario_HEREDIA_relpub$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`HEREDIA-relpub-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_HEREDIA_relpub <- left_join(horario_HEREDIA_relpub, `BAN 03`)
names(horario_HEREDIA_relpub)[3] <- "BAN 03"

horario_HEREDIA_relpub$`BAN 03`[is.na(horario_HEREDIA_relpub$`BAN 03`)] <- 0


#BDE-42

`BDE-42` <- as.data.frame(count(`HEREDIA-relpub-materias-BDE-42`$HORARIO)) 

`BDE-42`$freq <- (`BDE-42`$freq)/sum(`BDE-42`$freq)

names(`BDE-42`)[1] <- "horario"

horario_HEREDIA_relpub <- left_join(horario_HEREDIA_relpub, `BDE-42`)
names(horario_HEREDIA_relpub)[4] <- "BDE-42"

horario_HEREDIA_relpub$`BDE-42`[is.na(horario_HEREDIA_relpub$`BDE-42`)] <- 0


#BIN-03

`BIN-03` <- as.data.frame(count(`HEREDIA-relpub-materias-BIN-03`$HORARIO)) 

`BIN-03`$freq <- (`BIN-03`$freq)/sum(`BIN-03`$freq)

names(`BIN-03`)[1] <- "horario"

horario_HEREDIA_relpub <- left_join(horario_HEREDIA_relpub, `BIN-03`)
names(horario_HEREDIA_relpub)[5] <- "BIN-03"

horario_HEREDIA_relpub$`BIN-03`[is.na(horario_HEREDIA_relpub$`BIN-03`)] <- 0


#BPE 02

`BPE 02` <- as.data.frame(count(`HEREDIA-relpub-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_HEREDIA_relpub <- left_join(horario_HEREDIA_relpub, `BPE 02`)
names(horario_HEREDIA_relpub)[6] <- "BPE 02"

horario_HEREDIA_relpub$`BPE 02`[is.na(horario_HEREDIA_relpub$`BPE 02`)] <- 0


#BPU-22

`BPU-22` <- as.data.frame(count(`HEREDIA-relpub-materias-BPU-22`$HORARIO)) 

`BPU-22`$freq <- (`BPU-22`$freq)/sum(`BPU-22`$freq)

names(`BPU-22`)[1] <- "horario"

horario_HEREDIA_relpub <- left_join(horario_HEREDIA_relpub, `BPU-22`)
names(horario_HEREDIA_relpub)[7] <- "BPU-22"

horario_HEREDIA_relpub$`BPU-22`[is.na(horario_HEREDIA_relpub$`BPU-22`)] <- 0



##wide to long

horario_HEREDIA_relpub$id <- "Ulatina_HEREDIA_relpub_pand_C2"
horario_HEREDIA_relpub <-  horario_HEREDIA_relpub%>% dplyr::select(id, everything())

horario_HEREDIA_relpub <- melt(horario_HEREDIA_relpub, id = c("id", "horario"))
names(horario_HEREDIA_relpub)[3] <- "materia"
names(horario_HEREDIA_relpub)[4] <- "asistencia"



#HEREDIA-seg_inf


`HEREDIA-seg_inf-materias` <- split(`HEREDIA-seg_inf`, f = `HEREDIA-seg_inf`$cod_padre) 
names(`HEREDIA-seg_inf-materias`) <- paste0("HEREDIA-seg_inf-materias-",names(`HEREDIA-seg_inf-materias`)) 

list2env(`HEREDIA-seg_inf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_HEREDIA_seg_inf <- as.data.frame(pf_latina$HORARIO)
names(horario_HEREDIA_seg_inf)[1] <- "horario"
horario_HEREDIA_seg_inf <- unique(horario_HEREDIA_seg_inf)


`obs_HEREDIA-seg_inf-materias` <- as.data.frame(sapply(`HEREDIA-seg_inf-materias`, NROW))

`obs_HEREDIA-seg_inf-materias` <- tibble::rownames_to_column(`obs_HEREDIA-seg_inf-materias`, "materia")
names(`obs_HEREDIA-seg_inf-materias`)[2] <- "obs"

`obs_HEREDIA-seg_inf-materias`$materia <- str_remove(`obs_HEREDIA-seg_inf-materias`$materia, "HEREDIA-seg_inf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_HEREDIA-seg_inf-materias` <- filter(`obs_HEREDIA-seg_inf-materias`, obs >= 10)
`no_elegibles_HEREDIA-seg_inf-materias` <- filter(`obs_HEREDIA-seg_inf-materias`, obs < 10)


#BING 01

`BING 01` <- as.data.frame(count(`HEREDIA-seg_inf-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_HEREDIA_seg_inf <- left_join(horario_HEREDIA_seg_inf, `BING 01`)
names(horario_HEREDIA_seg_inf)[2] <- "BING 01"

horario_HEREDIA_seg_inf$`BING 01`[is.na(horario_HEREDIA_seg_inf$`BING 01`)] <- 0



##wide to long

horario_HEREDIA_seg_inf$id <- "Ulatina_HEREDIA_seg_inf_pand_C2"
horario_HEREDIA_seg_inf <-  horario_HEREDIA_seg_inf%>% dplyr::select(id, everything())

horario_HEREDIA_seg_inf <- melt(horario_HEREDIA_seg_inf, id = c("id", "horario"))
names(horario_HEREDIA_seg_inf)[3] <- "materia"
names(horario_HEREDIA_seg_inf)[4] <- "asistencia"




#Consolidado de sede HEREDIA

horario_HEREDIA <- rbind(horario_HEREDIA_admin_hoteleria, horario_HEREDIA_admin_neg,
                         horario_HEREDIA_arquit, horario_HEREDIA_civil, horario_HEREDIA_comput,
                         horario_HEREDIA_derecho,horario_HEREDIA_dis_graf,horario_HEREDIA_dis_int,horario_HEREDIA_elect,
                         horario_HEREDIA_elect_mec,horario_HEREDIA_gastro,horario_HEREDIA_indus,horario_HEREDIA_mec_adm,
                         horario_HEREDIA_psico,horario_HEREDIA_publ,horario_HEREDIA_relpub,horario_HEREDIA_seg_inf)

#total poblacion por carrera HEREDIA

materias_HEREDIA_pand_C2 <- count(HEREDIA$cod_padre)
names(materias_HEREDIA_pand_C2)[1] <- "materia"
names(materias_HEREDIA_pand_C2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_HEREDIA <- left_join(horario_HEREDIA, materias_HEREDIA_pand_C2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_HEREDIA$asistencia, by = list(horario_HEREDIA$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_HEREDIA <- left_join(horario_HEREDIA, pob_asist2)

horario_HEREDIA$asistencia2 <- horario_HEREDIA$asistencia/horario_HEREDIA$sum_prop
horario_HEREDIA$asistencia2[horario_HEREDIA$asistencia2 == Inf] <- 0

horario_HEREDIA$pob_asist <- round((horario_HEREDIA$asistencia2)*(horario_HEREDIA$poblacion),0)


#Guardo todos los horarios en su folder correspondiente

count(horario_HEREDIA$id)
Replaces <- data.frame(from = c("Ulatina_HEREDIA_admin_neg_pand_C2","Ulatina_HEREDIA_ter_fis_pand_C2", 
                                "Ulatina_HEREDIA_conta_pub_pand_C2","Ulatina_HEREDIA_admin_hoteleria_pand_C2",
                                "Ulatina_HEREDIA_anim_dig_pand_C2", "Ulatina_HEREDIA_civil_pand_C2"
                                ,"Ulatina_HEREDIA_dis_graf_pand_C2","Ulatina_HEREDIA_dis_int_pand_C2"
                                ,"Ulatina_HEREDIA_elect_mec_pand_C2","Ulatina_HEREDIA_mec_adm_pand_C2"), 
                       
                       to = c("Ulatina_HEREDIA_admin-neg_pand_C2", "Ulatina_HEREDIA_ter-fis_pand_C2", 
                              "Ulatina_HEREDIA_conta_pub-pand_C2","Ulatina_HEREDIA_admin-hoteleria_pand_C2",
                              "Ulatina_HEREDIA_anim-dig_pand_C2","Ulatina_HEREDIA_c-com_pand_C2",
                              "Ulatina_HEREDIA_dis-graf_pand_C2","Ulatina_HEREDIA_dis-int_pand_C2"
                              ,"Ulatina_HEREDIA_elect-mec_pand_C2","Ulatina_HEREDIA_mec-adm_pand_C2"))
horario_HEREDIA <- FindReplace(data = horario_HEREDIA, Var = "id", replaceData = Replaces,
                               from = "from", to = "to", exact = FALSE)


count(horario_HEREDIA$id)

write_xlsx(horario_HEREDIA,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/horario_HEREDIA_latina_pand_C2.xlsx")

# write_xlsx(horario_HEREDIA_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/admin_neg_C2.xlsx")
# write_xlsx(horario_HEREDIA_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/contabilidad_C2.xlsx")
# write_xlsx(horario_HEREDIA_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/derecho_C2.xlsx")
# write_xlsx(horario_HEREDIA_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/industrial_C2.xlsx")
# write_xlsx(horario_HEREDIA_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/ingles_C2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_HEREDIA$id, "_", 5)

horario_HEREDIA <- cbind(split, horario_HEREDIA)
names(horario_HEREDIA)[1] <- "marca"
names(horario_HEREDIA)[2] <- "sede"
names(horario_HEREDIA)[3] <- "carrera"
names(horario_HEREDIA)[4] <- "modalidad"
names(horario_HEREDIA)[5] <- "cuatrimestre"

horario_HEREDIA <- horario_HEREDIA %>% dplyr::select(-id)


horario_HEREDIA_unique <- subset(horario_HEREDIA, pob_asist != 0)

horario_HEREDIA_unique <- horario_HEREDIA_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_HEREDIA_unique$marca <- "Ulatina"
horario_HEREDIA_unique$sede <- "HEREDIA"
horario_HEREDIA_unique$modalidad <- "pand"
horario_HEREDIA_unique$cuatrimestre <- "C2"

horario_HEREDIA_unique <- horario_HEREDIA_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_HEREDIA_unique <- horario_HEREDIA_unique[with(horario_HEREDIA_unique, order(materia, horario)), ]  

horario_HEREDIA_unique <- horario_HEREDIA_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_HEREDIA_unique$unoanueve <- 0
horario_HEREDIA_unique$unoanueve[horario_HEREDIA_unique$Asistencia <= 9] <- 1

horario_HEREDIA_unique$dieza17 <- 0
horario_HEREDIA_unique$dieza17[horario_HEREDIA_unique$Asistencia >= 10 & horario_HEREDIA_unique$Asistencia <= 17] <- 1

horario_HEREDIA_unique$di18a30 <- 0
horario_HEREDIA_unique$di18a30[horario_HEREDIA_unique$Asistencia >= 18 & horario_HEREDIA_unique$Asistencia <= 30] <- 1

horario_HEREDIA_unique$di31a60 <- 0
horario_HEREDIA_unique$di31a60[horario_HEREDIA_unique$Asistencia >= 31 & horario_HEREDIA_unique$Asistencia <= 60] <- 1

horario_HEREDIA_unique$mas60 <- 0
horario_HEREDIA_unique$mas60[horario_HEREDIA_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_HEREDIA_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_HEREDIA_unique <- left_join(horario_HEREDIA_unique, duplicados, by = "materia")

names(horario_HEREDIA_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_HEREDIA_unique$recomendacion <- 0
horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$unoanueve == 1 & horario_HEREDIA_unique$duplicado == 0] <- "cerrar horario"
horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$unoanueve == 1 & horario_HEREDIA_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$dieza17 == 1 & horario_HEREDIA_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$dieza17 == 1 & horario_HEREDIA_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_HEREDIA_unique$recomendacion[horario_HEREDIA_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_HEREDIA_unique <- horario_HEREDIA_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                    horario, materia, Asistencia, recomendacion)


horario_split <- as.data.frame(str_split_fixed(horario_HEREDIA_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_HEREDIA_unique <- cbind(horario_HEREDIA_unique, horario_split)
names(horario_HEREDIA_unique)

horario_HEREDIA_unique$recom_d <- 0
horario_HEREDIA_unique$recom_d[horario_HEREDIA_unique$recomendacion == "unir horario" | horario_HEREDIA_unique$recomendacion == "cerrar horario"] <- 0
horario_HEREDIA_unique$recom_d[horario_HEREDIA_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                                 horario_HEREDIA_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_HEREDIA_unique$recom_d[horario_HEREDIA_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_HEREDIA_unique$recom_d[horario_HEREDIA_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_HEREDIA_unique <- horario_HEREDIA_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)

write_xlsx(horario_HEREDIA_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/recom_HEREDIA_latina_pand_C2.xlsx")



###### Comparativo de cursos ofertados para usarlo contra la tabla dinamica HEREDIA ######

horario_split_2 <- as.data.frame(str_split_fixed(HEREDIA$HORARIO, " ", 2))
names(horario_split_2)[1] <- "dia"
names(horario_split_2)[2] <- "hora"

HEREDIA <- cbind(HEREDIA, horario_split_2)
names(HEREDIA)

HEREDIA$paralelo <- paste0(HEREDIA$AULA, "-", HEREDIA$HORARIO)


write_xlsx(HEREDIA,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_HEREDIA/HEREDIA_mock.xlsx")


pt <- PivotTable$new()
pt$addData(HEREDIA)
pt$addColumnDataGroups("dia")
pt$addRowDataGroups("hora")
pt$defineCalculation(calculationName="paralelos", summariseExpression="paralelo")
pt$renderPivot()


######## ULATINA SEDE NEILY #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_NEILY_carr <- split(NEILY, f = NEILY$carrera) 
names(ulat_NEILY_carr) <- paste0("NEILY-",names(ulat_NEILY_carr)) 

list2env(ulat_NEILY_carr,envir=.GlobalEnv)


#segundo anidado Sede-carrera-materias#

#NEILY-admin_neg


`NEILY-admin_neg-materias` <- split(`NEILY-admin_neg`, f = `NEILY-admin_neg`$cod_padre) 
names(`NEILY-admin_neg-materias`) <- paste0("NEILY-admin_neg-materias-",names(`NEILY-admin_neg-materias`)) 

list2env(`NEILY-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_NEILY_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_NEILY_admin_neg)[1] <- "horario"
horario_NEILY_admin_neg <- unique(horario_NEILY_admin_neg)


`obs_NEILY-admin_neg-materias` <- as.data.frame(sapply(`NEILY-admin_neg-materias`, NROW))

`obs_NEILY-admin_neg-materias` <- tibble::rownames_to_column(`obs_NEILY-admin_neg-materias`, "materia")
names(`obs_NEILY-admin_neg-materias`)[2] <- "obs"

`obs_NEILY-admin_neg-materias`$materia <- str_remove(`obs_NEILY-admin_neg-materias`$materia, "NEILY-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_NEILY-admin_neg-materias` <- filter(`obs_NEILY-admin_neg-materias`, obs >= 10)
`no_elegibles_NEILY-admin_neg-materias` <- filter(`obs_NEILY-admin_neg-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`NEILY-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_NEILY_admin_neg <- left_join(horario_NEILY_admin_neg, `BAN 01`)
names(horario_NEILY_admin_neg)[2] <- "BAN 01"

horario_NEILY_admin_neg$`BAN 01`[is.na(horario_NEILY_admin_neg$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`NEILY-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_NEILY_admin_neg <- left_join(horario_NEILY_admin_neg, `BAN 03`)
names(horario_NEILY_admin_neg)[3] <- "BAN 03"

horario_NEILY_admin_neg$`BAN 03`[is.na(horario_NEILY_admin_neg$`BAN 03`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`NEILY-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_NEILY_admin_neg <- left_join(horario_NEILY_admin_neg, `BCP 01`)
names(horario_NEILY_admin_neg)[4] <- "BCP 01"

horario_NEILY_admin_neg$`BCP 01`[is.na(horario_NEILY_admin_neg$`BCP 01`)] <- 0


#BDE-02

`BDE-02` <- as.data.frame(count(`NEILY-admin_neg-materias-BDE-02`$HORARIO)) 

`BDE-02`$freq <- (`BDE-02`$freq)/sum(`BDE-02`$freq)

names(`BDE-02`)[1] <- "horario"

horario_NEILY_admin_neg <- left_join(horario_NEILY_admin_neg, `BDE-02`)
names(horario_NEILY_admin_neg)[5] <- "BDE-02"

horario_NEILY_admin_neg$`BDE-02`[is.na(horario_NEILY_admin_neg$`BDE-02`)] <- 0



#BMA 02

`BMA 02` <- as.data.frame(count(`NEILY-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_NEILY_admin_neg <- left_join(horario_NEILY_admin_neg, `BMA 02`)
names(horario_NEILY_admin_neg)[6] <- "BMA 02"

horario_NEILY_admin_neg$`BMA 02`[is.na(horario_NEILY_admin_neg$`BMA 02`)] <- 0


##wide to long

horario_NEILY_admin_neg$id <- "Ulatina_NEILY_admin_neg_pand_C2"
horario_NEILY_admin_neg <-  horario_NEILY_admin_neg%>% dplyr::select(id, everything())

horario_NEILY_admin_neg <- melt(horario_NEILY_admin_neg, id = c("id", "horario"))
names(horario_NEILY_admin_neg)[3] <- "materia"
names(horario_NEILY_admin_neg)[4] <- "asistencia"


#NEILY-ingles


`NEILY-ingles-materias` <- split(`NEILY-ingles`, f = `NEILY-ingles`$cod_padre) 
names(`NEILY-ingles-materias`) <- paste0("NEILY-ingles-materias-",names(`NEILY-ingles-materias`)) 

list2env(`NEILY-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_NEILY_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_NEILY_ingles)[1] <- "horario"
horario_NEILY_ingles <- unique(horario_NEILY_ingles)


`obs_NEILY-ingles-materias` <- as.data.frame(sapply(`NEILY-ingles-materias`, NROW))

`obs_NEILY-ingles-materias` <- tibble::rownames_to_column(`obs_NEILY-ingles-materias`, "materia")
names(`obs_NEILY-ingles-materias`)[2] <- "obs"

`obs_NEILY-ingles-materias`$materia <- str_remove(`obs_NEILY-ingles-materias`$materia, "NEILY-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_NEILY-ingles-materias` <- filter(`obs_NEILY-ingles-materias`, obs >= 10)
`no_elegibles_NEILY-ingles-materias` <- filter(`obs_NEILY-ingles-materias`, obs < 10)




#BAR-03

`BAR-03` <- as.data.frame(count(`NEILY-ingles-materias-BAR-03`$HORARIO)) 

`BAR-03`$freq <- (`BAR-03`$freq)/sum(`BAR-03`$freq)

names(`BAR-03`)[1] <- "horario"

horario_NEILY_ingles <- left_join(horario_NEILY_ingles, `BAR-03`)
names(horario_NEILY_ingles)[2] <- "BAR-03"

horario_NEILY_ingles$`BAR-03`[is.na(horario_NEILY_ingles$`BAR-03`)] <- 0



#BCA-01

`BCA-01` <- as.data.frame(count(`NEILY-ingles-materias-BCA-01`$HORARIO)) 

`BCA-01`$freq <- (`BCA-01`$freq)/sum(`BCA-01`$freq)

names(`BCA-01`)[1] <- "horario"

horario_NEILY_ingles <- left_join(horario_NEILY_ingles, `BCA-01`)
names(horario_NEILY_ingles)[3] <- "BCA-01"

horario_NEILY_ingles$`BCA-01`[is.na(horario_NEILY_ingles$`BCA-01`)] <- 0



#BCP 01

`BCP 01` <- as.data.frame(count(`NEILY-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_NEILY_ingles <- left_join(horario_NEILY_ingles, `BCP 01`)
names(horario_NEILY_ingles)[4] <- "BCP 01"

horario_NEILY_ingles$`BCP 01`[is.na(horario_NEILY_ingles$`BCP 01`)] <- 0



#BCS-01

`BCS-01` <- as.data.frame(count(`NEILY-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_NEILY_ingles <- left_join(horario_NEILY_ingles, `BCS-01`)
names(horario_NEILY_ingles)[5] <- "BCS-01"

horario_NEILY_ingles$`BCS-01`[is.na(horario_NEILY_ingles$`BCS-01`)] <- 0


#BCS 01

`BCS 01` <- as.data.frame(count(`NEILY-ingles-materias-BCS 01`$HORARIO)) 

`BCS 01`$freq <- (`BCS 01`$freq)/sum(`BCS 01`$freq)

names(`BCS 01`)[1] <- "horario"

horario_NEILY_ingles <- left_join(horario_NEILY_ingles, `BCS 01`)
names(horario_NEILY_ingles)[6] <- "BCS 01"

horario_NEILY_ingles$`BCS 01`[is.na(horario_NEILY_ingles$`BCS 01`)] <- 0


##wide to long

horario_NEILY_ingles$id <- "Ulatina_NEILY_ingles_pand_C2"
horario_NEILY_ingles <-  horario_NEILY_ingles%>% dplyr::select(id, everything())

horario_NEILY_ingles <- melt(horario_NEILY_ingles, id = c("id", "horario"))
names(horario_NEILY_ingles)[3] <- "materia"
names(horario_NEILY_ingles)[4] <- "asistencia"



#Consolidado de sede NEILY

horario_NEILY <- rbind(horario_NEILY_admin_neg,horario_NEILY_ingles)

#total poblacion por carrera NEILY

materias_NEILY_pand_C2 <- count(NEILY$cod_padre)
names(materias_NEILY_pand_C2)[1] <- "materia"
names(materias_NEILY_pand_C2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_NEILY <- left_join(horario_NEILY, materias_NEILY_pand_C2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_NEILY$asistencia, by = list(horario_NEILY$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_NEILY <- left_join(horario_NEILY, pob_asist2)

horario_NEILY$asistencia2 <- horario_NEILY$asistencia/horario_NEILY$sum_prop
horario_NEILY$asistencia2[horario_NEILY$asistencia2 == Inf] <- 0

horario_NEILY$pob_asist <- round((horario_NEILY$asistencia2)*(horario_NEILY$poblacion),0)


#Guardo todos los horarios en su folder correspondiente

count(horario_NEILY$id)
Replaces <- data.frame(from = c("Ulatina_NEILY_admin_neg_pand_C2","Ulatina_NEILY_ter_fis_pand_C2", 
                                "Ulatina_NEILY_conta_pub_pand_C2","Ulatina_NEILY_admin_hoteleria_pand_C2",
                                "Ulatina_NEILY_anim_dig_pand_C2", "Ulatina_NEILY_civil_pand_C2"
                                ,"Ulatina_NEILY_dis_graf_pand_C2","Ulatina_NEILY_dis_int_pand_C2"
                                ,"Ulatina_NEILY_elect_mec_pand_C2","Ulatina_NEILY_mec_adm_pand_C2"), 
                       
                       to = c("Ulatina_NEILY_admin-neg_pand_C2", "Ulatina_NEILY_ter-fis_pand_C2", 
                              "Ulatina_NEILY_conta_pub-pand_C2","Ulatina_NEILY_admin-hoteleria_pand_C2",
                              "Ulatina_NEILY_anim-dig_pand_C2","Ulatina_NEILY_c-com_pand_C2",
                              "Ulatina_NEILY_dis-graf_pand_C2","Ulatina_NEILY_dis-int_pand_C2"
                              ,"Ulatina_NEILY_elect-mec_pand_C2","Ulatina_NEILY_mec-adm_pand_C2"))
horario_NEILY <- FindReplace(data = horario_NEILY, Var = "id", replaceData = Replaces,
                             from = "from", to = "to", exact = FALSE)


count(horario_NEILY$id)

write_xlsx(horario_NEILY,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/horario_NEILY_latina_pand_C2.xlsx")

# write_xlsx(horario_NEILY_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/admin_neg_C2.xlsx")
# write_xlsx(horario_NEILY_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/contabilidad_C2.xlsx")
# write_xlsx(horario_NEILY_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/derecho_C2.xlsx")
# write_xlsx(horario_NEILY_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/industrial_C2.xlsx")
# write_xlsx(horario_NEILY_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/ingles_C2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_NEILY$id, "_", 5)

horario_NEILY <- cbind(split, horario_NEILY)
names(horario_NEILY)[1] <- "marca"
names(horario_NEILY)[2] <- "sede"
names(horario_NEILY)[3] <- "carrera"
names(horario_NEILY)[4] <- "modalidad"
names(horario_NEILY)[5] <- "cuatrimestre"

horario_NEILY <- horario_NEILY %>% dplyr::select(-id)


horario_NEILY_unique <- subset(horario_NEILY, pob_asist != 0)

horario_NEILY_unique <- horario_NEILY_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_NEILY_unique$marca <- "Ulatina"
horario_NEILY_unique$sede <- "NEILY"
horario_NEILY_unique$modalidad <- "pand"
horario_NEILY_unique$cuatrimestre <- "C2"

horario_NEILY_unique <- horario_NEILY_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_NEILY_unique <- horario_NEILY_unique[with(horario_NEILY_unique, order(materia, horario)), ]  

horario_NEILY_unique <- horario_NEILY_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_NEILY_unique$unoanueve <- 0
horario_NEILY_unique$unoanueve[horario_NEILY_unique$Asistencia <= 9] <- 1

horario_NEILY_unique$dieza17 <- 0
horario_NEILY_unique$dieza17[horario_NEILY_unique$Asistencia >= 10 & horario_NEILY_unique$Asistencia <= 17] <- 1

horario_NEILY_unique$di18a30 <- 0
horario_NEILY_unique$di18a30[horario_NEILY_unique$Asistencia >= 18 & horario_NEILY_unique$Asistencia <= 30] <- 1

horario_NEILY_unique$di31a60 <- 0
horario_NEILY_unique$di31a60[horario_NEILY_unique$Asistencia >= 31 & horario_NEILY_unique$Asistencia <= 60] <- 1

horario_NEILY_unique$mas60 <- 0
horario_NEILY_unique$mas60[horario_NEILY_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_NEILY_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_NEILY_unique <- left_join(horario_NEILY_unique, duplicados, by = "materia")

names(horario_NEILY_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_NEILY_unique$recomendacion <- 0
horario_NEILY_unique$recomendacion[horario_NEILY_unique$unoanueve == 1 & horario_NEILY_unique$duplicado == 0] <- "cerrar horario"
horario_NEILY_unique$recomendacion[horario_NEILY_unique$unoanueve == 1 & horario_NEILY_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_NEILY_unique$recomendacion[horario_NEILY_unique$dieza17 == 1 & horario_NEILY_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_NEILY_unique$recomendacion[horario_NEILY_unique$dieza17 == 1 & horario_NEILY_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_NEILY_unique$recomendacion[horario_NEILY_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_NEILY_unique$recomendacion[horario_NEILY_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_NEILY_unique$recomendacion[horario_NEILY_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_NEILY_unique <- horario_NEILY_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                horario, materia, Asistencia, recomendacion)


horario_split <- as.data.frame(str_split_fixed(horario_NEILY_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_NEILY_unique <- cbind(horario_NEILY_unique, horario_split)
names(horario_NEILY_unique)

horario_NEILY_unique$recom_d <- 0
horario_NEILY_unique$recom_d[horario_NEILY_unique$recomendacion == "unir horario" | horario_NEILY_unique$recomendacion == "cerrar horario"] <- 0
horario_NEILY_unique$recom_d[horario_NEILY_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                               horario_NEILY_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_NEILY_unique$recom_d[horario_NEILY_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_NEILY_unique$recom_d[horario_NEILY_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_NEILY_unique <- horario_NEILY_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)

write_xlsx(horario_NEILY_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/recom_NEILY_latina_pand_C2.xlsx")



###### Comparativo de cursos ofertados para usarlo contra la tabla dinamica NEILY ######

horario_split_2 <- as.data.frame(str_split_fixed(NEILY$HORARIO, " ", 2))
names(horario_split_2)[1] <- "dia"
names(horario_split_2)[2] <- "hora"

NEILY <- cbind(NEILY, horario_split_2)
names(NEILY)

NEILY$paralelo <- paste0(NEILY$AULA, "-", NEILY$HORARIO)


write_xlsx(NEILY,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_NEILY/NEILY_mock.xlsx")


pt <- PivotTable$new()
pt$addData(NEILY)
pt$addColumnDataGroups("dia")
pt$addRowDataGroups("hora")
pt$defineCalculation(calculationName="paralelos", summariseExpression="paralelo")
pt$renderPivot()


######## ULATINA SEDE PEREZZELEDON #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_PEREZZELEDON_carr <- split(PEREZZELEDON, f = PEREZZELEDON$carrera) 
names(ulat_PEREZZELEDON_carr) <- paste0("PEREZZELEDON-",names(ulat_PEREZZELEDON_carr)) 

list2env(ulat_PEREZZELEDON_carr,envir=.GlobalEnv)


#segundo anidado Sede-carrera-materias#

#PEREZZELEDON-admin_neg


`PEREZZELEDON-admin_neg-materias` <- split(`PEREZZELEDON-admin_neg`, f = `PEREZZELEDON-admin_neg`$cod_padre) 
names(`PEREZZELEDON-admin_neg-materias`) <- paste0("PEREZZELEDON-admin_neg-materias-",names(`PEREZZELEDON-admin_neg-materias`)) 

list2env(`PEREZZELEDON-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_admin_neg)[1] <- "horario"
horario_PEREZZELEDON_admin_neg <- unique(horario_PEREZZELEDON_admin_neg)


`obs_PEREZZELEDON-admin_neg-materias` <- as.data.frame(sapply(`PEREZZELEDON-admin_neg-materias`, NROW))

`obs_PEREZZELEDON-admin_neg-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-admin_neg-materias`, "materia")
names(`obs_PEREZZELEDON-admin_neg-materias`)[2] <- "obs"

`obs_PEREZZELEDON-admin_neg-materias`$materia <- str_remove(`obs_PEREZZELEDON-admin_neg-materias`$materia, "PEREZZELEDON-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-admin_neg-materias` <- filter(`obs_PEREZZELEDON-admin_neg-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-admin_neg-materias` <- filter(`obs_PEREZZELEDON-admin_neg-materias`, obs < 10)


#BAN 01

`BAN 01` <- as.data.frame(count(`PEREZZELEDON-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_PEREZZELEDON_admin_neg <- left_join(horario_PEREZZELEDON_admin_neg, `BAN 01`)
names(horario_PEREZZELEDON_admin_neg)[2] <- "BAN 01"

horario_PEREZZELEDON_admin_neg$`BAN 01`[is.na(horario_PEREZZELEDON_admin_neg$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`PEREZZELEDON-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_PEREZZELEDON_admin_neg <- left_join(horario_PEREZZELEDON_admin_neg, `BAN 03`)
names(horario_PEREZZELEDON_admin_neg)[3] <- "BAN 03"

horario_PEREZZELEDON_admin_neg$`BAN 03`[is.na(horario_PEREZZELEDON_admin_neg$`BAN 03`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`PEREZZELEDON-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_PEREZZELEDON_admin_neg <- left_join(horario_PEREZZELEDON_admin_neg, `BCP 01`)
names(horario_PEREZZELEDON_admin_neg)[4] <- "BCP 01"

horario_PEREZZELEDON_admin_neg$`BCP 01`[is.na(horario_PEREZZELEDON_admin_neg$`BCP 01`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`PEREZZELEDON-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_PEREZZELEDON_admin_neg <- left_join(horario_PEREZZELEDON_admin_neg, `BPE 27`)
names(horario_PEREZZELEDON_admin_neg)[5] <- "BPE 27"

horario_PEREZZELEDON_admin_neg$`BPE 27`[is.na(horario_PEREZZELEDON_admin_neg$`BPE 27`)] <- 0




##wide to long

horario_PEREZZELEDON_admin_neg$id <- "Ulatina_PEREZZELEDON_admin_neg_pand_C2"
horario_PEREZZELEDON_admin_neg <-  horario_PEREZZELEDON_admin_neg%>% dplyr::select(id, everything())

horario_PEREZZELEDON_admin_neg <- melt(horario_PEREZZELEDON_admin_neg, id = c("id", "horario"))
names(horario_PEREZZELEDON_admin_neg)[3] <- "materia"
names(horario_PEREZZELEDON_admin_neg)[4] <- "asistencia"


#PEREZZELEDON-ingles


`PEREZZELEDON-ingles-materias` <- split(`PEREZZELEDON-ingles`, f = `PEREZZELEDON-ingles`$cod_padre) 
names(`PEREZZELEDON-ingles-materias`) <- paste0("PEREZZELEDON-ingles-materias-",names(`PEREZZELEDON-ingles-materias`)) 

list2env(`PEREZZELEDON-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_ingles)[1] <- "horario"
horario_PEREZZELEDON_ingles <- unique(horario_PEREZZELEDON_ingles)


`obs_PEREZZELEDON-ingles-materias` <- as.data.frame(sapply(`PEREZZELEDON-ingles-materias`, NROW))

`obs_PEREZZELEDON-ingles-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-ingles-materias`, "materia")
names(`obs_PEREZZELEDON-ingles-materias`)[2] <- "obs"

`obs_PEREZZELEDON-ingles-materias`$materia <- str_remove(`obs_PEREZZELEDON-ingles-materias`$materia, "PEREZZELEDON-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-ingles-materias` <- filter(`obs_PEREZZELEDON-ingles-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-ingles-materias` <- filter(`obs_PEREZZELEDON-ingles-materias`, obs < 10)




#BAR-02

`BAR-02` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BAR-02`$HORARIO)) 

`BAR-02`$freq <- (`BAR-02`$freq)/sum(`BAR-02`$freq)

names(`BAR-02`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BAR-02`)
names(horario_PEREZZELEDON_ingles)[2] <- "BAR-02"

horario_PEREZZELEDON_ingles$`BAR-02`[is.na(horario_PEREZZELEDON_ingles$`BAR-02`)] <- 0


#BAR-05

`BAR-05` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BAR-05`$HORARIO)) 

`BAR-05`$freq <- (`BAR-05`$freq)/sum(`BAR-05`$freq)

names(`BAR-05`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BAR-05`)
names(horario_PEREZZELEDON_ingles)[3] <- "BAR-05"

horario_PEREZZELEDON_ingles$`BAR-05`[is.na(horario_PEREZZELEDON_ingles$`BAR-05`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BCP 01`)
names(horario_PEREZZELEDON_ingles)[4] <- "BCP 01"

horario_PEREZZELEDON_ingles$`BCP 01`[is.na(horario_PEREZZELEDON_ingles$`BCP 01`)] <- 0



#BCS-01

`BCS-01` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BCS-01`)
names(horario_PEREZZELEDON_ingles)[5] <- "BCS-01"

horario_PEREZZELEDON_ingles$`BCS-01`[is.na(horario_PEREZZELEDON_ingles$`BCS-01`)] <- 0


#BCA-02

`BCA-02` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BCA-02`$HORARIO)) 

`BCA-02`$freq <- (`BCA-02`$freq)/sum(`BCA-02`$freq)

names(`BCA-02`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BCA-02`)
names(horario_PEREZZELEDON_ingles)[6] <- "BCA-02"

horario_PEREZZELEDON_ingles$`BCA-02`[is.na(horario_PEREZZELEDON_ingles$`BCA-02`)] <- 0


#BIN-01

`BIN-01` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BIN-01`)
names(horario_PEREZZELEDON_ingles)[7] <- "BIN-01"

horario_PEREZZELEDON_ingles$`BIN-01`[is.na(horario_PEREZZELEDON_ingles$`BIN-01`)] <- 0



#BIS01

BIS01 <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, BIS01)
names(horario_PEREZZELEDON_ingles)[8] <- "BIS01"

horario_PEREZZELEDON_ingles$BIS01[is.na(horario_PEREZZELEDON_ingles$BIS01)] <- 0


##wide to long

horario_PEREZZELEDON_ingles$id <- "Ulatina_PEREZZELEDON_ingles_pand_C2"
horario_PEREZZELEDON_ingles <-  horario_PEREZZELEDON_ingles%>% dplyr::select(id, everything())

horario_PEREZZELEDON_ingles <- melt(horario_PEREZZELEDON_ingles, id = c("id", "horario"))
names(horario_PEREZZELEDON_ingles)[3] <- "materia"
names(horario_PEREZZELEDON_ingles)[4] <- "asistencia"



#PEREZZELEDON-comput


`PEREZZELEDON-comput-materias` <- split(`PEREZZELEDON-comput`, f = `PEREZZELEDON-comput`$cod_padre) 
names(`PEREZZELEDON-comput-materias`) <- paste0("PEREZZELEDON-comput-materias-",names(`PEREZZELEDON-comput-materias`)) 

list2env(`PEREZZELEDON-comput-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_comput <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_comput)[1] <- "horario"
horario_PEREZZELEDON_comput <- unique(horario_PEREZZELEDON_comput)


`obs_PEREZZELEDON-comput-materias` <- as.data.frame(sapply(`PEREZZELEDON-comput-materias`, NROW))

`obs_PEREZZELEDON-comput-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-comput-materias`, "materia")
names(`obs_PEREZZELEDON-comput-materias`)[2] <- "obs"

`obs_PEREZZELEDON-comput-materias`$materia <- str_remove(`obs_PEREZZELEDON-comput-materias`$materia, "PEREZZELEDON-comput-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-comput-materias` <- filter(`obs_PEREZZELEDON-comput-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-comput-materias` <- filter(`obs_PEREZZELEDON-comput-materias`, obs < 10)




#NO HAY SUFICIENTES DATOS PARA INFERIR 



#PEREZZELEDON-derecho


`PEREZZELEDON-derecho-materias` <- split(`PEREZZELEDON-derecho`, f = `PEREZZELEDON-derecho`$cod_padre) 
names(`PEREZZELEDON-derecho-materias`) <- paste0("PEREZZELEDON-derecho-materias-",names(`PEREZZELEDON-derecho-materias`)) 

list2env(`PEREZZELEDON-derecho-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_derecho <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_derecho)[1] <- "horario"
horario_PEREZZELEDON_derecho <- unique(horario_PEREZZELEDON_derecho)


`obs_PEREZZELEDON-derecho-materias` <- as.data.frame(sapply(`PEREZZELEDON-derecho-materias`, NROW))

`obs_PEREZZELEDON-derecho-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-derecho-materias`, "materia")
names(`obs_PEREZZELEDON-derecho-materias`)[2] <- "obs"

`obs_PEREZZELEDON-derecho-materias`$materia <- str_remove(`obs_PEREZZELEDON-derecho-materias`$materia, "PEREZZELEDON-derecho-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-derecho-materias` <- filter(`obs_PEREZZELEDON-derecho-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-derecho-materias` <- filter(`obs_PEREZZELEDON-derecho-materias`, obs < 10)




#BAN-01

`BAN-01` <- as.data.frame(count(`PEREZZELEDON-derecho-materias-BAN-01`$HORARIO)) 

`BAN-01`$freq <- (`BAN-01`$freq)/sum(`BAN-01`$freq)

names(`BAN-01`)[1] <- "horario"

horario_PEREZZELEDON_derecho <- left_join(horario_PEREZZELEDON_derecho, `BAN-01`)
names(horario_PEREZZELEDON_derecho)[2] <- "BAN-01"

horario_PEREZZELEDON_derecho$`BAN-01`[is.na(horario_PEREZZELEDON_derecho$`BAN-01`)] <- 0


#BAN-02

`BAN-02` <- as.data.frame(count(`PEREZZELEDON-derecho-materias-BAN-02`$HORARIO)) 

`BAN-02`$freq <- (`BAN-02`$freq)/sum(`BAN-02`$freq)

names(`BAN-02`)[1] <- "horario"

horario_PEREZZELEDON_derecho <- left_join(horario_PEREZZELEDON_derecho, `BAN-02`)
names(horario_PEREZZELEDON_derecho)[3] <- "BAN-02"

horario_PEREZZELEDON_derecho$`BAN-02`[is.na(horario_PEREZZELEDON_derecho$`BAN-02`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`PEREZZELEDON-derecho-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_PEREZZELEDON_derecho <- left_join(horario_PEREZZELEDON_derecho, `BAN 03`)
names(horario_PEREZZELEDON_derecho)[4] <- "BAN 03"

horario_PEREZZELEDON_derecho$`BAN 03`[is.na(horario_PEREZZELEDON_derecho$`BAN 03`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`PEREZZELEDON-derecho-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_PEREZZELEDON_derecho <- left_join(horario_PEREZZELEDON_derecho, `BPE 27`)
names(horario_PEREZZELEDON_derecho)[5] <- "BPE 27"

horario_PEREZZELEDON_derecho$`BPE 27`[is.na(horario_PEREZZELEDON_derecho$`BPE 27`)] <- 0


##wide to long

horario_PEREZZELEDON_derecho$id <- "Ulatina_PEREZZELEDON_derecho_pand_C2"
horario_PEREZZELEDON_derecho <-  horario_PEREZZELEDON_derecho%>% dplyr::select(id, everything())

horario_PEREZZELEDON_derecho <- melt(horario_PEREZZELEDON_derecho, id = c("id", "horario"))
names(horario_PEREZZELEDON_derecho)[3] <- "materia"
names(horario_PEREZZELEDON_derecho)[4] <- "asistencia"




#PEREZZELEDON-enf


`PEREZZELEDON-enf-materias` <- split(`PEREZZELEDON-enf`, f = `PEREZZELEDON-enf`$cod_padre) 
names(`PEREZZELEDON-enf-materias`) <- paste0("PEREZZELEDON-enf-materias-",names(`PEREZZELEDON-enf-materias`)) 

list2env(`PEREZZELEDON-enf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_enf <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_enf)[1] <- "horario"
horario_PEREZZELEDON_enf <- unique(horario_PEREZZELEDON_enf)


`obs_PEREZZELEDON-enf-materias` <- as.data.frame(sapply(`PEREZZELEDON-enf-materias`, NROW))

`obs_PEREZZELEDON-enf-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-enf-materias`, "materia")
names(`obs_PEREZZELEDON-enf-materias`)[2] <- "obs"

`obs_PEREZZELEDON-enf-materias`$materia <- str_remove(`obs_PEREZZELEDON-enf-materias`$materia, "PEREZZELEDON-enf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-enf-materias` <- filter(`obs_PEREZZELEDON-enf-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-enf-materias` <- filter(`obs_PEREZZELEDON-enf-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BCS-01`)
names(horario_PEREZZELEDON_enf)[2] <- "BCS-01"

horario_PEREZZELEDON_enf$`BCS-01`[is.na(horario_PEREZZELEDON_enf$`BCS-01`)] <- 0


#BIE-01

`BIE-01` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BIE-01`$HORARIO)) 

`BIE-01`$freq <- (`BIE-01`$freq)/sum(`BIE-01`$freq)

names(`BIE-01`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BIE-01`)
names(horario_PEREZZELEDON_enf)[3] <- "BIE-01"

horario_PEREZZELEDON_enf$`BIE-01`[is.na(horario_PEREZZELEDON_enf$`BIE-01`)] <- 0


#BIE-02

`BIE-02` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BIE-02`$HORARIO)) 

`BIE-02`$freq <- (`BIE-02`$freq)/sum(`BIE-02`$freq)

names(`BIE-02`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BIE-02`)
names(horario_PEREZZELEDON_enf)[4] <- "BIE-02"

horario_PEREZZELEDON_enf$`BIE-02`[is.na(horario_PEREZZELEDON_enf$`BIE-02`)] <- 0


#BIE-03

`BIE-03` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BIE-03`$HORARIO)) 

`BIE-03`$freq <- (`BIE-03`$freq)/sum(`BIE-03`$freq)

names(`BIE-03`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BIE-03`)
names(horario_PEREZZELEDON_enf)[5] <- "BIE-03"

horario_PEREZZELEDON_enf$`BIE-03`[is.na(horario_PEREZZELEDON_enf$`BIE-03`)] <- 0


#BIE-05

`BIE-05` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BIE-05`$HORARIO)) 

`BIE-05`$freq <- (`BIE-05`$freq)/sum(`BIE-05`$freq)

names(`BIE-05`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BIE-05`)
names(horario_PEREZZELEDON_enf)[6] <- "BIE-05"

horario_PEREZZELEDON_enf$`BIE-05`[is.na(horario_PEREZZELEDON_enf$`BIE-05`)] <- 0



#BII 01

`BII 01` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BII 01`$HORARIO)) 

`BII 01`$freq <- (`BII 01`$freq)/sum(`BII 01`$freq)

names(`BII 01`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BII 01`)
names(horario_PEREZZELEDON_enf)[7] <- "BII 01"

horario_PEREZZELEDON_enf$`BII 01`[is.na(horario_PEREZZELEDON_enf$`BII 01`)] <- 0



#BIN-01

`BIN-01` <- as.data.frame(count(`PEREZZELEDON-enf-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_PEREZZELEDON_enf <- left_join(horario_PEREZZELEDON_enf, `BIN-01`)
names(horario_PEREZZELEDON_enf)[8] <- "BIN-01"

horario_PEREZZELEDON_enf$`BIN-01`[is.na(horario_PEREZZELEDON_enf$`BIN-01`)] <- 0


##wide to long

horario_PEREZZELEDON_enf$id <- "Ulatina_PEREZZELEDON_enf_pand_C2"
horario_PEREZZELEDON_enf <-  horario_PEREZZELEDON_enf%>% dplyr::select(id, everything())

horario_PEREZZELEDON_enf <- melt(horario_PEREZZELEDON_enf, id = c("id", "horario"))
names(horario_PEREZZELEDON_enf)[3] <- "materia"
names(horario_PEREZZELEDON_enf)[4] <- "asistencia"



#PEREZZELEDON-indus


`PEREZZELEDON-indus-materias` <- split(`PEREZZELEDON-indus`, f = `PEREZZELEDON-indus`$cod_padre) 
names(`PEREZZELEDON-indus-materias`) <- paste0("PEREZZELEDON-indus-materias-",names(`PEREZZELEDON-indus-materias`)) 

list2env(`PEREZZELEDON-indus-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_indus <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_indus)[1] <- "horario"
horario_PEREZZELEDON_indus <- unique(horario_PEREZZELEDON_indus)


`obs_PEREZZELEDON-indus-materias` <- as.data.frame(sapply(`PEREZZELEDON-indus-materias`, NROW))

`obs_PEREZZELEDON-indus-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-indus-materias`, "materia")
names(`obs_PEREZZELEDON-indus-materias`)[2] <- "obs"

`obs_PEREZZELEDON-indus-materias`$materia <- str_remove(`obs_PEREZZELEDON-indus-materias`$materia, "PEREZZELEDON-indus-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-indus-materias` <- filter(`obs_PEREZZELEDON-indus-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-indus-materias` <- filter(`obs_PEREZZELEDON-indus-materias`, obs < 10)



#BIM 21

`BIM 21` <- as.data.frame(count(`PEREZZELEDON-indus-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_PEREZZELEDON_indus <- left_join(horario_PEREZZELEDON_indus, `BIM 21`)
names(horario_PEREZZELEDON_indus)[2] <- "BIM 21"

horario_PEREZZELEDON_indus$`BIM 21`[is.na(horario_PEREZZELEDON_indus$`BIM 21`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`PEREZZELEDON-indus-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_PEREZZELEDON_indus <- left_join(horario_PEREZZELEDON_indus, `BMA 01`)
names(horario_PEREZZELEDON_indus)[3] <- "BMA 01"

horario_PEREZZELEDON_indus$`BMA 01`[is.na(horario_PEREZZELEDON_indus$`BMA 01`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`PEREZZELEDON-indus-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_PEREZZELEDON_indus <- left_join(horario_PEREZZELEDON_indus, `BPE 27`)
names(horario_PEREZZELEDON_indus)[4] <- "BPE 27"

horario_PEREZZELEDON_indus$`BPE 27`[is.na(horario_PEREZZELEDON_indus$`BPE 27`)] <- 0


#QU 01

`QU 01` <- as.data.frame(count(`PEREZZELEDON-indus-materias-QU 01`$HORARIO)) 

`QU 01`$freq <- (`QU 01`$freq)/sum(`QU 01`$freq)

names(`QU 01`)[1] <- "horario"

horario_PEREZZELEDON_indus <- left_join(horario_PEREZZELEDON_indus, `QU 01`)
names(horario_PEREZZELEDON_indus)[5] <- "QU 01"

horario_PEREZZELEDON_indus$`QU 01`[is.na(horario_PEREZZELEDON_indus$`QU 01`)] <- 0


#BED-34

`BED-34` <- as.data.frame(count(`PEREZZELEDON-indus-materias-BED-34`$HORARIO)) 

`BED-34`$freq <- (`BED-34`$freq)/sum(`BED-34`$freq)

names(`BED-34`)[1] <- "horario"

horario_PEREZZELEDON_indus <- left_join(horario_PEREZZELEDON_indus, `BED-34`)
names(horario_PEREZZELEDON_indus)[6] <- "BED-34"

horario_PEREZZELEDON_indus$`BED-34`[is.na(horario_PEREZZELEDON_indus$`BED-34`)] <- 0


##wide to long

horario_PEREZZELEDON_indus$id <- "Ulatina_PEREZZELEDON_indus_pand_C2"
horario_PEREZZELEDON_indus <-  horario_PEREZZELEDON_indus%>% dplyr::select(id, everything())

horario_PEREZZELEDON_indus <- melt(horario_PEREZZELEDON_indus, id = c("id", "horario"))
names(horario_PEREZZELEDON_indus)[3] <- "materia"
names(horario_PEREZZELEDON_indus)[4] <- "asistencia"



#PEREZZELEDON-ingles


`PEREZZELEDON-ingles-materias` <- split(`PEREZZELEDON-ingles`, f = `PEREZZELEDON-ingles`$cod_padre) 
names(`PEREZZELEDON-ingles-materias`) <- paste0("PEREZZELEDON-ingles-materias-",names(`PEREZZELEDON-ingles-materias`)) 

list2env(`PEREZZELEDON-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_ingles)[1] <- "horario"
horario_PEREZZELEDON_ingles <- unique(horario_PEREZZELEDON_ingles)


`obs_PEREZZELEDON-ingles-materias` <- as.data.frame(sapply(`PEREZZELEDON-ingles-materias`, NROW))

`obs_PEREZZELEDON-ingles-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-ingles-materias`, "materia")
names(`obs_PEREZZELEDON-ingles-materias`)[2] <- "obs"

`obs_PEREZZELEDON-ingles-materias`$materia <- str_remove(`obs_PEREZZELEDON-ingles-materias`$materia, "PEREZZELEDON-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-ingles-materias` <- filter(`obs_PEREZZELEDON-ingles-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-ingles-materias` <- filter(`obs_PEREZZELEDON-ingles-materias`, obs < 10)



#BAR-05

`BAR-05` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BAR-05`$HORARIO)) 

`BAR-05`$freq <- (`BAR-05`$freq)/sum(`BAR-05`$freq)

names(`BAR-05`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BAR-05`)
names(horario_PEREZZELEDON_ingles)[2] <- "BAR-05"

horario_PEREZZELEDON_ingles$`BAR-05`[is.na(horario_PEREZZELEDON_ingles$`BAR-05`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BCP 01`)
names(horario_PEREZZELEDON_ingles)[3] <- "BCP 01"

horario_PEREZZELEDON_ingles$`BCP 01`[is.na(horario_PEREZZELEDON_ingles$`BCP 01`)] <- 0


#BCS-01

`BCS-01` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BCS-01`)
names(horario_PEREZZELEDON_ingles)[4] <- "BCS-01"

horario_PEREZZELEDON_ingles$`BCS-01`[is.na(horario_PEREZZELEDON_ingles$`BCS-01`)] <- 0



#BIS01

BIS01 <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, BIS01)
names(horario_PEREZZELEDON_ingles)[5] <- "BIS01"

horario_PEREZZELEDON_ingles$BIS01[is.na(horario_PEREZZELEDON_ingles$BIS01)] <- 0


#BIN-01

`BIN-01` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BIN-01`)
names(horario_PEREZZELEDON_ingles)[6] <- "BIN-01"

horario_PEREZZELEDON_ingles$`BIN-01`[is.na(horario_PEREZZELEDON_ingles$`BIN-01`)] <- 0



#BAR-02

`BAR-02` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BAR-02`$HORARIO)) 

`BAR-02`$freq <- (`BAR-02`$freq)/sum(`BAR-02`$freq)

names(`BAR-02`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BAR-02`)
names(horario_PEREZZELEDON_ingles)[7] <- "BAR-02"

horario_PEREZZELEDON_ingles$`BAR-02`[is.na(horario_PEREZZELEDON_ingles$`BAR-02`)] <- 0



#BCA-02

`BCA-02` <- as.data.frame(count(`PEREZZELEDON-ingles-materias-BCA-02`$HORARIO)) 

`BCA-02`$freq <- (`BCA-02`$freq)/sum(`BCA-02`$freq)

names(`BCA-02`)[1] <- "horario"

horario_PEREZZELEDON_ingles <- left_join(horario_PEREZZELEDON_ingles, `BCA-02`)
names(horario_PEREZZELEDON_ingles)[8] <- "BCA-02"

horario_PEREZZELEDON_ingles$`BCA-02`[is.na(horario_PEREZZELEDON_ingles$`BCA-02`)] <- 0



##wide to long

horario_PEREZZELEDON_ingles$id <- "Ulatina_PEREZZELEDON_ingles_pand_C2"
horario_PEREZZELEDON_ingles <-  horario_PEREZZELEDON_ingles%>% dplyr::select(id, everything())

horario_PEREZZELEDON_ingles <- melt(horario_PEREZZELEDON_ingles, id = c("id", "horario"))
names(horario_PEREZZELEDON_ingles)[3] <- "materia"
names(horario_PEREZZELEDON_ingles)[4] <- "asistencia"


#PEREZZELEDON-psico


`PEREZZELEDON-psico-materias` <- split(`PEREZZELEDON-psico`, f = `PEREZZELEDON-psico`$cod_padre) 
names(`PEREZZELEDON-psico-materias`) <- paste0("PEREZZELEDON-psico-materias-",names(`PEREZZELEDON-psico-materias`)) 

list2env(`PEREZZELEDON-psico-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_PEREZZELEDON_psico <- as.data.frame(pf_latina$HORARIO)
names(horario_PEREZZELEDON_psico)[1] <- "horario"
horario_PEREZZELEDON_psico <- unique(horario_PEREZZELEDON_psico)


`obs_PEREZZELEDON-psico-materias` <- as.data.frame(sapply(`PEREZZELEDON-psico-materias`, NROW))

`obs_PEREZZELEDON-psico-materias` <- tibble::rownames_to_column(`obs_PEREZZELEDON-psico-materias`, "materia")
names(`obs_PEREZZELEDON-psico-materias`)[2] <- "obs"

`obs_PEREZZELEDON-psico-materias`$materia <- str_remove(`obs_PEREZZELEDON-psico-materias`$materia, "PEREZZELEDON-psico-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_PEREZZELEDON-psico-materias` <- filter(`obs_PEREZZELEDON-psico-materias`, obs >= 10)
`no_elegibles_PEREZZELEDON-psico-materias` <- filter(`obs_PEREZZELEDON-psico-materias`, obs < 10)




#BFIS 01

`BFIS 01` <- as.data.frame(count(`PEREZZELEDON-psico-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `BFIS 01`)
names(horario_PEREZZELEDON_psico)[2] <- "BFIS 01"

horario_PEREZZELEDON_psico$`BFIS 01`[is.na(horario_PEREZZELEDON_psico$`BFIS 01`)] <- 0


#LCTS-01

`LCTS-01` <- as.data.frame(count(`PEREZZELEDON-psico-materias-LCTS-01`$HORARIO)) 

`LCTS-01`$freq <- (`LCTS-01`$freq)/sum(`LCTS-01`$freq)

names(`LCTS-01`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `LCTS-01`)
names(horario_PEREZZELEDON_psico)[3] <- "LCTS-01"

horario_PEREZZELEDON_psico$`LCTS-01`[is.na(horario_PEREZZELEDON_psico$`LCTS-01`)] <- 0


#LPS 01

`LPS 01` <- as.data.frame(count(`PEREZZELEDON-psico-materias-LPS 01`$HORARIO)) 

`LPS 01`$freq <- (`LPS 01`$freq)/sum(`LPS 01`$freq)

names(`LPS 01`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `LPS 01`)
names(horario_PEREZZELEDON_psico)[4] <- "LPS 01"

horario_PEREZZELEDON_psico$`LPS 01`[is.na(horario_PEREZZELEDON_psico$`LPS 01`)] <- 0


#LPS 04

`LPS 04` <- as.data.frame(count(`PEREZZELEDON-psico-materias-LPS 04`$HORARIO)) 

`LPS 04`$freq <- (`LPS 04`$freq)/sum(`LPS 04`$freq)

names(`LPS 04`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `LPS 04`)
names(horario_PEREZZELEDON_psico)[5] <- "LPS 04"

horario_PEREZZELEDON_psico$`LPS 04`[is.na(horario_PEREZZELEDON_psico$`LPS 04`)] <- 0


#BIC-33

`BIC-33` <- as.data.frame(count(`PEREZZELEDON-psico-materias-BIC-33`$HORARIO)) 

`BIC-33`$freq <- (`BIC-33`$freq)/sum(`BIC-33`$freq)

names(`BIC-33`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `BIC-33`)
names(horario_PEREZZELEDON_psico)[6] <- "BIC-33"

horario_PEREZZELEDON_psico$`BIC-33`[is.na(horario_PEREZZELEDON_psico$`BIC-33`)] <- 0


#BIN-04

`BIN-04` <- as.data.frame(count(`PEREZZELEDON-psico-materias-BIN-04`$HORARIO)) 

`BIN-04`$freq <- (`BIN-04`$freq)/sum(`BIN-04`$freq)

names(`BIN-04`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `BIN-04`)
names(horario_PEREZZELEDON_psico)[7] <- "BIN-04"

horario_PEREZZELEDON_psico$`BIN-04`[is.na(horario_PEREZZELEDON_psico$`BIN-04`)] <- 0


#BING 01

`BING 01` <- as.data.frame(count(`PEREZZELEDON-psico-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_PEREZZELEDON_psico <- left_join(horario_PEREZZELEDON_psico, `BING 01`)
names(horario_PEREZZELEDON_psico)[8] <- "BING 01"

horario_PEREZZELEDON_psico$`BING 01`[is.na(horario_PEREZZELEDON_psico$`BING 01`)] <- 0



##wide to long

horario_PEREZZELEDON_psico$id <- "Ulatina_PEREZZELEDON_psico_pand_C2"
horario_PEREZZELEDON_psico <-  horario_PEREZZELEDON_psico%>% dplyr::select(id, everything())

horario_PEREZZELEDON_psico <- melt(horario_PEREZZELEDON_psico, id = c("id", "horario"))
names(horario_PEREZZELEDON_psico)[3] <- "materia"
names(horario_PEREZZELEDON_psico)[4] <- "asistencia"


#Consolidado de sede PEREZZELEDON

horario_PEREZZELEDON <- rbind(horario_PEREZZELEDON_admin_neg,horario_PEREZZELEDON_ingles,
                              horario_PEREZZELEDON_derecho,horario_PEREZZELEDON_enf,
                              horario_PEREZZELEDON_indus,horario_PEREZZELEDON_ingles,horario_PEREZZELEDON_psico)

#total poblacion por carrera PEREZZELEDON

materias_PEREZZELEDON_pand_C2 <- count(PEREZZELEDON$cod_padre)
names(materias_PEREZZELEDON_pand_C2)[1] <- "materia"
names(materias_PEREZZELEDON_pand_C2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_PEREZZELEDON <- left_join(horario_PEREZZELEDON, materias_PEREZZELEDON_pand_C2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_PEREZZELEDON$asistencia, by = list(horario_PEREZZELEDON$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_PEREZZELEDON <- left_join(horario_PEREZZELEDON, pob_asist2)

horario_PEREZZELEDON$asistencia2 <- horario_PEREZZELEDON$asistencia/horario_PEREZZELEDON$sum_prop
horario_PEREZZELEDON$asistencia2[horario_PEREZZELEDON$asistencia2 == Inf] <- 0

horario_PEREZZELEDON$pob_asist <- round((horario_PEREZZELEDON$asistencia2)*(horario_PEREZZELEDON$poblacion),0)


#Guardo todos los horarios en su folder correspondiente

count(horario_PEREZZELEDON$id)
Replaces <- data.frame(from = c("Ulatina_PEREZZELEDON_admin_neg_pand_C2","Ulatina_PEREZZELEDON_ter_fis_pand_C2", 
                                "Ulatina_PEREZZELEDON_conta_pub_pand_C2","Ulatina_PEREZZELEDON_admin_hoteleria_pand_C2",
                                "Ulatina_PEREZZELEDON_anim_dig_pand_C2", "Ulatina_PEREZZELEDON_civil_pand_C2"
                                ,"Ulatina_PEREZZELEDON_dis_graf_pand_C2","Ulatina_PEREZZELEDON_dis_int_pand_C2"
                                ,"Ulatina_PEREZZELEDON_elect_mec_pand_C2","Ulatina_PEREZZELEDON_mec_adm_pand_C2"), 
                       
                       to = c("Ulatina_PEREZZELEDON_admin-neg_pand_C2", "Ulatina_PEREZZELEDON_ter-fis_pand_C2", 
                              "Ulatina_PEREZZELEDON_conta_pub-pand_C2","Ulatina_PEREZZELEDON_admin-hoteleria_pand_C2",
                              "Ulatina_PEREZZELEDON_anim-dig_pand_C2","Ulatina_PEREZZELEDON_c-com_pand_C2",
                              "Ulatina_PEREZZELEDON_dis-graf_pand_C2","Ulatina_PEREZZELEDON_dis-int_pand_C2"
                              ,"Ulatina_PEREZZELEDON_elect-mec_pand_C2","Ulatina_PEREZZELEDON_mec-adm_pand_C2"))
horario_PEREZZELEDON <- FindReplace(data = horario_PEREZZELEDON, Var = "id", replaceData = Replaces,
                                    from = "from", to = "to", exact = FALSE)


count(horario_PEREZZELEDON$id)

write_xlsx(horario_PEREZZELEDON,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/horario_PEREZZELEDON_latina_pand_C2.xlsx")

# write_xlsx(horario_PEREZZELEDON_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/admin_neg_C2.xlsx")
# write_xlsx(horario_PEREZZELEDON_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/contabilidad_C2.xlsx")
# write_xlsx(horario_PEREZZELEDON_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/derecho_C2.xlsx")
# write_xlsx(horario_PEREZZELEDON_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/industrial_C2.xlsx")
# write_xlsx(horario_PEREZZELEDON_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/ingles_C2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_PEREZZELEDON$id, "_", 5)

horario_PEREZZELEDON <- cbind(split, horario_PEREZZELEDON)
names(horario_PEREZZELEDON)[1] <- "marca"
names(horario_PEREZZELEDON)[2] <- "sede"
names(horario_PEREZZELEDON)[3] <- "carrera"
names(horario_PEREZZELEDON)[4] <- "modalidad"
names(horario_PEREZZELEDON)[5] <- "cuatrimestre"

horario_PEREZZELEDON <- horario_PEREZZELEDON %>% dplyr::select(-id)


horario_PEREZZELEDON_unique <- subset(horario_PEREZZELEDON, pob_asist != 0)

horario_PEREZZELEDON_unique <- horario_PEREZZELEDON_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_PEREZZELEDON_unique$marca <- "Ulatina"
horario_PEREZZELEDON_unique$sede <- "PEREZZELEDON"
horario_PEREZZELEDON_unique$modalidad <- "pand"
horario_PEREZZELEDON_unique$cuatrimestre <- "C2"

horario_PEREZZELEDON_unique <- horario_PEREZZELEDON_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_PEREZZELEDON_unique <- horario_PEREZZELEDON_unique[with(horario_PEREZZELEDON_unique, order(materia, horario)), ]  

horario_PEREZZELEDON_unique <- horario_PEREZZELEDON_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_PEREZZELEDON_unique$unoanueve <- 0
horario_PEREZZELEDON_unique$unoanueve[horario_PEREZZELEDON_unique$Asistencia <= 9] <- 1

horario_PEREZZELEDON_unique$dieza17 <- 0
horario_PEREZZELEDON_unique$dieza17[horario_PEREZZELEDON_unique$Asistencia >= 10 & horario_PEREZZELEDON_unique$Asistencia <= 17] <- 1

horario_PEREZZELEDON_unique$di18a30 <- 0
horario_PEREZZELEDON_unique$di18a30[horario_PEREZZELEDON_unique$Asistencia >= 18 & horario_PEREZZELEDON_unique$Asistencia <= 30] <- 1

horario_PEREZZELEDON_unique$di31a60 <- 0
horario_PEREZZELEDON_unique$di31a60[horario_PEREZZELEDON_unique$Asistencia >= 31 & horario_PEREZZELEDON_unique$Asistencia <= 60] <- 1

horario_PEREZZELEDON_unique$mas60 <- 0
horario_PEREZZELEDON_unique$mas60[horario_PEREZZELEDON_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_PEREZZELEDON_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_PEREZZELEDON_unique <- left_join(horario_PEREZZELEDON_unique, duplicados, by = "materia")

names(horario_PEREZZELEDON_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_PEREZZELEDON_unique$recomendacion <- 0
horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$unoanueve == 1 & horario_PEREZZELEDON_unique$duplicado == 0] <- "cerrar horario"
horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$unoanueve == 1 & horario_PEREZZELEDON_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$dieza17 == 1 & horario_PEREZZELEDON_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$dieza17 == 1 & horario_PEREZZELEDON_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_PEREZZELEDON_unique$recomendacion[horario_PEREZZELEDON_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_PEREZZELEDON_unique <- horario_PEREZZELEDON_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                              horario, materia, Asistencia, recomendacion)


horario_split <- as.data.frame(str_split_fixed(horario_PEREZZELEDON_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_PEREZZELEDON_unique <- cbind(horario_PEREZZELEDON_unique, horario_split)
names(horario_PEREZZELEDON_unique)

horario_PEREZZELEDON_unique$recom_d <- 0
horario_PEREZZELEDON_unique$recom_d[horario_PEREZZELEDON_unique$recomendacion == "unir horario" | horario_PEREZZELEDON_unique$recomendacion == "cerrar horario"] <- 0
horario_PEREZZELEDON_unique$recom_d[horario_PEREZZELEDON_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                                      horario_PEREZZELEDON_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_PEREZZELEDON_unique$recom_d[horario_PEREZZELEDON_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_PEREZZELEDON_unique$recom_d[horario_PEREZZELEDON_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_PEREZZELEDON_unique <- horario_PEREZZELEDON_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)

write_xlsx(horario_PEREZZELEDON_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/recom_PEREZZELEDON_latina_pand_C2.xlsx")



###### Comparativo de cursos ofertados para usarlo contra la tabla dinamica PEREZZELEDON ######

horario_split_2 <- as.data.frame(str_split_fixed(PEREZZELEDON$HORARIO, " ", 2))
names(horario_split_2)[1] <- "dia"
names(horario_split_2)[2] <- "hora"

PEREZZELEDON <- cbind(PEREZZELEDON, horario_split_2)
names(PEREZZELEDON)

PEREZZELEDON$paralelo <- paste0(PEREZZELEDON$AULA, "-", PEREZZELEDON$HORARIO)


write_xlsx(PEREZZELEDON,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_PEREZZELEDON/PEREZZELEDON_mock.xlsx")


pt <- PivotTable$new()
pt$addData(PEREZZELEDON)
pt$addColumnDataGroups("dia")
pt$addRowDataGroups("hora")
pt$defineCalculation(calculationName="paralelos", summariseExpression="paralelo")
pt$renderPivot()


######## ULATINA SEDE SANJOSE #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_SANJOSE_carr <- split(SANJOSE, f = SANJOSE$carrera) 
names(ulat_SANJOSE_carr) <- paste0("SANJOSE-",names(ulat_SANJOSE_carr)) 

list2env(ulat_SANJOSE_carr,envir=.GlobalEnv)


#segundo anidado Sede-carrera-materias#

#SANJOSE-admin_neg


`SANJOSE-admin_neg-materias` <- split(`SANJOSE-admin_neg`, f = `SANJOSE-admin_neg`$cod_padre) 
names(`SANJOSE-admin_neg-materias`) <- paste0("SANJOSE-admin_neg-materias-",names(`SANJOSE-admin_neg-materias`)) 

list2env(`SANJOSE-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_admin_neg)[1] <- "horario"
horario_SANJOSE_admin_neg <- unique(horario_SANJOSE_admin_neg)


`obs_SANJOSE-admin_neg-materias` <- as.data.frame(sapply(`SANJOSE-admin_neg-materias`, NROW))

`obs_SANJOSE-admin_neg-materias` <- tibble::rownames_to_column(`obs_SANJOSE-admin_neg-materias`, "materia")
names(`obs_SANJOSE-admin_neg-materias`)[2] <- "obs"

`obs_SANJOSE-admin_neg-materias`$materia <- str_remove(`obs_SANJOSE-admin_neg-materias`$materia, "SANJOSE-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-admin_neg-materias` <- filter(`obs_SANJOSE-admin_neg-materias`, obs >= 10)
`no_elegibles_SANJOSE-admin_neg-materias` <- filter(`obs_SANJOSE-admin_neg-materias`, obs < 10)


#BAN 01

`BAN 01` <- as.data.frame(count(`SANJOSE-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `BAN 01`)
names(horario_SANJOSE_admin_neg)[2] <- "BAN 01"

horario_SANJOSE_admin_neg$`BAN 01`[is.na(horario_SANJOSE_admin_neg$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`SANJOSE-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `BAN 03`)
names(horario_SANJOSE_admin_neg)[3] <- "BAN 03"

horario_SANJOSE_admin_neg$`BAN 03`[is.na(horario_SANJOSE_admin_neg$`BAN 03`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`SANJOSE-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `BCP 01`)
names(horario_SANJOSE_admin_neg)[4] <- "BCP 01"

horario_SANJOSE_admin_neg$`BCP 01`[is.na(horario_SANJOSE_admin_neg$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`SANJOSE-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `BMA 02`)
names(horario_SANJOSE_admin_neg)[5] <- "BMA 02"

horario_SANJOSE_admin_neg$`BMA 02`[is.na(horario_SANJOSE_admin_neg$`BMA 02`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`SANJOSE-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `BPE 27`)
names(horario_SANJOSE_admin_neg)[6] <- "BPE 27"

horario_SANJOSE_admin_neg$`BPE 27`[is.na(horario_SANJOSE_admin_neg$`BPE 27`)] <- 0


#BPE 02

`BPE 02` <- as.data.frame(count(`SANJOSE-admin_neg-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `BPE 02`)
names(horario_SANJOSE_admin_neg)[7] <- "BPE 02"

horario_SANJOSE_admin_neg$`BPE 02`[is.na(horario_SANJOSE_admin_neg$`BPE 02`)] <- 0


#LAN 01

`LAN 01` <- as.data.frame(count(`SANJOSE-admin_neg-materias-LAN 01`$HORARIO)) 

`LAN 01`$freq <- (`LAN 01`$freq)/sum(`LAN 01`$freq)

names(`LAN 01`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `LAN 01`)
names(horario_SANJOSE_admin_neg)[8] <- "LAN 01"

horario_SANJOSE_admin_neg$`LAN 01`[is.na(horario_SANJOSE_admin_neg$`LAN 01`)] <- 0


#LAN 02

`LAN 02` <- as.data.frame(count(`SANJOSE-admin_neg-materias-LAN 02`$HORARIO)) 

`LAN 02`$freq <- (`LAN 02`$freq)/sum(`LAN 02`$freq)

names(`LAN 02`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `LAN 02`)
names(horario_SANJOSE_admin_neg)[9] <- "LAN 02"

horario_SANJOSE_admin_neg$`LAN 02`[is.na(horario_SANJOSE_admin_neg$`LAN 02`)] <- 0



#LAN 03

`LAN 03` <- as.data.frame(count(`SANJOSE-admin_neg-materias-LAN 03`$HORARIO)) 

`LAN 03`$freq <- (`LAN 03`$freq)/sum(`LAN 03`$freq)

names(`LAN 03`)[1] <- "horario"

horario_SANJOSE_admin_neg <- left_join(horario_SANJOSE_admin_neg, `LAN 03`)
names(horario_SANJOSE_admin_neg)[10] <- "LAN 03"

horario_SANJOSE_admin_neg$`LAN 03`[is.na(horario_SANJOSE_admin_neg$`LAN 03`)] <- 0


##wide to long

horario_SANJOSE_admin_neg$id <- "Ulatina_SANJOSE_admin_neg_pand_C2"
horario_SANJOSE_admin_neg <-  horario_SANJOSE_admin_neg%>% dplyr::select(id, everything())

horario_SANJOSE_admin_neg <- melt(horario_SANJOSE_admin_neg, id = c("id", "horario"))
names(horario_SANJOSE_admin_neg)[3] <- "materia"
names(horario_SANJOSE_admin_neg)[4] <- "asistencia"


#SANJOSE-ingles


`SANJOSE-ingles-materias` <- split(`SANJOSE-ingles`, f = `SANJOSE-ingles`$cod_padre) 
names(`SANJOSE-ingles-materias`) <- paste0("SANJOSE-ingles-materias-",names(`SANJOSE-ingles-materias`)) 

list2env(`SANJOSE-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_ingles)[1] <- "horario"
horario_SANJOSE_ingles <- unique(horario_SANJOSE_ingles)


`obs_SANJOSE-ingles-materias` <- as.data.frame(sapply(`SANJOSE-ingles-materias`, NROW))

`obs_SANJOSE-ingles-materias` <- tibble::rownames_to_column(`obs_SANJOSE-ingles-materias`, "materia")
names(`obs_SANJOSE-ingles-materias`)[2] <- "obs"

`obs_SANJOSE-ingles-materias`$materia <- str_remove(`obs_SANJOSE-ingles-materias`$materia, "SANJOSE-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-ingles-materias` <- filter(`obs_SANJOSE-ingles-materias`, obs >= 10)
`no_elegibles_SANJOSE-ingles-materias` <- filter(`obs_SANJOSE-ingles-materias`, obs < 10)



#BCA-02

`BCA-02` <- as.data.frame(count(`SANJOSE-ingles-materias-BCA-02`$HORARIO)) 

`BCA-02`$freq <- (`BCA-02`$freq)/sum(`BCA-02`$freq)

names(`BCA-02`)[1] <- "horario"

horario_SANJOSE_ingles <- left_join(horario_SANJOSE_ingles, `BCA-02`)
names(horario_SANJOSE_ingles)[2] <- "BCA-02"

horario_SANJOSE_ingles$`BCA-02`[is.na(horario_SANJOSE_ingles$`BCA-02`)] <- 0




#BCP 01

`BCP 01` <- as.data.frame(count(`SANJOSE-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANJOSE_ingles <- left_join(horario_SANJOSE_ingles, `BCP 01`)
names(horario_SANJOSE_ingles)[3] <- "BCP 01"

horario_SANJOSE_ingles$`BCP 01`[is.na(horario_SANJOSE_ingles$`BCP 01`)] <- 0


#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_ingles <- left_join(horario_SANJOSE_ingles, `BCS-01`)
names(horario_SANJOSE_ingles)[4] <- "BCS-01"

horario_SANJOSE_ingles$`BCS-01`[is.na(horario_SANJOSE_ingles$`BCS-01`)] <- 0





##wide to long

horario_SANJOSE_ingles$id <- "Ulatina_SANJOSE_ingles_pand_C2"
horario_SANJOSE_ingles <-  horario_SANJOSE_ingles%>% dplyr::select(id, everything())

horario_SANJOSE_ingles <- melt(horario_SANJOSE_ingles, id = c("id", "horario"))
names(horario_SANJOSE_ingles)[3] <- "materia"
names(horario_SANJOSE_ingles)[4] <- "asistencia"



#SANJOSE-comput


`SANJOSE-comput-materias` <- split(`SANJOSE-comput`, f = `SANJOSE-comput`$cod_padre) 
names(`SANJOSE-comput-materias`) <- paste0("SANJOSE-comput-materias-",names(`SANJOSE-comput-materias`)) 

list2env(`SANJOSE-comput-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_comput <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_comput)[1] <- "horario"
horario_SANJOSE_comput <- unique(horario_SANJOSE_comput)


`obs_SANJOSE-comput-materias` <- as.data.frame(sapply(`SANJOSE-comput-materias`, NROW))

`obs_SANJOSE-comput-materias` <- tibble::rownames_to_column(`obs_SANJOSE-comput-materias`, "materia")
names(`obs_SANJOSE-comput-materias`)[2] <- "obs"

`obs_SANJOSE-comput-materias`$materia <- str_remove(`obs_SANJOSE-comput-materias`$materia, "SANJOSE-comput-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-comput-materias` <- filter(`obs_SANJOSE-comput-materias`, obs >= 10)
`no_elegibles_SANJOSE-comput-materias` <- filter(`obs_SANJOSE-comput-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-comput-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_comput <- left_join(horario_SANJOSE_comput, `BCS-01`)
names(horario_SANJOSE_comput)[2] <- "BCS-01"

horario_SANJOSE_comput$`BCS-01`[is.na(horario_SANJOSE_comput$`BCS-01`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`SANJOSE-comput-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_SANJOSE_comput <- left_join(horario_SANJOSE_comput, `BMA 01`)
names(horario_SANJOSE_comput)[3] <- "BMA 01"

horario_SANJOSE_comput$`BMA 01`[is.na(horario_SANJOSE_comput$`BMA 01`)] <- 0



#BIS01

BIS01 <- as.data.frame(count(`SANJOSE-comput-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_SANJOSE_comput <- left_join(horario_SANJOSE_comput, BIS01)
names(horario_SANJOSE_comput)[4] <- "BIS01"

horario_SANJOSE_comput$BIS01[is.na(horario_SANJOSE_comput$BIS01)] <- 0


#BIS02

BIS02 <- as.data.frame(count(`SANJOSE-comput-materias-BIS02`$HORARIO)) 

BIS02$freq <- (BIS02$freq)/sum(BIS02$freq)

names(BIS02)[1] <- "horario"

horario_SANJOSE_comput <- left_join(horario_SANJOSE_comput, BIS02)
names(horario_SANJOSE_comput)[5] <- "BIS02"

horario_SANJOSE_comput$BIS02[is.na(horario_SANJOSE_comput$BIS02)] <- 0


#BIS03

BIS03 <- as.data.frame(count(`SANJOSE-comput-materias-BIS03`$HORARIO)) 

BIS03$freq <- (BIS03$freq)/sum(BIS03$freq)

names(BIS03)[1] <- "horario"

horario_SANJOSE_comput <- left_join(horario_SANJOSE_comput, BIS03)
names(horario_SANJOSE_comput)[6] <- "BIS03"

horario_SANJOSE_comput$BIS03[is.na(horario_SANJOSE_comput$BIS03)] <- 0


##wide to long

horario_SANJOSE_comput$id <- "Ulatina_SANJOSE_comput_pand_C2"
horario_SANJOSE_comput <-  horario_SANJOSE_comput%>% dplyr::select(id, everything())

horario_SANJOSE_comput <- melt(horario_SANJOSE_comput, id = c("id", "horario"))
names(horario_SANJOSE_comput)[3] <- "materia"
names(horario_SANJOSE_comput)[4] <- "asistencia"


#SANJOSE-conta


`SANJOSE-conta-materias` <- split(`SANJOSE-conta`, f = `SANJOSE-conta`$cod_padre) 
names(`SANJOSE-conta-materias`) <- paste0("SANJOSE-conta-materias-",names(`SANJOSE-conta-materias`)) 

list2env(`SANJOSE-conta-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_conta <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_conta)[1] <- "horario"
horario_SANJOSE_conta <- unique(horario_SANJOSE_conta)


`obs_SANJOSE-conta-materias` <- as.data.frame(sapply(`SANJOSE-conta-materias`, NROW))

`obs_SANJOSE-conta-materias` <- tibble::rownames_to_column(`obs_SANJOSE-conta-materias`, "materia")
names(`obs_SANJOSE-conta-materias`)[2] <- "obs"

`obs_SANJOSE-conta-materias`$materia <- str_remove(`obs_SANJOSE-conta-materias`$materia, "SANJOSE-conta-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-conta-materias` <- filter(`obs_SANJOSE-conta-materias`, obs >= 10)
`no_elegibles_SANJOSE-conta-materias` <- filter(`obs_SANJOSE-conta-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-conta-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_conta <- left_join(horario_SANJOSE_conta, `BAN-040`)
names(horario_SANJOSE_conta)[2] <- "BAN-040"

horario_SANJOSE_conta$`BAN-040`[is.na(horario_SANJOSE_conta$`BAN-040`)] <- 0


#BAN 01

`BAN 01` <- as.data.frame(count(`SANJOSE-conta-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANJOSE_conta <- left_join(horario_SANJOSE_conta, `BAN 01`)
names(horario_SANJOSE_conta)[3] <- "BAN 01"

horario_SANJOSE_conta$`BAN 01`[is.na(horario_SANJOSE_conta$`BAN 01`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`SANJOSE-conta-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANJOSE_conta <- left_join(horario_SANJOSE_conta, `BCP 01`)
names(horario_SANJOSE_conta)[4] <- "BCP 01"

horario_SANJOSE_conta$`BCP 01`[is.na(horario_SANJOSE_conta$`BCP 01`)] <- 0


##wide to long

horario_SANJOSE_conta$id <- "Ulatina_SANJOSE_conta_pand_C2"
horario_SANJOSE_conta <-  horario_SANJOSE_conta%>% dplyr::select(id, everything())

horario_SANJOSE_conta <- melt(horario_SANJOSE_conta, id = c("id", "horario"))
names(horario_SANJOSE_conta)[3] <- "materia"
names(horario_SANJOSE_conta)[4] <- "asistencia"


#SANJOSE-conta_pub


`SANJOSE-conta_pub-materias` <- split(`SANJOSE-conta_pub`, f = `SANJOSE-conta_pub`$cod_padre) 
names(`SANJOSE-conta_pub-materias`) <- paste0("SANJOSE-conta_pub-materias-",names(`SANJOSE-conta_pub-materias`)) 

list2env(`SANJOSE-conta_pub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_conta_pub <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_conta_pub)[1] <- "horario"
horario_SANJOSE_conta_pub <- unique(horario_SANJOSE_conta_pub)


`obs_SANJOSE-conta_pub-materias` <- as.data.frame(sapply(`SANJOSE-conta_pub-materias`, NROW))

`obs_SANJOSE-conta_pub-materias` <- tibble::rownames_to_column(`obs_SANJOSE-conta_pub-materias`, "materia")
names(`obs_SANJOSE-conta_pub-materias`)[2] <- "obs"

`obs_SANJOSE-conta_pub-materias`$materia <- str_remove(`obs_SANJOSE-conta_pub-materias`$materia, "SANJOSE-conta_pub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-conta_pub-materias` <- filter(`obs_SANJOSE-conta_pub-materias`, obs >= 10)
`no_elegibles_SANJOSE-conta_pub-materias` <- filter(`obs_SANJOSE-conta_pub-materias`, obs < 10)


#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANJOSE-conta_pub-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANJOSE_conta_pub <- left_join(horario_SANJOSE_conta_pub, `BFIS 01`)
names(horario_SANJOSE_conta_pub)[2] <- "BFIS 01"

horario_SANJOSE_conta_pub$`BFIS 01`[is.na(horario_SANJOSE_conta_pub$`BFIS 01`)] <- 0


##wide to long

horario_SANJOSE_conta_pub$id <- "Ulatina_SANJOSE_conta_pub_pand_C2"
horario_SANJOSE_conta_pub <-  horario_SANJOSE_conta_pub%>% dplyr::select(id, everything())

horario_SANJOSE_conta_pub <- melt(horario_SANJOSE_conta_pub, id = c("id", "horario"))
names(horario_SANJOSE_conta_pub)[3] <- "materia"
names(horario_SANJOSE_conta_pub)[4] <- "asistencia"




#SANJOSE-derecho


`SANJOSE-derecho-materias` <- split(`SANJOSE-derecho`, f = `SANJOSE-derecho`$cod_padre) 
names(`SANJOSE-derecho-materias`) <- paste0("SANJOSE-derecho-materias-",names(`SANJOSE-derecho-materias`)) 

list2env(`SANJOSE-derecho-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_derecho <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_derecho)[1] <- "horario"
horario_SANJOSE_derecho <- unique(horario_SANJOSE_derecho)


`obs_SANJOSE-derecho-materias` <- as.data.frame(sapply(`SANJOSE-derecho-materias`, NROW))

`obs_SANJOSE-derecho-materias` <- tibble::rownames_to_column(`obs_SANJOSE-derecho-materias`, "materia")
names(`obs_SANJOSE-derecho-materias`)[2] <- "obs"

`obs_SANJOSE-derecho-materias`$materia <- str_remove(`obs_SANJOSE-derecho-materias`$materia, "SANJOSE-derecho-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-derecho-materias` <- filter(`obs_SANJOSE-derecho-materias`, obs >= 10)
`no_elegibles_SANJOSE-derecho-materias` <- filter(`obs_SANJOSE-derecho-materias`, obs < 10)




#BAN-01

`BAN-01` <- as.data.frame(count(`SANJOSE-derecho-materias-BAN-01`$HORARIO)) 

`BAN-01`$freq <- (`BAN-01`$freq)/sum(`BAN-01`$freq)

names(`BAN-01`)[1] <- "horario"

horario_SANJOSE_derecho <- left_join(horario_SANJOSE_derecho, `BAN-01`)
names(horario_SANJOSE_derecho)[2] <- "BAN-01"

horario_SANJOSE_derecho$`BAN-01`[is.na(horario_SANJOSE_derecho$`BAN-01`)] <- 0


#BAN-02

`BAN-02` <- as.data.frame(count(`SANJOSE-derecho-materias-BAN-02`$HORARIO)) 

`BAN-02`$freq <- (`BAN-02`$freq)/sum(`BAN-02`$freq)

names(`BAN-02`)[1] <- "horario"

horario_SANJOSE_derecho <- left_join(horario_SANJOSE_derecho, `BAN-02`)
names(horario_SANJOSE_derecho)[3] <- "BAN-02"

horario_SANJOSE_derecho$`BAN-02`[is.na(horario_SANJOSE_derecho$`BAN-02`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`SANJOSE-derecho-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_SANJOSE_derecho <- left_join(horario_SANJOSE_derecho, `BAN 03`)
names(horario_SANJOSE_derecho)[4] <- "BAN 03"

horario_SANJOSE_derecho$`BAN 03`[is.na(horario_SANJOSE_derecho$`BAN 03`)] <- 0


##wide to long

horario_SANJOSE_derecho$id <- "Ulatina_SANJOSE_derecho_pand_C2"
horario_SANJOSE_derecho <-  horario_SANJOSE_derecho%>% dplyr::select(id, everything())

horario_SANJOSE_derecho <- melt(horario_SANJOSE_derecho, id = c("id", "horario"))
names(horario_SANJOSE_derecho)[3] <- "materia"
names(horario_SANJOSE_derecho)[4] <- "asistencia"




#SANJOSE-enf


`SANJOSE-enf-materias` <- split(`SANJOSE-enf`, f = `SANJOSE-enf`$cod_padre) 
names(`SANJOSE-enf-materias`) <- paste0("SANJOSE-enf-materias-",names(`SANJOSE-enf-materias`)) 

list2env(`SANJOSE-enf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_enf <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_enf)[1] <- "horario"
horario_SANJOSE_enf <- unique(horario_SANJOSE_enf)


`obs_SANJOSE-enf-materias` <- as.data.frame(sapply(`SANJOSE-enf-materias`, NROW))

`obs_SANJOSE-enf-materias` <- tibble::rownames_to_column(`obs_SANJOSE-enf-materias`, "materia")
names(`obs_SANJOSE-enf-materias`)[2] <- "obs"

`obs_SANJOSE-enf-materias`$materia <- str_remove(`obs_SANJOSE-enf-materias`$materia, "SANJOSE-enf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-enf-materias` <- filter(`obs_SANJOSE-enf-materias`, obs >= 10)
`no_elegibles_SANJOSE-enf-materias` <- filter(`obs_SANJOSE-enf-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-enf-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_enf <- left_join(horario_SANJOSE_enf, `BCS-01`)
names(horario_SANJOSE_enf)[2] <- "BCS-01"

horario_SANJOSE_enf$`BCS-01`[is.na(horario_SANJOSE_enf$`BCS-01`)] <- 0


#LCTS-02

`LCTS-02` <- as.data.frame(count(`SANJOSE-enf-materias-LCTS-02`$HORARIO)) 

`LCTS-02`$freq <- (`LCTS-02`$freq)/sum(`LCTS-02`$freq)

names(`LCTS-02`)[1] <- "horario"

horario_SANJOSE_enf <- left_join(horario_SANJOSE_enf, `LCTS-02`)
names(horario_SANJOSE_enf)[3] <- "LCTS-02"

horario_SANJOSE_enf$`LCTS-02`[is.na(horario_SANJOSE_enf$`LCTS-02`)] <- 0


#LDFB-01

`LDFB-01` <- as.data.frame(count(`SANJOSE-enf-materias-LDFB-01`$HORARIO)) 

`LDFB-01`$freq <- (`LDFB-01`$freq)/sum(`LDFB-01`$freq)

names(`LDFB-01`)[1] <- "horario"

horario_SANJOSE_enf <- left_join(horario_SANJOSE_enf, `LDFB-01`)
names(horario_SANJOSE_enf)[4] <- "LDFB-01"

horario_SANJOSE_enf$`LDFB-01`[is.na(horario_SANJOSE_enf$`LDFB-01`)] <- 0


#LENF-01

`LENF-01` <- as.data.frame(count(`SANJOSE-enf-materias-LENF-01`$HORARIO)) 

`LENF-01`$freq <- (`LENF-01`$freq)/sum(`LENF-01`$freq)

names(`LENF-01`)[1] <- "horario"

horario_SANJOSE_enf <- left_join(horario_SANJOSE_enf, `LENF-01`)
names(horario_SANJOSE_enf)[5] <- "LENF-01"

horario_SANJOSE_enf$`LENF-01`[is.na(horario_SANJOSE_enf$`LENF-01`)] <- 0


##wide to long

horario_SANJOSE_enf$id <- "Ulatina_SANJOSE_enf_pand_C2"
horario_SANJOSE_enf <-  horario_SANJOSE_enf%>% dplyr::select(id, everything())

horario_SANJOSE_enf <- melt(horario_SANJOSE_enf, id = c("id", "horario"))
names(horario_SANJOSE_enf)[3] <- "materia"
names(horario_SANJOSE_enf)[4] <- "asistencia"



#SANJOSE-indus


`SANJOSE-indus-materias` <- split(`SANJOSE-indus`, f = `SANJOSE-indus`$cod_padre) 
names(`SANJOSE-indus-materias`) <- paste0("SANJOSE-indus-materias-",names(`SANJOSE-indus-materias`)) 

list2env(`SANJOSE-indus-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_indus <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_indus)[1] <- "horario"
horario_SANJOSE_indus <- unique(horario_SANJOSE_indus)


`obs_SANJOSE-indus-materias` <- as.data.frame(sapply(`SANJOSE-indus-materias`, NROW))

`obs_SANJOSE-indus-materias` <- tibble::rownames_to_column(`obs_SANJOSE-indus-materias`, "materia")
names(`obs_SANJOSE-indus-materias`)[2] <- "obs"

`obs_SANJOSE-indus-materias`$materia <- str_remove(`obs_SANJOSE-indus-materias`$materia, "SANJOSE-indus-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-indus-materias` <- filter(`obs_SANJOSE-indus-materias`, obs >= 10)
`no_elegibles_SANJOSE-indus-materias` <- filter(`obs_SANJOSE-indus-materias`, obs < 10)


#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANJOSE-indus-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BFIS 01`)
names(horario_SANJOSE_indus)[2] <- "BFIS 01"

horario_SANJOSE_indus$`BFIS 01`[is.na(horario_SANJOSE_indus$`BFIS 01`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`SANJOSE-indus-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BMA 01`)
names(horario_SANJOSE_indus)[3] <- "BMA 01"

horario_SANJOSE_indus$`BMA 01`[is.na(horario_SANJOSE_indus$`BMA 01`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`SANJOSE-indus-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BPE 27`)
names(horario_SANJOSE_indus)[4] <- "BPE 27"

horario_SANJOSE_indus$`BPE 27`[is.na(horario_SANJOSE_indus$`BPE 27`)] <- 0


#BPE 02

`BPE 02` <- as.data.frame(count(`SANJOSE-indus-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BPE 02`)
names(horario_SANJOSE_indus)[5] <- "BPE 02"

horario_SANJOSE_indus$`BPE 02`[is.na(horario_SANJOSE_indus$`BPE 02`)] <- 0


#LCB-03

`LCB-03` <- as.data.frame(count(`SANJOSE-indus-materias-LCB-03`$HORARIO)) 

`LCB-03`$freq <- (`LCB-03`$freq)/sum(`LCB-03`$freq)

names(`LCB-03`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `LCB-03`)
names(horario_SANJOSE_indus)[6] <- "LCB-03"

horario_SANJOSE_indus$`LCB-03`[is.na(horario_SANJOSE_indus$`LCB-03`)] <- 0



#BIM 21

`BIM 21` <- as.data.frame(count(`SANJOSE-indus-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BIM 21`)
names(horario_SANJOSE_indus)[7] <- "BIM 21"

horario_SANJOSE_indus$`BIM 21`[is.na(horario_SANJOSE_indus$`BIM 21`)] <- 0



#BED-34

`BED-34` <- as.data.frame(count(`SANJOSE-indus-materias-BED-34`$HORARIO)) 

`BED-34`$freq <- (`BED-34`$freq)/sum(`BED-34`$freq)

names(`BED-34`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BED-34`)
names(horario_SANJOSE_indus)[8] <- "BED-34"

horario_SANJOSE_indus$`BED-34`[is.na(horario_SANJOSE_indus$`BED-34`)] <- 0


#BAR-01

`BAR-01` <- as.data.frame(count(`SANJOSE-indus-materias-BAR-01`$HORARIO)) 

`BAR-01`$freq <- (`BAR-01`$freq)/sum(`BAR-01`$freq)

names(`BAR-01`)[1] <- "horario"

horario_SANJOSE_indus <- left_join(horario_SANJOSE_indus, `BAR-01`)
names(horario_SANJOSE_indus)[9] <- "BAR-01"

horario_SANJOSE_indus$`BAR-01`[is.na(horario_SANJOSE_indus$`BAR-01`)] <- 0


##wide to long

horario_SANJOSE_indus$id <- "Ulatina_SANJOSE_indus_pand_C2"
horario_SANJOSE_indus <-  horario_SANJOSE_indus%>% dplyr::select(id, everything())

horario_SANJOSE_indus <- melt(horario_SANJOSE_indus, id = c("id", "horario"))
names(horario_SANJOSE_indus)[3] <- "materia"
names(horario_SANJOSE_indus)[4] <- "asistencia"



#SANJOSE-psico


`SANJOSE-psico-materias` <- split(`SANJOSE-psico`, f = `SANJOSE-psico`$cod_padre) 
names(`SANJOSE-psico-materias`) <- paste0("SANJOSE-psico-materias-",names(`SANJOSE-psico-materias`)) 

list2env(`SANJOSE-psico-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_psico <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_psico)[1] <- "horario"
horario_SANJOSE_psico <- unique(horario_SANJOSE_psico)


`obs_SANJOSE-psico-materias` <- as.data.frame(sapply(`SANJOSE-psico-materias`, NROW))

`obs_SANJOSE-psico-materias` <- tibble::rownames_to_column(`obs_SANJOSE-psico-materias`, "materia")
names(`obs_SANJOSE-psico-materias`)[2] <- "obs"

`obs_SANJOSE-psico-materias`$materia <- str_remove(`obs_SANJOSE-psico-materias`$materia, "SANJOSE-psico-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-psico-materias` <- filter(`obs_SANJOSE-psico-materias`, obs >= 10)
`no_elegibles_SANJOSE-psico-materias` <- filter(`obs_SANJOSE-psico-materias`, obs < 10)




#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANJOSE-psico-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `BFIS 01`)
names(horario_SANJOSE_psico)[2] <- "BFIS 01"

horario_SANJOSE_psico$`BFIS 01`[is.na(horario_SANJOSE_psico$`BFIS 01`)] <- 0


#LCTS-01

`LCTS-01` <- as.data.frame(count(`SANJOSE-psico-materias-LCTS-01`$HORARIO)) 

`LCTS-01`$freq <- (`LCTS-01`$freq)/sum(`LCTS-01`$freq)

names(`LCTS-01`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `LCTS-01`)
names(horario_SANJOSE_psico)[3] <- "LCTS-01"

horario_SANJOSE_psico$`LCTS-01`[is.na(horario_SANJOSE_psico$`LCTS-01`)] <- 0


#LPS 01

`LPS 01` <- as.data.frame(count(`SANJOSE-psico-materias-LPS 01`$HORARIO)) 

`LPS 01`$freq <- (`LPS 01`$freq)/sum(`LPS 01`$freq)

names(`LPS 01`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `LPS 01`)
names(horario_SANJOSE_psico)[4] <- "LPS 01"

horario_SANJOSE_psico$`LPS 01`[is.na(horario_SANJOSE_psico$`LPS 01`)] <- 0


#LPS 04

`LPS 04` <- as.data.frame(count(`SANJOSE-psico-materias-LPS 04`$HORARIO)) 

`LPS 04`$freq <- (`LPS 04`$freq)/sum(`LPS 04`$freq)

names(`LPS 04`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `LPS 04`)
names(horario_SANJOSE_psico)[5] <- "LPS 04"

horario_SANJOSE_psico$`LPS 04`[is.na(horario_SANJOSE_psico$`LPS 04`)] <- 0



#BPS-02

`BPS-02` <- as.data.frame(count(`SANJOSE-psico-materias-BPS-02`$HORARIO)) 

`BPS-02`$freq <- (`BPS-02`$freq)/sum(`BPS-02`$freq)

names(`BPS-02`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `BPS-02`)
names(horario_SANJOSE_psico)[6] <- "BPS-02"

horario_SANJOSE_psico$`BPS-02`[is.na(horario_SANJOSE_psico$`BPS-02`)] <- 0


#BIN-04

`BIN-04` <- as.data.frame(count(`SANJOSE-psico-materias-BIN-04`$HORARIO)) 

`BIN-04`$freq <- (`BIN-04`$freq)/sum(`BIN-04`$freq)

names(`BIN-04`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `BIN-04`)
names(horario_SANJOSE_psico)[7] <- "BIN-04"

horario_SANJOSE_psico$`BIN-04`[is.na(horario_SANJOSE_psico$`BIN-04`)] <- 0



#BDE-02

`BDE-02` <- as.data.frame(count(`SANJOSE-psico-materias-BDE-02`$HORARIO)) 

`BDE-02`$freq <- (`BDE-02`$freq)/sum(`BDE-02`$freq)

names(`BDE-02`)[1] <- "horario"

horario_SANJOSE_psico <- left_join(horario_SANJOSE_psico, `BDE-02`)
names(horario_SANJOSE_psico)[8] <- "BDE-02"

horario_SANJOSE_psico$`BDE-02`[is.na(horario_SANJOSE_psico$`BDE-02`)] <- 0



##wide to long

horario_SANJOSE_psico$id <- "Ulatina_SANJOSE_psico_pand_C2"
horario_SANJOSE_psico <-  horario_SANJOSE_psico%>% dplyr::select(id, everything())

horario_SANJOSE_psico <- melt(horario_SANJOSE_psico, id = c("id", "horario"))
names(horario_SANJOSE_psico)[3] <- "materia"
names(horario_SANJOSE_psico)[4] <- "asistencia"




#SANJOSE-anim_dig


`SANJOSE-anim_dig-materias` <- split(`SANJOSE-anim_dig`, f = `SANJOSE-anim_dig`$cod_padre) 
names(`SANJOSE-anim_dig-materias`) <- paste0("SANJOSE-anim_dig-materias-",names(`SANJOSE-anim_dig-materias`)) 

list2env(`SANJOSE-anim_dig-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_anim_dig <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_anim_dig)[1] <- "horario"
horario_SANJOSE_anim_dig <- unique(horario_SANJOSE_anim_dig)


`obs_SANJOSE-anim_dig-materias` <- as.data.frame(sapply(`SANJOSE-anim_dig-materias`, NROW))

`obs_SANJOSE-anim_dig-materias` <- tibble::rownames_to_column(`obs_SANJOSE-anim_dig-materias`, "materia")
names(`obs_SANJOSE-anim_dig-materias`)[2] <- "obs"

`obs_SANJOSE-anim_dig-materias`$materia <- str_remove(`obs_SANJOSE-anim_dig-materias`$materia, "SANJOSE-anim_dig-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-anim_dig-materias` <- filter(`obs_SANJOSE-anim_dig-materias`, obs >= 10)
`no_elegibles_SANJOSE-anim_dig-materias` <- filter(`obs_SANJOSE-anim_dig-materias`, obs < 10)



#BDG 01

`BDG 01` <- as.data.frame(count(`SANJOSE-anim_dig-materias-BDG 01`$HORARIO)) 

`BDG 01`$freq <- (`BDG 01`$freq)/sum(`BDG 01`$freq)

names(`BDG 01`)[1] <- "horario"

horario_SANJOSE_anim_dig <- left_join(horario_SANJOSE_anim_dig, `BDG 01`)
names(horario_SANJOSE_anim_dig)[2] <- "BDG 01"

horario_SANJOSE_anim_dig$`BDG 01`[is.na(horario_SANJOSE_anim_dig$`BDG 01`)] <- 0


#BPE 02

`BPE 02` <- as.data.frame(count(`SANJOSE-anim_dig-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_SANJOSE_anim_dig <- left_join(horario_SANJOSE_anim_dig, `BPE 02`)
names(horario_SANJOSE_anim_dig)[3] <- "BPE 02"

horario_SANJOSE_anim_dig$`BPE 02`[is.na(horario_SANJOSE_anim_dig$`BPE 02`)] <- 0


##wide to long

horario_SANJOSE_anim_dig$id <- "Ulatina_SANJOSE_anim_dig_pand_C2"
horario_SANJOSE_anim_dig <-  horario_SANJOSE_anim_dig%>% dplyr::select(id, everything())

horario_SANJOSE_anim_dig <- melt(horario_SANJOSE_anim_dig, id = c("id", "horario"))
names(horario_SANJOSE_anim_dig)[3] <- "materia"
names(horario_SANJOSE_anim_dig)[4] <- "asistencia"



#SANJOSE-arquit


`SANJOSE-arquit-materias` <- split(`SANJOSE-arquit`, f = `SANJOSE-arquit`$cod_padre) 
names(`SANJOSE-arquit-materias`) <- paste0("SANJOSE-arquit-materias-",names(`SANJOSE-arquit-materias`)) 

list2env(`SANJOSE-arquit-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_arquit <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_arquit)[1] <- "horario"
horario_SANJOSE_arquit <- unique(horario_SANJOSE_arquit)


`obs_SANJOSE-arquit-materias` <- as.data.frame(sapply(`SANJOSE-arquit-materias`, NROW))

`obs_SANJOSE-arquit-materias` <- tibble::rownames_to_column(`obs_SANJOSE-arquit-materias`, "materia")
names(`obs_SANJOSE-arquit-materias`)[2] <- "obs"

`obs_SANJOSE-arquit-materias`$materia <- str_remove(`obs_SANJOSE-arquit-materias`$materia, "SANJOSE-arquit-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-arquit-materias` <- filter(`obs_SANJOSE-arquit-materias`, obs >= 10)
`no_elegibles_SANJOSE-arquit-materias` <- filter(`obs_SANJOSE-arquit-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`SANJOSE-arquit-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANJOSE_arquit <- left_join(horario_SANJOSE_arquit, `BAN 01`)
names(horario_SANJOSE_arquit)[2] <- "BAN 01"

horario_SANJOSE_arquit$`BAN 01`[is.na(horario_SANJOSE_arquit$`BAN 01`)] <- 0


#BAR-03

`BAR-03` <- as.data.frame(count(`SANJOSE-arquit-materias-BAR-03`$HORARIO)) 

`BAR-03`$freq <- (`BAR-03`$freq)/sum(`BAR-03`$freq)

names(`BAR-03`)[1] <- "horario"

horario_SANJOSE_arquit <- left_join(horario_SANJOSE_arquit, `BAR-03`)
names(horario_SANJOSE_arquit)[3] <- "BAR-03"

horario_SANJOSE_arquit$`BAR-03`[is.na(horario_SANJOSE_arquit$`BAR-03`)] <- 0


#BAR-04

`BAR-04` <- as.data.frame(count(`SANJOSE-arquit-materias-BAR-04`$HORARIO)) 

`BAR-04`$freq <- (`BAR-04`$freq)/sum(`BAR-04`$freq)

names(`BAR-04`)[1] <- "horario"

horario_SANJOSE_arquit <- left_join(horario_SANJOSE_arquit, `BAR-04`)
names(horario_SANJOSE_arquit)[4] <- "BAR-04"

horario_SANJOSE_arquit$`BAR-04`[is.na(horario_SANJOSE_arquit$`BAR-04`)] <- 0


##wide to long

horario_SANJOSE_arquit$id <- "Ulatina_SANJOSE_arquit_pand_C2"
horario_SANJOSE_arquit <-  horario_SANJOSE_arquit%>% dplyr::select(id, everything())

horario_SANJOSE_arquit <- melt(horario_SANJOSE_arquit, id = c("id", "horario"))
names(horario_SANJOSE_arquit)[3] <- "materia"
names(horario_SANJOSE_arquit)[4] <- "asistencia"




#SANJOSE-c_biolo


`SANJOSE-c_biolo-materias` <- split(`SANJOSE-c_biolo`, f = `SANJOSE-c_biolo`$cod_padre) 
names(`SANJOSE-c_biolo-materias`) <- paste0("SANJOSE-c_biolo-materias-",names(`SANJOSE-c_biolo-materias`)) 

list2env(`SANJOSE-c_biolo-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_c_biolo <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_c_biolo)[1] <- "horario"
horario_SANJOSE_c_biolo <- unique(horario_SANJOSE_c_biolo)


`obs_SANJOSE-c_biolo-materias` <- as.data.frame(sapply(`SANJOSE-c_biolo-materias`, NROW))

`obs_SANJOSE-c_biolo-materias` <- tibble::rownames_to_column(`obs_SANJOSE-c_biolo-materias`, "materia")
names(`obs_SANJOSE-c_biolo-materias`)[2] <- "obs"

`obs_SANJOSE-c_biolo-materias`$materia <- str_remove(`obs_SANJOSE-c_biolo-materias`$materia, "SANJOSE-c_biolo-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-c_biolo-materias` <- filter(`obs_SANJOSE-c_biolo-materias`, obs >= 10)
`no_elegibles_SANJOSE-c_biolo-materias` <- filter(`obs_SANJOSE-c_biolo-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-c_biolo-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_c_biolo <- left_join(horario_SANJOSE_c_biolo, `BAN-040`)
names(horario_SANJOSE_c_biolo)[2] <- "BAN-040"

horario_SANJOSE_c_biolo$`BAN-040`[is.na(horario_SANJOSE_c_biolo$`BAN-040`)] <- 0

#BMA 02

`BMA 02` <- as.data.frame(count(`SANJOSE-c_biolo-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_SANJOSE_c_biolo <- left_join(horario_SANJOSE_c_biolo, `BMA 02`)
names(horario_SANJOSE_c_biolo)[3] <- "BMA 02"

horario_SANJOSE_c_biolo$`BMA 02`[is.na(horario_SANJOSE_c_biolo$`BMA 02`)] <- 0


#BAN 01

`BAN 01` <- as.data.frame(count(`SANJOSE-c_biolo-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANJOSE_c_biolo <- left_join(horario_SANJOSE_c_biolo, `BAN 01`)
names(horario_SANJOSE_c_biolo)[4] <- "BAN 01"

horario_SANJOSE_c_biolo$`BAN 01`[is.na(horario_SANJOSE_c_biolo$`BAN 01`)] <- 0




##wide to long

horario_SANJOSE_c_biolo$id <- "Ulatina_SANJOSE_c_biolo_pand_C2"
horario_SANJOSE_c_biolo <-  horario_SANJOSE_c_biolo%>% dplyr::select(id, everything())

horario_SANJOSE_c_biolo <- melt(horario_SANJOSE_c_biolo, id = c("id", "horario"))
names(horario_SANJOSE_c_biolo)[3] <- "materia"
names(horario_SANJOSE_c_biolo)[4] <- "asistencia"



#SANJOSE-civil


`SANJOSE-civil-materias` <- split(`SANJOSE-civil`, f = `SANJOSE-civil`$cod_padre) 
names(`SANJOSE-civil-materias`) <- paste0("SANJOSE-civil-materias-",names(`SANJOSE-civil-materias`)) 

list2env(`SANJOSE-civil-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_civil <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_civil)[1] <- "horario"
horario_SANJOSE_civil <- unique(horario_SANJOSE_civil)


`obs_SANJOSE-civil-materias` <- as.data.frame(sapply(`SANJOSE-civil-materias`, NROW))

`obs_SANJOSE-civil-materias` <- tibble::rownames_to_column(`obs_SANJOSE-civil-materias`, "materia")
names(`obs_SANJOSE-civil-materias`)[2] <- "obs"

`obs_SANJOSE-civil-materias`$materia <- str_remove(`obs_SANJOSE-civil-materias`$materia, "SANJOSE-civil-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-civil-materias` <- filter(`obs_SANJOSE-civil-materias`, obs >= 10)
`no_elegibles_SANJOSE-civil-materias` <- filter(`obs_SANJOSE-civil-materias`, obs < 10)




#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANJOSE-civil-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `BFIS 01`)
names(horario_SANJOSE_civil)[2] <- "BFIS 01"

horario_SANJOSE_civil$`BFIS 01`[is.na(horario_SANJOSE_civil$`BFIS 01`)] <- 0



#BMA 01

`BMA 01` <- as.data.frame(count(`SANJOSE-civil-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `BMA 01`)
names(horario_SANJOSE_civil)[3] <- "BMA 01"

horario_SANJOSE_civil$`BMA 01`[is.na(horario_SANJOSE_civil$`BMA 01`)] <- 0


#LCB-03

`LCB-03` <- as.data.frame(count(`SANJOSE-civil-materias-LCB-03`$HORARIO)) 

`LCB-03`$freq <- (`LCB-03`$freq)/sum(`LCB-03`$freq)

names(`LCB-03`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `LCB-03`)
names(horario_SANJOSE_civil)[4] <- "LCB-03"

horario_SANJOSE_civil$`LCB-03`[is.na(horario_SANJOSE_civil$`LCB-03`)] <- 0


#BMAT-01

`BMAT-01` <- as.data.frame(count(`SANJOSE-civil-materias-BMAT-01`$HORARIO)) 

`BMAT-01`$freq <- (`BMAT-01`$freq)/sum(`BMAT-01`$freq)

names(`BMAT-01`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `BMAT-01`)
names(horario_SANJOSE_civil)[5] <- "BMAT-01"

horario_SANJOSE_civil$`BMAT-01`[is.na(horario_SANJOSE_civil$`BMAT-01`)] <- 0


#BINGE-38

`BINGE-38` <- as.data.frame(count(`SANJOSE-civil-materias-BINGE-38`$HORARIO)) 

`BINGE-38`$freq <- (`BINGE-38`$freq)/sum(`BINGE-38`$freq)

names(`BINGE-38`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `BINGE-38`)
names(horario_SANJOSE_civil)[6] <- "BINGE-38"

horario_SANJOSE_civil$`BINGE-38`[is.na(horario_SANJOSE_civil$`BINGE-38`)] <- 0


#BIN-01

`BIN-01` <- as.data.frame(count(`SANJOSE-civil-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `BIN-01`)
names(horario_SANJOSE_civil)[7] <- "BIN-01"

horario_SANJOSE_civil$`BIN-01`[is.na(horario_SANJOSE_civil$`BIN-01`)] <- 0


#BAN-04

`BAN-04` <- as.data.frame(count(`SANJOSE-civil-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_SANJOSE_civil <- left_join(horario_SANJOSE_civil, `BAN-04`)
names(horario_SANJOSE_civil)[8] <- "BAN-04"

horario_SANJOSE_civil$`BAN-04`[is.na(horario_SANJOSE_civil$`BAN-04`)] <- 0


##wide to long

horario_SANJOSE_civil$id <- "Ulatina_SANJOSE_civil_pand_C2"
horario_SANJOSE_civil <-  horario_SANJOSE_civil%>% dplyr::select(id, everything())

horario_SANJOSE_civil <- melt(horario_SANJOSE_civil, id = c("id", "horario"))
names(horario_SANJOSE_civil)[3] <- "materia"
names(horario_SANJOSE_civil)[4] <- "asistencia"




#SANJOSE-com_mercadeo


`SANJOSE-com_mercadeo-materias` <- split(`SANJOSE-com_mercadeo`, f = `SANJOSE-com_mercadeo`$cod_padre) 
names(`SANJOSE-com_mercadeo-materias`) <- paste0("SANJOSE-com_mercadeo-materias-",names(`SANJOSE-com_mercadeo-materias`)) 

list2env(`SANJOSE-com_mercadeo-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_com_mercadeo <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_com_mercadeo)[1] <- "horario"
horario_SANJOSE_com_mercadeo <- unique(horario_SANJOSE_com_mercadeo)


`obs_SANJOSE-com_mercadeo-materias` <- as.data.frame(sapply(`SANJOSE-com_mercadeo-materias`, NROW))

`obs_SANJOSE-com_mercadeo-materias` <- tibble::rownames_to_column(`obs_SANJOSE-com_mercadeo-materias`, "materia")
names(`obs_SANJOSE-com_mercadeo-materias`)[2] <- "obs"

`obs_SANJOSE-com_mercadeo-materias`$materia <- str_remove(`obs_SANJOSE-com_mercadeo-materias`$materia, "SANJOSE-com_mercadeo-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-com_mercadeo-materias` <- filter(`obs_SANJOSE-com_mercadeo-materias`, obs >= 10)
`no_elegibles_SANJOSE-com_mercadeo-materias` <- filter(`obs_SANJOSE-com_mercadeo-materias`, obs < 10)




#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANJOSE-com_mercadeo-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANJOSE_com_mercadeo <- left_join(horario_SANJOSE_com_mercadeo, `BFIS 01`)
names(horario_SANJOSE_com_mercadeo)[2] <- "BFIS 01"

horario_SANJOSE_com_mercadeo$`BFIS 01`[is.na(horario_SANJOSE_com_mercadeo$`BFIS 01`)] <- 0



##wide to long

horario_SANJOSE_com_mercadeo$id <- "Ulatina_SANJOSE_com_mercadeo_pand_C2"
horario_SANJOSE_com_mercadeo <-  horario_SANJOSE_com_mercadeo%>% dplyr::select(id, everything())

horario_SANJOSE_com_mercadeo <- melt(horario_SANJOSE_com_mercadeo, id = c("id", "horario"))
names(horario_SANJOSE_com_mercadeo)[3] <- "materia"
names(horario_SANJOSE_com_mercadeo)[4] <- "asistencia"



#SANJOSE-dis_graf


`SANJOSE-dis_graf-materias` <- split(`SANJOSE-dis_graf`, f = `SANJOSE-dis_graf`$cod_padre) 
names(`SANJOSE-dis_graf-materias`) <- paste0("SANJOSE-dis_graf-materias-",names(`SANJOSE-dis_graf-materias`)) 

list2env(`SANJOSE-dis_graf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_dis_graf <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_dis_graf)[1] <- "horario"
horario_SANJOSE_dis_graf <- unique(horario_SANJOSE_dis_graf)


`obs_SANJOSE-dis_graf-materias` <- as.data.frame(sapply(`SANJOSE-dis_graf-materias`, NROW))

`obs_SANJOSE-dis_graf-materias` <- tibble::rownames_to_column(`obs_SANJOSE-dis_graf-materias`, "materia")
names(`obs_SANJOSE-dis_graf-materias`)[2] <- "obs"

`obs_SANJOSE-dis_graf-materias`$materia <- str_remove(`obs_SANJOSE-dis_graf-materias`$materia, "SANJOSE-dis_graf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-dis_graf-materias` <- filter(`obs_SANJOSE-dis_graf-materias`, obs >= 10)
`no_elegibles_SANJOSE-dis_graf-materias` <- filter(`obs_SANJOSE-dis_graf-materias`, obs < 10)


#BDE-02

`BDE-02` <- as.data.frame(count(`SANJOSE-dis_graf-materias-BDE-02`$HORARIO)) 

`BDE-02`$freq <- (`BDE-02`$freq)/sum(`BDE-02`$freq)

names(`BDE-02`)[1] <- "horario"

horario_SANJOSE_dis_graf <- left_join(horario_SANJOSE_dis_graf, `BDE-02`)
names(horario_SANJOSE_dis_graf)[2] <- "BDE-02"

horario_SANJOSE_dis_graf$`BDE-02`[is.na(horario_SANJOSE_dis_graf$`BDE-02`)] <- 0




#BDG 02

`BDG 02` <- as.data.frame(count(`SANJOSE-dis_graf-materias-BDG 02`$HORARIO)) 

`BDG 02`$freq <- (`BDG 02`$freq)/sum(`BDG 02`$freq)

names(`BDG 02`)[1] <- "horario"

horario_SANJOSE_dis_graf <- left_join(horario_SANJOSE_dis_graf, `BDG 02`)
names(horario_SANJOSE_dis_graf)[3] <- "BDG 02"

horario_SANJOSE_dis_graf$`BDG 02`[is.na(horario_SANJOSE_dis_graf$`BDG 02`)] <- 0



#BPU-24

`BPU-24` <- as.data.frame(count(`SANJOSE-dis_graf-materias-BPU-24`$HORARIO)) 

`BPU-24`$freq <- (`BPU-24`$freq)/sum(`BPU-24`$freq)

names(`BPU-24`)[1] <- "horario"

horario_SANJOSE_dis_graf <- left_join(horario_SANJOSE_dis_graf, `BPU-24`)
names(horario_SANJOSE_dis_graf)[4] <- "BPU-24"

horario_SANJOSE_dis_graf$`BPU-24`[is.na(horario_SANJOSE_dis_graf$`BPU-24`)] <- 0



##wide to long

horario_SANJOSE_dis_graf$id <- "Ulatina_SANJOSE_dis_graf_pand_C2"
horario_SANJOSE_dis_graf <-  horario_SANJOSE_dis_graf%>% dplyr::select(id, everything())

horario_SANJOSE_dis_graf <- melt(horario_SANJOSE_dis_graf, id = c("id", "horario"))
names(horario_SANJOSE_dis_graf)[3] <- "materia"
names(horario_SANJOSE_dis_graf)[4] <- "asistencia"




#SANJOSE-dis_int


`SANJOSE-dis_int-materias` <- split(`SANJOSE-dis_int`, f = `SANJOSE-dis_int`$cod_padre) 
names(`SANJOSE-dis_int-materias`) <- paste0("SANJOSE-dis_int-materias-",names(`SANJOSE-dis_int-materias`)) 

list2env(`SANJOSE-dis_int-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_dis_int <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_dis_int)[1] <- "horario"
horario_SANJOSE_dis_int <- unique(horario_SANJOSE_dis_int)


`obs_SANJOSE-dis_int-materias` <- as.data.frame(sapply(`SANJOSE-dis_int-materias`, NROW))

`obs_SANJOSE-dis_int-materias` <- tibble::rownames_to_column(`obs_SANJOSE-dis_int-materias`, "materia")
names(`obs_SANJOSE-dis_int-materias`)[2] <- "obs"

`obs_SANJOSE-dis_int-materias`$materia <- str_remove(`obs_SANJOSE-dis_int-materias`$materia, "SANJOSE-dis_int-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-dis_int-materias` <- filter(`obs_SANJOSE-dis_int-materias`, obs >= 10)
`no_elegibles_SANJOSE-dis_int-materias` <- filter(`obs_SANJOSE-dis_int-materias`, obs < 10)



#NO SUFICIENTE DATA PARA INFERIR


#SANJOSE-econ


`SANJOSE-econ-materias` <- split(`SANJOSE-econ`, f = `SANJOSE-econ`$cod_padre) 
names(`SANJOSE-econ-materias`) <- paste0("SANJOSE-econ-materias-",names(`SANJOSE-econ-materias`)) 

list2env(`SANJOSE-econ-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_econ <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_econ)[1] <- "horario"
horario_SANJOSE_econ <- unique(horario_SANJOSE_econ)


`obs_SANJOSE-econ-materias` <- as.data.frame(sapply(`SANJOSE-econ-materias`, NROW))

`obs_SANJOSE-econ-materias` <- tibble::rownames_to_column(`obs_SANJOSE-econ-materias`, "materia")
names(`obs_SANJOSE-econ-materias`)[2] <- "obs"

`obs_SANJOSE-econ-materias`$materia <- str_remove(`obs_SANJOSE-econ-materias`$materia, "SANJOSE-econ-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-econ-materias` <- filter(`obs_SANJOSE-econ-materias`, obs >= 10)
`no_elegibles_SANJOSE-econ-materias` <- filter(`obs_SANJOSE-econ-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-econ-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_econ <- left_join(horario_SANJOSE_econ, `BAN-040`)
names(horario_SANJOSE_econ)[2] <- "BAN-040"

horario_SANJOSE_econ$`BAN-040`[is.na(horario_SANJOSE_econ$`BAN-040`)] <- 0




#BAN-350

`BAN-350` <- as.data.frame(count(`SANJOSE-econ-materias-BAN-350`$HORARIO)) 

`BAN-350`$freq <- (`BAN-350`$freq)/sum(`BAN-350`$freq)

names(`BAN-350`)[1] <- "horario"

horario_SANJOSE_econ <- left_join(horario_SANJOSE_econ, `BAN-350`)
names(horario_SANJOSE_econ)[3] <- "BAN-350"

horario_SANJOSE_econ$`BAN-350`[is.na(horario_SANJOSE_econ$`BAN-350`)] <- 0




#BCP 01

`BCP 01` <- as.data.frame(count(`SANJOSE-econ-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANJOSE_econ <- left_join(horario_SANJOSE_econ, `BCP 01`)
names(horario_SANJOSE_econ)[4] <- "BCP 01"

horario_SANJOSE_econ$`BCP 01`[is.na(horario_SANJOSE_econ$`BCP 01`)] <- 0


#BMA 04

`BMA 04` <- as.data.frame(count(`SANJOSE-econ-materias-BMA 04`$HORARIO)) 

`BMA 04`$freq <- (`BMA 04`$freq)/sum(`BMA 04`$freq)

names(`BMA 04`)[1] <- "horario"

horario_SANJOSE_econ <- left_join(horario_SANJOSE_econ, `BMA 04`)
names(horario_SANJOSE_econ)[5] <- "BMA 04"

horario_SANJOSE_econ$`BMA 04`[is.na(horario_SANJOSE_econ$`BMA 04`)] <- 0



#BMA 09

`BMA 09` <- as.data.frame(count(`SANJOSE-econ-materias-BMA 09`$HORARIO)) 

`BMA 09`$freq <- (`BMA 09`$freq)/sum(`BMA 09`$freq)

names(`BMA 09`)[1] <- "horario"

horario_SANJOSE_econ <- left_join(horario_SANJOSE_econ, `BMA 09`)
names(horario_SANJOSE_econ)[6] <- "BMA 09"

horario_SANJOSE_econ$`BMA 09`[is.na(horario_SANJOSE_econ$`BMA 09`)] <- 0


#BMAT-01

`BMAT-01` <- as.data.frame(count(`SANJOSE-econ-materias-BMAT-01`$HORARIO)) 

`BMAT-01`$freq <- (`BMAT-01`$freq)/sum(`BMAT-01`$freq)

names(`BMAT-01`)[1] <- "horario"

horario_SANJOSE_econ <- left_join(horario_SANJOSE_econ, `BMAT-01`)
names(horario_SANJOSE_econ)[7] <- "BMAT-01"

horario_SANJOSE_econ$`BMAT-01`[is.na(horario_SANJOSE_econ$`BMAT-01`)] <- 0


##wide to long

horario_SANJOSE_econ$id <- "Ulatina_SANJOSE_econ_pand_C2"
horario_SANJOSE_econ <-  horario_SANJOSE_econ%>% dplyr::select(id, everything())

horario_SANJOSE_econ <- melt(horario_SANJOSE_econ, id = c("id", "horario"))
names(horario_SANJOSE_econ)[3] <- "materia"
names(horario_SANJOSE_econ)[4] <- "asistencia"



#SANJOSE-educ_pre


`SANJOSE-educ_pre-materias` <- split(`SANJOSE-educ_pre`, f = `SANJOSE-educ_pre`$cod_padre) 
names(`SANJOSE-educ_pre-materias`) <- paste0("SANJOSE-educ_pre-materias-",names(`SANJOSE-educ_pre-materias`)) 

list2env(`SANJOSE-educ_pre-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_educ_pre <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_educ_pre)[1] <- "horario"
horario_SANJOSE_educ_pre <- unique(horario_SANJOSE_educ_pre)


`obs_SANJOSE-educ_pre-materias` <- as.data.frame(sapply(`SANJOSE-educ_pre-materias`, NROW))

`obs_SANJOSE-educ_pre-materias` <- tibble::rownames_to_column(`obs_SANJOSE-educ_pre-materias`, "materia")
names(`obs_SANJOSE-educ_pre-materias`)[2] <- "obs"

`obs_SANJOSE-educ_pre-materias`$materia <- str_remove(`obs_SANJOSE-educ_pre-materias`$materia, "SANJOSE-educ_pre-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-educ_pre-materias` <- filter(`obs_SANJOSE-educ_pre-materias`, obs >= 10)
`no_elegibles_SANJOSE-educ_pre-materias` <- filter(`obs_SANJOSE-educ_pre-materias`, obs < 10)




#BAN-03

`BAN-03` <- as.data.frame(count(`SANJOSE-educ_pre-materias-BAN-03`$HORARIO)) 

`BAN-03`$freq <- (`BAN-03`$freq)/sum(`BAN-03`$freq)

names(`BAN-03`)[1] <- "horario"

horario_SANJOSE_educ_pre <- left_join(horario_SANJOSE_educ_pre, `BAN-03`)
names(horario_SANJOSE_educ_pre)[2] <- "BAN-03"

horario_SANJOSE_educ_pre$`BAN-03`[is.na(horario_SANJOSE_educ_pre$`BAN-03`)] <- 0




#BAN-04

`BAN-04` <- as.data.frame(count(`SANJOSE-educ_pre-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_SANJOSE_educ_pre <- left_join(horario_SANJOSE_educ_pre, `BAN-04`)
names(horario_SANJOSE_educ_pre)[3] <- "BAN-04"

horario_SANJOSE_educ_pre$`BAN-04`[is.na(horario_SANJOSE_educ_pre$`BAN-04`)] <- 0




#BDE-02

`BDE-02` <- as.data.frame(count(`SANJOSE-educ_pre-materias-BDE-02`$HORARIO)) 

`BDE-02`$freq <- (`BDE-02`$freq)/sum(`BDE-02`$freq)

names(`BDE-02`)[1] <- "horario"

horario_SANJOSE_educ_pre <- left_join(horario_SANJOSE_educ_pre, `BDE-02`)
names(horario_SANJOSE_educ_pre)[4] <- "BDE-02"

horario_SANJOSE_educ_pre$`BDE-02`[is.na(horario_SANJOSE_educ_pre$`BDE-02`)] <- 0



##wide to long

horario_SANJOSE_educ_pre$id <- "Ulatina_SANJOSE_educ_pre_pand_C2"
horario_SANJOSE_educ_pre <-  horario_SANJOSE_educ_pre%>% dplyr::select(id, everything())

horario_SANJOSE_educ_pre <- melt(horario_SANJOSE_educ_pre, id = c("id", "horario"))
names(horario_SANJOSE_educ_pre)[3] <- "materia"
names(horario_SANJOSE_educ_pre)[4] <- "asistencia"




#SANJOSE-elec


`SANJOSE-elect-materias` <- split(`SANJOSE-elect`, f = `SANJOSE-elect`$cod_padre) 
names(`SANJOSE-elect-materias`) <- paste0("SANJOSE-elect-materias-",names(`SANJOSE-elect-materias`)) 

list2env(`SANJOSE-elect-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_elect <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_elect)[1] <- "horario"
horario_SANJOSE_elect <- unique(horario_SANJOSE_elect)


`obs_SANJOSE-elect-materias` <- as.data.frame(sapply(`SANJOSE-elect-materias`, NROW))

`obs_SANJOSE-elect-materias` <- tibble::rownames_to_column(`obs_SANJOSE-elect-materias`, "materia")
names(`obs_SANJOSE-elect-materias`)[2] <- "obs"

`obs_SANJOSE-elect-materias`$materia <- str_remove(`obs_SANJOSE-elect-materias`$materia, "SANJOSE-elect-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-elect-materias` <- filter(`obs_SANJOSE-elect-materias`, obs >= 10)
`no_elegibles_SANJOSE-elect-materias` <- filter(`obs_SANJOSE-elect-materias`, obs < 10)




#NO HAY SUFICIENTES DATOS PARA INFERIR

#SANJOSE-elect_med


`SANJOSE-elect_med-materias` <- split(`SANJOSE-elect_med`, f = `SANJOSE-elect_med`$cod_padre) 
names(`SANJOSE-elect_med-materias`) <- paste0("SANJOSE-elect_med-materias-",names(`SANJOSE-elect_med-materias`)) 

list2env(`SANJOSE-elect_med-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_elect_med <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_elect_med)[1] <- "horario"
horario_SANJOSE_elect_med <- unique(horario_SANJOSE_elect_med)


`obs_SANJOSE-elect_med-materias` <- as.data.frame(sapply(`SANJOSE-elect_med-materias`, NROW))

`obs_SANJOSE-elect_med-materias` <- tibble::rownames_to_column(`obs_SANJOSE-elect_med-materias`, "materia")
names(`obs_SANJOSE-elect_med-materias`)[2] <- "obs"

`obs_SANJOSE-elect_med-materias`$materia <- str_remove(`obs_SANJOSE-elect_med-materias`$materia, "SANJOSE-elect_med-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-elect_med-materias` <- filter(`obs_SANJOSE-elect_med-materias`, obs >= 10)
`no_elegibles_SANJOSE-elect_med-materias` <- filter(`obs_SANJOSE-elect_med-materias`, obs < 10)




#BAN-04

`BAN-04` <- as.data.frame(count(`SANJOSE-elect_med-materias-BAN-04`$HORARIO)) 

`BAN-04`$freq <- (`BAN-04`$freq)/sum(`BAN-04`$freq)

names(`BAN-04`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `BAN-04`)
names(horario_SANJOSE_elect_med)[2] <- "BAN-04"

horario_SANJOSE_elect_med$`BAN-04`[is.na(horario_SANJOSE_elect_med$`BAN-04`)] <- 0




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-elect_med-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `BAN-040`)
names(horario_SANJOSE_elect_med)[3] <- "BAN-040"

horario_SANJOSE_elect_med$`BAN-040`[is.na(horario_SANJOSE_elect_med$`BAN-040`)] <- 0




#BAN-09

`BAN-09` <- as.data.frame(count(`SANJOSE-elect_med-materias-BAN-09`$HORARIO)) 

`BAN-09`$freq <- (`BAN-09`$freq)/sum(`BAN-09`$freq)

names(`BAN-09`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `BAN-09`)
names(horario_SANJOSE_elect_med)[4] <- "BAN-09"

horario_SANJOSE_elect_med$`BAN-09`[is.na(horario_SANJOSE_elect_med$`BAN-09`)] <- 0



#BAN-35

`BAN-35` <- as.data.frame(count(`SANJOSE-elect_med-materias-BAN-35`$HORARIO)) 

`BAN-35`$freq <- (`BAN-35`$freq)/sum(`BAN-35`$freq)

names(`BAN-35`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `BAN-35`)
names(horario_SANJOSE_elect_med)[5] <- "BAN-35"

horario_SANJOSE_elect_med$`BAN-35`[is.na(horario_SANJOSE_elect_med$`BAN-35`)] <- 0



#BAR-01

`BAR-01` <- as.data.frame(count(`SANJOSE-elect_med-materias-BAR-01`$HORARIO)) 

`BAR-01`$freq <- (`BAR-01`$freq)/sum(`BAR-01`$freq)

names(`BAR-01`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `BAR-01`)
names(horario_SANJOSE_elect_med)[6] <- "BAR-01"

horario_SANJOSE_elect_med$`BAR-01`[is.na(horario_SANJOSE_elect_med$`BAR-01`)] <- 0


#BIE-05

`BIE-05` <- as.data.frame(count(`SANJOSE-elect_med-materias-BIE-05`$HORARIO)) 

`BIE-05`$freq <- (`BIE-05`$freq)/sum(`BIE-05`$freq)

names(`BIE-05`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `BIE-05`)
names(horario_SANJOSE_elect_med)[7] <- "BIE-05"

horario_SANJOSE_elect_med$`BIE-05`[is.na(horario_SANJOSE_elect_med$`BIE-05`)] <- 0



#LCB-03

`LCB-03` <- as.data.frame(count(`SANJOSE-elect_med-materias-LCB-03`$HORARIO)) 

`LCB-03`$freq <- (`LCB-03`$freq)/sum(`LCB-03`$freq)

names(`LCB-03`)[1] <- "horario"

horario_SANJOSE_elect_med <- left_join(horario_SANJOSE_elect_med, `LCB-03`)
names(horario_SANJOSE_elect_med)[8] <- "LCB-03"

horario_SANJOSE_elect_med$`LCB-03`[is.na(horario_SANJOSE_elect_med$`LCB-03`)] <- 0


##wide to long

horario_SANJOSE_elect_med$id <- "Ulatina_SANJOSE_elect_med_pand_C2"
horario_SANJOSE_elect_med <-  horario_SANJOSE_elect_med%>% dplyr::select(id, everything())

horario_SANJOSE_elect_med <- melt(horario_SANJOSE_elect_med, id = c("id", "horario"))
names(horario_SANJOSE_elect_med)[3] <- "materia"
names(horario_SANJOSE_elect_med)[4] <- "asistencia"



#SANJOSE-farm


`SANJOSE-farm-materias` <- split(`SANJOSE-farm`, f = `SANJOSE-farm`$cod_padre) 
names(`SANJOSE-farm-materias`) <- paste0("SANJOSE-farm-materias-",names(`SANJOSE-farm-materias`)) 

list2env(`SANJOSE-farm-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_farm <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_farm)[1] <- "horario"
horario_SANJOSE_farm <- unique(horario_SANJOSE_farm)


`obs_SANJOSE-farm-materias` <- as.data.frame(sapply(`SANJOSE-farm-materias`, NROW))

`obs_SANJOSE-farm-materias` <- tibble::rownames_to_column(`obs_SANJOSE-farm-materias`, "materia")
names(`obs_SANJOSE-farm-materias`)[2] <- "obs"

`obs_SANJOSE-farm-materias`$materia <- str_remove(`obs_SANJOSE-farm-materias`$materia, "SANJOSE-farm-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-farm-materias` <- filter(`obs_SANJOSE-farm-materias`, obs >= 10)
`no_elegibles_SANJOSE-farm-materias` <- filter(`obs_SANJOSE-farm-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-farm-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_farm <- left_join(horario_SANJOSE_farm, `BCS-01`)
names(horario_SANJOSE_farm)[2] <- "BCS-01"

horario_SANJOSE_farm$`BCS-01`[is.na(horario_SANJOSE_farm$`BCS-01`)] <- 0




#LDFB-01.

`LDFB-01.` <- as.data.frame(count(`SANJOSE-farm-materias-LDFB-01.`$HORARIO)) 

`LDFB-01.`$freq <- (`LDFB-01.`$freq)/sum(`LDFB-01.`$freq)

names(`LDFB-01.`)[1] <- "horario"

horario_SANJOSE_farm <- left_join(horario_SANJOSE_farm, `LDFB-01.`)
names(horario_SANJOSE_farm)[3] <- "LDFB-01."

horario_SANJOSE_farm$`LDFB-01.`[is.na(horario_SANJOSE_farm$`LDFB-01.`)] <- 0


#LFAR 01

`LFAR 01` <- as.data.frame(count(`SANJOSE-farm-materias-LFAR 01`$HORARIO)) 

`LFAR 01`$freq <- (`LFAR 01`$freq)/sum(`LFAR 01`$freq)

names(`LFAR 01`)[1] <- "horario"

horario_SANJOSE_farm <- left_join(horario_SANJOSE_farm, `LFAR 01`)
names(horario_SANJOSE_farm)[4] <- "LFAR 01"

horario_SANJOSE_farm$`LFAR 01`[is.na(horario_SANJOSE_farm$`LFAR 01`)] <- 0



#LFAR 02

`LFAR 02` <- as.data.frame(count(`SANJOSE-farm-materias-LFAR 02`$HORARIO)) 

`LFAR 02`$freq <- (`LFAR 02`$freq)/sum(`LFAR 02`$freq)

names(`LFAR 02`)[1] <- "horario"

horario_SANJOSE_farm <- left_join(horario_SANJOSE_farm, `LFAR 02`)
names(horario_SANJOSE_farm)[5] <- "LFAR 02"

horario_SANJOSE_farm$`LFAR 02`[is.na(horario_SANJOSE_farm$`LFAR 02`)] <- 0


#LFAR 03

`LFAR 03` <- as.data.frame(count(`SANJOSE-farm-materias-LFAR 03`$HORARIO)) 

`LFAR 03`$freq <- (`LFAR 03`$freq)/sum(`LFAR 03`$freq)

names(`LFAR 03`)[1] <- "horario"

horario_SANJOSE_farm <- left_join(horario_SANJOSE_farm, `LFAR 03`)
names(horario_SANJOSE_farm)[6] <- "LFAR 03"

horario_SANJOSE_farm$`LFAR 03`[is.na(horario_SANJOSE_farm$`LFAR 03`)] <- 0



##wide to long

horario_SANJOSE_farm$id <- "Ulatina_SANJOSE_farm_pand_C2"
horario_SANJOSE_farm <-  horario_SANJOSE_farm%>% dplyr::select(id, everything())

horario_SANJOSE_farm <- melt(horario_SANJOSE_farm, id = c("id", "horario"))
names(horario_SANJOSE_farm)[3] <- "materia"
names(horario_SANJOSE_farm)[4] <- "asistencia"




#SANJOSE-gest_neg


`SANJOSE-gest_neg-materias` <- split(`SANJOSE-gest_neg`, f = `SANJOSE-gest_neg`$cod_padre) 
names(`SANJOSE-gest_neg-materias`) <- paste0("SANJOSE-gest_neg-materias-",names(`SANJOSE-gest_neg-materias`)) 

list2env(`SANJOSE-gest_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_gest_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_gest_neg)[1] <- "horario"
horario_SANJOSE_gest_neg <- unique(horario_SANJOSE_gest_neg)


`obs_SANJOSE-gest_neg-materias` <- as.data.frame(sapply(`SANJOSE-gest_neg-materias`, NROW))

`obs_SANJOSE-gest_neg-materias` <- tibble::rownames_to_column(`obs_SANJOSE-gest_neg-materias`, "materia")
names(`obs_SANJOSE-gest_neg-materias`)[2] <- "obs"

`obs_SANJOSE-gest_neg-materias`$materia <- str_remove(`obs_SANJOSE-gest_neg-materias`$materia, "SANJOSE-gest_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-gest_neg-materias` <- filter(`obs_SANJOSE-gest_neg-materias`, obs >= 10)
`no_elegibles_SANJOSE-gest_neg-materias` <- filter(`obs_SANJOSE-gest_neg-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-gest_neg-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_gest_neg <- left_join(horario_SANJOSE_gest_neg, `BAN-040`)
names(horario_SANJOSE_gest_neg)[2] <- "BAN-040"

horario_SANJOSE_gest_neg$`BAN-040`[is.na(horario_SANJOSE_gest_neg$`BAN-040`)] <- 0




#BAN 01

`BAN 01` <- as.data.frame(count(`SANJOSE-gest_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANJOSE_gest_neg <- left_join(horario_SANJOSE_gest_neg, `BAN 01`)
names(horario_SANJOSE_gest_neg)[3] <- "BAN 01"

horario_SANJOSE_gest_neg$`BAN 01`[is.na(horario_SANJOSE_gest_neg$`BAN 01`)] <- 0




#BIS01

BIS01 <- as.data.frame(count(`SANJOSE-gest_neg-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_SANJOSE_gest_neg <- left_join(horario_SANJOSE_gest_neg, BIS01)
names(horario_SANJOSE_gest_neg)[4] <- "BIS01"

horario_SANJOSE_gest_neg$BIS01[is.na(horario_SANJOSE_gest_neg$BIS01)] <- 0



#BMAT-01

`BMAT-01` <- as.data.frame(count(`SANJOSE-gest_neg-materias-BMAT-01`$HORARIO)) 

`BMAT-01`$freq <- (`BMAT-01`$freq)/sum(`BMAT-01`$freq)

names(`BMAT-01`)[1] <- "horario"

horario_SANJOSE_gest_neg <- left_join(horario_SANJOSE_gest_neg, `BMAT-01`)
names(horario_SANJOSE_gest_neg)[5] <- "BMAT-01"

horario_SANJOSE_gest_neg$`BMAT-01`[is.na(horario_SANJOSE_gest_neg$`BMAT-01`)] <- 0



##wide to long

horario_SANJOSE_gest_neg$id <- "Ulatina_SANJOSE_gest_neg_pand_C2"
horario_SANJOSE_gest_neg <-  horario_SANJOSE_gest_neg%>% dplyr::select(id, everything())

horario_SANJOSE_gest_neg <- melt(horario_SANJOSE_gest_neg, id = c("id", "horario"))
names(horario_SANJOSE_gest_neg)[3] <- "materia"
names(horario_SANJOSE_gest_neg)[4] <- "asistencia"






#SANJOSE-med_cir


`SANJOSE-med_cir-materias` <- split(`SANJOSE-med_cir`, f = `SANJOSE-med_cir`$cod_padre) 
names(`SANJOSE-med_cir-materias`) <- paste0("SANJOSE-med_cir-materias-",names(`SANJOSE-med_cir-materias`)) 

list2env(`SANJOSE-med_cir-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_med_cir <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_med_cir)[1] <- "horario"
horario_SANJOSE_med_cir <- unique(horario_SANJOSE_med_cir)


`obs_SANJOSE-med_cir-materias` <- as.data.frame(sapply(`SANJOSE-med_cir-materias`, NROW))

`obs_SANJOSE-med_cir-materias` <- tibble::rownames_to_column(`obs_SANJOSE-med_cir-materias`, "materia")
names(`obs_SANJOSE-med_cir-materias`)[2] <- "obs"

`obs_SANJOSE-med_cir-materias`$materia <- str_remove(`obs_SANJOSE-med_cir-materias`$materia, "SANJOSE-med_cir-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-med_cir-materias` <- filter(`obs_SANJOSE-med_cir-materias`, obs >= 10)
`no_elegibles_SANJOSE-med_cir-materias` <- filter(`obs_SANJOSE-med_cir-materias`, obs < 10)



#BED-35

`BED-35` <- as.data.frame(count(`SANJOSE-med_cir-materias-BED-35`$HORARIO)) 

`BED-35`$freq <- (`BED-35`$freq)/sum(`BED-35`$freq)

names(`BED-35`)[1] <- "horario"

horario_SANJOSE_med_cir <- left_join(horario_SANJOSE_med_cir, `BED-35`)
names(horario_SANJOSE_med_cir)[2] <- "BED-35"

horario_SANJOSE_med_cir$`BED-35`[is.na(horario_SANJOSE_med_cir$`BED-35`)] <- 0


#BIN-02

`BIN-02` <- as.data.frame(count(`SANJOSE-med_cir-materias-BIN-02`$HORARIO)) 

`BIN-02`$freq <- (`BIN-02`$freq)/sum(`BIN-02`$freq)

names(`BIN-02`)[1] <- "horario"

horario_SANJOSE_med_cir <- left_join(horario_SANJOSE_med_cir, `BIN-02`)
names(horario_SANJOSE_med_cir)[3] <- "BIN-02"

horario_SANJOSE_med_cir$`BIN-02`[is.na(horario_SANJOSE_med_cir$`BIN-02`)] <- 0



#BIN-03

`BIN-03` <- as.data.frame(count(`SANJOSE-med_cir-materias-BIN-03`$HORARIO)) 

`BIN-03`$freq <- (`BIN-03`$freq)/sum(`BIN-03`$freq)

names(`BIN-03`)[1] <- "horario"

horario_SANJOSE_med_cir <- left_join(horario_SANJOSE_med_cir, `BIN-03`)
names(horario_SANJOSE_med_cir)[4] <- "BIN-03"

horario_SANJOSE_med_cir$`BIN-03`[is.na(horario_SANJOSE_med_cir$`BIN-03`)] <- 0


#BED-36

`BED-36` <- as.data.frame(count(`SANJOSE-med_cir-materias-BED-36`$HORARIO)) 

`BED-36`$freq <- (`BED-36`$freq)/sum(`BED-36`$freq)

names(`BED-36`)[1] <- "horario"

horario_SANJOSE_med_cir <- left_join(horario_SANJOSE_med_cir, `BED-36`)
names(horario_SANJOSE_med_cir)[5] <- "BED-36"

horario_SANJOSE_med_cir$`BED-36`[is.na(horario_SANJOSE_med_cir$`BED-36`)] <- 0


#BIN-01

`BIN-01` <- as.data.frame(count(`SANJOSE-med_cir-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_SANJOSE_med_cir <- left_join(horario_SANJOSE_med_cir, `BIN-01`)
names(horario_SANJOSE_med_cir)[6] <- "BIN-01"

horario_SANJOSE_med_cir$`BIN-01`[is.na(horario_SANJOSE_med_cir$`BIN-01`)] <- 0



##wide to long

horario_SANJOSE_med_cir$id <- "Ulatina_SANJOSE_med_cir_pand_C2"
horario_SANJOSE_med_cir <-  horario_SANJOSE_med_cir%>% dplyr::select(id, everything())

horario_SANJOSE_med_cir <- melt(horario_SANJOSE_med_cir, id = c("id", "horario"))
names(horario_SANJOSE_med_cir)[3] <- "materia"
names(horario_SANJOSE_med_cir)[4] <- "asistencia"



#SANJOSE-nutri


`SANJOSE-nutri-materias` <- split(`SANJOSE-nutri`, f = `SANJOSE-nutri`$cod_padre) 
names(`SANJOSE-nutri-materias`) <- paste0("SANJOSE-nutri-materias-",names(`SANJOSE-nutri-materias`)) 

list2env(`SANJOSE-nutri-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_nutri <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_nutri)[1] <- "horario"
horario_SANJOSE_nutri <- unique(horario_SANJOSE_nutri)


`obs_SANJOSE-nutri-materias` <- as.data.frame(sapply(`SANJOSE-nutri-materias`, NROW))

`obs_SANJOSE-nutri-materias` <- tibble::rownames_to_column(`obs_SANJOSE-nutri-materias`, "materia")
names(`obs_SANJOSE-nutri-materias`)[2] <- "obs"

`obs_SANJOSE-nutri-materias`$materia <- str_remove(`obs_SANJOSE-nutri-materias`$materia, "SANJOSE-nutri-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-nutri-materias` <- filter(`obs_SANJOSE-nutri-materias`, obs >= 10)
`no_elegibles_SANJOSE-nutri-materias` <- filter(`obs_SANJOSE-nutri-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-nutri-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_nutri <- left_join(horario_SANJOSE_nutri, `BCS-01`)
names(horario_SANJOSE_nutri)[2] <- "BCS-01"

horario_SANJOSE_nutri$`BCS-01`[is.na(horario_SANJOSE_nutri$`BCS-01`)] <- 0




#BIN-03

`BIN-03` <- as.data.frame(count(`SANJOSE-nutri-materias-BIN-03`$HORARIO)) 

`BIN-03`$freq <- (`BIN-03`$freq)/sum(`BIN-03`$freq)

names(`BIN-03`)[1] <- "horario"

horario_SANJOSE_nutri <- left_join(horario_SANJOSE_nutri, `BIN-03`)
names(horario_SANJOSE_nutri)[3] <- "BIN-03"

horario_SANJOSE_nutri$`BIN-03`[is.na(horario_SANJOSE_nutri$`BIN-03`)] <- 0




#LCTS-01

`LCTS-01` <- as.data.frame(count(`SANJOSE-nutri-materias-LCTS-01`$HORARIO)) 

`LCTS-01`$freq <- (`LCTS-01`$freq)/sum(`LCTS-01`$freq)

names(`LCTS-01`)[1] <- "horario"

horario_SANJOSE_nutri <- left_join(horario_SANJOSE_nutri, `LCTS-01`)
names(horario_SANJOSE_nutri)[4] <- "LCTS-01"

horario_SANJOSE_nutri$`LCTS-01`[is.na(horario_SANJOSE_nutri$`LCTS-01`)] <- 0


#LDFB-01

`LDFB-01` <- as.data.frame(count(`SANJOSE-nutri-materias-LDFB-01`$HORARIO)) 

`LDFB-01`$freq <- (`LDFB-01`$freq)/sum(`LDFB-01`$freq)

names(`LDFB-01`)[1] <- "horario"

horario_SANJOSE_nutri <- left_join(horario_SANJOSE_nutri, `LDFB-01`)
names(horario_SANJOSE_nutri)[5] <- "LDFB-01"

horario_SANJOSE_nutri$`LDFB-01`[is.na(horario_SANJOSE_nutri$`LDFB-01`)] <- 0


##wide to long

horario_SANJOSE_nutri$id <- "Ulatina_SANJOSE_nutri_pand_C2"
horario_SANJOSE_nutri <-  horario_SANJOSE_nutri%>% dplyr::select(id, everything())

horario_SANJOSE_nutri <- melt(horario_SANJOSE_nutri, id = c("id", "horario"))
names(horario_SANJOSE_nutri)[3] <- "materia"
names(horario_SANJOSE_nutri)[4] <- "asistencia"




#SANJOSE-odonto


`SANJOSE-odonto-materias` <- split(`SANJOSE-odonto`, f = `SANJOSE-odonto`$cod_padre) 
names(`SANJOSE-odonto-materias`) <- paste0("SANJOSE-odonto-materias-",names(`SANJOSE-odonto-materias`)) 

list2env(`SANJOSE-odonto-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_odonto <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_odonto)[1] <- "horario"
horario_SANJOSE_odonto <- unique(horario_SANJOSE_odonto)


`obs_SANJOSE-odonto-materias` <- as.data.frame(sapply(`SANJOSE-odonto-materias`, NROW))

`obs_SANJOSE-odonto-materias` <- tibble::rownames_to_column(`obs_SANJOSE-odonto-materias`, "materia")
names(`obs_SANJOSE-odonto-materias`)[2] <- "obs"

`obs_SANJOSE-odonto-materias`$materia <- str_remove(`obs_SANJOSE-odonto-materias`$materia, "SANJOSE-odonto-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-odonto-materias` <- filter(`obs_SANJOSE-odonto-materias`, obs >= 10)
`no_elegibles_SANJOSE-odonto-materias` <- filter(`obs_SANJOSE-odonto-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-odonto-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_odonto <- left_join(horario_SANJOSE_odonto, `BCS-01`)
names(horario_SANJOSE_odonto)[2] <- "BCS-01"

horario_SANJOSE_odonto$`BCS-01`[is.na(horario_SANJOSE_odonto$`BCS-01`)] <- 0



#LDFB-01.

`LDFB-01.` <- as.data.frame(count(`SANJOSE-odonto-materias-LDFB-01.`$HORARIO)) 

`LDFB-01.`$freq <- (`LDFB-01.`$freq)/sum(`LDFB-01.`$freq)

names(`LDFB-01.`)[1] <- "horario"

horario_SANJOSE_odonto <- left_join(horario_SANJOSE_odonto, `LDFB-01.`)
names(horario_SANJOSE_odonto)[3] <- "LDFB-01."

horario_SANJOSE_odonto$`LDFB-01.`[is.na(horario_SANJOSE_odonto$`LDFB-01.`)] <- 0


#LCTS-02

`LCTS-02` <- as.data.frame(count(`SANJOSE-odonto-materias-LCTS-02`$HORARIO)) 

`LCTS-02`$freq <- (`LCTS-02`$freq)/sum(`LCTS-02`$freq)

names(`LCTS-02`)[1] <- "horario"

horario_SANJOSE_odonto <- left_join(horario_SANJOSE_odonto, `LCTS-02`)
names(horario_SANJOSE_odonto)[4] <- "LCTS-02"

horario_SANJOSE_odonto$`LCTS-02`[is.na(horario_SANJOSE_odonto$`LCTS-02`)] <- 0



#BIN-03

`BIN-03` <- as.data.frame(count(`SANJOSE-odonto-materias-BIN-03`$HORARIO)) 

`BIN-03`$freq <- (`BIN-03`$freq)/sum(`BIN-03`$freq)

names(`BIN-03`)[1] <- "horario"

horario_SANJOSE_odonto <- left_join(horario_SANJOSE_odonto, `BIN-03`)
names(horario_SANJOSE_odonto)[5] <- "BIN-03"

horario_SANJOSE_odonto$`BIN-03`[is.na(horario_SANJOSE_odonto$`BIN-03`)] <- 0


#BIN-04

`BIN-04` <- as.data.frame(count(`SANJOSE-odonto-materias-BIN-04`$HORARIO)) 

`BIN-04`$freq <- (`BIN-04`$freq)/sum(`BIN-04`$freq)

names(`BIN-04`)[1] <- "horario"

horario_SANJOSE_odonto <- left_join(horario_SANJOSE_odonto, `BIN-04`)
names(horario_SANJOSE_odonto)[6] <- "BIN-04"

horario_SANJOSE_odonto$`BIN-04`[is.na(horario_SANJOSE_odonto$`BIN-04`)] <- 0


##wide to long

horario_SANJOSE_odonto$id <- "Ulatina_SANJOSE_odonto_pand_C2"
horario_SANJOSE_odonto <-  horario_SANJOSE_odonto%>% dplyr::select(id, everything())

horario_SANJOSE_odonto <- melt(horario_SANJOSE_odonto, id = c("id", "horario"))
names(horario_SANJOSE_odonto)[3] <- "materia"
names(horario_SANJOSE_odonto)[4] <- "asistencia"




#SANJOSE-optom


`SANJOSE-optom-materias` <- split(`SANJOSE-optom`, f = `SANJOSE-optom`$cod_padre) 
names(`SANJOSE-optom-materias`) <- paste0("SANJOSE-optom-materias-",names(`SANJOSE-optom-materias`)) 

list2env(`SANJOSE-optom-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_optom <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_optom)[1] <- "horario"
horario_SANJOSE_optom <- unique(horario_SANJOSE_optom)


`obs_SANJOSE-optom-materias` <- as.data.frame(sapply(`SANJOSE-optom-materias`, NROW))

`obs_SANJOSE-optom-materias` <- tibble::rownames_to_column(`obs_SANJOSE-optom-materias`, "materia")
names(`obs_SANJOSE-optom-materias`)[2] <- "obs"

`obs_SANJOSE-optom-materias`$materia <- str_remove(`obs_SANJOSE-optom-materias`$materia, "SANJOSE-optom-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-optom-materias` <- filter(`obs_SANJOSE-optom-materias`, obs >= 10)
`no_elegibles_SANJOSE-optom-materias` <- filter(`obs_SANJOSE-optom-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-optom-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_optom <- left_join(horario_SANJOSE_optom, `BCS-01`)
names(horario_SANJOSE_optom)[2] <- "BCS-01"

horario_SANJOSE_optom$`BCS-01`[is.na(horario_SANJOSE_optom$`BCS-01`)] <- 0



#LOPT 01

`LOPT 01` <- as.data.frame(count(`SANJOSE-optom-materias-LOPT 01`$HORARIO)) 

`LOPT 01`$freq <- (`LOPT 01`$freq)/sum(`LOPT 01`$freq)

names(`LOPT 01`)[1] <- "horario"

horario_SANJOSE_optom <- left_join(horario_SANJOSE_optom, `LOPT 01`)
names(horario_SANJOSE_optom)[3] <- "LOPT 01"

horario_SANJOSE_optom$`LOPT 01`[is.na(horario_SANJOSE_optom$`LOPT 01`)] <- 0


#LDFB-01.

`LDFB-01.` <- as.data.frame(count(`SANJOSE-optom-materias-LDFB-01.`$HORARIO)) 

`LDFB-01.`$freq <- (`LDFB-01.`$freq)/sum(`LDFB-01.`$freq)

names(`LDFB-01.`)[1] <- "horario"

horario_SANJOSE_optom <- left_join(horario_SANJOSE_optom, `LDFB-01.`)
names(horario_SANJOSE_optom)[4] <- "LDFB-01."

horario_SANJOSE_optom$`LDFB-01.`[is.na(horario_SANJOSE_optom$`LDFB-01.`)] <- 0


#BIN-04

`BIN-04` <- as.data.frame(count(`SANJOSE-optom-materias-BIN-04`$HORARIO)) 

`BIN-04`$freq <- (`BIN-04`$freq)/sum(`BIN-04`$freq)

names(`BIN-04`)[1] <- "horario"

horario_SANJOSE_optom <- left_join(horario_SANJOSE_optom, `BIN-04`)
names(horario_SANJOSE_optom)[5] <- "BIN-04"

horario_SANJOSE_optom$`BIN-04`[is.na(horario_SANJOSE_optom$`BIN-04`)] <- 0


##wide to long

horario_SANJOSE_optom$id <- "Ulatina_SANJOSE_optom_pand_C2"
horario_SANJOSE_optom <-  horario_SANJOSE_optom%>% dplyr::select(id, everything())

horario_SANJOSE_optom <- melt(horario_SANJOSE_optom, id = c("id", "horario"))
names(horario_SANJOSE_optom)[3] <- "materia"
names(horario_SANJOSE_optom)[4] <- "asistencia"




#SANJOSE-period


`SANJOSE-period-materias` <- split(`SANJOSE-period`, f = `SANJOSE-period`$cod_padre) 
names(`SANJOSE-period-materias`) <- paste0("SANJOSE-period-materias-",names(`SANJOSE-period-materias`)) 

list2env(`SANJOSE-period-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_period <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_period)[1] <- "horario"
horario_SANJOSE_period <- unique(horario_SANJOSE_period)


`obs_SANJOSE-period-materias` <- as.data.frame(sapply(`SANJOSE-period-materias`, NROW))

`obs_SANJOSE-period-materias` <- tibble::rownames_to_column(`obs_SANJOSE-period-materias`, "materia")
names(`obs_SANJOSE-period-materias`)[2] <- "obs"

`obs_SANJOSE-period-materias`$materia <- str_remove(`obs_SANJOSE-period-materias`$materia, "SANJOSE-period-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-period-materias` <- filter(`obs_SANJOSE-period-materias`, obs >= 10)
`no_elegibles_SANJOSE-period-materias` <- filter(`obs_SANJOSE-period-materias`, obs < 10)


#BDG 01

`BDG 01` <- as.data.frame(count(`SANJOSE-period-materias-BDG 01`$HORARIO)) 

`BDG 01`$freq <- (`BDG 01`$freq)/sum(`BDG 01`$freq)

names(`BDG 01`)[1] <- "horario"

horario_SANJOSE_period <- left_join(horario_SANJOSE_period, `BDG 01`)
names(horario_SANJOSE_period)[2] <- "BDG 01"

horario_SANJOSE_period$`BDG 01`[is.na(horario_SANJOSE_period$`BDG 01`)] <- 0




#BPE 01

`BPE 01` <- as.data.frame(count(`SANJOSE-period-materias-BPE 01`$HORARIO)) 

`BPE 01`$freq <- (`BPE 01`$freq)/sum(`BPE 01`$freq)

names(`BPE 01`)[1] <- "horario"

horario_SANJOSE_period <- left_join(horario_SANJOSE_period, `BPE 01`)
names(horario_SANJOSE_period)[3] <- "BPE 01"

horario_SANJOSE_period$`BPE 01`[is.na(horario_SANJOSE_period$`BPE 01`)] <- 0


#BPE 02

`BPE 02` <- as.data.frame(count(`SANJOSE-period-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_SANJOSE_period <- left_join(horario_SANJOSE_period, `BPE 02`)
names(horario_SANJOSE_period)[4] <- "BPE 02"

horario_SANJOSE_period$`BPE 02`[is.na(horario_SANJOSE_period$`BPE 02`)] <- 0



#BPE-03

`BPE-03` <- as.data.frame(count(`SANJOSE-period-materias-BPE-03`$HORARIO)) 

`BPE-03`$freq <- (`BPE-03`$freq)/sum(`BPE-03`$freq)

names(`BPE-03`)[1] <- "horario"

horario_SANJOSE_period <- left_join(horario_SANJOSE_period, `BPE-03`)
names(horario_SANJOSE_period)[5] <- "BPE-03"

horario_SANJOSE_period$`BPE-03`[is.na(horario_SANJOSE_period$`BPE-03`)] <- 0




##wide to long

horario_SANJOSE_period$id <- "Ulatina_SANJOSE_period_pand_C2"
horario_SANJOSE_period <-  horario_SANJOSE_period%>% dplyr::select(id, everything())

horario_SANJOSE_period <- melt(horario_SANJOSE_period, id = c("id", "horario"))
names(horario_SANJOSE_period)[3] <- "materia"
names(horario_SANJOSE_period)[4] <- "asistencia"





#SANJOSE-publ


`SANJOSE-publ-materias` <- split(`SANJOSE-publ`, f = `SANJOSE-publ`$cod_padre) 
names(`SANJOSE-publ-materias`) <- paste0("SANJOSE-publ-materias-",names(`SANJOSE-publ-materias`)) 

list2env(`SANJOSE-publ-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_publ <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_publ)[1] <- "horario"
horario_SANJOSE_publ <- unique(horario_SANJOSE_publ)


`obs_SANJOSE-publ-materias` <- as.data.frame(sapply(`SANJOSE-publ-materias`, NROW))

`obs_SANJOSE-publ-materias` <- tibble::rownames_to_column(`obs_SANJOSE-publ-materias`, "materia")
names(`obs_SANJOSE-publ-materias`)[2] <- "obs"

`obs_SANJOSE-publ-materias`$materia <- str_remove(`obs_SANJOSE-publ-materias`$materia, "SANJOSE-publ-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-publ-materias` <- filter(`obs_SANJOSE-publ-materias`, obs >= 10)
`no_elegibles_SANJOSE-publ-materias` <- filter(`obs_SANJOSE-publ-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-publ-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_publ <- left_join(horario_SANJOSE_publ, `BAN-040`)
names(horario_SANJOSE_publ)[2] <- "BAN-040"

horario_SANJOSE_publ$`BAN-040`[is.na(horario_SANJOSE_publ$`BAN-040`)] <- 0




#BAN 01

`BAN 01` <- as.data.frame(count(`SANJOSE-publ-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANJOSE_publ <- left_join(horario_SANJOSE_publ, `BAN 01`)
names(horario_SANJOSE_publ)[3] <- "BAN 01"

horario_SANJOSE_publ$`BAN 01`[is.na(horario_SANJOSE_publ$`BAN 01`)] <- 0




#BPE 02

`BPE 02` <- as.data.frame(count(`SANJOSE-publ-materias-BPE 02`$HORARIO)) 

`BPE 02`$freq <- (`BPE 02`$freq)/sum(`BPE 02`$freq)

names(`BPE 02`)[1] <- "horario"

horario_SANJOSE_publ <- left_join(horario_SANJOSE_publ, `BPE 02`)
names(horario_SANJOSE_publ)[4] <- "BPE 02"

horario_SANJOSE_publ$`BPE 02`[is.na(horario_SANJOSE_publ$`BPE 02`)] <- 0


#BPU-20

`BPU-20` <- as.data.frame(count(`SANJOSE-publ-materias-BPU-20`$HORARIO)) 

`BPU-20`$freq <- (`BPU-20`$freq)/sum(`BPU-20`$freq)

names(`BPU-20`)[1] <- "horario"

horario_SANJOSE_publ <- left_join(horario_SANJOSE_publ, `BPU-20`)
names(horario_SANJOSE_publ)[5] <- "BPU-20"

horario_SANJOSE_publ$`BPU-20`[is.na(horario_SANJOSE_publ$`BPU-20`)] <- 0



#BPU-43

`BPU-43` <- as.data.frame(count(`SANJOSE-publ-materias-BPU-43`$HORARIO)) 

`BPU-43`$freq <- (`BPU-43`$freq)/sum(`BPU-43`$freq)

names(`BPU-43`)[1] <- "horario"

horario_SANJOSE_publ <- left_join(horario_SANJOSE_publ, `BPU-43`)
names(horario_SANJOSE_publ)[6] <- "BPU-43"

horario_SANJOSE_publ$`BPU-43`[is.na(horario_SANJOSE_publ$`BPU-43`)] <- 0



##wide to long

horario_SANJOSE_publ$id <- "Ulatina_SANJOSE_publ_pand_C2"
horario_SANJOSE_publ <-  horario_SANJOSE_publ%>% dplyr::select(id, everything())

horario_SANJOSE_publ <- melt(horario_SANJOSE_publ, id = c("id", "horario"))
names(horario_SANJOSE_publ)[3] <- "materia"
names(horario_SANJOSE_publ)[4] <- "asistencia"


#SANJOSE-relint


`SANJOSE-relint-materias` <- split(`SANJOSE-relint`, f = `SANJOSE-relint`$cod_padre) 
names(`SANJOSE-relint-materias`) <- paste0("SANJOSE-relint-materias-",names(`SANJOSE-relint-materias`)) 

list2env(`SANJOSE-relint-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_relint <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_relint)[1] <- "horario"
horario_SANJOSE_relint <- unique(horario_SANJOSE_relint)


`obs_SANJOSE-relint-materias` <- as.data.frame(sapply(`SANJOSE-relint-materias`, NROW))

`obs_SANJOSE-relint-materias` <- tibble::rownames_to_column(`obs_SANJOSE-relint-materias`, "materia")
names(`obs_SANJOSE-relint-materias`)[2] <- "obs"

`obs_SANJOSE-relint-materias`$materia <- str_remove(`obs_SANJOSE-relint-materias`$materia, "SANJOSE-relint-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-relint-materias` <- filter(`obs_SANJOSE-relint-materias`, obs >= 10)
`no_elegibles_SANJOSE-relint-materias` <- filter(`obs_SANJOSE-relint-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-relint-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_relint <- left_join(horario_SANJOSE_relint, `BAN-040`)
names(horario_SANJOSE_relint)[2] <- "BAN-040"

horario_SANJOSE_relint$`BAN-040`[is.na(horario_SANJOSE_relint$`BAN-040`)] <- 0


#BDE-33

`BDE-33` <- as.data.frame(count(`SANJOSE-relint-materias-BDE-33`$HORARIO)) 

`BDE-33`$freq <- (`BDE-33`$freq)/sum(`BDE-33`$freq)

names(`BDE-33`)[1] <- "horario"

horario_SANJOSE_relint <- left_join(horario_SANJOSE_relint, `BDE-33`)
names(horario_SANJOSE_relint)[3] <- "BDE-33"

horario_SANJOSE_relint$`BDE-33`[is.na(horario_SANJOSE_relint$`BDE-33`)] <- 0



#BDE-42

`BDE-42` <- as.data.frame(count(`SANJOSE-relint-materias-BDE-42`$HORARIO)) 

`BDE-42`$freq <- (`BDE-42`$freq)/sum(`BDE-42`$freq)

names(`BDE-42`)[1] <- "horario"

horario_SANJOSE_relint <- left_join(horario_SANJOSE_relint, `BDE-42`)
names(horario_SANJOSE_relint)[4] <- "BDE-42"

horario_SANJOSE_relint$`BDE-42`[is.na(horario_SANJOSE_relint$`BDE-42`)] <- 0


#BIN-01

`BIN-01` <- as.data.frame(count(`SANJOSE-relint-materias-BIN-01`$HORARIO)) 

`BIN-01`$freq <- (`BIN-01`$freq)/sum(`BIN-01`$freq)

names(`BIN-01`)[1] <- "horario"

horario_SANJOSE_relint <- left_join(horario_SANJOSE_relint, `BIN-01`)
names(horario_SANJOSE_relint)[5] <- "BIN-01"

horario_SANJOSE_relint$`BIN-01`[is.na(horario_SANJOSE_relint$`BIN-01`)] <- 0


##wide to long

horario_SANJOSE_relint$id <- "Ulatina_SANJOSE_relint_pand_C2"
horario_SANJOSE_relint <-  horario_SANJOSE_relint%>% dplyr::select(id, everything())

horario_SANJOSE_relint <- melt(horario_SANJOSE_relint, id = c("id", "horario"))
names(horario_SANJOSE_relint)[3] <- "materia"
names(horario_SANJOSE_relint)[4] <- "asistencia"




#SANJOSE-relpub


`SANJOSE-relpub-materias` <- split(`SANJOSE-relpub`, f = `SANJOSE-relpub`$cod_padre) 
names(`SANJOSE-relpub-materias`) <- paste0("SANJOSE-relpub-materias-",names(`SANJOSE-relpub-materias`)) 

list2env(`SANJOSE-relpub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_relpub <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_relpub)[1] <- "horario"
horario_SANJOSE_relpub <- unique(horario_SANJOSE_relpub)


`obs_SANJOSE-relpub-materias` <- as.data.frame(sapply(`SANJOSE-relpub-materias`, NROW))

`obs_SANJOSE-relpub-materias` <- tibble::rownames_to_column(`obs_SANJOSE-relpub-materias`, "materia")
names(`obs_SANJOSE-relpub-materias`)[2] <- "obs"

`obs_SANJOSE-relpub-materias`$materia <- str_remove(`obs_SANJOSE-relpub-materias`$materia, "SANJOSE-relpub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-relpub-materias` <- filter(`obs_SANJOSE-relpub-materias`, obs >= 10)
`no_elegibles_SANJOSE-relpub-materias` <- filter(`obs_SANJOSE-relpub-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANJOSE-relpub-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANJOSE_relpub <- left_join(horario_SANJOSE_relpub, `BCS-01`)
names(horario_SANJOSE_relpub)[2] <- "BCS-01"

horario_SANJOSE_relpub$`BCS-01`[is.na(horario_SANJOSE_relpub$`BCS-01`)] <- 0


#BRP01

BRP01 <- as.data.frame(count(`SANJOSE-relpub-materias-BRP01`$HORARIO)) 

BRP01$freq <- (BRP01$freq)/sum(BRP01$freq)

names(BRP01)[1] <- "horario"

horario_SANJOSE_relpub <- left_join(horario_SANJOSE_relpub, BRP01)
names(horario_SANJOSE_relpub)[3] <- "BRP01"

horario_SANJOSE_relpub$BRP01[is.na(horario_SANJOSE_relpub$BRP01)] <- 0



#BRP02

BRP02 <- as.data.frame(count(`SANJOSE-relpub-materias-BRP02`$HORARIO)) 

BRP02$freq <- (BRP02$freq)/sum(BRP02$freq)

names(BRP02)[1] <- "horario"

horario_SANJOSE_relpub <- left_join(horario_SANJOSE_relpub, BRP02)
names(horario_SANJOSE_relpub)[4] <- "BRP02"

horario_SANJOSE_relpub$BRP02[is.na(horario_SANJOSE_relpub$BRP02)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`SANJOSE-relpub-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_SANJOSE_relpub <- left_join(horario_SANJOSE_relpub, `BPE 27`)
names(horario_SANJOSE_relpub)[5] <- "BPE 27"

horario_SANJOSE_relpub$`BPE 27`[is.na(horario_SANJOSE_relpub$`BPE 27`)] <- 0


##wide to long

horario_SANJOSE_relpub$id <- "Ulatina_SANJOSE_relpub_pand_C2"
horario_SANJOSE_relpub <-  horario_SANJOSE_relpub%>% dplyr::select(id, everything())

horario_SANJOSE_relpub <- melt(horario_SANJOSE_relpub, id = c("id", "horario"))
names(horario_SANJOSE_relpub)[3] <- "materia"
names(horario_SANJOSE_relpub)[4] <- "asistencia"



#SANJOSE-social


`SANJOSE-social-materias` <- split(`SANJOSE-social`, f = `SANJOSE-social`$cod_padre) 
names(`SANJOSE-social-materias`) <- paste0("SANJOSE-social-materias-",names(`SANJOSE-social-materias`)) 

list2env(`SANJOSE-social-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_social <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_social)[1] <- "horario"
horario_SANJOSE_social <- unique(horario_SANJOSE_social)


`obs_SANJOSE-social-materias` <- as.data.frame(sapply(`SANJOSE-social-materias`, NROW))

`obs_SANJOSE-social-materias` <- tibble::rownames_to_column(`obs_SANJOSE-social-materias`, "materia")
names(`obs_SANJOSE-social-materias`)[2] <- "obs"

`obs_SANJOSE-social-materias`$materia <- str_remove(`obs_SANJOSE-social-materias`$materia, "SANJOSE-social-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-social-materias` <- filter(`obs_SANJOSE-social-materias`, obs >= 10)
`no_elegibles_SANJOSE-social-materias` <- filter(`obs_SANJOSE-social-materias`, obs < 10)




#BTSO 01

`BTSO 01` <- as.data.frame(count(`SANJOSE-social-materias-BTSO 01`$HORARIO)) 

`BTSO 01`$freq <- (`BTSO 01`$freq)/sum(`BTSO 01`$freq)

names(`BTSO 01`)[1] <- "horario"

horario_SANJOSE_social <- left_join(horario_SANJOSE_social, `BTSO 01`)
names(horario_SANJOSE_social)[2] <- "BTSO 01"

horario_SANJOSE_social$`BTSO 01`[is.na(horario_SANJOSE_social$`BTSO 01`)] <- 0




#BTSO 02

`BTSO 02` <- as.data.frame(count(`SANJOSE-social-materias-BTSO 02`$HORARIO)) 

`BTSO 02`$freq <- (`BTSO 02`$freq)/sum(`BTSO 02`$freq)

names(`BTSO 02`)[1] <- "horario"

horario_SANJOSE_social <- left_join(horario_SANJOSE_social, `BTSO 02`)
names(horario_SANJOSE_social)[3] <- "BTSO 02"

horario_SANJOSE_social$`BTSO 02`[is.na(horario_SANJOSE_social$`BTSO 02`)] <- 0




#BTSO 03

`BTSO 03` <- as.data.frame(count(`SANJOSE-social-materias-BTSO 03`$HORARIO)) 

`BTSO 03`$freq <- (`BTSO 03`$freq)/sum(`BTSO 03`$freq)

names(`BTSO 03`)[1] <- "horario"

horario_SANJOSE_social <- left_join(horario_SANJOSE_social, `BTSO 03`)
names(horario_SANJOSE_social)[4] <- "BTSO 03"

horario_SANJOSE_social$`BTSO 03`[is.na(horario_SANJOSE_social$`BTSO 03`)] <- 0


#BTSO 04

`BTSO 04` <- as.data.frame(count(`SANJOSE-social-materias-BTSO 04`$HORARIO)) 

`BTSO 04`$freq <- (`BTSO 04`$freq)/sum(`BTSO 04`$freq)

names(`BTSO 04`)[1] <- "horario"

horario_SANJOSE_social <- left_join(horario_SANJOSE_social, `BTSO 04`)
names(horario_SANJOSE_social)[5] <- "BTSO 04"

horario_SANJOSE_social$`BTSO 04`[is.na(horario_SANJOSE_social$`BTSO 04`)] <- 0


#LPS 02

`LPS 02` <- as.data.frame(count(`SANJOSE-social-materias-LPS 02`$HORARIO)) 

`LPS 02`$freq <- (`LPS 02`$freq)/sum(`LPS 02`$freq)

names(`LPS 02`)[1] <- "horario"

horario_SANJOSE_social <- left_join(horario_SANJOSE_social, `LPS 02`)
names(horario_SANJOSE_social)[6] <- "LPS 02"

horario_SANJOSE_social$`LPS 02`[is.na(horario_SANJOSE_social$`LPS 02`)] <- 0


#BING 01

`BING 01` <- as.data.frame(count(`SANJOSE-social-materias-BING 01`$HORARIO)) 

`BING 01`$freq <- (`BING 01`$freq)/sum(`BING 01`$freq)

names(`BING 01`)[1] <- "horario"

horario_SANJOSE_social <- left_join(horario_SANJOSE_social, `BING 01`)
names(horario_SANJOSE_social)[7] <- "BING 01"

horario_SANJOSE_social$`BING 01`[is.na(horario_SANJOSE_social$`BING 01`)] <- 0


##wide to long

horario_SANJOSE_social$id <- "Ulatina_SANJOSE_social_pand_C2"
horario_SANJOSE_social <-  horario_SANJOSE_social%>% dplyr::select(id, everything())

horario_SANJOSE_social <- melt(horario_SANJOSE_social, id = c("id", "horario"))
names(horario_SANJOSE_social)[3] <- "materia"
names(horario_SANJOSE_social)[4] <- "asistencia"



#SANJOSE-soft


`SANJOSE-soft-materias` <- split(`SANJOSE-soft`, f = `SANJOSE-soft`$cod_padre) 
names(`SANJOSE-soft-materias`) <- paste0("SANJOSE-soft-materias-",names(`SANJOSE-soft-materias`)) 

list2env(`SANJOSE-soft-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_soft <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_soft)[1] <- "horario"
horario_SANJOSE_soft <- unique(horario_SANJOSE_soft)


`obs_SANJOSE-soft-materias` <- as.data.frame(sapply(`SANJOSE-soft-materias`, NROW))

`obs_SANJOSE-soft-materias` <- tibble::rownames_to_column(`obs_SANJOSE-soft-materias`, "materia")
names(`obs_SANJOSE-soft-materias`)[2] <- "obs"

`obs_SANJOSE-soft-materias`$materia <- str_remove(`obs_SANJOSE-soft-materias`$materia, "SANJOSE-soft-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-soft-materias` <- filter(`obs_SANJOSE-soft-materias`, obs >= 10)
`no_elegibles_SANJOSE-soft-materias` <- filter(`obs_SANJOSE-soft-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-soft-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_soft <- left_join(horario_SANJOSE_soft, `BAN-040`)
names(horario_SANJOSE_soft)[2] <- "BAN-040"

horario_SANJOSE_soft$`BAN-040`[is.na(horario_SANJOSE_soft$`BAN-040`)] <- 0



#BCS01

BCS01 <- as.data.frame(count(`SANJOSE-soft-materias-BCS01`$HORARIO)) 

BCS01$freq <- (BCS01$freq)/sum(BCS01$freq)

names(BCS01)[1] <- "horario"

horario_SANJOSE_soft <- left_join(horario_SANJOSE_soft, BCS01)
names(horario_SANJOSE_soft)[3] <- "BCS01"

horario_SANJOSE_soft$BCS01[is.na(horario_SANJOSE_soft$BCS01)] <- 0



##wide to long

horario_SANJOSE_soft$id <- "Ulatina_SANJOSE_soft_pand_C2"
horario_SANJOSE_soft <-  horario_SANJOSE_soft%>% dplyr::select(id, everything())

horario_SANJOSE_soft <- melt(horario_SANJOSE_soft, id = c("id", "horario"))
names(horario_SANJOSE_soft)[3] <- "materia"
names(horario_SANJOSE_soft)[4] <- "asistencia"



#SANJOSE-telem


`SANJOSE-telem-materias` <- split(`SANJOSE-telem`, f = `SANJOSE-telem`$cod_padre) 
names(`SANJOSE-telem-materias`) <- paste0("SANJOSE-telem-materias-",names(`SANJOSE-telem-materias`)) 

list2env(`SANJOSE-telem-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_telem <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_telem)[1] <- "horario"
horario_SANJOSE_telem <- unique(horario_SANJOSE_telem)


`obs_SANJOSE-telem-materias` <- as.data.frame(sapply(`SANJOSE-telem-materias`, NROW))

`obs_SANJOSE-telem-materias` <- tibble::rownames_to_column(`obs_SANJOSE-telem-materias`, "materia")
names(`obs_SANJOSE-telem-materias`)[2] <- "obs"

`obs_SANJOSE-telem-materias`$materia <- str_remove(`obs_SANJOSE-telem-materias`$materia, "SANJOSE-telem-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-telem-materias` <- filter(`obs_SANJOSE-telem-materias`, obs >= 10)
`no_elegibles_SANJOSE-telem-materias` <- filter(`obs_SANJOSE-telem-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANJOSE-telem-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANJOSE_telem <- left_join(horario_SANJOSE_telem, `BAN-040`)
names(horario_SANJOSE_telem)[2] <- "BAN-040"

horario_SANJOSE_telem$`BAN-040`[is.na(horario_SANJOSE_telem$`BAN-040`)] <- 0




#BDE-02

`BDE-02` <- as.data.frame(count(`SANJOSE-telem-materias-BDE-02`$HORARIO)) 

`BDE-02`$freq <- (`BDE-02`$freq)/sum(`BDE-02`$freq)

names(`BDE-02`)[1] <- "horario"

horario_SANJOSE_telem <- left_join(horario_SANJOSE_telem, `BDE-02`)
names(horario_SANJOSE_telem)[3] <- "BDE-02"

horario_SANJOSE_telem$`BDE-02`[is.na(horario_SANJOSE_telem$`BDE-02`)] <- 0



#BMAT-01

`BMAT-01` <- as.data.frame(count(`SANJOSE-telem-materias-BMAT-01`$HORARIO)) 

`BMAT-01`$freq <- (`BMAT-01`$freq)/sum(`BMAT-01`$freq)

names(`BMAT-01`)[1] <- "horario"

horario_SANJOSE_telem <- left_join(horario_SANJOSE_telem, `BMAT-01`)
names(horario_SANJOSE_telem)[4] <- "BMAT-01"

horario_SANJOSE_telem$`BMAT-01`[is.na(horario_SANJOSE_telem$`BMAT-01`)] <- 0



#BMAT-05

`BMAT-05` <- as.data.frame(count(`SANJOSE-telem-materias-BMAT-05`$HORARIO)) 

`BMAT-05`$freq <- (`BMAT-05`$freq)/sum(`BMAT-05`$freq)

names(`BMAT-05`)[1] <- "horario"

horario_SANJOSE_telem <- left_join(horario_SANJOSE_telem, `BMAT-05`)
names(horario_SANJOSE_telem)[5] <- "BMAT-05"

horario_SANJOSE_telem$`BMAT-05`[is.na(horario_SANJOSE_telem$`BMAT-05`)] <- 0


##wide to long

horario_SANJOSE_telem$id <- "Ulatina_SANJOSE_telem_pand_C2"
horario_SANJOSE_telem <-  horario_SANJOSE_telem%>% dplyr::select(id, everything())

horario_SANJOSE_telem <- melt(horario_SANJOSE_telem, id = c("id", "horario"))
names(horario_SANJOSE_telem)[3] <- "materia"
names(horario_SANJOSE_telem)[4] <- "asistencia"





#SANJOSE-ter_fis


`SANJOSE-ter_fis-materias` <- split(`SANJOSE-ter_fis`, f = `SANJOSE-ter_fis`$cod_padre) 
names(`SANJOSE-ter_fis-materias`) <- paste0("SANJOSE-ter_fis-materias-",names(`SANJOSE-ter_fis-materias`)) 

list2env(`SANJOSE-ter_fis-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_ter_fis <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_ter_fis)[1] <- "horario"
horario_SANJOSE_ter_fis <- unique(horario_SANJOSE_ter_fis)


`obs_SANJOSE-ter_fis-materias` <- as.data.frame(sapply(`SANJOSE-ter_fis-materias`, NROW))

`obs_SANJOSE-ter_fis-materias` <- tibble::rownames_to_column(`obs_SANJOSE-ter_fis-materias`, "materia")
names(`obs_SANJOSE-ter_fis-materias`)[2] <- "obs"

`obs_SANJOSE-ter_fis-materias`$materia <- str_remove(`obs_SANJOSE-ter_fis-materias`$materia, "SANJOSE-ter_fis-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-ter_fis-materias` <- filter(`obs_SANJOSE-ter_fis-materias`, obs >= 10)
`no_elegibles_SANJOSE-ter_fis-materias` <- filter(`obs_SANJOSE-ter_fis-materias`, obs < 10)



#BTF-01

`BTF-01` <- as.data.frame(count(`SANJOSE-ter_fis-materias-BTF-01`$HORARIO)) 

`BTF-01`$freq <- (`BTF-01`$freq)/sum(`BTF-01`$freq)

names(`BTF-01`)[1] <- "horario"

horario_SANJOSE_ter_fis <- left_join(horario_SANJOSE_ter_fis, `BTF-01`)
names(horario_SANJOSE_ter_fis)[2] <- "BTF-01"

horario_SANJOSE_ter_fis$`BTF-01`[is.na(horario_SANJOSE_ter_fis$`BTF-01`)] <- 0

#LCTS-02

`LCTS-02` <- as.data.frame(count(`SANJOSE-ter_fis-materias-LCTS-02`$HORARIO)) 

`LCTS-02`$freq <- (`LCTS-02`$freq)/sum(`LCTS-02`$freq)

names(`LCTS-02`)[1] <- "horario"

horario_SANJOSE_ter_fis <- left_join(horario_SANJOSE_ter_fis, `LCTS-02`)
names(horario_SANJOSE_ter_fis)[3] <- "LCTS-02"

horario_SANJOSE_ter_fis$`LCTS-02`[is.na(horario_SANJOSE_ter_fis$`LCTS-02`)] <- 0



#LDFB-01

`LDFB-01` <- as.data.frame(count(`SANJOSE-ter_fis-materias-LDFB-01`$HORARIO)) 

`LDFB-01`$freq <- (`LDFB-01`$freq)/sum(`LDFB-01`$freq)

names(`LDFB-01`)[1] <- "horario"

horario_SANJOSE_ter_fis <- left_join(horario_SANJOSE_ter_fis, `LDFB-01`)
names(horario_SANJOSE_ter_fis)[4] <- "LDFB-01"

horario_SANJOSE_ter_fis$`LDFB-01`[is.na(horario_SANJOSE_ter_fis$`LDFB-01`)] <- 0



#LTF 01

`LTF 01` <- as.data.frame(count(`SANJOSE-ter_fis-materias-LTF 01`$HORARIO)) 

`LTF 01`$freq <- (`LTF 01`$freq)/sum(`LTF 01`$freq)

names(`LTF 01`)[1] <- "horario"

horario_SANJOSE_ter_fis <- left_join(horario_SANJOSE_ter_fis, `LTF 01`)
names(horario_SANJOSE_ter_fis)[5] <- "LTF 01"

horario_SANJOSE_ter_fis$`LTF 01`[is.na(horario_SANJOSE_ter_fis$`LTF 01`)] <- 0


##wide to long

horario_SANJOSE_ter_fis$id <- "Ulatina_SANJOSE_ter_fis_pand_C2"
horario_SANJOSE_ter_fis <-  horario_SANJOSE_ter_fis%>% dplyr::select(id, everything())

horario_SANJOSE_ter_fis <- melt(horario_SANJOSE_ter_fis, id = c("id", "horario"))
names(horario_SANJOSE_ter_fis)[3] <- "materia"
names(horario_SANJOSE_ter_fis)[4] <- "asistencia"






#SANJOSE-tur_sos


`SANJOSE-tur_sos-materias` <- split(`SANJOSE-tur_sos`, f = `SANJOSE-tur_sos`$cod_padre) 
names(`SANJOSE-tur_sos-materias`) <- paste0("SANJOSE-tur_sos-materias-",names(`SANJOSE-tur_sos-materias`)) 

list2env(`SANJOSE-tur_sos-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANJOSE_tur_sos <- as.data.frame(pf_latina$HORARIO)
names(horario_SANJOSE_tur_sos)[1] <- "horario"
horario_SANJOSE_tur_sos <- unique(horario_SANJOSE_tur_sos)


`obs_SANJOSE-tur_sos-materias` <- as.data.frame(sapply(`SANJOSE-tur_sos-materias`, NROW))

`obs_SANJOSE-tur_sos-materias` <- tibble::rownames_to_column(`obs_SANJOSE-tur_sos-materias`, "materia")
names(`obs_SANJOSE-tur_sos-materias`)[2] <- "obs"

`obs_SANJOSE-tur_sos-materias`$materia <- str_remove(`obs_SANJOSE-tur_sos-materias`$materia, "SANJOSE-tur_sos-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANJOSE-tur_sos-materias` <- filter(`obs_SANJOSE-tur_sos-materias`, obs >= 10)
`no_elegibles_SANJOSE-tur_sos-materias` <- filter(`obs_SANJOSE-tur_sos-materias`, obs < 10)




#NO HAY DATOS PARA INFERIR

#Consolidado de sede SANJOSE

horario_SANJOSE <- rbind(horario_SANJOSE_admin_neg,horario_SANJOSE_anim_dig,horario_SANJOSE_arquit,
                         horario_SANJOSE_c_biolo,horario_SANJOSE_civil,
                         horario_SANJOSE_com_mercadeo,horario_SANJOSE_comput,horario_SANJOSE_conta,
                         horario_SANJOSE_conta_pub,horario_SANJOSE_derecho, horario_SANJOSE_dis_graf,
                         horario_SANJOSE_econ,horario_SANJOSE_educ_pre,
                         horario_SANJOSE_elect_med,horario_SANJOSE_enf,horario_SANJOSE_farm,
                         horario_SANJOSE_gest_neg,horario_SANJOSE_indus,horario_SANJOSE_ingles,
                         horario_SANJOSE_med_cir,horario_SANJOSE_nutri,horario_SANJOSE_odonto,
                         horario_SANJOSE_optom,horario_SANJOSE_period,horario_SANJOSE_psico,
                         horario_SANJOSE_publ,horario_SANJOSE_relint,horario_SANJOSE_relpub,
                         horario_SANJOSE_social,horario_SANJOSE_soft,horario_SANJOSE_telem,
                         horario_SANJOSE_ter_fis)

#total poblacion por carrera SANJOSE

materias_SANJOSE_pand_C2 <- count(SANJOSE$cod_padre)
names(materias_SANJOSE_pand_C2)[1] <- "materia"
names(materias_SANJOSE_pand_C2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_SANJOSE <- left_join(horario_SANJOSE, materias_SANJOSE_pand_C2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_SANJOSE$asistencia, by = list(horario_SANJOSE$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_SANJOSE <- left_join(horario_SANJOSE, pob_asist2)

horario_SANJOSE$asistencia2 <- horario_SANJOSE$asistencia/horario_SANJOSE$sum_prop
horario_SANJOSE$asistencia2[horario_SANJOSE$asistencia2 == Inf] <- 0

horario_SANJOSE$pob_asist <- round((horario_SANJOSE$asistencia2)*(horario_SANJOSE$poblacion),0)


#Guardo todos los horarios en su folder correspondiente

count(horario_SANJOSE$id)
Replaces <- data.frame(from = c("Ulatina_SANJOSE_admin_neg_pand_C2","Ulatina_SANJOSE_ter_fis_pand_C2", 
                                "Ulatina_SANJOSE_conta_pub_pand_C2","Ulatina_SANJOSE_admin_hoteleria_pand_C2",
                                "Ulatina_SANJOSE_anim_dig_pand_C2", "Ulatina_SANJOSE_civil_pand_C2"
                                ,"Ulatina_SANJOSE_dis_graf_pand_C2","Ulatina_SANJOSE_dis_int_pand_C2"
                                ,"Ulatina_SANJOSE_elect_mec_pand_C2","Ulatina_SANJOSE_mec_adm_pand_C2"
                                ,"Ulatina_SANJOSE_c_biolo_pand_C2","Ulatina_SANJOSE_com_dig_pand_C2"
                                ,"Ulatina_SANJOSE_com_mercadeo_pand_C2","Ulatina_SANJOSE_dis_graf_pand_C2"
                                ,"Ulatina_SANJOSE_educ_pre_pand_C2","Ulatina_SANJOSE_elect_med_pand_C2"
                                ,"Ulatina_SANJOSE_tur_sos_pand_C2"), 
                       
                       to = c("Ulatina_SANJOSE_admin-neg_pand_C2", "Ulatina_SANJOSE_ter-fis_pand_C2", 
                              "Ulatina_SANJOSE_conta_pub-pand_C2","Ulatina_SANJOSE_admin-hoteleria_pand_C2",
                              "Ulatina_SANJOSE_anim-dig_pand_C2","Ulatina_SANJOSE_c-com_pand_C2",
                              "Ulatina_SANJOSE_dis-graf_pand_C2","Ulatina_SANJOSE_dis-int_pand_C2"
                              ,"Ulatina_SANJOSE_elect-mec_pand_C2","Ulatina_SANJOSE_mec-adm_pand_C2",
                              "Ulatina_SANJOSE_c-biolo_pand_C2","Ulatina_SANJOSE_com-dig_pand_C2"
                              ,"Ulatina_SANJOSE_com-mercadeo_pand_C2","Ulatina_SANJOSE_dis-graf_pand_C2"
                              ,"Ulatina_SANJOSE_educ-pre_pand_C2","Ulatina_SANJOSE_elect-med_pand_C2"
                              ,"Ulatina_SANJOSE_tur-sos_pand_C2"))

horario_SANJOSE <- FindReplace(data = horario_SANJOSE, Var = "id", replaceData = Replaces,
                               from = "from", to = "to", exact = FALSE)


count(horario_SANJOSE$id)

write_xlsx(horario_SANJOSE,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/horario_SANJOSE_latina_pand_C2.xlsx")

# write_xlsx(horario_SANJOSE_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/admin_neg_C2.xlsx")
# write_xlsx(horario_SANJOSE_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/contabilidad_C2.xlsx")
# write_xlsx(horario_SANJOSE_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/derecho_C2.xlsx")
# write_xlsx(horario_SANJOSE_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/industrial_C2.xlsx")
# write_xlsx(horario_SANJOSE_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/ingles_C2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_SANJOSE$id, "_", 5)

horario_SANJOSE <- cbind(split, horario_SANJOSE)
names(horario_SANJOSE)[1] <- "marca"
names(horario_SANJOSE)[2] <- "sede"
names(horario_SANJOSE)[3] <- "carrera"
names(horario_SANJOSE)[4] <- "modalidad"
names(horario_SANJOSE)[5] <- "cuatrimestre"

horario_SANJOSE <- horario_SANJOSE %>% dplyr::select(-id)


horario_SANJOSE_unique <- subset(horario_SANJOSE, pob_asist != 0)

horario_SANJOSE_unique <- horario_SANJOSE_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_SANJOSE_unique$marca <- "Ulatina"
horario_SANJOSE_unique$sede <- "SANJOSE"
horario_SANJOSE_unique$modalidad <- "pand"
horario_SANJOSE_unique$cuatrimestre <- "C2"

horario_SANJOSE_unique <- horario_SANJOSE_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_SANJOSE_unique <- horario_SANJOSE_unique[with(horario_SANJOSE_unique, order(materia, horario)), ]  

horario_SANJOSE_unique <- horario_SANJOSE_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_SANJOSE_unique$unoanueve <- 0
horario_SANJOSE_unique$unoanueve[horario_SANJOSE_unique$Asistencia <= 9] <- 1

horario_SANJOSE_unique$dieza17 <- 0
horario_SANJOSE_unique$dieza17[horario_SANJOSE_unique$Asistencia >= 10 & horario_SANJOSE_unique$Asistencia <= 17] <- 1

horario_SANJOSE_unique$di18a30 <- 0
horario_SANJOSE_unique$di18a30[horario_SANJOSE_unique$Asistencia >= 18 & horario_SANJOSE_unique$Asistencia <= 30] <- 1

horario_SANJOSE_unique$di31a60 <- 0
horario_SANJOSE_unique$di31a60[horario_SANJOSE_unique$Asistencia >= 31 & horario_SANJOSE_unique$Asistencia <= 60] <- 1

horario_SANJOSE_unique$mas60 <- 0
horario_SANJOSE_unique$mas60[horario_SANJOSE_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_SANJOSE_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_SANJOSE_unique <- left_join(horario_SANJOSE_unique, duplicados, by = "materia")

names(horario_SANJOSE_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_SANJOSE_unique$recomendacion <- 0
horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$unoanueve == 1 & horario_SANJOSE_unique$duplicado == 0] <- "cerrar horario"
horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$unoanueve == 1 & horario_SANJOSE_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$dieza17 == 1 & horario_SANJOSE_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$dieza17 == 1 & horario_SANJOSE_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_SANJOSE_unique$recomendacion[horario_SANJOSE_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_SANJOSE_unique <- horario_SANJOSE_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                    horario, materia, Asistencia, recomendacion)


horario_split <- as.data.frame(str_split_fixed(horario_SANJOSE_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_SANJOSE_unique <- cbind(horario_SANJOSE_unique, horario_split)
names(horario_SANJOSE_unique)

horario_SANJOSE_unique$recom_d <- 0
horario_SANJOSE_unique$recom_d[horario_SANJOSE_unique$recomendacion == "unir horario" | horario_SANJOSE_unique$recomendacion == "cerrar horario"] <- 0
horario_SANJOSE_unique$recom_d[horario_SANJOSE_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                                 horario_SANJOSE_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_SANJOSE_unique$recom_d[horario_SANJOSE_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_SANJOSE_unique$recom_d[horario_SANJOSE_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_SANJOSE_unique <- horario_SANJOSE_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)

write_xlsx(horario_SANJOSE_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/recom_SANJOSE_latina_pand_C2.xlsx")



###### Comparativo de cursos ofertados para usarlo contra la tabla dinamica SANJOSE ######

horario_split_2 <- as.data.frame(str_split_fixed(SANJOSE$HORARIO, " ", 2))
names(horario_split_2)[1] <- "dia"
names(horario_split_2)[2] <- "hora"

SANJOSE <- cbind(SANJOSE, horario_split_2)
names(SANJOSE)

SANJOSE$paralelo <- paste0(SANJOSE$AULA, "-", SANJOSE$HORARIO)


write_xlsx(SANJOSE,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANJOSE/SANJOSE_mock.xlsx")


pt <- PivotTable$new()
pt$addData(SANJOSE)
pt$addColumnDataGroups("dia")
pt$addRowDataGroups("hora")
pt$defineCalculation(calculationName="paralelos", summariseExpression="paralelo")
pt$renderPivot()




######## ULATINA SEDE SANTACRUZ #########


#primer animado sede-carrera
#Diferenciado entre bases de datos de cada una de las sedes y sus carreras #

ulat_SANTACRUZ_carr <- split(SANTACRUZ, f = SANTACRUZ$carrera) 
names(ulat_SANTACRUZ_carr) <- paste0("SANTACRUZ-",names(ulat_SANTACRUZ_carr)) 

list2env(ulat_SANTACRUZ_carr,envir=.GlobalEnv)


#segundo anidado Sede-carrera-materias#

#SANTACRUZ-admin_neg


`SANTACRUZ-admin_neg-materias` <- split(`SANTACRUZ-admin_neg`, f = `SANTACRUZ-admin_neg`$cod_padre) 
names(`SANTACRUZ-admin_neg-materias`) <- paste0("SANTACRUZ-admin_neg-materias-",names(`SANTACRUZ-admin_neg-materias`)) 

list2env(`SANTACRUZ-admin_neg-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_admin_neg <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_admin_neg)[1] <- "horario"
horario_SANTACRUZ_admin_neg <- unique(horario_SANTACRUZ_admin_neg)


`obs_SANTACRUZ-admin_neg-materias` <- as.data.frame(sapply(`SANTACRUZ-admin_neg-materias`, NROW))

`obs_SANTACRUZ-admin_neg-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-admin_neg-materias`, "materia")
names(`obs_SANTACRUZ-admin_neg-materias`)[2] <- "obs"

`obs_SANTACRUZ-admin_neg-materias`$materia <- str_remove(`obs_SANTACRUZ-admin_neg-materias`$materia, "SANTACRUZ-admin_neg-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-admin_neg-materias` <- filter(`obs_SANTACRUZ-admin_neg-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-admin_neg-materias` <- filter(`obs_SANTACRUZ-admin_neg-materias`, obs < 10)


#BAN 01

`BAN 01` <- as.data.frame(count(`SANTACRUZ-admin_neg-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANTACRUZ_admin_neg <- left_join(horario_SANTACRUZ_admin_neg, `BAN 01`)
names(horario_SANTACRUZ_admin_neg)[2] <- "BAN 01"

horario_SANTACRUZ_admin_neg$`BAN 01`[is.na(horario_SANTACRUZ_admin_neg$`BAN 01`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`SANTACRUZ-admin_neg-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_SANTACRUZ_admin_neg <- left_join(horario_SANTACRUZ_admin_neg, `BAN 03`)
names(horario_SANTACRUZ_admin_neg)[3] <- "BAN 03"

horario_SANTACRUZ_admin_neg$`BAN 03`[is.na(horario_SANTACRUZ_admin_neg$`BAN 03`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`SANTACRUZ-admin_neg-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANTACRUZ_admin_neg <- left_join(horario_SANTACRUZ_admin_neg, `BCP 01`)
names(horario_SANTACRUZ_admin_neg)[4] <- "BCP 01"

horario_SANTACRUZ_admin_neg$`BCP 01`[is.na(horario_SANTACRUZ_admin_neg$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`SANTACRUZ-admin_neg-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_SANTACRUZ_admin_neg <- left_join(horario_SANTACRUZ_admin_neg, `BMA 02`)
names(horario_SANTACRUZ_admin_neg)[5] <- "BMA 02"

horario_SANTACRUZ_admin_neg$`BMA 02`[is.na(horario_SANTACRUZ_admin_neg$`BMA 02`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`SANTACRUZ-admin_neg-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_SANTACRUZ_admin_neg <- left_join(horario_SANTACRUZ_admin_neg, `BPE 27`)
names(horario_SANTACRUZ_admin_neg)[6] <- "BPE 27"

horario_SANTACRUZ_admin_neg$`BPE 27`[is.na(horario_SANTACRUZ_admin_neg$`BPE 27`)] <- 0


##wide to long

horario_SANTACRUZ_admin_neg$id <- "Ulatina_SANTACRUZ_admin_neg_pand_C2"
horario_SANTACRUZ_admin_neg <-  horario_SANTACRUZ_admin_neg%>% dplyr::select(id, everything())

horario_SANTACRUZ_admin_neg <- melt(horario_SANTACRUZ_admin_neg, id = c("id", "horario"))
names(horario_SANTACRUZ_admin_neg)[3] <- "materia"
names(horario_SANTACRUZ_admin_neg)[4] <- "asistencia"


#SANTACRUZ-ingles


`SANTACRUZ-ingles-materias` <- split(`SANTACRUZ-ingles`, f = `SANTACRUZ-ingles`$cod_padre) 
names(`SANTACRUZ-ingles-materias`) <- paste0("SANTACRUZ-ingles-materias-",names(`SANTACRUZ-ingles-materias`)) 

list2env(`SANTACRUZ-ingles-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_ingles <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_ingles)[1] <- "horario"
horario_SANTACRUZ_ingles <- unique(horario_SANTACRUZ_ingles)


`obs_SANTACRUZ-ingles-materias` <- as.data.frame(sapply(`SANTACRUZ-ingles-materias`, NROW))

`obs_SANTACRUZ-ingles-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-ingles-materias`, "materia")
names(`obs_SANTACRUZ-ingles-materias`)[2] <- "obs"

`obs_SANTACRUZ-ingles-materias`$materia <- str_remove(`obs_SANTACRUZ-ingles-materias`$materia, "SANTACRUZ-ingles-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-ingles-materias` <- filter(`obs_SANTACRUZ-ingles-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-ingles-materias` <- filter(`obs_SANTACRUZ-ingles-materias`, obs < 10)




#BAR-03

`BAR-03` <- as.data.frame(count(`SANTACRUZ-ingles-materias-BAR-03`$HORARIO)) 

`BAR-03`$freq <- (`BAR-03`$freq)/sum(`BAR-03`$freq)

names(`BAR-03`)[1] <- "horario"

horario_SANTACRUZ_ingles <- left_join(horario_SANTACRUZ_ingles, `BAR-03`)
names(horario_SANTACRUZ_ingles)[2] <- "BAR-03"

horario_SANTACRUZ_ingles$`BAR-03`[is.na(horario_SANTACRUZ_ingles$`BAR-03`)] <- 0



#BCP 01

`BCP 01` <- as.data.frame(count(`SANTACRUZ-ingles-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANTACRUZ_ingles <- left_join(horario_SANTACRUZ_ingles, `BCP 01`)
names(horario_SANTACRUZ_ingles)[3] <- "BCP 01"

horario_SANTACRUZ_ingles$`BCP 01`[is.na(horario_SANTACRUZ_ingles$`BCP 01`)] <- 0


#BCS-01

`BCS-01` <- as.data.frame(count(`SANTACRUZ-ingles-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANTACRUZ_ingles <- left_join(horario_SANTACRUZ_ingles, `BCS-01`)
names(horario_SANTACRUZ_ingles)[4] <- "BCS-01"

horario_SANTACRUZ_ingles$`BCS-01`[is.na(horario_SANTACRUZ_ingles$`BCS-01`)] <- 0




#BCA-01

`BCA-01` <- as.data.frame(count(`SANTACRUZ-ingles-materias-BCA-01`$HORARIO)) 

`BCA-01`$freq <- (`BCA-01`$freq)/sum(`BCA-01`$freq)

names(`BCA-01`)[1] <- "horario"

horario_SANTACRUZ_ingles <- left_join(horario_SANTACRUZ_ingles, `BCA-01`)
names(horario_SANTACRUZ_ingles)[5] <- "BCA-01"

horario_SANTACRUZ_ingles$`BCA-01`[is.na(horario_SANTACRUZ_ingles$`BCA-01`)] <- 0




#BCS 01

`BCS 01` <- as.data.frame(count(`SANTACRUZ-ingles-materias-BCS 01`$HORARIO)) 

`BCS 01`$freq <- (`BCS 01`$freq)/sum(`BCS 01`$freq)

names(`BCS 01`)[1] <- "horario"

horario_SANTACRUZ_ingles <- left_join(horario_SANTACRUZ_ingles, `BCS 01`)
names(horario_SANTACRUZ_ingles)[6] <- "BCS 01"

horario_SANTACRUZ_ingles$`BCS 01`[is.na(horario_SANTACRUZ_ingles$`BCS 01`)] <- 0


#BCS01

BCS01 <- as.data.frame(count(`SANTACRUZ-ingles-materias-BCS01`$HORARIO)) 

BCS01$freq <- (BCS01$freq)/sum(BCS01$freq)

names(BCS01)[1] <- "horario"

horario_SANTACRUZ_ingles <- left_join(horario_SANTACRUZ_ingles, BCS01)
names(horario_SANTACRUZ_ingles)[7] <- "BCS01"

horario_SANTACRUZ_ingles$BCS01[is.na(horario_SANTACRUZ_ingles$BCS01)] <- 0



##wide to long

horario_SANTACRUZ_ingles$id <- "Ulatina_SANTACRUZ_ingles_pand_C2"
horario_SANTACRUZ_ingles <-  horario_SANTACRUZ_ingles%>% dplyr::select(id, everything())

horario_SANTACRUZ_ingles <- melt(horario_SANTACRUZ_ingles, id = c("id", "horario"))
names(horario_SANTACRUZ_ingles)[3] <- "materia"
names(horario_SANTACRUZ_ingles)[4] <- "asistencia"



#SANTACRUZ-comput


`SANTACRUZ-comput-materias` <- split(`SANTACRUZ-comput`, f = `SANTACRUZ-comput`$cod_padre) 
names(`SANTACRUZ-comput-materias`) <- paste0("SANTACRUZ-comput-materias-",names(`SANTACRUZ-comput-materias`)) 

list2env(`SANTACRUZ-comput-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_comput <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_comput)[1] <- "horario"
horario_SANTACRUZ_comput <- unique(horario_SANTACRUZ_comput)


`obs_SANTACRUZ-comput-materias` <- as.data.frame(sapply(`SANTACRUZ-comput-materias`, NROW))

`obs_SANTACRUZ-comput-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-comput-materias`, "materia")
names(`obs_SANTACRUZ-comput-materias`)[2] <- "obs"

`obs_SANTACRUZ-comput-materias`$materia <- str_remove(`obs_SANTACRUZ-comput-materias`$materia, "SANTACRUZ-comput-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-comput-materias` <- filter(`obs_SANTACRUZ-comput-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-comput-materias` <- filter(`obs_SANTACRUZ-comput-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANTACRUZ-comput-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANTACRUZ_comput <- left_join(horario_SANTACRUZ_comput, `BCS-01`)
names(horario_SANTACRUZ_comput)[2] <- "BCS-01"

horario_SANTACRUZ_comput$`BCS-01`[is.na(horario_SANTACRUZ_comput$`BCS-01`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`SANTACRUZ-comput-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_SANTACRUZ_comput <- left_join(horario_SANTACRUZ_comput, `BMA 01`)
names(horario_SANTACRUZ_comput)[3] <- "BMA 01"

horario_SANTACRUZ_comput$`BMA 01`[is.na(horario_SANTACRUZ_comput$`BMA 01`)] <- 0



#BIS01

BIS01 <- as.data.frame(count(`SANTACRUZ-comput-materias-BIS01`$HORARIO)) 

BIS01$freq <- (BIS01$freq)/sum(BIS01$freq)

names(BIS01)[1] <- "horario"

horario_SANTACRUZ_comput <- left_join(horario_SANTACRUZ_comput, BIS01)
names(horario_SANTACRUZ_comput)[4] <- "BIS01"

horario_SANTACRUZ_comput$BIS01[is.na(horario_SANTACRUZ_comput$BIS01)] <- 0


#BIS02

BIS02 <- as.data.frame(count(`SANTACRUZ-comput-materias-BIS02`$HORARIO)) 

BIS02$freq <- (BIS02$freq)/sum(BIS02$freq)

names(BIS02)[1] <- "horario"

horario_SANTACRUZ_comput <- left_join(horario_SANTACRUZ_comput, BIS02)
names(horario_SANTACRUZ_comput)[5] <- "BIS02"

horario_SANTACRUZ_comput$BIS02[is.na(horario_SANTACRUZ_comput$BIS02)] <- 0


#BIS03

BIS03 <- as.data.frame(count(`SANTACRUZ-comput-materias-BIS03`$HORARIO)) 

BIS03$freq <- (BIS03$freq)/sum(BIS03$freq)

names(BIS03)[1] <- "horario"

horario_SANTACRUZ_comput <- left_join(horario_SANTACRUZ_comput, BIS03)
names(horario_SANTACRUZ_comput)[6] <- "BIS03"

horario_SANTACRUZ_comput$BIS03[is.na(horario_SANTACRUZ_comput$BIS03)] <- 0


##wide to long

horario_SANTACRUZ_comput$id <- "Ulatina_SANTACRUZ_comput_pand_C2"
horario_SANTACRUZ_comput <-  horario_SANTACRUZ_comput%>% dplyr::select(id, everything())

horario_SANTACRUZ_comput <- melt(horario_SANTACRUZ_comput, id = c("id", "horario"))
names(horario_SANTACRUZ_comput)[3] <- "materia"
names(horario_SANTACRUZ_comput)[4] <- "asistencia"


#SANTACRUZ-conta


`SANTACRUZ-conta-materias` <- split(`SANTACRUZ-conta`, f = `SANTACRUZ-conta`$cod_padre) 
names(`SANTACRUZ-conta-materias`) <- paste0("SANTACRUZ-conta-materias-",names(`SANTACRUZ-conta-materias`)) 

list2env(`SANTACRUZ-conta-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_conta <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_conta)[1] <- "horario"
horario_SANTACRUZ_conta <- unique(horario_SANTACRUZ_conta)


`obs_SANTACRUZ-conta-materias` <- as.data.frame(sapply(`SANTACRUZ-conta-materias`, NROW))

`obs_SANTACRUZ-conta-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-conta-materias`, "materia")
names(`obs_SANTACRUZ-conta-materias`)[2] <- "obs"

`obs_SANTACRUZ-conta-materias`$materia <- str_remove(`obs_SANTACRUZ-conta-materias`$materia, "SANTACRUZ-conta-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-conta-materias` <- filter(`obs_SANTACRUZ-conta-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-conta-materias` <- filter(`obs_SANTACRUZ-conta-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANTACRUZ-conta-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANTACRUZ_conta <- left_join(horario_SANTACRUZ_conta, `BAN-040`)
names(horario_SANTACRUZ_conta)[2] <- "BAN-040"

horario_SANTACRUZ_conta$`BAN-040`[is.na(horario_SANTACRUZ_conta$`BAN-040`)] <- 0


#BAN 01

`BAN 01` <- as.data.frame(count(`SANTACRUZ-conta-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANTACRUZ_conta <- left_join(horario_SANTACRUZ_conta, `BAN 01`)
names(horario_SANTACRUZ_conta)[3] <- "BAN 01"

horario_SANTACRUZ_conta$`BAN 01`[is.na(horario_SANTACRUZ_conta$`BAN 01`)] <- 0


#BCP 01

`BCP 01` <- as.data.frame(count(`SANTACRUZ-conta-materias-BCP 01`$HORARIO)) 

`BCP 01`$freq <- (`BCP 01`$freq)/sum(`BCP 01`$freq)

names(`BCP 01`)[1] <- "horario"

horario_SANTACRUZ_conta <- left_join(horario_SANTACRUZ_conta, `BCP 01`)
names(horario_SANTACRUZ_conta)[4] <- "BCP 01"

horario_SANTACRUZ_conta$`BCP 01`[is.na(horario_SANTACRUZ_conta$`BCP 01`)] <- 0


#BMA 02

`BMA 02` <- as.data.frame(count(`SANTACRUZ-conta-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_SANTACRUZ_conta <- left_join(horario_SANTACRUZ_conta, `BMA 02`)
names(horario_SANTACRUZ_conta)[5] <- "BMA 02"

horario_SANTACRUZ_conta$`BMA 02`[is.na(horario_SANTACRUZ_conta$`BMA 02`)] <- 0




##wide to long

horario_SANTACRUZ_conta$id <- "Ulatina_SANTACRUZ_conta_pand_C2"
horario_SANTACRUZ_conta <-  horario_SANTACRUZ_conta%>% dplyr::select(id, everything())

horario_SANTACRUZ_conta <- melt(horario_SANTACRUZ_conta, id = c("id", "horario"))
names(horario_SANTACRUZ_conta)[3] <- "materia"
names(horario_SANTACRUZ_conta)[4] <- "asistencia"


#SANTACRUZ-conta_pub


`SANTACRUZ-conta_pub-materias` <- split(`SANTACRUZ-conta_pub`, f = `SANTACRUZ-conta_pub`$cod_padre) 
names(`SANTACRUZ-conta_pub-materias`) <- paste0("SANTACRUZ-conta_pub-materias-",names(`SANTACRUZ-conta_pub-materias`)) 

list2env(`SANTACRUZ-conta_pub-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_conta_pub <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_conta_pub)[1] <- "horario"
horario_SANTACRUZ_conta_pub <- unique(horario_SANTACRUZ_conta_pub)


`obs_SANTACRUZ-conta_pub-materias` <- as.data.frame(sapply(`SANTACRUZ-conta_pub-materias`, NROW))

`obs_SANTACRUZ-conta_pub-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-conta_pub-materias`, "materia")
names(`obs_SANTACRUZ-conta_pub-materias`)[2] <- "obs"

`obs_SANTACRUZ-conta_pub-materias`$materia <- str_remove(`obs_SANTACRUZ-conta_pub-materias`$materia, "SANTACRUZ-conta_pub-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-conta_pub-materias` <- filter(`obs_SANTACRUZ-conta_pub-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-conta_pub-materias` <- filter(`obs_SANTACRUZ-conta_pub-materias`, obs < 10)

#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANTACRUZ-conta_pub-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANTACRUZ_conta_pub <- left_join(horario_SANTACRUZ_conta_pub, `BFIS 01`)
names(horario_SANTACRUZ_conta_pub)[2] <- "BFIS 01"

horario_SANTACRUZ_conta_pub$`BFIS 01`[is.na(horario_SANTACRUZ_conta_pub$`BFIS 01`)] <- 0


##wide to long

horario_SANTACRUZ_conta_pub$id <- "Ulatina_SANTACRUZ_conta_pub_pand_C2"
horario_SANTACRUZ_conta_pub <-  horario_SANTACRUZ_conta_pub%>% dplyr::select(id, everything())

horario_SANTACRUZ_conta_pub <- melt(horario_SANTACRUZ_conta_pub, id = c("id", "horario"))
names(horario_SANTACRUZ_conta_pub)[3] <- "materia"
names(horario_SANTACRUZ_conta_pub)[4] <- "asistencia"




#SANTACRUZ-derecho


`SANTACRUZ-derecho-materias` <- split(`SANTACRUZ-derecho`, f = `SANTACRUZ-derecho`$cod_padre) 
names(`SANTACRUZ-derecho-materias`) <- paste0("SANTACRUZ-derecho-materias-",names(`SANTACRUZ-derecho-materias`)) 

list2env(`SANTACRUZ-derecho-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_derecho <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_derecho)[1] <- "horario"
horario_SANTACRUZ_derecho <- unique(horario_SANTACRUZ_derecho)


`obs_SANTACRUZ-derecho-materias` <- as.data.frame(sapply(`SANTACRUZ-derecho-materias`, NROW))

`obs_SANTACRUZ-derecho-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-derecho-materias`, "materia")
names(`obs_SANTACRUZ-derecho-materias`)[2] <- "obs"

`obs_SANTACRUZ-derecho-materias`$materia <- str_remove(`obs_SANTACRUZ-derecho-materias`$materia, "SANTACRUZ-derecho-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-derecho-materias` <- filter(`obs_SANTACRUZ-derecho-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-derecho-materias` <- filter(`obs_SANTACRUZ-derecho-materias`, obs < 10)




#BAN-01

`BAN-01` <- as.data.frame(count(`SANTACRUZ-derecho-materias-BAN-01`$HORARIO)) 

`BAN-01`$freq <- (`BAN-01`$freq)/sum(`BAN-01`$freq)

names(`BAN-01`)[1] <- "horario"

horario_SANTACRUZ_derecho <- left_join(horario_SANTACRUZ_derecho, `BAN-01`)
names(horario_SANTACRUZ_derecho)[2] <- "BAN-01"

horario_SANTACRUZ_derecho$`BAN-01`[is.na(horario_SANTACRUZ_derecho$`BAN-01`)] <- 0


#BAN-02

`BAN-02` <- as.data.frame(count(`SANTACRUZ-derecho-materias-BAN-02`$HORARIO)) 

`BAN-02`$freq <- (`BAN-02`$freq)/sum(`BAN-02`$freq)

names(`BAN-02`)[1] <- "horario"

horario_SANTACRUZ_derecho <- left_join(horario_SANTACRUZ_derecho, `BAN-02`)
names(horario_SANTACRUZ_derecho)[3] <- "BAN-02"

horario_SANTACRUZ_derecho$`BAN-02`[is.na(horario_SANTACRUZ_derecho$`BAN-02`)] <- 0


#BAN 03

`BAN 03` <- as.data.frame(count(`SANTACRUZ-derecho-materias-BAN 03`$HORARIO)) 

`BAN 03`$freq <- (`BAN 03`$freq)/sum(`BAN 03`$freq)

names(`BAN 03`)[1] <- "horario"

horario_SANTACRUZ_derecho <- left_join(horario_SANTACRUZ_derecho, `BAN 03`)
names(horario_SANTACRUZ_derecho)[4] <- "BAN 03"

horario_SANTACRUZ_derecho$`BAN 03`[is.na(horario_SANTACRUZ_derecho$`BAN 03`)] <- 0



##wide to long

horario_SANTACRUZ_derecho$id <- "Ulatina_SANTACRUZ_derecho_pand_C2"
horario_SANTACRUZ_derecho <-  horario_SANTACRUZ_derecho%>% dplyr::select(id, everything())

horario_SANTACRUZ_derecho <- melt(horario_SANTACRUZ_derecho, id = c("id", "horario"))
names(horario_SANTACRUZ_derecho)[3] <- "materia"
names(horario_SANTACRUZ_derecho)[4] <- "asistencia"




#SANTACRUZ-enf


`SANTACRUZ-enf-materias` <- split(`SANTACRUZ-enf`, f = `SANTACRUZ-enf`$cod_padre) 
names(`SANTACRUZ-enf-materias`) <- paste0("SANTACRUZ-enf-materias-",names(`SANTACRUZ-enf-materias`)) 

list2env(`SANTACRUZ-enf-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_enf <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_enf)[1] <- "horario"
horario_SANTACRUZ_enf <- unique(horario_SANTACRUZ_enf)


`obs_SANTACRUZ-enf-materias` <- as.data.frame(sapply(`SANTACRUZ-enf-materias`, NROW))

`obs_SANTACRUZ-enf-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-enf-materias`, "materia")
names(`obs_SANTACRUZ-enf-materias`)[2] <- "obs"

`obs_SANTACRUZ-enf-materias`$materia <- str_remove(`obs_SANTACRUZ-enf-materias`$materia, "SANTACRUZ-enf-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-enf-materias` <- filter(`obs_SANTACRUZ-enf-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-enf-materias` <- filter(`obs_SANTACRUZ-enf-materias`, obs < 10)




#BCS-01

`BCS-01` <- as.data.frame(count(`SANTACRUZ-enf-materias-BCS-01`$HORARIO)) 

`BCS-01`$freq <- (`BCS-01`$freq)/sum(`BCS-01`$freq)

names(`BCS-01`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BCS-01`)
names(horario_SANTACRUZ_enf)[2] <- "BCS-01"

horario_SANTACRUZ_enf$`BCS-01`[is.na(horario_SANTACRUZ_enf$`BCS-01`)] <- 0


#LENF-01

`LENF-01` <- as.data.frame(count(`SANTACRUZ-enf-materias-LENF-01`$HORARIO)) 

`LENF-01`$freq <- (`LENF-01`$freq)/sum(`LENF-01`$freq)

names(`LENF-01`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `LENF-01`)
names(horario_SANTACRUZ_enf)[3] <- "LENF-01"

horario_SANTACRUZ_enf$`LENF-01`[is.na(horario_SANTACRUZ_enf$`LENF-01`)] <- 0


#BIE-01

`BIE-01` <- as.data.frame(count(`SANTACRUZ-enf-materias-BIE-01`$HORARIO)) 

`BIE-01`$freq <- (`BIE-01`$freq)/sum(`BIE-01`$freq)

names(`BIE-01`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BIE-01`)
names(horario_SANTACRUZ_enf)[4] <- "BIE-01"

horario_SANTACRUZ_enf$`BIE-01`[is.na(horario_SANTACRUZ_enf$`BIE-01`)] <- 0



#BIE-02

`BIE-02` <- as.data.frame(count(`SANTACRUZ-enf-materias-BIE-02`$HORARIO)) 

`BIE-02`$freq <- (`BIE-02`$freq)/sum(`BIE-02`$freq)

names(`BIE-02`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BIE-02`)
names(horario_SANTACRUZ_enf)[5] <- "BIE-02"

horario_SANTACRUZ_enf$`BIE-02`[is.na(horario_SANTACRUZ_enf$`BIE-02`)] <- 0


#BIE-05

`BIE-05` <- as.data.frame(count(`SANTACRUZ-enf-materias-BIE-05`$HORARIO)) 

`BIE-05`$freq <- (`BIE-05`$freq)/sum(`BIE-05`$freq)

names(`BIE-05`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BIE-05`)
names(horario_SANTACRUZ_enf)[6] <- "BIE-05"

horario_SANTACRUZ_enf$`BIE-05`[is.na(horario_SANTACRUZ_enf$`BIE-05`)] <- 0


#BII 01

`BII 01` <- as.data.frame(count(`SANTACRUZ-enf-materias-BII 01`$HORARIO)) 

`BII 01`$freq <- (`BII 01`$freq)/sum(`BII 01`$freq)

names(`BII 01`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BII 01`)
names(horario_SANTACRUZ_enf)[7] <- "BII 01"

horario_SANTACRUZ_enf$`BII 01`[is.na(horario_SANTACRUZ_enf$`BII 01`)] <- 0




#BIE-03

`BIE-03` <- as.data.frame(count(`SANTACRUZ-enf-materias-BIE-03`$HORARIO)) 

`BIE-03`$freq <- (`BIE-03`$freq)/sum(`BIE-03`$freq)

names(`BIE-03`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BIE-03`)
names(horario_SANTACRUZ_enf)[8] <- "BIE-03"

horario_SANTACRUZ_enf$`BIE-03`[is.na(horario_SANTACRUZ_enf$`BIE-03`)] <- 0

#BIM 21

`BIM 21` <- as.data.frame(count(`SANTACRUZ-enf-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_SANTACRUZ_enf <- left_join(horario_SANTACRUZ_enf, `BIM 21`)
names(horario_SANTACRUZ_enf)[9] <- "BIM 21"

horario_SANTACRUZ_enf$`BIM 21`[is.na(horario_SANTACRUZ_enf$`BIM 21`)] <- 0



##wide to long

horario_SANTACRUZ_enf$id <- "Ulatina_SANTACRUZ_enf_pand_C2"
horario_SANTACRUZ_enf <-  horario_SANTACRUZ_enf%>% dplyr::select(id, everything())

horario_SANTACRUZ_enf <- melt(horario_SANTACRUZ_enf, id = c("id", "horario"))
names(horario_SANTACRUZ_enf)[3] <- "materia"
names(horario_SANTACRUZ_enf)[4] <- "asistencia"



#SANTACRUZ-indus


`SANTACRUZ-indus-materias` <- split(`SANTACRUZ-indus`, f = `SANTACRUZ-indus`$cod_padre) 
names(`SANTACRUZ-indus-materias`) <- paste0("SANTACRUZ-indus-materias-",names(`SANTACRUZ-indus-materias`)) 

list2env(`SANTACRUZ-indus-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_indus <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_indus)[1] <- "horario"
horario_SANTACRUZ_indus <- unique(horario_SANTACRUZ_indus)


`obs_SANTACRUZ-indus-materias` <- as.data.frame(sapply(`SANTACRUZ-indus-materias`, NROW))

`obs_SANTACRUZ-indus-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-indus-materias`, "materia")
names(`obs_SANTACRUZ-indus-materias`)[2] <- "obs"

`obs_SANTACRUZ-indus-materias`$materia <- str_remove(`obs_SANTACRUZ-indus-materias`$materia, "SANTACRUZ-indus-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-indus-materias` <- filter(`obs_SANTACRUZ-indus-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-indus-materias` <- filter(`obs_SANTACRUZ-indus-materias`, obs < 10)



#BFIS 01

`BFIS 01` <- as.data.frame(count(`SANTACRUZ-indus-materias-BFIS 01`$HORARIO)) 

`BFIS 01`$freq <- (`BFIS 01`$freq)/sum(`BFIS 01`$freq)

names(`BFIS 01`)[1] <- "horario"

horario_SANTACRUZ_indus <- left_join(horario_SANTACRUZ_indus, `BFIS 01`)
names(horario_SANTACRUZ_indus)[2] <- "BFIS 01"

horario_SANTACRUZ_indus$`BFIS 01`[is.na(horario_SANTACRUZ_indus$`BFIS 01`)] <- 0


#BIM 21

`BIM 21` <- as.data.frame(count(`SANTACRUZ-indus-materias-BIM 21`$HORARIO)) 

`BIM 21`$freq <- (`BIM 21`$freq)/sum(`BIM 21`$freq)

names(`BIM 21`)[1] <- "horario"

horario_SANTACRUZ_indus <- left_join(horario_SANTACRUZ_indus, `BIM 21`)
names(horario_SANTACRUZ_indus)[3] <- "BIM 21"

horario_SANTACRUZ_indus$`BIM 21`[is.na(horario_SANTACRUZ_indus$`BIM 21`)] <- 0


#BMA 01

`BMA 01` <- as.data.frame(count(`SANTACRUZ-indus-materias-BMA 01`$HORARIO)) 

`BMA 01`$freq <- (`BMA 01`$freq)/sum(`BMA 01`$freq)

names(`BMA 01`)[1] <- "horario"

horario_SANTACRUZ_indus <- left_join(horario_SANTACRUZ_indus, `BMA 01`)
names(horario_SANTACRUZ_indus)[4] <- "BMA 01"

horario_SANTACRUZ_indus$`BMA 01`[is.na(horario_SANTACRUZ_indus$`BMA 01`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`SANTACRUZ-indus-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_SANTACRUZ_indus <- left_join(horario_SANTACRUZ_indus, `BPE 27`)
names(horario_SANTACRUZ_indus)[5] <- "BPE 27"

horario_SANTACRUZ_indus$`BPE 27`[is.na(horario_SANTACRUZ_indus$`BPE 27`)] <- 0


#BII 01

`BII 01` <- as.data.frame(count(`SANTACRUZ-indus-materias-BII 01`$HORARIO)) 

`BII 01`$freq <- (`BII 01`$freq)/sum(`BII 01`$freq)

names(`BII 01`)[1] <- "horario"

horario_SANTACRUZ_indus <- left_join(horario_SANTACRUZ_indus, `BII 01`)
names(horario_SANTACRUZ_indus)[6] <- "BII 01"

horario_SANTACRUZ_indus$`BII 01`[is.na(horario_SANTACRUZ_indus$`BII 01`)] <- 0


#QU 01

`QU 01` <- as.data.frame(count(`SANTACRUZ-indus-materias-QU 01`$HORARIO)) 

`QU 01`$freq <- (`QU 01`$freq)/sum(`QU 01`$freq)

names(`QU 01`)[1] <- "horario"

horario_SANTACRUZ_indus <- left_join(horario_SANTACRUZ_indus, `QU 01`)
names(horario_SANTACRUZ_indus)[7] <- "QU 01"

horario_SANTACRUZ_indus$`QU 01`[is.na(horario_SANTACRUZ_indus$`QU 01`)] <- 0


##wide to long

horario_SANTACRUZ_indus$id <- "Ulatina_SANTACRUZ_indus_pand_C2"
horario_SANTACRUZ_indus <-  horario_SANTACRUZ_indus%>% dplyr::select(id, everything())

horario_SANTACRUZ_indus <- melt(horario_SANTACRUZ_indus, id = c("id", "horario"))
names(horario_SANTACRUZ_indus)[3] <- "materia"
names(horario_SANTACRUZ_indus)[4] <- "asistencia"



#santacruz-arquit

`SANTACRUZ-arquit-materias` <- split(`SANTACRUZ-arquit`, f = `SANTACRUZ-arquit`$cod_padre) 
names(`SANTACRUZ-arquit-materias`) <- paste0("SANTACRUZ-arquit-materias-",names(`SANTACRUZ-arquit-materias`)) 

list2env(`SANTACRUZ-arquit-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_arquit <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_arquit)[1] <- "horario"
horario_SANTACRUZ_arquit <- unique(horario_SANTACRUZ_arquit)


`obs_SANTACRUZ-arquit-materias` <- as.data.frame(sapply(`SANTACRUZ-arquit-materias`, NROW))

`obs_SANTACRUZ-arquit-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-arquit-materias`, "materia")
names(`obs_SANTACRUZ-arquit-materias`)[2] <- "obs"

`obs_SANTACRUZ-arquit-materias`$materia <- str_remove(`obs_SANTACRUZ-arquit-materias`$materia, "SANTACRUZ-arquit-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-arquit-materias` <- filter(`obs_SANTACRUZ-arquit-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-arquit-materias` <- filter(`obs_SANTACRUZ-arquit-materias`, obs < 10)




#BAN 01

`BAN 01` <- as.data.frame(count(`SANTACRUZ-arquit-materias-BAN 01`$HORARIO)) 

`BAN 01`$freq <- (`BAN 01`$freq)/sum(`BAN 01`$freq)

names(`BAN 01`)[1] <- "horario"

horario_SANTACRUZ_arquit <- left_join(horario_SANTACRUZ_arquit, `BAN 01`)
names(horario_SANTACRUZ_arquit)[2] <- "BAN 01"

horario_SANTACRUZ_arquit$`BAN 01`[is.na(horario_SANTACRUZ_arquit$`BAN 01`)] <- 0


##wide to long

horario_SANTACRUZ_arquit$id <- "Ulatina_SANTACRUZ_arquit_pand_C2"
horario_SANTACRUZ_arquit <-  horario_SANTACRUZ_arquit%>% dplyr::select(id, everything())

horario_SANTACRUZ_arquit <- melt(horario_SANTACRUZ_arquit, id = c("id", "horario"))
names(horario_SANTACRUZ_arquit)[3] <- "materia"
names(horario_SANTACRUZ_arquit)[4] <- "asistencia"



#SANTACRUZ-ter_fis


`SANTACRUZ-ter_fis-materias` <- split(`SANTACRUZ-ter_fis`, f = `SANTACRUZ-ter_fis`$cod_padre) 
names(`SANTACRUZ-ter_fis-materias`) <- paste0("SANTACRUZ-ter_fis-materias-",names(`SANTACRUZ-ter_fis-materias`)) 

list2env(`SANTACRUZ-ter_fis-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_ter_fis <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_ter_fis)[1] <- "horario"
horario_SANTACRUZ_ter_fis <- unique(horario_SANTACRUZ_ter_fis)


`obs_SANTACRUZ-ter_fis-materias` <- as.data.frame(sapply(`SANTACRUZ-ter_fis-materias`, NROW))

`obs_SANTACRUZ-ter_fis-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-ter_fis-materias`, "materia")
names(`obs_SANTACRUZ-ter_fis-materias`)[2] <- "obs"

`obs_SANTACRUZ-ter_fis-materias`$materia <- str_remove(`obs_SANTACRUZ-ter_fis-materias`$materia, "SANTACRUZ-ter_fis-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-ter_fis-materias` <- filter(`obs_SANTACRUZ-ter_fis-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-ter_fis-materias` <- filter(`obs_SANTACRUZ-ter_fis-materias`, obs < 10)




#BAN-040

`BAN-040` <- as.data.frame(count(`SANTACRUZ-ter_fis-materias-BAN-040`$HORARIO)) 

`BAN-040`$freq <- (`BAN-040`$freq)/sum(`BAN-040`$freq)

names(`BAN-040`)[1] <- "horario"

horario_SANTACRUZ_ter_fis <- left_join(horario_SANTACRUZ_ter_fis, `BAN-040`)
names(horario_SANTACRUZ_ter_fis)[2] <- "BAN-040"

horario_SANTACRUZ_ter_fis$`BAN-040`[is.na(horario_SANTACRUZ_ter_fis$`BAN-040`)] <- 0


#BDE-42

`BDE-42` <- as.data.frame(count(`SANTACRUZ-ter_fis-materias-BDE-42`$HORARIO)) 

`BDE-42`$freq <- (`BDE-42`$freq)/sum(`BDE-42`$freq)

names(`BDE-42`)[1] <- "horario"

horario_SANTACRUZ_ter_fis <- left_join(horario_SANTACRUZ_ter_fis, `BDE-42`)
names(horario_SANTACRUZ_ter_fis)[3] <- "BDE-42"

horario_SANTACRUZ_ter_fis$`BDE-42`[is.na(horario_SANTACRUZ_ter_fis$`BDE-42`)] <- 0



#BDE-43

`BDE-43` <- as.data.frame(count(`SANTACRUZ-ter_fis-materias-BDE-43`$HORARIO)) 

`BDE-43`$freq <- (`BDE-43`$freq)/sum(`BDE-43`$freq)

names(`BDE-43`)[1] <- "horario"

horario_SANTACRUZ_ter_fis <- left_join(horario_SANTACRUZ_ter_fis, `BDE-43`)
names(horario_SANTACRUZ_ter_fis)[4] <- "BDE-43"

horario_SANTACRUZ_ter_fis$`BDE-43`[is.na(horario_SANTACRUZ_ter_fis$`BDE-43`)] <- 0



#BMA 02

`BMA 02` <- as.data.frame(count(`SANTACRUZ-ter_fis-materias-BMA 02`$HORARIO)) 

`BMA 02`$freq <- (`BMA 02`$freq)/sum(`BMA 02`$freq)

names(`BMA 02`)[1] <- "horario"

horario_SANTACRUZ_ter_fis <- left_join(horario_SANTACRUZ_ter_fis, `BMA 02`)
names(horario_SANTACRUZ_ter_fis)[5] <- "BMA 02"

horario_SANTACRUZ_ter_fis$`BMA 02`[is.na(horario_SANTACRUZ_ter_fis$`BMA 02`)] <- 0


#BPE 27

`BPE 27` <- as.data.frame(count(`SANTACRUZ-ter_fis-materias-BPE 27`$HORARIO)) 

`BPE 27`$freq <- (`BPE 27`$freq)/sum(`BPE 27`$freq)

names(`BPE 27`)[1] <- "horario"

horario_SANTACRUZ_ter_fis <- left_join(horario_SANTACRUZ_ter_fis, `BPE 27`)
names(horario_SANTACRUZ_ter_fis)[6] <- "BPE 27"

horario_SANTACRUZ_ter_fis$`BPE 27`[is.na(horario_SANTACRUZ_ter_fis$`BPE 27`)] <- 0

##wide to long

horario_SANTACRUZ_ter_fis$id <- "Ulatina_SANTACRUZ_ter_fis_pand_C2"
horario_SANTACRUZ_ter_fis <-  horario_SANTACRUZ_ter_fis%>% dplyr::select(id, everything())

horario_SANTACRUZ_ter_fis <- melt(horario_SANTACRUZ_ter_fis, id = c("id", "horario"))
names(horario_SANTACRUZ_ter_fis)[3] <- "materia"
names(horario_SANTACRUZ_ter_fis)[4] <- "asistencia"






#SANTACRUZ-sist


`SANTACRUZ-sist-materias` <- split(`SANTACRUZ-sist`, f = `SANTACRUZ-sist`$cod_padre) 
names(`SANTACRUZ-sist-materias`) <- paste0("SANTACRUZ-sist-materias-",names(`SANTACRUZ-sist-materias`)) 

list2env(`SANTACRUZ-sist-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_sist <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_sist)[1] <- "horario"
horario_SANTACRUZ_sist <- unique(horario_SANTACRUZ_sist)


`obs_SANTACRUZ-sist-materias` <- as.data.frame(sapply(`SANTACRUZ-sist-materias`, NROW))

`obs_SANTACRUZ-sist-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-sist-materias`, "materia")
names(`obs_SANTACRUZ-sist-materias`)[2] <- "obs"

`obs_SANTACRUZ-sist-materias`$materia <- str_remove(`obs_SANTACRUZ-sist-materias`$materia, "SANTACRUZ-sist-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-sist-materias` <- filter(`obs_SANTACRUZ-sist-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-sist-materias` <- filter(`obs_SANTACRUZ-sist-materias`, obs < 10)




#NO SUFICIENTES DATOS

#SANTACRUZ-educ


`SANTACRUZ-educ-materias` <- split(`SANTACRUZ-educ`, f = `SANTACRUZ-educ`$cod_padre) 
names(`SANTACRUZ-educ-materias`) <- paste0("SANTACRUZ-educ-materias-",names(`SANTACRUZ-educ-materias`)) 

list2env(`SANTACRUZ-educ-materias`,envir=.GlobalEnv)


#Probabilidades de horarios anidadas para cada una de las materias de administracion de negocios 

horario_SANTACRUZ_educ <- as.data.frame(pf_latina$HORARIO)
names(horario_SANTACRUZ_educ)[1] <- "horario"
horario_SANTACRUZ_educ <- unique(horario_SANTACRUZ_educ)


`obs_SANTACRUZ-educ-materias` <- as.data.frame(sapply(`SANTACRUZ-educ-materias`, NROW))

`obs_SANTACRUZ-educ-materias` <- tibble::rownames_to_column(`obs_SANTACRUZ-educ-materias`, "materia")
names(`obs_SANTACRUZ-educ-materias`)[2] <- "obs"

`obs_SANTACRUZ-educ-materias`$materia <- str_remove(`obs_SANTACRUZ-educ-materias`$materia, "SANTACRUZ-educ-materias-")

#materias elegibles y no para la matriz de probabilidades
`elegibles_SANTACRUZ-educ-materias` <- filter(`obs_SANTACRUZ-educ-materias`, obs >= 10)
`no_elegibles_SANTACRUZ-educ-materias` <- filter(`obs_SANTACRUZ-educ-materias`, obs < 10)




#NO HAY SUFICIENTES DATOS

#Consolidado de sede SANTACRUZ



names(horario_SANTACRUZ_arquit) <- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_comput)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_conta)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_conta_pub)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_derecho)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_enf)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_indus)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_ingles)<- names(horario_SANTACRUZ_admin_neg)
names(horario_SANTACRUZ_ter_fis)<- names(horario_SANTACRUZ_admin_neg)

horario_SANTACRUZ <- rbind(horario_SANTACRUZ_admin_neg,horario_SANTACRUZ_arquit,
                           horario_SANTACRUZ_comput,horario_SANTACRUZ_conta,
                           horario_SANTACRUZ_conta_pub,horario_SANTACRUZ_derecho,horario_SANTACRUZ_enf,
                           horario_SANTACRUZ_indus,horario_SANTACRUZ_ingles,
                           horario_SANTACRUZ_ter_fis)



#total poblacion por carrera SANTACRUZ

materias_SANTACRUZ_pand_C2 <- count(SANTACRUZ$cod_padre)
names(materias_SANTACRUZ_pand_C2)[1] <- "materia"
names(materias_SANTACRUZ_pand_C2)[2] <- "poblacion"


#Left join entre los horarios y su correspondiente poblacion 

horario_SANTACRUZ <- left_join(horario_SANTACRUZ, materias_SANTACRUZ_pand_C2)


#Suma de las proporciones totales y sacamos una probabilidad de probabilidades condicionadas

pob_asist2 <- aggregate(x = horario_SANTACRUZ$asistencia, by = list(horario_SANTACRUZ$materia), FUN = sum)      
names(pob_asist2)[1] <- "materia"
names(pob_asist2)[2] <- "sum_prop"


#Probabilidad de la probabilidad para tener un compilado de probabilidades 

horario_SANTACRUZ <- left_join(horario_SANTACRUZ, pob_asist2)

horario_SANTACRUZ$asistencia2 <- horario_SANTACRUZ$asistencia/horario_SANTACRUZ$sum_prop
horario_SANTACRUZ$asistencia2[horario_SANTACRUZ$asistencia2 == Inf] <- 0

horario_SANTACRUZ$pob_asist <- round((horario_SANTACRUZ$asistencia2)*(horario_SANTACRUZ$poblacion),0)


#Guardo todos los horarios en su folder correspondiente

count(horario_SANTACRUZ$id)
Replaces <- data.frame(from = c("Ulatina_SANTACRUZ_admin_neg_pand_C2","Ulatina_SANTACRUZ_ter_fis_pand_C2", 
                                "Ulatina_SANTACRUZ_conta_pub_pand_C2","Ulatina_SANTACRUZ_admin_hoteleria_pand_C2",
                                "Ulatina_SANTACRUZ_anim_dig_pand_C2", "Ulatina_SANTACRUZ_civil_pand_C2"
                                ,"Ulatina_SANTACRUZ_dis_graf_pand_C2","Ulatina_SANTACRUZ_dis_int_pand_C2"
                                ,"Ulatina_SANTACRUZ_elect_mec_pand_C2","Ulatina_SANTACRUZ_mec_adm_pand_C2"
                                ,"Ulatina_SANTACRUZ_c_biolo_pand_C2","Ulatina_SANTACRUZ_com_dig_pand_C2"
                                ,"Ulatina_SANTACRUZ_com_mercadeo_pand_C2","Ulatina_SANTACRUZ_dis_graf_pand_C2"
                                ,"Ulatina_SANTACRUZ_educ_pre_pand_C2","Ulatina_SANTACRUZ_elect_med_pand_C2"
                                ,"Ulatina_SANTACRUZ_tur_sos_pand_C2"), 
                       
                       to = c("Ulatina_SANTACRUZ_admin-neg_pand_C2", "Ulatina_SANTACRUZ_ter-fis_pand_C2", 
                              "Ulatina_SANTACRUZ_conta_pub-pand_C2","Ulatina_SANTACRUZ_admin-hoteleria_pand_C2",
                              "Ulatina_SANTACRUZ_anim-dig_pand_C2","Ulatina_SANTACRUZ_c-com_pand_C2",
                              "Ulatina_SANTACRUZ_dis-graf_pand_C2","Ulatina_SANTACRUZ_dis-int_pand_C2"
                              ,"Ulatina_SANTACRUZ_elect-mec_pand_C2","Ulatina_SANTACRUZ_mec-adm_pand_C2",
                              "Ulatina_SANTACRUZ_c-biolo_pand_C2","Ulatina_SANTACRUZ_com-dig_pand_C2"
                              ,"Ulatina_SANTACRUZ_com-mercadeo_pand_C2","Ulatina_SANTACRUZ_dis-graf_pand_C2"
                              ,"Ulatina_SANTACRUZ_educ-pre_pand_C2","Ulatina_SANTACRUZ_elect-med_pand_C2"
                              ,"Ulatina_SANTACRUZ_tur-sos_pand_C2"))

horario_SANTACRUZ <- FindReplace(data = horario_SANTACRUZ, Var = "id", replaceData = Replaces,
                                 from = "from", to = "to", exact = FALSE)


count(horario_SANTACRUZ$id)

write_xlsx(horario_SANTACRUZ,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/horario_SANTACRUZ_latina_pand_C2.xlsx")

# write_xlsx(horario_SANTACRUZ_admin_neg,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/admin_neg_C2.xlsx")
# write_xlsx(horario_SANTACRUZ_conta,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/contabilidad_C2.xlsx")
# write_xlsx(horario_SANTACRUZ_derecho,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/derecho_C2.xlsx")
# write_xlsx(horario_SANTACRUZ_indus,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/industrial_C2.xlsx")
# write_xlsx(horario_SANTACRUZ_ingles,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/ingles_C2.xlsx")


#Consolidado unicamente a nivel de horarios, manteniendo todo constante excepto carrera
#Dividimos entre columnas

split <- str_split_fixed(horario_SANTACRUZ$id, "_", 5)

horario_SANTACRUZ <- cbind(split, horario_SANTACRUZ)
names(horario_SANTACRUZ)[1] <- "marca"
names(horario_SANTACRUZ)[2] <- "sede"
names(horario_SANTACRUZ)[3] <- "carrera"
names(horario_SANTACRUZ)[4] <- "modalidad"
names(horario_SANTACRUZ)[5] <- "cuatrimestre"

horario_SANTACRUZ <- horario_SANTACRUZ %>% dplyr::select(-id)


horario_SANTACRUZ_unique <- subset(horario_SANTACRUZ, pob_asist != 0)

horario_SANTACRUZ_unique <- horario_SANTACRUZ_unique %>% group_by(horario, materia) %>% summarise(Asistencia = sum(pob_asist))

horario_SANTACRUZ_unique$marca <- "Ulatina"
horario_SANTACRUZ_unique$sede <- "SANTACRUZ"
horario_SANTACRUZ_unique$modalidad <- "pand"
horario_SANTACRUZ_unique$cuatrimestre <- "C2"

horario_SANTACRUZ_unique <- horario_SANTACRUZ_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, horario, materia, Asistencia)

horario_SANTACRUZ_unique <- horario_SANTACRUZ_unique[with(horario_SANTACRUZ_unique, order(materia, horario)), ]  

horario_SANTACRUZ_unique <- horario_SANTACRUZ_unique %>% group_by(materia) %>% mutate(counter = row_number(materia))

#Rangos horarios
horario_SANTACRUZ_unique$unoanueve <- 0
horario_SANTACRUZ_unique$unoanueve[horario_SANTACRUZ_unique$Asistencia <= 9] <- 1

horario_SANTACRUZ_unique$dieza17 <- 0
horario_SANTACRUZ_unique$dieza17[horario_SANTACRUZ_unique$Asistencia >= 10 & horario_SANTACRUZ_unique$Asistencia <= 17] <- 1

horario_SANTACRUZ_unique$di18a30 <- 0
horario_SANTACRUZ_unique$di18a30[horario_SANTACRUZ_unique$Asistencia >= 18 & horario_SANTACRUZ_unique$Asistencia <= 30] <- 1

horario_SANTACRUZ_unique$di31a60 <- 0
horario_SANTACRUZ_unique$di31a60[horario_SANTACRUZ_unique$Asistencia >= 31 & horario_SANTACRUZ_unique$Asistencia <= 60] <- 1

horario_SANTACRUZ_unique$mas60 <- 0
horario_SANTACRUZ_unique$mas60[horario_SANTACRUZ_unique$Asistencia >= 61] <- 1



#Duplicados
duplicados <- as.data.frame(table(horario_SANTACRUZ_unique$materia))
names(duplicados)[1] <- "materia"
names(duplicados)[2] <- "freq"

duplicados$freq[duplicados$freq <= 1] <- 0
duplicados$freq[duplicados$freq > 1] <- 1

#Duplicados left join

horario_SANTACRUZ_unique <- left_join(horario_SANTACRUZ_unique, duplicados, by = "materia")

names(horario_SANTACRUZ_unique)[14] <- "duplicado"


#Regla dura 

#entre 1 y 9 

horario_SANTACRUZ_unique$recomendacion <- 0
horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$unoanueve == 1 & horario_SANTACRUZ_unique$duplicado == 0] <- "cerrar horario"
horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$unoanueve == 1 & horario_SANTACRUZ_unique$duplicado == 1] <- "unir horario"

#entre 10 y 17

horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$dieza17 == 1 & horario_SANTACRUZ_unique$duplicado == 0] <- "ofertar unicamente en ese horario"
horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$dieza17 == 1 & horario_SANTACRUZ_unique$duplicado == 1] <- "ofertar e intentar consolidar en 1 horario"

#entre 18 y 30 se recomienda ofertar

horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$di18a30 == 1] <- "abrir unicamente en ese horario"

#entre 30 y 60

horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$di31a60 == 1] <- "abrir 2 paralelos en este horario"

#mas de 60

horario_SANTACRUZ_unique$recomendacion[horario_SANTACRUZ_unique$mas60 == 1] <- "abrir 3 paralelos en este horario"


#Base Final

horario_SANTACRUZ_unique <- horario_SANTACRUZ_unique %>%  dplyr::select(marca, sede, modalidad, cuatrimestre,
                                                                        horario, materia, Asistencia, recomendacion)


horario_split <- as.data.frame(str_split_fixed(horario_SANTACRUZ_unique$horario, " ", 2))
names(horario_split)[1] <- "dia"
names(horario_split)[2] <- "hora"

horario_SANTACRUZ_unique <- cbind(horario_SANTACRUZ_unique, horario_split)
names(horario_SANTACRUZ_unique)

horario_SANTACRUZ_unique$recom_d <- 0
horario_SANTACRUZ_unique$recom_d[horario_SANTACRUZ_unique$recomendacion == "unir horario" | horario_SANTACRUZ_unique$recomendacion == "cerrar horario"] <- 0
horario_SANTACRUZ_unique$recom_d[horario_SANTACRUZ_unique$recomendacion == "ofertar e intentar consolidar en 1 horario" | 
                                   horario_SANTACRUZ_unique$recomendacion == "abrir unicamente en ese horario" ] <- 1
horario_SANTACRUZ_unique$recom_d[horario_SANTACRUZ_unique$recomendacion == "abrir 2 paralelos en este horario"] <- 2
horario_SANTACRUZ_unique$recom_d[horario_SANTACRUZ_unique$recomendacion == "abrir 3 paralelos en este horario"] <- 3

horario_SANTACRUZ_unique <- horario_SANTACRUZ_unique %>% dplyr::select(marca, sede, modalidad, cuatrimestre, dia, hora, materia, Asistencia, recomendacion, recom_d)

write_xlsx(horario_SANTACRUZ_unique,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/recom_SANTACRUZ_latina_pand_C2.xlsx")



###### Comparativo de cursos ofertados para usarlo contra la tabla dinamica SANTACRUZ ######

horario_split_2 <- as.data.frame(str_split_fixed(SANTACRUZ$HORARIO, " ", 2))
names(horario_split_2)[1] <- "dia"
names(horario_split_2)[2] <- "hora"

SANTACRUZ <- cbind(SANTACRUZ, horario_split_2)
names(SANTACRUZ)

SANTACRUZ$paralelo <- paste0(SANTACRUZ$AULA, "-", SANTACRUZ$HORARIO)


write_xlsx(SANTACRUZ,"COORDINACION DE PROYECTOS/CurriculumPers/ULATINA/s_SANTACRUZ/SANTACRUZ_mock.xlsx")


pt <- PivotTable$new()
pt$addData(SANTACRUZ)
pt$addColumnDataGroups("dia")
pt$addRowDataGroups("hora")
pt$defineCalculation(calculationName="paralelos", summariseExpression="paralelo")
pt$renderPivot()




end_time <- Sys.time()

time <- round(end_time-start_time,0)

